/*
 RequireJS text 0.27.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/*
 Copyright 2011-2013 Abdulla Abdurakhmanov
 Original sources are available at https://code.google.com/p/x2js/

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 */

function X2JS(e){function n(){e.escapeMode===undefined&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",e.enableToStringFunc===undefined&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],e.skipEmptyTextNodesForObj===undefined&&(e.skipEmptyTextNodesForObj=!0),e.stripWhitespaces===undefined&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[]}function i(){function e(e){var t=String(e);return t.length===1&&(t="0"+t),t}typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),typeof Date.prototype.toISOString!="function"&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}function s(e){var t=e.localName;t==null&&(t=e.baseName);if(t==null||t=="")t=e.nodeName;return t}function o(e){return e.prefix}function u(e){return typeof e=="string"?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):e}function a(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function f(t,n,r){switch(e.arrayAccessForm){case"property":t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]}if(!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0){var i=0;for(;i<e.arrayAccessFormPaths.length;i++){var s=e.arrayAccessFormPaths[i];if(typeof s=="string"){if(s==r)break}else if(s instanceof RegExp){if(s.test(r))break}else if(typeof s=="function"&&s(t,n,r))break}i!=e.arrayAccessFormPaths.length&&(t[n]=[t[n]])}}function l(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]);if(t[6]&&t[7]){var i=t[6]*60+Number(t[7]),s=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";i=0+(s=="-"?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else e.indexOf("Z",e.length-1)!==-1&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function c(t,n,r){if(e.datetimeAccessFormPaths.length>0){var i=r.split(".#")[0],s=0;for(;s<e.datetimeAccessFormPaths.length;s++){var o=e.datetimeAccessFormPaths[s];if(typeof o=="string"){if(o==i)break}else if(o instanceof RegExp){if(o.test(i))break}else if(typeof o=="function"&&o(obj,n,i))break}return s!=e.datetimeAccessFormPaths.length?l(t):t}return t}function h(t,n){if(t.nodeType==r.DOCUMENT_NODE){var i=new Object,u=t.childNodes;for(var l=0;l<u.length;l++){var p=u.item(l);if(p.nodeType==r.ELEMENT_NODE){var d=s(p);i[d]=h(p,d)}}return i}if(t.nodeType==r.ELEMENT_NODE){var i=new Object;i.__cnt=0;var u=t.childNodes;for(var l=0;l<u.length;l++){var p=u.item(l),d=s(p);p.nodeType!=r.COMMENT_NODE&&(i.__cnt++,i[d]==null?(i[d]=h(p,n+"."+d),f(i,d,n+"."+d)):(i[d]!=null&&(i[d]instanceof Array||(i[d]=[i[d]],f(i,d,n+"."+d))),i[d][i[d].length]=h(p,n+"."+d)))}for(var v=0;v<t.attributes.length;v++){var m=t.attributes.item(v);i.__cnt++,i[e.attributePrefix+m.name]=m.value}var g=o(t);return g!=null&&g!=""&&(i.__cnt++,i.__prefix=g),i["#text"]!=null&&(i.__text=i["#text"],i.__text instanceof Array&&(i.__text=i.__text.join("\n")),e.escapeMode&&(i.__text=a(i.__text)),e.stripWhitespaces&&(i.__text=i.__text.trim()),delete i["#text"],e.arrayAccessForm=="property"&&delete i["#text_asArray"],i.__text=c(i.__text,d,n+"."+d)),i["#cdata-section"]!=null&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],e.arrayAccessForm=="property"&&delete i["#cdata-section_asArray"]),i.__cnt==1&&i.__text!=null?i=i.__text:i.__cnt==0&&e.emptyNodeForm=="text"?i="":i.__cnt>1&&i.__text!=null&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&i.__text==""||i.__text.trim()=="")&&delete i.__text,delete i.__cnt,e.enableToStringFunc&&(i.__text!=null||i.__cdata!=null)&&(i.toString=function(){return(this.__text!=null?this.__text:"")+(this.__cdata!=null?this.__cdata:"")}),i}if(t.nodeType==r.TEXT_NODE||t.nodeType==r.CDATA_SECTION_NODE)return t.nodeValue}function p(t,n,r,i){var s="<"+(t!=null&&t.__prefix!=null?t.__prefix+":":"")+n;if(r!=null)for(var o=0;o<r.length;o++){var a=r[o],f=t[a];e.escapeMode&&(f=u(f)),s+=" "+a.substr(e.attributePrefix.length)+"='"+f+"'"}return i?s+="/>":s+=">",s}function d(e,t){return"</"+(e.__prefix!=null?e.__prefix+":":"")+t+">"}function v(e,t){return e.indexOf(t,e.length-t.length)!==-1}function m(t,n){return e.arrayAccessForm=="property"&&v(n.toString(),"_asArray")||n.toString().indexOf(e.attributePrefix)==0||n.toString().indexOf("__")==0||t[n]instanceof Function?!0:!1}function g(e){var t=0;if(e instanceof Object)for(var n in e){if(m(e,n))continue;t++}return t}function y(t){var n=[];if(t instanceof Object)for(var r in t)r.toString().indexOf("__")==-1&&r.toString().indexOf(e.attributePrefix)==0&&n.push(r);return n}function b(t){var n="";return t.__cdata!=null&&(n+="<![CDATA["+t.__cdata+"]]>"),t.__text!=null&&(e.escapeMode?n+=u(t.__text):n+=t.__text),n}function w(t){var n="";return t instanceof Object?n+=b(t):t!=null&&(e.escapeMode?n+=u(t):n+=t),n}function E(e,t,n){var r="";if(e.length==0)r+=p(e,t,n,!0);else for(var i=0;i<e.length;i++)r+=p(e[i],t,y(e[i]),!1),r+=S(e[i]),r+=d(e[i],t);return r}function S(e){var t="",n=g(e);if(n>0)for(var r in e){if(m(e,r))continue;var i=e[r],s=y(i);if(i==null||i==undefined)t+=p(i,r,s,!0);else if(i instanceof Object)if(i instanceof Array)t+=E(i,r,s);else if(i instanceof Date)t+=p(i,r,s,!1),t+=i.toISOString(),t+=d(i,r);else{var o=g(i);o>0||i.__text!=null||i.__cdata!=null?(t+=p(i,r,s,!1),t+=S(i),t+=d(i,r)):t+=p(i,r,s,!0)}else t+=p(i,r,s,!1),t+=w(i),t+=d(i,r)}return t+=w(e),t}var t="1.1.4";e=e||{},n(),i();var r={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){if(e===undefined)return null;var t;if(window.DOMParser){var n=new window.DOMParser,r=n.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI;t=n.parseFromString(e,"text/xml"),t.getElementsByTagNameNS(r,"parsererror").length>0&&(t=null)}else e.indexOf("<?")==0&&(e=e.substr(e.indexOf("?>")+2)),t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},this.asArray=function(e){return e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():typeof e=="number"?(new Date(e)).toISOString():null},this.asDateTime=function(e){return typeof e=="string"?l(e):e},this.xml2json=function(e){return h(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return t!=null?this.xml2json(t):null},this.json2xml_str=function(e){return S(e)},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return t}}require.config({paths:{templateBasePath:"com/es/Default_Templates"},theme:"default",resourceBundle:"default",assessmentConfig:{is_trackable:!1,single_ques_quiz:!1,is_persistable:!1},glossaryConfig:{lineCount:2},allowBookTheme:!1,fitToWidth:!0,readerCss:["com/external/videojs/video-js.css","css/widget_global.css","css/widget_color.css","css/widgets_fonts.css","css/widgets_glossary.css","css/widget.css","css/widgets_slidernav.css","com/external/galleria/galleria.classic.css","themes/jbl/css/widgets_theme.css"],iframeCss:["css/widget_global.css","css/widget_color.css","css/widgets_iFrameWidget.css","com/external/videojs/video-js.css","themes/jbl/css/widgets_iframeTheme.css"],iframeCss_android4:["widgets_iframeTheme-4.2.2","widgets_theme-4.2.2"]}),define("main-config",function(){}),define("com/es/widgets/WidgetConstants",[],function(){return window.WIDGET_CONSTANTS||(window.WIDGET_CONSTANTS={VERSION:"1.0.56.7",GALLERY_WIDGET:"gallery",IMAGE_WIDGET:"image",VIDEO_WIDGET:"video",AUDIO_WIDGET:"audio",TIP_WIDGET:"tip",HTML_WIDGET:"HTML",FILE_WIDGET:"file",ASSESSMENT_WIDGET:"assessment",LEARNOSITY_WIDGET:"learnosity",LEARNOSITY_SERVICE_BASE_URL:"",LEARNOSITY_ACCESS_TOKEN:"",LEARNOSITY_STANDALONE:!1,HODDERASSESS_WIDGET:"HDLAssess",HDLREPORTS_WIDGET:"HDLReports",EOW_WIDGET:"eow",EOW_SERVICE_BASE_URL:"",EOW_LDL_SERVER:"",EOW_LDL_SERVICE_URL:"",EOW_GROUPS:"",EOW_STANDALONE:!1,EOW_RDR_HTML_PATH:"",EOW_CLOSE_ETA_POPUP:"closeETAPopup",SEEK:5,DATA_MODE_TRANSPARENT:"transparent",DATA_MODE_OPAQUE:"opaque",DATA_MODE_INLINE:"inline",DATA_MODE_COMPACT:"compact",DATA_MODE_POSTER:"poster",DATA_BORDER_SHOW:"show",DATA_BORDER_HIDDEN:"hidden",DATA_HASVIEW_YES:"yes",DATA_HASVIEW_NO:"no",DATA_BORDER_YES:"yes",DATA_BORDER_NO:"no",DATA_BORDER_TRUE:"true",DATA_BORDER_FALSE:"false",DATA_LAYOUT_REFLOW:"reflow",DATA_LAYOUT_FIXED:"fixed",MIN_WIDTH:150,MIN_HEIGHT:150,AUDIO_MIN_WIDTH:254,AUDIO_MIN_HEIGHT:202,AUDIO_MAX_WIDTH:300,VIDEO_MIN_WIDTH:300,VIDEO_MIN_HEIGHT:200,IMAGE_MIN_WIDTH:250,IMAGE_MIN_HEIGHT:250,TIP_MIN_WIDTH:300,TIP_MIN_HEIGHT:95,HTML_MIN_WIDTH:300,HTML_MIN_HEIGHT:95,TP_MIN_WIDTH:300,TP_MIN_HEIGHT:95,FILE_MIN_WIDTH:300,FILE_MIN_HEIGHT:95,IMAGE_GAL_MIN_WIDTH:250,IMAGE_GAL_MIN_HEIGHT:250,ASSESSMENT_MIN_WIDTH:300,ASSESSMENT_MIN_HEIGHT:200,ASSETS_URL:"",DOWNLOADED_ASSETS_URL:"",DOWNLOAD_SUPPORTED:!1,CONTENT_BASE_URL:"",DESCRIPTION_EXPAND:"More",DESCRIPTION_COLLAPSE:"Less",LOCALE_COOKIE_NAME:"myAppLocaleCookie",NETWORK_AVAILABLE:!0,USER_ID:"",USER_NAME:"",USER_ROLE:"",BOOK_ID:"",BOOK_ISBN_NO:"",BOOK_TITLE:"",BOOK_TYPE:"",APPLICATION_TYPE:"Reader",LOCALE:"",USER_LOGIN_TIME:"",USER_LOGIN_TYPE:"",EDITOR_LABEL:"Editor",HODDERASSESS_BASE_URL:"http://10.12.65.70:8080/pubportal/QA/",HODDERASSESS_HTML_LAUNCH_URL:"testingPage.html",ACCESS_TOKEN:"",CLOSE_WIDGET_POPUP:"closeWidgetPopup",HDL_ASSESS_PROPERTIES:null,HDL_REPORTS_PROPERTIES:null,HDL_WIDGET_CODE_BASE_PATH:"com/external/Widget_HodderCodeBase/Hodder_HTML5_Assessment/www/index.html",HDL_REPORT_WIDGET_CODE_BASE_PATH:"com/external/Widget_HodderCodeBase/Hodder_HTML5_Assessment//www/reportCard.html",HOME_PAGE_URL:"",PRINT_MODE:!1,THIRD_PARTY_PATH:{saras:"com/external/saras/index.html"}}),window.WIDGET_CONSTANTS}),define("com/es/utilities/AppConst",[],function(){var e={USER_ID:"",USER_NAME:"",USER_ROLE:"",USER_LOGIN_TIME:"",PAGE_ID:"",BOOK_ID:"",BOOK_TITLE:"",BOOK_TYPE:"",HOME_PAGE_URL:"",SERVICE_BASE_URL:"",contentBaseUrl:"",CONTENT_BASE_URL:"",ROOT_URL:"",PAGE_NAME:"",DEVICE_PIXEL_RATIO:"",WIDGET_HTTP_BASE_PATH:"",BOOK_BASE_URL:"",KEY_IDENTIFIER:"",FONT_MANAGER:"",TOC_DATA_BASE_URL:"",USER_SERVICE_SUB_URL:"/user/profile/",LOGOUT_SERVICE_SUB_URL:"logout.excel",BOOK_ISBN_NO:"",ALLOW_SAMPLE_BOOK_DEFINITION:!1,EOW_LDL_SERVER:"http://ldluat.ldldev.co.uk/",EOW_LDL_SERVICE_URL:"http://ldluat.ldldev.co.uk/authoriseWidget.php",EOW_RDR_HTML_PATH:"http://localhost:8080/pubportal/QA"};window.AppConst=e}),define("com/es/utilities/AppEvent",[],function(){var e={CLICK:"click",CHANGE:"change",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",TIME_UPDATE:"timeupdate",ASSET_SELECTED:"onAssetSelected",ASSETPOPUP_CANCEL_CLICKED:"onAssetpopUpCancelClick",CONFIG_UPDATED:"onConfigUpdated",CONTEXTMENU_ITEM_SELECTED:"onContextMenuItemClick",SHOW_CONTEXTMENU_CLICKED:"onShowContextMenuClick",SAVE_CONTENT:"onSavePageInitiated",ON_MODE_SELECT:"onModeSelected",TOC_ITEM_SELECT:"onTocItemSelected",TOC_ITEM_CLICK:"onTocItemClick",EDIT_TOC_CLICK:"onEditTocClick",DONE_TOC_CLICK:"onDoneTocClick",TOC_TREE_ITEM_RENAMED:"onTOCTreeItemRenamed",WIDGET_ADDED:"onWidgetAdd",DIRTY_STATE_CHANGED:"onDirtyStateChanged",EDIT_LINK_CLICKED:"onEditLinkClick",SHOW_GLOSSARY:"showGlossary",OPTION_ADDED:"optionAdded",FIB_ANSWER_ADDED:"onFibActivityAppend",ADD_ASSET:"onAssetAdd",DONE_LINK_POPUP_CLICK:"onDoneLinkPopupClick",TOC_EDITABLE_NODE_CLICKED:"onTOCTreeEditableItemClick",TOC_EDITABLE_NODE_BLURRED:"onTOCTreeEditableItemBlur",TOC_RENDER_COMPLETE:"onTOCRenderComplete",REPORTING_READY:"reporting_ready",EDITOR_READY:"qa_editor_ready",RENDERER_READY:"qa_renderer_ready",QUESTION_CREATED:"question_created",GLOSSARY_EDITOR_READY:"glossary_editor_ready",TOCEDITOR_READY:"toc_editor_ready",QUIZ_CREATOR_READY:"quiz_creator_ready",INPUT_PROPERTY_CHANGE:"input propertychange"};window.AppEvent=e}),define("com/es/widgets/WidgetUtils",[],function(){var e=new Object;return e.log=function(e){},e.isTouchDevice=function(){var e=String(document.documentElement.ontouchmove)!="undefined"?!0:!1;return e},e.isPhone=function(){return window.innerWidth<768?!0:!1},e.isiPhoneOriPod=function(){var e=navigator.userAgent,t=e.match(/iPhone/i),n=e.match(/iPod/i);return t||n?!0:!1},e.fillRange=function(e,t){var n=$(e).parent().css("color"),r=$(e).css("color");t*=100;var i="background: -webkit-linear-gradient(left, "+n+" 0%, "+n+" "+t+"%, "+r+" "+t+"%, "+r+" 100%);";i+="background: -moz-linear-gradient(left, "+n+" 0%, "+n+" "+t+"%, "+r+" "+t+"%, "+r+" 100%);",i+="background: -o-linear-gradient(left, "+n+" 0%, "+n+" "+t+"%, "+r+" "+t+"%, "+r+" 100%);";var s=$(e).attr("style"),o=s?s+" "+i:i;$(e).attr("style",o)},e.isIE=function(){if(navigator.userAgent.indexOf("MSIE")!=-1)var e=/MSIE (\d+\.\d+);/;else var e=/Trident.*rv[ :]*(\d+\.\d+)/;var t=e.test(navigator.userAgent);return t},e.getIEVersion=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=0;return t>0&&(n=parseInt(e.substring(t+5,e.indexOf(".",t)))),n},e.isAndriod=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android")>-1;return t},e.isIOS=function(){var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;return e},e.getAndroidVersion=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android"),n=0;return t!=-1&&(n=parseFloat(e.match(/android\s+([\d\.]+)/)[1])),n},e.parseHTML=function(e,t,n){if($.parseHTML)return $.parseHTML(e);if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,i=r.exec(e),s=!n&&[];return i?[t.createElement(i[1])]:(i=$.buildFragment([e],t,s),s&&$(s).remove(),$.merge([],i.fragment.childNodes))},e.setCookie=function(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="; expires="+r.toGMTString()}else var i="";document.cookie=e+"="+t+i+"; path=/"},e.getCookie=function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null},e.delCookie=function(t){e.setCookie(t,"",-1)},e.setLangCode=function(t,n){var r="en",i,s,o,u,a,f,l=String(document.documentElement.ontouchmove)!="undefined"?!0:!1;l?i=localStorage.getItem(WIDGET_CONSTANTS.LOCALE_COOKIE_NAME):i=e.getCookie(WIDGET_CONSTANTS.LOCALE_COOKIE_NAME),s=i&&i.toString().length>0?i:r,f=require.s.contexts._.config.resourceBundle?require.s.contexts._.config.resourceBundle:"default",o=s?require.toUrl("./resourceBundle/"+f+"/Strings/Strings_"+s+"/"+n):"",s!=="en"&&(u=require.toUrl("./resourceBundle/"+f+"/Strings/Strings_"+r+"/"+n)),a=function(e){window[t]=e,t==="AppLang"&&(window[t].VERSION+=WIDGET_CONSTANTS.VERSION)},$.ajax({async:!1,url:o,dataType:"json"}).done(function(e,t,n){a(e),WIDGET_CONSTANTS.LOCALE=s}).fail(function(e,t){console.error("Failed to load url: "+o+" with message: "+t),t==="error"&&u&&$.ajax({async:!1,url:u,dataType:"json"}).done(function(e,t,n){a(e),WIDGET_CONSTANTS.LOCALE=r}).fail(function(e,t){console.error("Failed to load url: "+u+" with message: "+t)})})},e.getOffset=function(e){return{left:e.get(0).offsetLeft,top:e.get(0).offsetTop}},e.getCleanURL=function(e){var t;return e.indexOf("file:///")>=0?(t=e.substr(e.indexOf("file:///")+8),t=t.replace(/([^:]\/)\/+/g,"$1"),t="file:///"+t):t=e.replace(/([^:]\/)\/+/g,"$1"),t},e.showLoader=function(){$("#loading-indicator").modal({show:!0,keyboard:!1,backdrop:"static"}),$(".modal-backdrop").last().css("z-index","9000")},e.hideLoader=function(){$("#loading-indicator").modal("hide")},e.sortObjByKey=function(e){var t=e,n=[],r,i,s,o={};for(r in t)t.hasOwnProperty(r)&&n.push(r);n.sort(),s=n.length;for(i=0;i<s;i++)r=n[i],o[r]=t[r];return o},e.injectCSSFile=function(t){var n=document.getElementsByTagName("head")[0],r=require.s.contexts._.config.readerCss;for(i=0;i<r.length;i++){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href="widgets/"+r[i],n.appendChild(s)}iframeHeadTag=t.document.getElementsByTagName("head")[0];var o=window.location.origin,u=window.location.pathname.split("/");u.pop();var a=u.join("/")+"/widgets/",f=require.s.contexts._.config.iframeCss;for(i=0;i<f.length;i++){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=o+a+"/"+f[i],iframeHeadTag.appendChild(s)}if(parseFloat(e.getAndroidVersion())<4.4&&e.isAndriod()){var l=require.s.contexts._.config.iframeCss_android4;for(i=0;i<l.length;i++){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=o+a+"/"+l[i],iframeHeadTag.appendChild(s)}}},e.getSvcParams=function(e){var t={};return e.data&&(t.data=e.data),e.type&&(t.type=e.type),e.url&&(t.url=e.url),e.contentType&&(t.contentType=e.contentType),e.success&&(t.success=e.success),e.error&&(t.error=e.error),e.context&&(t.context=e.context),e.crossDomain&&(t.crossDomain=e.crossDomain),e.headers&&(t.headers=e.headers),e.mimeType&&(t.mimeType=e.mimeType),e.statusCode&&(t.statusCode=e.statusCode),t},e.getWidgetProperties=function(e){var t=window.location.pathname.split("/")[1],n=window.location.origin+"/"+t+"/pubservice/";$.get(n+"/widget/props.excel?type="+e.type,function(e,t){}).done(function(t){console.log("second success",t),e.successCallback(t)}).fail(function(){console.log("error")})},e}),define("com/es/utilities/AppLang",["com/es/widgets/WidgetUtils"],function(e){var t={langGlobalObj:"AppLang",fileName:"editorStrings.json"};return e.setLangCode(t.langGlobalObj,t.fileName),!1}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("com/es/text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"0.27.0",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&i.inlineText&&(u[e]=n),r(n)},load:function(e,t,n,u){var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("com/es/text!templateBasePath/Editor/author/tocView/baseTemplate.html",[],function(){return'<div id="exp-col-wrapper" class=" exp-col-wrapper">\n		<span class=" expand-all"><%=AppLang.EXPAND_ALL_LABEL%></span>\n		<span class="">/</span>\n		<span class="colLapse-all"><%=AppLang.COLLAPSE_ALL_LABEL%></span>\n		<button type="button" id ="tocModeSaveBtn" class="btn tocModeSaveBtn disable" ><%=AppLang.SAVE_LABEL%></button>\n</div>\n<div class="toc-section">\n<ul class="header toc-header">\n    <li class="header-desc col-3x"><%=AppLang.TABLE_OF_CONTENTS%></li>\n    <li class="header-desc col-x"><%=AppLang.ADD_TO_SAMPLE_BOOK%></li>\n</ul>\n<nav id="tocContainerContent" class="toc-container toc-module" role="navigation" style="height: auto;">\n	<div id="editableTocWrapper" class="editableTocWrapper">\n		<ul id="editableTocContainer" class="editableTocContainer ui-sortable">\n		</ul>\n	</div>\n</nav>\n</div>'}),define("com/es/text!templateBasePath/Editor/author/tocView/tocModEditorContextMenuTemplate.html",[],function(){return'<div class="modal fade contextMenu">\n<div class="modal-dialog contextMenu-dialog">\n    <div class="modal-content contextMenu-content">\n      <div class="modal-body">\n        <ul class="contextMenuUL" role="menu">\n	          <li role="menuitem" id="link" class="link"><%=AppLang.LINK_LABEL%></li>\n	   		  <li role="menuitem" id="insert-after" class="insert-after"><%=AppLang.INSERT_AFTER_LABEL%></li>\n	          <li role="menuitem" id="insert-before" class="insert-before"><%=AppLang.INSERT_BEFORE_LABEL%></li>\n	          <li role="menuitem" id="insert-child" class="insert-child"><%=AppLang.INSERT_CHILD_LABEL%></li>\n	   		  <li role="menuitem" id="rename" class="rename"><%=AppLang.RENAME_LABEL%></li>\n	          <li role="menuitem" id="delete" class="delete"><%=AppLang.DELETE_LABEL%></li>\n	        </ul>\n      </div>\n    </div>\n  </div>\n</div>'}),define("com/es/utilities/services",["com/es/utilities/utils"],function(e){var t=new Object;return t.getBookMetadata=function(e){var t=e.model,n=e.successCallback,r=e.errorCallback;bookId=e.id,t.url=AppConst.SERVICE_BASE_URL+"book/"+bookId+"/details",t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.tocData=function(e){e.tocCollection.url=e.id+"/TOCData.json",e.tocCollection.fetch({success:function(t){e.successCallback(t)},error:function(t){e.errorCallback(t)}})},t.getAssetList=function(t){var n;t.assetListCollection.url=t.url,n={type:t.type,term:t.term,sortedby:t.sortedby,pageSize:t.pageSize,pageIndex:t.pageIndex},e.log("popupparams",t),t.assetListCollection.fetch({type:"POST",data:n,success:function(e){t.successCallback(e)},error:function(e){t.errorCallback(e)}})},t.getSelectedAssetData=function(e){var t="epub_content/assets/"+e.path;$.getJSON(t,{}).done(function(t){e.successCallback(t)}).fail(function(t,n,r){e.errorCallback(r)})},t.saveAndPublish=function(e){var t=unescape(AppConst.PAGE_NAME).split("#")[0],n={data:encodeURIComponent(e.data),page:t,enrichment:encodeURIComponent(e.enrichment),quiz:encodeURIComponent(e.quiz)};$.ajax({type:"POST",url:AppConst.SERVICE_BASE_URL+"book/"+AppConst.BOOK_ID+"/save",data:n,success:function(t){e.successCallback(e.callback,e.status)},error:function(t,n,r){e.errorCallback(n)}})},t.getUserInfo=function(e){var t=e.model,n=e.successCallback,r=e.errorCallback;t.url=AppConst.SERVICE_BASE_URL+AppConst.USER_SERVICE_SUB_URL+e.id,t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.getLinkList=function(e){var t=e.linkCollection,n=e.successCallback,r=e.errorCallback;t.url="epub_content/assetLists/linkList.json",t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.getGlossaryData=function(e){var t=e.glossaryCollection,n=e.successCallback,r=e.errorCallback;t.url="epub_content/glossary.json",t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.getOPFData=function(e){$.ajax({type:"GET",url:e.baseUrl,dataType:"xml",success:function(t){var n=new X2JS,r=n.xml2json(t),i=r.package;e.successCallback(i)},error:function(t){e.errorCallback(t)}})},t.getSpineData=function(e){$.ajax({type:"GET",url:e.baseUrl,dataType:"xml",success:function(t){var n=new X2JS,r=n.xml2json(t),i=r.package.manifest.item;e.successCallback(i)},error:function(t){e.errorCallback(t)}})},t.unlockBook=function(e){$.ajax({type:"GET",url:AppConst.SERVICE_BASE_URL+"book/unlock/"+AppConst.BOOK_ID+"?userId="+e.userID,success:function(t){e.successCallback(t)},error:function(t,n,r){e.failureCallback(n)}})},t.saveTOCData=function(e){var t=JSON.stringify(e.data),n={data:t,isSampleBookDefined:e.isSampleBookDefined};$.ajax({type:"POST",url:AppConst.SERVICE_BASE_URL+"book/"+AppConst.BOOK_ID+"/toc",data:n,success:function(t){e.success()},error:function(t,n,r){console.log("error in saving updated toc data"),e.error()}})},t.redirectLibrary=function(n){if(n){var r={userID:AppConst.USER_ID,successCallback:function(t){var n=jQuery.parseJSON(t);if(n.status=="true"){var r=window.location.href,i;i=r.substring(0,r.indexOf("/QA/")+1),i+="bookdefault.excel",window.location.href=i}else e.showToasterMessage(AppLang.UNABLE_TO_UNLOCK_FILE_FOR_USER_MESSAGE+AppConst.USER_ID,2e3,function(){var e=window.location.href,t;t=e.substring(0,e.indexOf("/QA/")+1),t+="bookdefault.excel",window.location.href=t})},failureCallback:function(e){console.log("Error occured: ",e)}};t.unlockBook(r)}else{var i=window.location.href,s;s=i.substring(0,i.indexOf("/QA/")+1),s+="bookdefault.excel",window.location.href=s}},t.redirectLogout=function(){var e=window.location.href,t;t=e.substring(0,e.indexOf("/QA/")+1),window.location.href=t+AppConst.LOGOUT_SERVICE_SUB_URL},t.fetchGlossaryData=function(e){e.glossaryCollection.url="/pubportal/QA/com/es/data/glossary.json",e.glossaryCollection.fetch({success:function(t){e.successCallback(t)},error:function(t){e.errorCallback(t)}})},t.fetchQuestionData=function(e){$.ajax({type:"GET",url:e.url,success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}})},t.fetchLrnActivity=function(e){var t={type:"GET",url:e.url,success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}};WIDGET_CONSTANTS.APPLICATION_TYPE==="Reader"&&(t.headers={userId:WIDGET_CONSTANTS.USER_ID}),$.ajax(t)},t.fetchLrnSignature=function(e){var t={security:e.data.securityObj,request:e.data.requestObj},n=null,r;t=JSON.stringify(t),WIDGET_CONSTANTS.APPLICATION_TYPE==="Editor"?n="application/json":n="text/plain",r={type:"POST",data:t,url:e.url,contentType:n,success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}},WIDGET_CONSTANTS.APPLICATION_TYPE==="Reader"&&(r.headers={userId:WIDGET_CONSTANTS.USER_ID}),$.ajax(r)},t.fetchEowData=function(e){var t={type:"POST",data:JSON.stringify(e.data),url:e.url,contentType:"application/json",success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}};$.ajax(t)},t}),define("com/es/text!templateBasePath/Editor/popups/confirmationPopupTemplate.html",[],function(){return'\r\n	<div class="confirmPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n				<div class="title modal-title"><%=AppLang.CONFIRMATION_POPUP_TITLE%></div>\r\n			</div>		\r\n			\r\n			<div class="modal-body message">\r\n				<%=AppLang.CONFIMATION_MESSAGE%>\r\n			</div>\r\n			\r\n			<div class="bottomBar modal-footer">\r\n				<div>\r\n					<button type="button" id="yes" class=" btn btn-default" ><%=AppLang.CONFIRMATION_POPUP_YES%></button>\r\n					<button type="button" id="no" class=" btn btn-primary" ><%=AppLang.CONFIRMATION_POPUP_NO%></button>\r\n	       			<button type="button" id="cancel" class=" btn btn-primary" ><%=AppLang.CONFIRMATION_POPUP_CANCEL%></button>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n'}),define("com/es/utilities/utils",["com/es/utilities/services","com/es/text!templateBasePath/Editor/popups/confirmationPopupTemplate.html","com/es/widgets/WidgetUtils"],function(e,t,n){var r=new Object;return r.DEFAULT_TOASTER_DURATION=1e3,r.log=function(e){},r.rewriteProperty=function(e,t,n){if(typeof e!="object")return e;for(var r in e)e.hasOwnProperty(r)&&(e[r.replace(t,n)]=this.rewriteProperty(e[r],t,n),r.indexOf(t)>-1&&delete e[r]);return e},r.showLoader=function(){$("#loading-indicator").modal({show:!0,keyboard:!1,backdrop:"static"}),$(".modal-backdrop").last().css("z-index","9000")},r.hideLoader=function(){$("#loading-indicator").modal("hide")},r.showAlert=function(e){if(!e)return!1;var t=e.toLowerCase().toString(),n=$("#js-alert"),r=$(".alert-text",n);r.html(t),n.modal({show:!0,keyboard:!1,backdrop:"static"}),n.on("hidden.bs.modal",function(e){r&&r.html(""),$(this).off("hidden.bs.modal")})},r.hideAlert=function(){},r.showToasterMessage=function(e,t,n,i){if(t==undefined||t==null||t=="")t=r.DEFAULT_TOASTER_DURATION;$("#toastMsg").text(e);var s=$(window).height()/2-$("#toastContainer").outerHeight()/2;$("#toastContainer").css({top:s,margin:"auto"}),$(".popUpContainer").addClass("onshow"),$("#toastContainer").modal("show"),r.myTimer=setTimeout(r.hideToasterMessage.bind(r,n,i),t)},r.hideToasterMessage=function(e,t){clearTimeout(r.myTimer),$("#toastContainer").modal("hide"),$(".popUpContainer").removeClass("onshow"),e!=undefined&&e!=null&&e(t)},r.showConfirmPopUp=function(e,n,r,i){var s=$("#confirmPopupCover"),o=_.template(t,{});$("#confirmPopupCover").attr("tabindex","-1"),s.html("").append(o),r!=undefined&&r!=undefined&&r!=undefined&&_.each(r,function(e){s.find("#"+e).remove()}),$(".title",s).html(n),$(".message",s).html(e),$(".bottomBar",s).find(".btn").unbind().bind(AppEvent.CLICK,function(e){s.modal("hide"),i(e.target.id)}),s.off("hidden.bs.modal").on("hidden.bs.modal",function(){$(".bottomBar",s).find(".btn").unbind(),s.html(""),$("body").css("overflow","auto")}),$("body").css("overflow","hidden"),s.modal("show")},r.loadJsCssFile=function(e,t,n,r){var i,s;s=e.get(0).contentWindow,r=="js"?(i=s.document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",t+"/"+n+".js")):r=="css"&&(i=s.document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",t+"/"+n+".css")),typeof i!="undefined"&&s.document.getElementsByTagName("head")[0].appendChild(i)},r.checkAddJsCssFile=function(e,t,n,i){var s,o,u,a,f,l=!1;o=e.get(0).contentWindow,i=="js"?s=t+"/"+n+".js":i=="css"&&(s=t+"/"+n+".css"),u=i=="js"?"script":i=="css"?"link":"none",a=i=="js"?"src":i=="css"?"href":"none",f=o.document.getElementsByTagName(u),l||r.loadJsCssFile(e,t,n,i)},r.getIframePageHtml=function(){var e=["jquery-ui.css","widgets.css","widgets_iFrameWidgetEditor.css","widgets_iFrameWidget.css","widget_color.css","widget_global.css","iframeTheme"],t=document.getElementById("authoringIframe"),n=t.contentWindow.document.documentElement,i=$("body",$(t).contents()).width(),s=jQuery(n).clone(),o=r.removeExtraContent(e,s,i),u='<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html>'+o.prop("outerHTML");return u},r.removeCssFile=function(e,t){return _.each(e,function(e){$('link[href*="'+e+'"]',t).remove()}),t},r.removeExtraContent=function(e,t,n){var i=$("#authoringIframe").contents(),s=["block"];$("#tinyhippos-injected",t).remove(),$("body",t).removeAttr("contenteditable"),$("body",t).removeAttr("dropzone"),$(".widget-ui",t).remove();var o=$(".widget-placeholder",t);o.find(".dummyWidget").remove(),o.find(".ui-resizable-handle").remove(),o.find(".move-icon").remove(),o.removeAttr("draggable"),o.removeAttr("contenteditable"),o.removeClass("ui-resizable"),o.removeClass("widgetFrame");var u=o.length;if(AppConst.BOOK_TYPE=="reflowable"){o.css("height","");for(var a=0;a<u;a++){var f=$(o[a]),l=$("div[id='"+f.get(0).id+"']",i),c=l.parent(),h=0;while(c.css("display").toLowerCase()=="inline")h++,c=c.parent();var p=c.width(),d=l.width();f.data("align")=="fitToWidth"&&(f.data("type")=="image"||f.data("type")=="imageGal"||f.data("type")=="video"||f.data("type")=="assessment"&&f.data("mode")=="poster")?(d=$("#ui-"+f.get(0).id+" img",i).width()/$("#"+f.get(0).id,i).width()*100+"%",f.attr("data-width",d),f.css("height",f.data("height"))):d=d/p*100+"%",f.css("width",d)}}else for(var a=0;a<u;a++){var f=$(o[a]);if(f.data("mode")=="compact"&&f.data("border")){var d=$("#div-border-ui-"+f.attr("id"),$("#authoringIframe").contents()).width(),v=$("#div-border-ui-"+f.attr("id"),$("#authoringIframe").contents()).height();$("#div-border-ui-"+f.attr("id"),t).remove(),f.css("width",d),f.css("height",v)}}var m=r.removeCssFile(e,t);return m},r.getDateFormat=function(e){var t=new Date(e),n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],i=n[t.getDay()],s=r[t.getMonth()],o=i+", "+s+" "+t.getDate()+", "+t.getFullYear();return o},r.clone=function(e){if(Object.prototype.toString.call(e)==="[object Array]"){var t=[],n=0,r=e.length;for(;n<r;n++)t[n]=arguments.callee(e[n]);return t}if(typeof e=="object"){var t={},n;for(n in e)t[n]=arguments.callee(e[n]);return t}return e},r.isTouchDevice=function(){var e=String(document.documentElement.ontouchmove)!="undefined"?!0:!1;return e},r.string2Bin=function(e){var t=[];for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},r.arrayBufferToBinaryString=function(e){var t="",n=new Uint8Array(e),r=n.byteLength;for(var i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t},r.string2ArrayBuffer=function(e){var t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(var r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t},r.bin2String=function(e){return String.fromCharCode.apply(String,e)},r.encode_utf8=function(e){return unescape(encodeURIComponent(e))},r.makeOptionsSortable=function(e,t,n){$(e).addClass("sortableOptions"),$(e).sortable({handle:"span.dragIcon",containment:t,update:function(e,t){n&&n()},start:function(){}})},r.getURlQueryStringParams=function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++)t=n[r].split("="),e.push(t[0]),e[t[0]]=t[1];return e},r.removeNbsp=function(e){var t;return e?t=e.replace(/&nbsp;/g,"").trim():t="",t},r.userInputValidator=function(e,t){var n=!1,r="";return t?e.find("img").length>0?(n=!0,n):(r=e.text().replace(/&nbsp;/g,"").trim(),r=r.replace("​",""),r?(n=!0,n):(n=!1,n)):(r=e.text().replace(/&nbsp;/g,"").trim(),r=r.replace("​",""),r?(n=!0,n):(n=!1,n))},r.sortObjByKey=function(e){var t=e,n=[],r,i,s,o={};for(r in t)t.hasOwnProperty(r)&&n.push(r);n.sort(),s=n.length;for(i=0;i<s;i++)r=n[i],o[r]=t[r];return o},r.isIE=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("msie")>-1;return t},r.isPhone=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:!1},r.getQuestionTypeById=function(e){var t=[{quesTypeID:101,quesType:"MCQ Single Response"},{quesTypeID:102,quesType:"MCQ Multiple Response"},{quesTypeID:103,quesType:"FIB Text"},{quesTypeID:104,quesType:"FIB Tap and Place"},{quesTypeID:105,quesType:"FIB Drop Down"},{quesTypeID:106,quesType:"Matching"},{quesTypeID:107,quesType:"Grouping"},{quesTypeID:108,quesType:"True or False"},{quesTypeID:109,quesType:"Collection"}],n="";return n=_.findWhere(t,{quesTypeID:parseInt(e)})?_.findWhere(t,{quesTypeID:parseInt(e)}).quesType:"",n},r.mouseWheel=function(e){$(e).on("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent,n=t.wheelDelta||-t.detail;this.scrollTop+=(n<0?1:-1)*30,e.preventDefault()})},r.checkProtocol=function(e){var e=e,t=e.split("http:"),n="https:";if(window.location.protocol===n){var r=n+t[1];return r}return e},r}),define("com/es/tocEditor/models/TOCModModel",[],function(){var e=Backbone.Model.extend({defaults:{id:null,url:"",spines:[],title:"",topics:[{id:null,url:"",spines:[],title:""}]},url:null});return new e}),define("com/es/tocEditor/collection/TOCModCollection",["com/es/tocEditor/models/TOCModModel"],function(e){var t=Backbone.Collection.extend({model:e});return new t}),define("com/es/text!templateBasePath/Editor/author/tocView/tocModItemTemplate.html",[],function(){return'<li id="<%=obj.url%>" >\r\n  <div class="edit-details-div">\r\n	  <!--span class="dragIcon"></span-->\r\n	  <% if (obj.name && obj.name.length > 0) { %>\r\n	  	<div contenteditable="false" class="nodeName" data-label="<%=obj.name%>"><%=obj.name%></div>\r\n	  <% } %>\r\n	  \r\n	  <% if (obj.label && obj.label.length > 0) { %>\r\n	  	<div contenteditable="false" class="nodeName" data-label="<%=obj.label%>"><%=obj.label%></div>\r\n	  <% } %>\r\n	  <div class="node-link"><%=obj.url%></div>\r\n  </div>\r\n  \r\n  <div class="manage-list-items">\r\n	  <span class="addLinkIcon"></span>\r\n  </div>\r\n</li>'}),define("com/es/tocEditor/views/TOCModView",["com/es/utilities/utils","com/es/utilities/services","com/es/tocEditor/models/TOCModModel","com/es/tocEditor/collection/TOCModCollection","com/es/text!templateBasePath/Editor/author/tocView/tocModItemTemplate.html"],function(e,t,n,r,i){var s=function(n){var r=null,i=null,s=null,o=null,u=null,a=null,f=function(t){var n=new Array;_.each(t,function(t){var r;e.rewriteProperty(t,"title","label"),e.rewriteProperty(t,"topics","children"),n.push(t)},this),a.tree({data:n,autoEscape:!1,autoOpen:!0,keyboardSupport:!1,openedIcon:"",closedIcon:"",onCreateLi:function(t,n){var r=n.find(".jqtree-title").text(),i=t.url,s="<div class='node-container'><div class='jqtree-element jqtree_common edit-details-div parent-spacing'></div></div>",o="<a class='jqtree_common jqtree-toggler'></a>",u="<div contenteditable='false' class='jqtree-title jqtree_common jqtree-name'>"+r+"</div>",a="<div class='manage-list-items'><span class='addLinkIcon'></span></div>",i="<div class='jqtree-node-link node-link parent-spacing'>"+i+"</div>",f="<div class='sample-checkbox-wrapper'><div class='checkbox-wrap'><input type='checkbox' class='inputCheckbox css-checkbox' id='"+(t.id+"-cbox")+"'/><label class='css-label' for='"+(t.id+"-cbox")+"'></label></div></div>";n.attr({id:t.id,"data-id":t.id}).find(".jqtree-element").after(s).remove().end().find(".jqtree-element.edit-details-div").append(o);var l=$(".jqtree-toggler",n);t.children.length>0&&n.hasClass("jqtree-folder")?l.css("display","inline-block"):l.css("display","none"),t.getLevel()>="2"&&l.remove(),n.find(".jqtree-element.edit-details-div").append(u).end().find(".node-container").append(a+i),t.type&&n.addClass(t.type),t.removeNewNode&&n.removeClass("newNode");if(AppConst.ALLOW_SAMPLE_BOOK_DEFINITION){var c=t.id,h=n.append(f).find(".sample-checkbox-wrapper").find("input").attr("data-id",c);t.getLevel()=="1"?(!("forSample"in t)&&!t.hasOwnProperty("forSample")&&(t.forSample=!1,e.log("TocEditor: forSample prop. is being added!")),t.forSample?h.prop("checked",!0):h.prop("checked",!1)):n.find(".checkbox-wrap").hide(),n.find(".manage-list-items").addClass("samp-book-position")}}}),r.trigger(AppEvent.TOC_RENDER_COMPLETE),e.hideLoader()},l=function(e){a.tree("openNode",e)},c=function(e){a.tree("closeNode",e)},h=function(n){o=n;var r=function(t){e.log("success")},i=function(){console.log(error)},s={url:o,successCallback:r,errorCallback:i};t.fetchQuestionData(s)},p=function(){},d=function(e){r.trigger(AppEvent.SHOW_CONTEXTMENU_CLICKED,e)},v=function(e){var t=e||t;e.which=="13"&&(t.preventDefault(),t.stopPropagation(),r.trigger(AppEvent.TOC_TREE_ITEM_RENAMED,$(e.target),$(e.target).parent().parent().parent()))},m=function(e){var t=$(e.target).parent().parent().parent(),n=a.tree("getNodeById",t.attr("data-id"));n.is_open?c(n):l(n)},g=function(e){var t=e||t,n=$(t.target),i={};i={node:n.parent().parent().parent()},r.trigger(AppEvent.TOC_EDITABLE_NODE_CLICKED,i)},y=function(e){var t=e||t,n=$(t.target),i={};i={node:n,parentNode:n.parent().parent().parent()},r.trigger(AppEvent.TOC_EDITABLE_NODE_BLURRED,i)},b=Backbone.View.extend({events:{"click .manage-list-items .addLinkIcon":d,"click .jqtree-folder .jqtree-element > .jqtree-toggler":m,"keyup .jqtree-title.jqtree-name":v,"click .jqtree-title.jqtree-name":g,"blur .jqtree-title.jqtree-name":y},initialize:function(e){s=e||{},i=s.el,r=this,o=s.url,a=$(i)},render:f,fetchData:h,syncData:p});return new b(n)};return s}),define("com/es/text!templateBasePath/Editor/author/contextMenuTemplate.html",[],function(){return'<div class="modal fade contextMenu">\r\n<div class="modal-dialog contextMenu-dialog">\r\n    <div class="modal-content contextMenu-content">\r\n      <div class="modal-body">\r\n        <ul class="contextMenuUL" role="menu">\r\n	          <li role="menuitem" id="edit" class="edit"><%=AppLang.EDIT_POPUP_LABEL%></li>\r\n	   		  <li role="menuitem" id="settings" class="settings"><%=AppLang.SETTINGS_LABEL%></li>\r\n	          <li role="menuitem" id="remove" class="remove"><%=AppLang.REMOVE_LABEL%></li>\r\n	        </ul>\r\n      </div>\r\n     \r\n    </div>\r\n  </div>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/popups/popUpTemplate.html",[],function(){return'<div class="popUpContainer">\r\n	<div id="loading-indicator" class="modal-dialog loading-indicator" >\r\n	    	<img class="preloader"/>\r\n	</div>\r\n	<!--div id="js-alert" class="modal-dialog alert alert-warning js-alert fade">\r\n	    <p class="js-alert-text"></p>\r\n	</div-->\r\n\r\n	<div id="js-alert" class="modal popup-alert-cover fade in" tabindex="-1" role="dialog">\r\n	    <div class="modal-dialog popup-alert modal-sm">\r\n	      <div class="modal-content">\r\n	        <!--div class="modal-header">\r\n	          <h4 class="modal-title alert-text" id="js-alert-text"></h4>\r\n	        </div-->\r\n	        <div class="modal-body">\r\n	          <p id="js-alert-text" class="alert-text"></p>\r\n	          <button type="button" class="btn btn-default cancelbtn" data-dismiss="modal" aria-label="Close">Close</button>\r\n	        </div>\r\n	      </div>\r\n	    </div>\r\n	</div>\r\n\r\n\r\n	\r\n	<div id="toastContainer" class="modal-dialog toastContainer" >\r\n	    <div id="toastMsg" class="modal-content">\r\n		</div>\r\n	</div>\r\n	<div id="confirmPopupCover" class="modal fade in">		\r\n	</div>\r\n</div>'}),define("com/es/views/ContextMenuView",["com/es/text!templateBasePath/Editor/author/contextMenuTemplate.html","com/es/text!templateBasePath/Editor/author/tocView/tocModEditorContextMenuTemplate.html","com/es/text!templateBasePath/Editor/popups/popUpTemplate.html"],function(e,t,n){var r=Backbone.View.extend({el:null,currentWidget:null,isTOCModInvoke:null,initialize:function(e){this.isTOCModInvoke=e.isTOCModInvoke,this.el=$(".contextMenu"),this.render()},render:function(){var r=this;$(this.el).remove(),r.isTOCModInvoke?($(document.body).append(_.template(n)),$(".popUpContainer").append(_.template(t)),this.el=$(".contextMenu"),this.el.addClass("editTocMenu")):($(".popUpContainer").append(_.template(e)),this.el=$(".contextMenu")),this.el=$(".contextMenu"),$(".contextMenu").attr("tabindex","-1"),$(this.el).find("li").unbind().bind(AppEvent.CLICK,function(e){r.trigger(AppEvent.CONTEXTMENU_ITEM_SELECTED,r,r.currentWidget,e.target.id)})},setPositionX:function(e){var t=$(e).offset().left,n=$(e).width(),r=0,i=0,s=0,o=0,u=$(e).offset().right,a=$(e).css("right");$("#authoringIframe").size()>0&&$("#authoringIframe").length>0?(r=$("#authoringIframe").offset().left+parseInt($("#authoringIframe").css("padding-left")),i=$("#authoringIframe").width(),s=$("#authoringIframe").contents().find("body").scrollLeft(),o=r+t-window.scrollX-s):o=t;var f=$(".contextMenu-content",this.el).width();if(this.isTOCModInvoke&&AppConst.ALLOW_SAMPLE_BOOK_DEFINITION){var l=$(e).parent().siblings(".sample-checkbox-wrapper").offset().left;$(".contextMenu-dialog",this.el).css("left",l+1)}else $(".contextMenu-dialog",this.el).css("left",o+n)},setPositionY:function(e){var t=$(e).offset().top,n=$(e).height(),r=window.pageYOffset||document.body.scrollTop,i=Math.max($(window).height(),$("html").height());if($("#authoringIframe").size()>0&&$("#authoringIframe").length>0){var s=$("#authoringIframe").offset().top,o=$("#authoringIframe").contents().find("body").scrollTop(),u=t,a=o,f=t+s-o-r;if(u>a)$(".contextMenu-dialog",this.el).css("top",f);else{var l=$(".contextMenu-content").get(0).clientHeight;$(".contextMenu-dialog",this.el).css("top",f+n-l)}}else if(this.isTOCModInvoke){var c=parseInt($(".contextMenu-dialog .contextMenuUL li").css("border-bottom-width"),10)+parseInt($(".contextMenu-dialog .contextMenuUL li").css("padding-top"),10)+parseInt($(".contextMenu-dialog .contextMenuUL li").css("padding-bottom"),10)+parseInt($(".contextMenu-dialog .contextMenuUL li").css("line-height"),10),h=$(".contextMenu-dialog .contextMenuUL li").length,p=h*c,d=t+n+p>i+r;d?$(".contextMenu-dialog",this.el).css("top",t+n-p-r):$(".contextMenu-dialog",this.el).css("top",t-r)}else $(".contextMenu-dialog",this.el).css("top",t-r)},makeInsertChildOptDisable:function(){var e=$(this.currentWidget).parent().parent();if(!e.hasClass("jqtree_common"))return!1;var t=$("#tocContainerContent").tree("getNodeById",e.attr("id"));t.getLevel()=="2"?$("#insert-child",this.el).addClass("disable").attr("disabled",!0):$("#insert-child",this.el).removeClass("disable").attr("disabled",!1)},show:function(e){var t=e.target;$(t).hasClass("widget-placeholder")||(t=t.parentNode),this.currentWidget=t,this.setPositionX(t),this.setPositionY(t),this.makeInsertChildOptDisable(),$(this.el).modal("show"),$(".modal-backdrop").css("opacity",0)},hide:function(){$(this.el).modal("hide")}});return r}),define("com/es/models/ContextMenuModel",[],function(){var e=Backbone.Model.extend({defaults:{screen:null}});return e}),define("com/es/models/LinkModel",[],function(){var e=Backbone.Model.extend({defaults:{id:"",type:"",title:"",thumbnail:"",description:"",src:""}});return e}),define("com/es/tocEditor/collection/TOCModLinkCollection",["com/es/models/LinkModel"],function(e){var t=Backbone.Collection.extend({model:e,url:""});return t}),define("com/es/text!templateBasePath/Editor/popups/linkPopup/tocModLinkPopupTemplate.html",[],function(){return'<div class="linkPopupCover modal fade in">\r\n	<div class="linkPopup tocLinkPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n				<button type="button" class="close-pop" data-dismiss="modal"></button>\r\n				<div class="popUpTitle modal-title"><%=AppLang.ADD_LINK_LABEL%></div>\r\n			</div>	\r\n			<ul class="linkItemHeader">\r\n				<li class="linkItem toc-spine-item hand-cursor">\r\n					<span class="popUpThumbnail toc-item-header"><%=AppLang.SPINE_ID_LABEL%></span>\r\n					<span class="radiobutton-col-3 toc-item-header"><%=AppLang.PREVIEW_LABEL%></span>\r\n					<span class="details-col-2 toc-item-header"><%=AppLang.PAGE_URL_LABEL%></span>\r\n				</li>\r\n			</ul>\r\n			<div id="linkList" class="popup-content-spacing linkList">\r\n			</div>\r\n			\r\n			<div class="bottomBar modal-footer">\r\n				<div class="paging"></div>\r\n				<div>\r\n	       			<button type="button" class="doneBtn btn btn-primary"  ><%=AppLang.SAVE_LABEL%> </button>\r\n					<button type="button" class="btn btn-default cancelbtn" data-dismiss="modal"><%=AppLang.CANCEL_LABEL%> </button>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Editor/popups/linkPopup/tocModLinkTemplate.html",[],function(){return'<li class="linkItem toc-spine-item hand-cursor" id="<%=_idref%>" data-href="<%=_href%>">\r\n	<span class="popUpThumbnail"><%=_idref%></span>\r\n	<span class="radiobutton-col-3">\r\n		<span class="previewIcon"></span>\r\n	</span>\r\n	<span class="details-col-2">\r\n		<%=_href%>\r\n	</span>\r\n</li>'}),define("com/es/tocEditor/views/TOCModLinkPopupView",["com/es/tocEditor/collection/TOCModLinkCollection","com/es/text!templateBasePath/Editor/popups/linkPopup/tocModLinkPopupTemplate.html","com/es/text!templateBasePath/Editor/popups/linkPopup/tocModLinkTemplate.html","com/es/utilities/services","com/es/utilities/utils"],function(e,t,n,r,i){var s=function(e){var r=null,i=null,s=null,o=null,u=null,a=null,f=null,l=null,c=null,h=null,p=null,d=null,v=null,m=null,g=[],y=function(){l=u,$(i).remove(),$(".popUpContainer").append(_.template(t)),i=$(".linkPopupCover"),T(l),$(".linkPopupCover").attr("tabindex","-1")},b=function(e,t,n,r){a=e,f=t,c=n.url,h=r.url,p=n.node,d=r.node,v=p?p.spineId:null,m=d?d.spineId:null,$(".searchInput").val(""),T(u),$(".linkPopupCover").modal("show"),L()},w=function(){A(),$(".linkPopupCover").modal("hide")},E=function(e,t){g=[],e&&i.find("#"+e).prevAll().addClass("disable"),t&&i.find("#"+t).nextAll().addClass("disable"),i.find("li").not(".disable").each(function(e,t){var n=$(t).attr("id");n&&g.push(n)})},S=function(e){r.trigger(AppEvent.DONE_LINK_POPUP_CLICK,$(a),$(".linkItem.linkItemActive",i),p,d,g)},x=function(e){var t=$(".searchInput",i).val();t=t.toLowerCase();if(e.which=="13"){var n=u.filter(function(e){if(e._href.toString().toLowerCase().indexOf(t)>-1)return e}),r=_.difference(l,n),s=_.difference(n,l);if(r.length!=0||s.length!=0)l=n,T(l)}else t.length==0&&T(u)},T=function(e){if(e.length>0){var t="<ul>";_.each(e,function(e){t+=_.template(n,e)}),t+="</ul>",$(i).find(".linkList").empty().append(t),(f!=null||f!="")&&$("#"+f).addClass("linkItemActive"),L()}else $(i).find(".linkList").append("<span class='noResult'> "+AppLang.NO_RESULT_FOUND_WITH_EXCLAMATION_MARK_LABEL+"</span>")},N=function(e){},C=function(e){var t=$(e.target).parent().parent(),n=$(".details-col-2",t).text().trim(),r=e||r;if(t.hasClass("disable"))return r.preventDefault(),r.stopPropagation(),!1;window.open(AppConst.CONTENT_BASE_URL+"/"+n,"_blank"),r.preventDefault(),r.stopPropagation()},k=function(e){var t,n=$(e.target);if(n.hasClass("previewIcon")||n.parent().hasClass("disable"))return!1;n.get(0).nodeName!=="LI"&&(n=n.parent(),t=$(".linkItem",i)),t.removeClass("linkItemActive"),n.addClass("linkItemActive")},L=function(e){$(".linkItem",i).bind(AppEvent.CLICK,k),$(".toc-spine-item .previewIcon",i).off("click").on("click",C),$(".doneBtn",i).off("click").on("click",S),$(".searchInput",i).on("keyup",x),$(".linkPopupCover").off("shown.bs.modal").on("shown.bs.modal",function(e){E(v,m),O(),_addClassOverflowContent()})},A=function(e){$(".linkItem",i).unbind(),$(".toc-spine-item .previewIcon",i).off(),$(".doneBtn",i).off(),$(".searchInput",i).off()},O=function(){var e=$(".popUpThumbnail, .details-col-2","#linkList"),t=!1;_.each(e,function(e){var n=$(e);e.scrollWidth>e.offsetWidth&&!n.parent().hasClass("disable")&&(n.attr({"data-toggle":"tooltip","data-placement":"top",title:n.text()}),t=!0)}),t&&$('[data-toggle="tooltip"]').tooltip()};_addClassOverflowContent=function(){$("#linkList").get(0).scrollHeight>$("#linkList").get(0).offsetHeight?$("#linkList").addClass("content-overflow"):$("#linkList").removeClass("content-overflow")};var M=Backbone.View.extend({events:{},initialize:function(e){s=e||{},r=this;var t=s.manifestData,n=s.spineData;_.each(n,function(e){var n=_.where(t,{_id:e._idref});try{e._href=n[0]._href}catch(r){console.log("_href not found for "+e._idref)}}),u=n},render:y,show:b,hide:w});return new M(e)};return s}),define("com/es/models/BooksListModel",[],function(){var e=Backbone.Model.extend({});return e}),define("com/external/xml2json",function(){}),define("com/es/tocEditor/TOCModEditor",["com/es/text!templateBasePath/Editor/author/tocView/baseTemplate.html","com/es/text!templateBasePath/Editor/author/tocView/tocModEditorContextMenuTemplate.html","com/es/utilities/utils","com/es/tocEditor/views/TOCModView","com/es/views/ContextMenuView","com/es/models/ContextMenuModel","com/es/tocEditor/views/TOCModLinkPopupView","com/es/models/BooksListModel","com/es/utilities/services","com/es/utilities/utils","com/external/xml2json"],function(e,t,n,r,i,s,o,u,a,f,l){var c=function(){AppConst.ROOT_URL=location.href.split("#")[0],AppConst.ROOT_PATH=window.location.pathname.split("/")[1],AppConst.SERVICE_BASE_URL=window.location.origin+"/"+AppConst.ROOT_PATH+"/pubservice/";var t,l,c,h=null,p=null,d=null,p=null,v=!0,m=!1,g,y,b,w;t=this;var E=function(t,r,i){AppConst.TOC_DATA_BASE_URL=r,n.showLoader();var s=_.template(e,{});$(t).append(s),c=$("#tocContainerContent",$(t)),l={container:c,el:c,url:r},Q(i)},S=function(e,t){var n=c.tree("getNodeById",t.attr("data-id")),r=e.text().trim(),i={label:r};I(n,i)},x=function(e){n.showToasterMessage(AppLang.NODE_CANT_BE_EMPTY),e.text(g)},T=function(e,t){e.text().length==0&&x(e),S(e,t)},N=function(e){z(),_.delay(function(){U(e.node)},50)},C=function(e){var t=$(e.node),n=$(e.parentNode),r=$(e.parentNode).attr("id");z(),t.text().length==0?(x(t),U(e.parentNode)):S(t,n)},k=function(e){var t=$(e.target).parent().parent().parent(),n=$(c).tree("getNodeById",t.attr("id"));$(c).tree("selectNode",n),d.show(e)},L=function(){var e=new s({screen:null});d=new i({model:e,isTOCModInvoke:!0}),_.delay(function(){d.on(AppEvent.CONTEXTMENU_ITEM_SELECTED,A.bind(this))},100)};L();var A=function(e,t,r){n.log(e);var i=$(e.currentWidget).parent().parent(),s=c.tree("getNodeById",i.attr("data-id")),o={label:"New node",id:"jqtree_"+(new Date).getTime(),url:"",type:"newNode"};switch(r){case"link":W(s,i);break;case"insert-after":B(s,o),pt();break;case"insert-before":H(s,o),pt();break;case"insert-child":if(s.getLevel()>="2")break;j(s,o),pt();break;case"rename":z(),_.delay(function(){U(i)},50);break;case"delete":F(s),pt()}if(s.getLevel()>="2"&&r=="insert-child")return!1;d.hide()},O=function(){return c.tree("getState")},M=function(e){return c.tree("getNodeById",e)},D=function(e){c.tree("openNode",e)},P=function(e){c.tree("closeNode",e)},H=function(e,t){c.tree("addNodeBefore",t,e);var n=$("#"+t.id);z(),_.delay(function(){U(n)},50),m=!0,st()},B=function(e,t){c.tree("addNodeAfter",t,e);var n=$("#"+t.id);z(),_.delay(function(){U(n)},50),m=!0,st()},j=function(e,t){c.tree("appendNode",t,e);var n=$("#"+t.id);z(),_.delay(function(){U(n)},50),m=!0,st()},F=function(e){c.tree("removeNode",e),m=!0,st()},I=function(e,t){c.tree("updateNode",e,t),m=!0,st()},q=function(e){pt()},R=function(e){pt()},U=function(e){var t=$(e.find(".jqtree-title.jqtree-name").get(0));t.addClass("jqtree-editable").attr("contenteditable","true").get(0).focus(),g=t.text(),m=!0,st()},z=function(){var e=$(".jqtree-editable",c);e.removeClass("jqtree-editable").attr("contenteditable","false")},W=function(e,t){X(t,e.spineId)},X=function(e,t){var n=c.tree("getNodeById",e.attr("data-id")),r=J(n),i=K(n);p.show(e,t,r,i)},V=function(e,t,r,i,s){var o=c.tree("getNodeById",e.attr("id")),u=$(".details-col-2",t).text().trim(),a=t.attr("id");updatedNodeData={};if(t.length==0||t.size==0)return n.showToasterMessage(AppLang.NO_LINK_SELETED_MESSAGE),!1;_updateSpines(a,o,r,i,s),updatedNodeData={url:u,spineId:a},e.hasClass("newNode")&&(e.removeClass("newNode"),updatedNodeData.removeNewNode=!0),I(o,updatedNodeData),p.hide()};_updateSpines=function(e,t,n,r,i){var s=i.indexOf(e);s=s===0?s+1:s;var o=i.splice(s);n&&c.tree("updateNode",n,{spines:i}),t&&c.tree("updateNode",t,{spines:o})};var J=function(e,t){var n={node:null,url:""};if(!e)return n;if(t&&e.url)return n.node=e,n.url=e.url,n;if(e.getPreviousSibling()){var r=e.getPreviousSibling();if(r){if(r.children.length>0){var i=r.children,s=i.length;for(var o=s-1;o>=0;o--){if(i[o].children.length>0)return J(i[o].children.length[i[o].children.length-1],!0);if(i[o].url)return n.url=i[o].url,n.node=i[o],n}}return r.url?(n.node=r,n.url=r.url,n):J(r,!0)}return n}return e.getLevel()>1?J(e.parent,!0):n},K=function(e,t){var n={node:null,url:""};if(!e)return n;if(t&&e.url)return n.node=e,n.url=e.url,n;if(e.children.length>0){var r=e.children,i=r.length;for(var s=0;s<=i-1;s++){if(r[s].url)return n.url=r[s].url,n.node=r[s],n;if(r[s].children.length>0)return K(r[s].children[0],!0)}}return e.getNextSibling()?K(e.getNextSibling(),!0):e.getLevel()>1?K(e.parent.getNextSibling(),!0):n},Q=function(e){AppConst.BOOK_ID=e;var t=window.location.href,n=new u,r=function(e){G(e)},i=Y,s={model:n,successCallback:r,errorCallback:i,id:e};a.getBookMetadata(s)},G=function(e,t){y=f.clone(e.attributes),_bookMetaLoaded=!0,AppConst.CONTENT_BASE_URL=e.attributes.baseUrl.replace(/\\/g,"/"),AppConst.BOOK_BASE_URL=e.attributes.bookBaseUrl,AppConst.KEY_IDENTIFIER=e.attributes.keyIdentifier,AppConst.BOOK_TYPE=e.attributes.bookType,AppConst.WIDGET_HTTP_BASE_PATH=y.Opcr_Location,AppConst.BOOK_TYPE=="pre-paginated"&&(AppConst.BOOK_TYPE="fixed"),"allowSampleBookDefinition"in e.attributes?AppConst.ALLOW_SAMPLE_BOOK_DEFINITION=e.attributes.allowSampleBookDefinition:AppConst.ALLOW_SAMPLE_BOOK_DEFINITION=!1,AppConst.ALLOW_SAMPLE_BOOK_DEFINITION||$(".header.toc-header","#edittoc").hide(),Z(AppConst.CONTENT_BASE_URL,e,t)},Y=function(e){console.log("Error while loading book meta data ",e),f.showToasterMessage(AppLang.ERROR_LOADING_BOOK_METADATA,2e3,function(){window.location.href=window.location.origin+"/pubportal/bookdefault.excel"})},Z=function(e,t,n){var i=function(e){b=e.manifest.item,w=e.spine.itemref,_.each(t.attributes.toc[0],function(e){et(e,b)}),p=new o({manifestData:b,spineData:w}),p.render(),p.off(AppEvent.DONE_LINK_POPUP_CLICK).on(AppEvent.DONE_LINK_POPUP_CLICK,V),h=new r(l),h.bind(AppEvent.TOC_RENDER_COMPLETE,pt),h.render(t.attributes.toc[0]),h.bind(AppEvent.SHOW_CONTEXTMENU_CLICKED,k),h.bind(AppEvent.TOC_TREE_ITEM_RENAMED,T),h.bind(AppEvent.TOC_EDITABLE_NODE_CLICKED,N),h.bind(AppEvent.TOC_EDITABLE_NODE_BLURRED,C),rt()},s=function(e){console.log("Invalid Content.opf ")},u=t.attributes.opfPath,f={successCallback:i,errorCallback:s,baseUrl:window.location.origin+"/"+u};a.getOPFData(f)},et=function(e,t,n){if(e.hasOwnProperty("spines")){var r=e.url;r=r.split("#")[0];var i=_.findWhere(b,{_href:r});if(i!==undefined)var s=i._id;else var s=n;var o=e.id;i!==undefined&&i.hasOwnProperty("chapterTitleId")&&(o=i.chapterTitleId);if(s!==undefined){e.spineId=s;var u=_.without(e.spines,s);u.length>0}}if(e.hasOwnProperty("topics")){var a=e.topics;_.each(a,function(e){et(e,null,s)})}},tt=function(e,t,n,r,i){e.topics||(e.topics=[]);var s="",o=[];_.each(t,function(t){var n=_.find(b,function(e){return e._id==t}),s={id:n._id,url:n._href,title:n._href,chapterTitleId:r,spineId:i};e.topics.push(s)})},nt=function(){};_updateSampleBookInfo=function(){var e=this,t=$(e).is(":checked"),n={forSample:t},r=c.tree("getNodeById",$(e).attr("data-id"));I(r,n)};var rt=function(){$("#tocModeSaveBtn").on("click",at),$("#exp-col-wrapper .colLapse-all").off("click").on("click",ct),$("#exp-col-wrapper .expand-all").off("click").on("click",ht),$(document.body).on("change",".inputCheckbox",_updateSampleBookInfo),$(c).off("tree.open").on("tree.open",q),$(c).off("tree.close").on("tree.close",R)},it=function(){$("#tocModeSaveBtn").off(),$("#exp-col-wrapper .colLapse-all, #exp-col-wrapper .expand-all").off("click"),$(".inputCheckbox").off("change"),$(c).off("tree.open, tree.close")},st=function(){var e=$("#tocModeSaveBtn");e.hasClass("disable")&&e.removeClass("disable")},ot=function(){var e=$("#tocModeSaveBtn");e.hasClass("disable")||e.addClass("disable")},ut=function(e){m?n.showConfirmPopUp(AppLang.SAVE_TOC_CHANGES_CONFIRMATION,AppLang.TOC_CONFIRMATION_DIALOGUE,"",function(t){if(t.toLowerCase()==="yes")it(),at(e);else{if(t.toLowerCase()!=="no")return;it(),n.hideLoader(),e()}}):(it(),e())},at=function(e){var t,r,i=!1;if(typeof e=="object"&&e.type=="click"){t=e,r=$(t.target);if(r.hasClass("disable"))return!1}ft();if(!v){var s=$(".newNode",c);n.showAlert(AppLang.ADD_SPINE_LINKS_TO_NEW_NODE_MESSAGE),U($(s[0]));return}if(m){var o=lt();c.find("input:checked").length>0?i=!0:i=!1;var u={success:function(t){n.showToasterMessage(AppLang.TOC_DATA_SAVED_SUCCESSFULLY),ot(),m=!1,v=!0,i=!1,typeof e=="function"&&e()},error:function(e){n.log(e)},data:o,isSampleBookDefined:i};a.saveTOCData(u)}else n.showToasterMessage(AppLang.NO_DATA_CHANGED_IN_TOC)},ft=function(){var e=$("#tocContainerContent").find(".newNode");if(e.length>0){v=!1;return}v=!0},lt=function(){var e=JSON.parse($("#tocContainerContent").tree("toJson")),t=[];return _.each(e,function(e){var r=n.rewriteProperty(e,"name","title");r=n.rewriteProperty(r,"children","topics");var i=[];delete r.is_open,_.each(r.topics,function(e){delete e.is_open}),t.push(r)},this),t},ct=function(e){var t=$("#tocContainerContent > ul > li.jqtree-folder"),n=$(e.target),r=[];n.hasClass("disabled")||(_.each(t,function(e){var t=M(e.id);r.push(t)}),_.each(r,function(e){P(e);if(e.children.length>0)for(var t=0;t<e.children.length;t++){var n=e.children[t];P(n)}}))},ht=function(e){var t=$("#tocContainerContent > ul > li.jqtree-folder"),n=$(e.target),r=[];n.hasClass("disabled")||(_.each(t,function(e){var t=M(e.id);r.push(t)}),_.each(r,function(e){D(e);if(e.children.length>0)for(var t=0;t<e.children.length;t++){var n=e.children[t];D(n)}}))},pt=function(){var e=O(),t=$("#exp-col-wrapper .expand-all"),n=$("#exp-col-wrapper .colLapse-all"),r,i=dt();r=parseInt(e.open_nodes.length,10),r===0?(t.hasClass("disabled")&&t.removeClass("disabled"),n.hasClass("disabled")||n.addClass("disabled")):i?(t.hasClass("disabled")||t.addClass("disabled"),n.hasClass("disabled")&&n.removeClass("disabled")):r>=1&&(t.hasClass("disabled")&&t.removeClass("disabled"),n.hasClass("disabled")&&n.removeClass("disabled"))},dt=function(){var e=$("#tocContainerContent > ul > li.jqtree-folder"),t=!1,n=[];return _.each(e,function(e){var t=e.id,r=$(c).tree("getNodeById",t);r.is_open&&n.push(r)}),n.length===e.length&&(t=!0),t},vt=Backbone.View.extend({events:{},initialize:function(){},init:function(e,t,n){E(e,t,n)},update:function(){_updateTOCdata()},checkUnsavedData:function(e){ut(e)}});return new vt};return window.TOCModEditor=new c,window.TOCModEditor}),require(["main-config","com/es/widgets/WidgetConstants","com/es/utilities/AppConst","com/es/utilities/AppEvent","com/es/utilities/AppLang","com/es/tocEditor/TOCModEditor"],function(e,t,n,r,i,s){$(window).trigger(AppEvent.TOCEDITOR_READY)}),define("com/es/mainTOCModEditor",function(){});