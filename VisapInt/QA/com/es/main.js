/*
 RequireJS text 0.27.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/**
 * Galleria v 1.3.5 2014-01-25
 * http://galleria.io
 *
 * Licensed under the MIT license
 * https://raw.github.com/aino/galleria/master/LICENSE
 *
 */

/**
 * Galleria Classic Theme 2012-08-08
 * http://galleria.io
 *
 * Licensed under the MIT license
 * https://raw.github.com/aino/galleria/master/LICENSE
 *
 */

/**
 * @license jquery.panzoom.js v1.12.1
 * Updated: Tue Mar 04 2014
 * Add pan and zoom functionality to any element
 * Copyright (c) 2014 timmy willison
 * Released under the MIT license
 * https://github.com/timmywil/jquery.panzoom/blob/master/MIT-License.txt
 */

/*!
 * Custom Universal Module Definition (UMD)
 *
 * Video.js will never be a non-browser lib so we can simplify UMD a bunch and
 * still support requirejs and browserify. This also needs to be closure
 * compiler compatible, so string keys are used.
 */

/*! Time Tracking -------------------------------------------------------------- */

/**
 * Copyright 2013 vtt.js Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*
 * transform: A jQuery cssHooks adding cross-browser 2d transform capabilities to $.fn.css() and $.fn.animate()
 *
 * limitations:
 * - requires jQuery 1.4.3+
 * - Should you use the *translate* property, then your elements need to be absolutely positionned in a relatively positionned wrapper **or it will fail in IE678**.
 * - transformOrigin is not accessible
 *
 * latest version and complete README available on Github:
 * https://github.com/louisremi/jquery.transform.js
 *
 * Copyright 2011 @louis_remi
 * Licensed under the MIT license.
 *
 * This saved you an hour of work?
 * Send me music http://www.amazon.co.uk/wishlist/HNTU0468LQON
 *
 */

/*
 * jPlayer Plugin for jQuery JavaScript Library
 * http://www.jplayer.org
 *
 * Copyright (c) 2009 - 2013 Happyworm Ltd
 * Licensed under the MIT license.
 * http://opensource.org/licenses/MIT
 *
 * Author: Mark J Panaghiston
 * Version: 2.4.0
 * Date: 5th June 2013
 */

/*
 * CirclePlayer for the jPlayer Plugin (jQuery)
 * http://www.jplayer.org
 *
 * Copyright (c) 2009 - 2012 Happyworm Ltd
 * Dual licensed under the MIT and GPL licenses.
 *  - http://www.opensource.org/licenses/mit-license.php
 *  - http://www.gnu.org/copyleft/gpl.html
 *
 * Version: 1.0.1 (jPlayer 2.1.0+)
 * Date: 30th May 2011
 *
 * Author: Mark J Panaghiston @thepag
 *
 * CirclePlayer prototype developed by:
 * Mark Boas @maboa
 * Silvia Benvenuti @aulentina
 * Jussi Kalliokoski @quinirill
 *
 * Inspired by :
 * Neway @imneway http://imneway.net/ http://forrst.com/posts/Untitled-CPt
 * and
 * Liam McKay @liammckay http://dribbble.com/shots/50882-Purple-Play-Pause
 *
 * Standing on the shoulders of :
 * John Resig @jresig
 * Mark Panaghiston @thepag
 * Louis-Rémi Babé @Louis_Remi
 */

/*
 *	jQuery carouFredSel 6.2.1
 *	Demo's and documentation:
 *	caroufredsel.dev7studios.com
 *
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */

/**
 * 
 * Find more about the Spinning Wheel function at
 * http://cubiq.org/spinning-wheel-on-webkit-for-iphone-ipod-touch/11
 *
 * Copyright (c) 2009 Matteo Spinelli, http://cubiq.org/
 * Released under MIT license
 * http://cubiq.org/dropbox/mit-license.txt
 * 
 * Version 1.4 - Last updated: 2009.07.09
 * 
 */

/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2010 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/

/*
 *  SliderNav - A Simple Content Slider with a Navigation Bar
 *  Copyright 2010 Monjurul Dolon, http://mdolon.com/
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://devgrow.com/slidernav
 */

/*
 Copyright 2011-2013 Abdulla Abdurakhmanov
 Original sources are available at https://code.google.com/p/x2js/

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 */

/*
 * Crypto-JS v2.5.3
 * http://code.google.com/p/crypto-js/
 * (c) 2009-2012 by Jeff Mott. All rights reserved.
 * http://code.google.com/p/crypto-js/wiki/License
 */

function _handleMultipleEvents(e,t,n,r){vjs.arr.forEach(n,function(n){e(t,n,r)})}function _logType(e,t){var n,r,i;n=Array.prototype.slice.call(t),r=function(){},i=window.console||{log:r,warn:r,error:r},e?n.unshift(e.toUpperCase()+":"):e="log",vjs.log.history.push(n),n.unshift("VIDEOJS:"),i[e].apply?i[e].apply(i,n):i[e](n.join(" "))}function DRAGON_DROP(e){var t=this;return t.$draggables=e.draggables,t.$dropzones=e.dropzones,t.$noDrags=e.noDrags,t.dropLoad=null,t.dragWindow=e.dragWindow,t.dragDocument=e.dragWindow.document,t.dragBody=e.dragWindow.document.body,t.dropWindow=e.dropWindow,t.dropDocument=e.dropWindow.document,t.dropBody=e.dropWindow.document.body,t.triggeredFrom=e.triggeredFrom,t.inIframe=e.inIframe,t.engage=function(){t.$draggables=$(t.$draggables),t.$dropzones=$(t.$dropzones),t.$draggables.attr("draggable","true"),t.$noDrags=t.$noDrags?$(t.$noDrags):$(),t.$dropzones.attr("dropzone","copy"),t.bindDraggables(),t.bindDropzones(),t.enabled=!0},t.bindDraggables=function(){t.$draggables=$(t.$draggables.selector,t.dragDocument),t.$noDrags=$(t.$noDrags.selector,t.dragDocument),t.$noDrags.attr("draggable","false"),t.$draggables.off("dragstart").on("dragstart",function(e){var n=e.originalEvent;t.$draggables.removeAttr("dragged");var r=n.pageX-$(n.target).offset().left,i=n.pageY-$(n.target).offset().top,s=n.dataTransfer;t.inIframe?content=n.target.outerHTML:content=t.triggeredFrom.insertWidgetFrame(n.target.outerHTML);var o=t.$draggables.is(n.target);o&&(s.effectAllowed="copy",s.setData("text/plain"," "),s.setData("text/plain",content),s.setData("inIframe",t.inIframe),s.setData("dragSelector",t.$draggables.selector),s.setData("dropSelector",t.$dropzones.selector),s.setData("marginX",r),s.setData("marginY",i),t.dropLoad=content,$(n.target).attr("dragged","dragged"))})},t.bindDropzones=function(){t.$dropzones=$(t.$dropzones.selector,t.dropDocument),t.$dropzones.off("dragenter dragover").on("dragenter dragover",function(e){if(t.enabled===!0){$("#authoringIframe").contents().find("body").attr("contenteditable",!0);var n=$(e.originalEvent.target);AppConst.BOOK_TYPE=="fixed"&&e.preventDefault()}}),t.$dropzones.off("dragleave").on("dragleave",function(e){var n=e.originalEvent,r=n.dataTransfer,i=t.$dropzones.is(n.relatedTarget),s=t.$dropzones.has(n.relatedTarget).length>0,o=i||s;o||($("#authoringIframe").contents().find("body").attr("contenteditable",!1),r.dropEffect="none",r.effectAllowed="null")}),t.$dropzones.off("drop").on("drop",function(e){var n=e.originalEvent;n.preventDefault(),t.dropLoad=n.dataTransfer.getData("text/plain"),t.inIframe=JSON.parse(n.dataTransfer.getData("inIframe")),t.$draggables.selector=n.dataTransfer.getData("dragSelector"),t.$dropzones.selector=n.dataTransfer.getData("dropSelector");var r=n.dataTransfer.getData("marginX"),i=n.dataTransfer.getData("marginY");t.inIframe?(t.dragDocument=document.getElementById("authoringIframe").contentWindow.document,t.dropDocument=document.getElementById("authoringIframe").contentWindow.document):(t.dragDocument=window.document,t.dropDocument=document.getElementById("authoringIframe").contentWindow.document);if(!t.dropLoad)return!1;if(AppConst.BOOK_TYPE=="fixed"){var s=$(t.dropLoad).attr("id");t.inIframe&&$(t.$draggables.selector,t.dragDocument).filter("[dragged]").remove(),$(t.dropDocument.body).append(t.dropLoad);var o=t.fixedBoundDropzones(n,r,i);$("div[id='"+s+"']",t.dropDocument).css({position:"absolute",top:o.Y+"px",left:o.X+"px"}),t.triggeredFrom.widgetAdded(t.dropLoad)}else{var u=null;document.caretRangeFromPoint?u=t.dropDocument.caretRangeFromPoint(n.clientX,n.clientY):n.rangeParent&&(u=t.dropDocument.createRange(),u.setStart(n.rangeParent,n.rangeOffset));var a=t.dropWindow.getSelection();a.removeAllRanges(),a.addRange(u),$(a.anchorNode).closest(t.$dropzones.selector,t.dropDocument).get(0).focus();var f;if($(a.anchorNode).hasClass("dummyWidget")||$(a.anchorNode).has("img").length>0||a.anchorOffset<0)f=!1;else{var l=t.dropDocument.createElement("div");l.innerHTML=t.dropLoad;var c=t.dropDocument.createDocumentFragment(),h,p;while(h=l.firstChild)p=c.appendChild(h);try{u.insertNode(c),f=!0}catch(n){console.log("error in inserting fragment: ",n),f=!1}}if(f)if(!t.inIframe)t.triggeredFrom.widgetAdded(t.dropLoad);else{var d=$(t.$draggables.selector,t.dragDocument).filter("[dragged]"),v=d.prev().get(0),m=d.next().get(0);v!=undefined&&m!=undefined&&!v.classList.contains("widget-placeholder")&&!m.classList.contains("widget-placeholder")&&v.className==m.className&&(v.innerHTML+=m.innerHTML,m.remove()),$(t.$draggables.selector,t.dragDocument).filter("[dragged]").remove(),t.triggeredFrom.widgetAdded(t.dropLoad)}u.commonAncestorContainer.parentNode.nodeType!="3"&&u.commonAncestorContainer.parentNode.normalize(),a.removeAllRanges(),t.triggeredFrom.widgetAdded(t.dropLoad)}$("#authoringIframe").contents().find("body").attr("contenteditable",!1),t.bindDraggables()})},t.disengage=function(){t.$draggables=$(t.$draggables.selector,t.dragDocument),t.$dropzones=$(t.$dropzones.selector,t.dropDocument),t.$noDrags=$(t.$noDrags.selector,t.dragDocument),t.$draggables.removeAttr("draggable").removeAttr("dragged").off("dragstart"),t.$noDrags.removeAttr("draggable"),t.$dropzones.removeAttr("droppable").off("dragenter"),t.$dropzones.off("drop"),t.enabled=!1},t.fixedBoundDropzones=function(e,n,r){var i,s,o,u=e.pageY-r,a=e.pageX-n,f=0,l=0,c=$(t.dropDocument.body).width(),h=$(t.dropDocument.body).height(),p=$("div[id='"+$(t.dropLoad).attr("id")+"']",t.dropDocument).width(),d=$("div[id='"+$(t.dropLoad).attr("id")+"']",t.dropDocument).height(),v=p-n,m=d-r;return s=a,o=u,u<=l&&(o=l),a<=f&&(s=f),parseInt(u)+parseInt(d)>=parseInt(h)&&(o=h-d),parseInt(a)+parseInt(p)>=parseInt(c)&&(s=c-p),i={X:s,Y:o},i},t}function X2JS(e){function n(){e.escapeMode===undefined&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",e.enableToStringFunc===undefined&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],e.skipEmptyTextNodesForObj===undefined&&(e.skipEmptyTextNodesForObj=!0),e.stripWhitespaces===undefined&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[]}function i(){function e(e){var t=String(e);return t.length===1&&(t="0"+t),t}typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),typeof Date.prototype.toISOString!="function"&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}function s(e){var t=e.localName;t==null&&(t=e.baseName);if(t==null||t=="")t=e.nodeName;return t}function o(e){return e.prefix}function u(e){return typeof e=="string"?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):e}function a(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function f(t,n,r){switch(e.arrayAccessForm){case"property":t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]}if(!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0){var i=0;for(;i<e.arrayAccessFormPaths.length;i++){var s=e.arrayAccessFormPaths[i];if(typeof s=="string"){if(s==r)break}else if(s instanceof RegExp){if(s.test(r))break}else if(typeof s=="function"&&s(t,n,r))break}i!=e.arrayAccessFormPaths.length&&(t[n]=[t[n]])}}function l(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]);if(t[6]&&t[7]){var i=t[6]*60+Number(t[7]),s=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";i=0+(s=="-"?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else e.indexOf("Z",e.length-1)!==-1&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function c(t,n,r){if(e.datetimeAccessFormPaths.length>0){var i=r.split(".#")[0],s=0;for(;s<e.datetimeAccessFormPaths.length;s++){var o=e.datetimeAccessFormPaths[s];if(typeof o=="string"){if(o==i)break}else if(o instanceof RegExp){if(o.test(i))break}else if(typeof o=="function"&&o(obj,n,i))break}return s!=e.datetimeAccessFormPaths.length?l(t):t}return t}function h(t,n){if(t.nodeType==r.DOCUMENT_NODE){var i=new Object,u=t.childNodes;for(var l=0;l<u.length;l++){var p=u.item(l);if(p.nodeType==r.ELEMENT_NODE){var d=s(p);i[d]=h(p,d)}}return i}if(t.nodeType==r.ELEMENT_NODE){var i=new Object;i.__cnt=0;var u=t.childNodes;for(var l=0;l<u.length;l++){var p=u.item(l),d=s(p);p.nodeType!=r.COMMENT_NODE&&(i.__cnt++,i[d]==null?(i[d]=h(p,n+"."+d),f(i,d,n+"."+d)):(i[d]!=null&&(i[d]instanceof Array||(i[d]=[i[d]],f(i,d,n+"."+d))),i[d][i[d].length]=h(p,n+"."+d)))}for(var v=0;v<t.attributes.length;v++){var m=t.attributes.item(v);i.__cnt++,i[e.attributePrefix+m.name]=m.value}var g=o(t);return g!=null&&g!=""&&(i.__cnt++,i.__prefix=g),i["#text"]!=null&&(i.__text=i["#text"],i.__text instanceof Array&&(i.__text=i.__text.join("\n")),e.escapeMode&&(i.__text=a(i.__text)),e.stripWhitespaces&&(i.__text=i.__text.trim()),delete i["#text"],e.arrayAccessForm=="property"&&delete i["#text_asArray"],i.__text=c(i.__text,d,n+"."+d)),i["#cdata-section"]!=null&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],e.arrayAccessForm=="property"&&delete i["#cdata-section_asArray"]),i.__cnt==1&&i.__text!=null?i=i.__text:i.__cnt==0&&e.emptyNodeForm=="text"?i="":i.__cnt>1&&i.__text!=null&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&i.__text==""||i.__text.trim()=="")&&delete i.__text,delete i.__cnt,e.enableToStringFunc&&(i.__text!=null||i.__cdata!=null)&&(i.toString=function(){return(this.__text!=null?this.__text:"")+(this.__cdata!=null?this.__cdata:"")}),i}if(t.nodeType==r.TEXT_NODE||t.nodeType==r.CDATA_SECTION_NODE)return t.nodeValue}function p(t,n,r,i){var s="<"+(t!=null&&t.__prefix!=null?t.__prefix+":":"")+n;if(r!=null)for(var o=0;o<r.length;o++){var a=r[o],f=t[a];e.escapeMode&&(f=u(f)),s+=" "+a.substr(e.attributePrefix.length)+"='"+f+"'"}return i?s+="/>":s+=">",s}function d(e,t){return"</"+(e.__prefix!=null?e.__prefix+":":"")+t+">"}function v(e,t){return e.indexOf(t,e.length-t.length)!==-1}function m(t,n){return e.arrayAccessForm=="property"&&v(n.toString(),"_asArray")||n.toString().indexOf(e.attributePrefix)==0||n.toString().indexOf("__")==0||t[n]instanceof Function?!0:!1}function g(e){var t=0;if(e instanceof Object)for(var n in e){if(m(e,n))continue;t++}return t}function y(t){var n=[];if(t instanceof Object)for(var r in t)r.toString().indexOf("__")==-1&&r.toString().indexOf(e.attributePrefix)==0&&n.push(r);return n}function b(t){var n="";return t.__cdata!=null&&(n+="<![CDATA["+t.__cdata+"]]>"),t.__text!=null&&(e.escapeMode?n+=u(t.__text):n+=t.__text),n}function w(t){var n="";return t instanceof Object?n+=b(t):t!=null&&(e.escapeMode?n+=u(t):n+=t),n}function E(e,t,n){var r="";if(e.length==0)r+=p(e,t,n,!0);else for(var i=0;i<e.length;i++)r+=p(e[i],t,y(e[i]),!1),r+=S(e[i]),r+=d(e[i],t);return r}function S(e){var t="",n=g(e);if(n>0)for(var r in e){if(m(e,r))continue;var i=e[r],s=y(i);if(i==null||i==undefined)t+=p(i,r,s,!0);else if(i instanceof Object)if(i instanceof Array)t+=E(i,r,s);else if(i instanceof Date)t+=p(i,r,s,!1),t+=i.toISOString(),t+=d(i,r);else{var o=g(i);o>0||i.__text!=null||i.__cdata!=null?(t+=p(i,r,s,!1),t+=S(i),t+=d(i,r)):t+=p(i,r,s,!0)}else t+=p(i,r,s,!1),t+=w(i),t+=d(i,r)}return t+=w(e),t}var t="1.1.4";e=e||{},n(),i();var r={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){if(e===undefined)return null;var t;if(window.DOMParser){var n=new window.DOMParser,r=n.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI;t=n.parseFromString(e,"text/xml"),t.getElementsByTagNameNS(r,"parsererror").length>0&&(t=null)}else e.indexOf("<?")==0&&(e=e.substr(e.indexOf("?>")+2)),t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},this.asArray=function(e){return e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():typeof e=="number"?(new Date(e)).toISOString():null},this.asDateTime=function(e){return typeof e=="string"?l(e):e},this.xml2json=function(e){return h(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return t!=null?this.xml2json(t):null},this.json2xml_str=function(e){return S(e)},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return t}}require.config({paths:{templateBasePath:"com/es/Default_Templates"},theme:"default",resourceBundle:"default",assessmentConfig:{is_trackable:!1,single_ques_quiz:!1,is_persistable:!1},glossaryConfig:{lineCount:2},allowBookTheme:!1,fitToWidth:!0,readerCss:["com/external/videojs/video-js.css","css/widget_global.css","css/widget_color.css","css/widgets_fonts.css","css/widgets_glossary.css","css/widget.css","css/widgets_slidernav.css","com/external/galleria/galleria.classic.css","themes/jbl/css/widgets_theme.css"],iframeCss:["css/widget_global.css","css/widget_color.css","css/widgets_iFrameWidget.css","com/external/videojs/video-js.css","themes/jbl/css/widgets_iframeTheme.css"],iframeCss_android4:["widgets_iframeTheme-4.2.2","widgets_theme-4.2.2"]}),define("main-config",function(){}),define("com/es/widgets/WidgetConstants",[],function(){return window.WIDGET_CONSTANTS||(window.WIDGET_CONSTANTS={VERSION:"1.0.56.7",GALLERY_WIDGET:"gallery",IMAGE_WIDGET:"image",VIDEO_WIDGET:"video",AUDIO_WIDGET:"audio",TIP_WIDGET:"tip",HTML_WIDGET:"HTML",FILE_WIDGET:"file",ASSESSMENT_WIDGET:"assessment",LEARNOSITY_WIDGET:"learnosity",LEARNOSITY_SERVICE_BASE_URL:"",LEARNOSITY_ACCESS_TOKEN:"",LEARNOSITY_STANDALONE:!1,HODDERASSESS_WIDGET:"HDLAssess",HDLREPORTS_WIDGET:"HDLReports",EOW_WIDGET:"eow",EOW_SERVICE_BASE_URL:"",EOW_LDL_SERVER:"",EOW_LDL_SERVICE_URL:"",EOW_GROUPS:"",EOW_STANDALONE:!1,EOW_RDR_HTML_PATH:"",EOW_CLOSE_ETA_POPUP:"closeETAPopup",SEEK:5,DATA_MODE_TRANSPARENT:"transparent",DATA_MODE_OPAQUE:"opaque",DATA_MODE_INLINE:"inline",DATA_MODE_COMPACT:"compact",DATA_MODE_POSTER:"poster",DATA_BORDER_SHOW:"show",DATA_BORDER_HIDDEN:"hidden",DATA_HASVIEW_YES:"yes",DATA_HASVIEW_NO:"no",DATA_BORDER_YES:"yes",DATA_BORDER_NO:"no",DATA_BORDER_TRUE:"true",DATA_BORDER_FALSE:"false",DATA_LAYOUT_REFLOW:"reflow",DATA_LAYOUT_FIXED:"fixed",MIN_WIDTH:150,MIN_HEIGHT:150,AUDIO_MIN_WIDTH:254,AUDIO_MIN_HEIGHT:202,AUDIO_MAX_WIDTH:300,VIDEO_MIN_WIDTH:300,VIDEO_MIN_HEIGHT:200,IMAGE_MIN_WIDTH:250,IMAGE_MIN_HEIGHT:250,TIP_MIN_WIDTH:300,TIP_MIN_HEIGHT:95,HTML_MIN_WIDTH:300,HTML_MIN_HEIGHT:95,TP_MIN_WIDTH:300,TP_MIN_HEIGHT:95,FILE_MIN_WIDTH:300,FILE_MIN_HEIGHT:95,IMAGE_GAL_MIN_WIDTH:250,IMAGE_GAL_MIN_HEIGHT:250,ASSESSMENT_MIN_WIDTH:300,ASSESSMENT_MIN_HEIGHT:200,ASSETS_URL:"",DOWNLOADED_ASSETS_URL:"",DOWNLOAD_SUPPORTED:!1,CONTENT_BASE_URL:"",DESCRIPTION_EXPAND:"More",DESCRIPTION_COLLAPSE:"Less",LOCALE_COOKIE_NAME:"myAppLocaleCookie",NETWORK_AVAILABLE:!0,USER_ID:"",USER_NAME:"",USER_ROLE:"",BOOK_ID:"",BOOK_ISBN_NO:"",BOOK_TITLE:"",BOOK_TYPE:"",APPLICATION_TYPE:"Reader",LOCALE:"",USER_LOGIN_TIME:"",USER_LOGIN_TYPE:"",EDITOR_LABEL:"Editor",HODDERASSESS_BASE_URL:"http://10.12.65.70:8080/pubportal/QA/",HODDERASSESS_HTML_LAUNCH_URL:"testingPage.html",ACCESS_TOKEN:"",CLOSE_WIDGET_POPUP:"closeWidgetPopup",HDL_ASSESS_PROPERTIES:null,HDL_REPORTS_PROPERTIES:null,HDL_WIDGET_CODE_BASE_PATH:"com/external/Widget_HodderCodeBase/Hodder_HTML5_Assessment/www/index.html",HDL_REPORT_WIDGET_CODE_BASE_PATH:"com/external/Widget_HodderCodeBase/Hodder_HTML5_Assessment//www/reportCard.html",HOME_PAGE_URL:"",PRINT_MODE:!1,THIRD_PARTY_PATH:{saras:"com/external/saras/index.html"}}),window.WIDGET_CONSTANTS}),define("com/es/controllers/router",[],function(){var e,t=Backbone.Router.extend({routes:{":userId/:bookId":"launchBook",":userId/":"launchBook",":userId/:bookId/:pageId":"loadBookPage",":userId/:bookId/":"loadBookPage","*actions":"defaultAction"}}),n=function(n){e=n;var r=new t;r.on("route:defaultAction",function(e){}),r.on("route:launchBook",function(t,n){if(!n){window.location.href=window.location.origin+"/pubportal/bookdefault.excel";return}var r=function(t){e.launchBook(n,t)},i=function(e){console.log(e)};e.getUserInfo(t,r,i)}),r.on("route:loadBookPage",function(t,n,r){if(AppConst.BOOK_ID!=n||!r){AppConst.PAGE_ID=r?r:"";var i=t+"/"+n;this.navigate(i,{trigger:!0});return}if(e.isBookMetaLoaded()===!1){AppConst.PAGE_ID=r;var s=window.location.href;s=s.replace("/"+r,""),window.location.href=s}else e.loadBookPage(n,r)}),Backbone.history.start()};return{initialize:n}}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("com/es/text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"0.27.0",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&i.inlineText&&(u[e]=n),r(n)},load:function(e,t,n,u){var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("com/es/text!templateBasePath/Editor/author/authorViewTemplate.html",[],function(){return'<header id="widgetsContainer" class="navbar navbar-default" role="navigation">\n</header>\n<section class="col-lg-12 top-border">\n	<div class="row-offcanvas row-offcanvas-left">\n		<div id="div-widget-container">\n		<div class="header-sepration"></div>\n    <div class="widget-actions"  id="widgetIconsContainer">\n	<div class="widget-icons">\n	<div class="label widgetIcon"><div  id="imageIcon" class="image-widget-icon center imageIcon"></div><%=AppLang.IMAGE_ICON_LABEL%></div>\n	<div class="label widgetIcon"><div id="imageGalIcon" class="imageGallery-widget-icon center imageGalIcon"></div><%=AppLang.IMAGE_GALLERY_ICON_LABEL%></div>\n	<div class="label widgetIcon" ><div id="videoIcon" class="video-widget-icon center  videoIcon"></div><%=AppLang.VIDEO_ICON_LABEL%></div>\n	<div class="label widgetIcon"><div id="audioIcon" class="audio-widget-icon center  audioIcon"></div><%=AppLang.AUDIO_ICON_LABEL%></div>\n	<div class="label widgetIcon"><div id="assessmentIcon" class="quiz-widget-icon center  assessmentIcon"></div><%=AppLang.ASSESSMENT_ICON_LABEL%></div>\n	<div class="label widgetIcon"><div id="tipIcon" class="tip-widget-icon center  tipIcon"></div><%=AppLang.TIP_ICON_LABEL%></div>\n	<div class="label widgetIcon"><div id="htmlIcon" class="html-widget-icon center  htmlIcon"></div><%=AppLang.HTML_ICON_LABEL%></div>\n	<div class="label widgetIcon"><div id="fileIcon" class="file-widget-icon center  fileIcon"></div><%=AppLang.FILE_ICON_LABEL%></div>\n	<div class="label widgetIcon"><div id="sarasIcon" class="saras-widget-icon center sarasIcon"></div><%=AppLang.TP_ICON_LABEL%></div>\n\n	\n	<!--<div class="label widgetIcon"><div class="tip-widget-icon center"></div>Tips</div>\n	<div class="label widgetIcon"><div class="quiz-widget-icon center"></div>Quiz</div>\n	--></div>\n	\n\n    </div>\n	\n</div>\n		\n		<section id="contentIframeContainer" class="contentIframeContainer">\n		\n		</section></div>\n		<div id = "tocContainer" class="toc-container col-xs-6 col-sm-3">\n		</div>\n		\n		<div id = "editTocViewContainer" class="edit-toc-view-container" style="display: none;">\n			<div id = "editTocView" class="edit-toc-view" style="width: 300px;">\n				<div id = "editTocContainer" class="toc-container col-xs-6 col-sm-3">\n				</div>\n			</div>\n			<div id = "editableTocView" class="editable-toc-view" style="width: 600px;height: 100%;background-color: white;">\n				<div id="editableTocWrapper" class="editableTocWrapper">\n					<ul id="editableTocContainer" class="editableTocContainer">\n					</ul>\n				</div>\n			</div>\n		</div>	\n		<div id = "glossaryContainer" class="glossaryContainer" style="display: none;">\n		</div>\n		\n			\n</section>\n\n\n\n\n<!--\n<div class="login-bottom">\n  <div class="login-bottom-row clearfix">\n    <div class="pull-left"><%=AppLang.COPYRIGHT%></div>\n    <div class="div-center"><%=AppLang.VERSION%></div>\n    <div class="pull-right"><img src="images/footer-logo.png" border="0" alt="ExcelSoft"></div>\n  </div>\n</div>-->\n'}),define("com/es/text!templateBasePath/Editor/popups/popUpTemplate.html",[],function(){return'<div class="popUpContainer">\r\n	<div id="loading-indicator" class="modal-dialog loading-indicator" >\r\n	    	<img class="preloader"/>\r\n	</div>\r\n	<!--div id="js-alert" class="modal-dialog alert alert-warning js-alert fade">\r\n	    <p class="js-alert-text"></p>\r\n	</div-->\r\n\r\n	<div id="js-alert" class="modal popup-alert-cover fade in" tabindex="-1" role="dialog">\r\n	    <div class="modal-dialog popup-alert modal-sm">\r\n	      <div class="modal-content">\r\n	        <!--div class="modal-header">\r\n	          <h4 class="modal-title alert-text" id="js-alert-text"></h4>\r\n	        </div-->\r\n	        <div class="modal-body">\r\n	          <p id="js-alert-text" class="alert-text"></p>\r\n	          <button type="button" class="btn btn-default cancelbtn" data-dismiss="modal" aria-label="Close">Close</button>\r\n	        </div>\r\n	      </div>\r\n	    </div>\r\n	</div>\r\n\r\n\r\n	\r\n	<div id="toastContainer" class="modal-dialog toastContainer" >\r\n	    <div id="toastMsg" class="modal-content">\r\n		</div>\r\n	</div>\r\n	<div id="confirmPopupCover" class="modal fade in">		\r\n	</div>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/author/tocView/tocViewTemplate.html",[],function(){return'<div class="bookMetaData">\n	<span class="cover"><img/></span>\n	<div class="inline-block"><span class="title"></span>\n	<span class="author"></span></div>\n	\n</div>\n<!--div class="editTocContent">\n	<div class="editBtnContainer">\n		<a href="javascript:void(0)" id="editTocBtn"> <%=AppLang.EDIT_LABEL%> </a>\n	</div>\n</div-->\n<nav id = "tocContainerContent" class="toc-container" role="navigation">\n		</nav>  \n<div class="version-no"  id="appVersion" >\n	<%=AppLang.VERSION%>\n</div>'}),define("com/es/text!templateBasePath/Editor/author/tocView/tocItemTemplate.html",[],function(){return'<span class="tocItem" id="<%=url%>" data-id="<%=id%>"><%=label%></span>'}),define("com/es/models/TocModel",[],function(){var e=Backbone.Model.extend({defaults:{url:""}});return e}),define("com/es/models/AssetPopupModel",[],function(){var e=Backbone.Model.extend({defaults:{type:""}});return e}),define("com/es/collections/TocCollection",["com/es/models/AssetPopupModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),define("com/es/text!templateBasePath/Editor/popups/confirmationPopupTemplate.html",[],function(){return'\r\n	<div class="confirmPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n				<div class="title modal-title"><%=AppLang.CONFIRMATION_POPUP_TITLE%></div>\r\n			</div>		\r\n			\r\n			<div class="modal-body message">\r\n				<%=AppLang.CONFIMATION_MESSAGE%>\r\n			</div>\r\n			\r\n			<div class="bottomBar modal-footer">\r\n				<div>\r\n					<button type="button" id="yes" class=" btn btn-default" ><%=AppLang.CONFIRMATION_POPUP_YES%></button>\r\n					<button type="button" id="no" class=" btn btn-primary" ><%=AppLang.CONFIRMATION_POPUP_NO%></button>\r\n	       			<button type="button" id="cancel" class=" btn btn-primary" ><%=AppLang.CONFIRMATION_POPUP_CANCEL%></button>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n'}),define("com/es/widgets/WidgetUtils",[],function(){var e=new Object;return e.log=function(e){},e.isTouchDevice=function(){var e=String(document.documentElement.ontouchmove)!="undefined"?!0:!1;return e},e.isPhone=function(){return window.innerWidth<768?!0:!1},e.isiPhoneOriPod=function(){var e=navigator.userAgent,t=e.match(/iPhone/i),n=e.match(/iPod/i);return t||n?!0:!1},e.fillRange=function(e,t){var n=$(e).parent().css("color"),r=$(e).css("color");t*=100;var i="background: -webkit-linear-gradient(left, "+n+" 0%, "+n+" "+t+"%, "+r+" "+t+"%, "+r+" 100%);";i+="background: -moz-linear-gradient(left, "+n+" 0%, "+n+" "+t+"%, "+r+" "+t+"%, "+r+" 100%);",i+="background: -o-linear-gradient(left, "+n+" 0%, "+n+" "+t+"%, "+r+" "+t+"%, "+r+" 100%);";var s=$(e).attr("style"),o=s?s+" "+i:i;$(e).attr("style",o)},e.isIE=function(){if(navigator.userAgent.indexOf("MSIE")!=-1)var e=/MSIE (\d+\.\d+);/;else var e=/Trident.*rv[ :]*(\d+\.\d+)/;var t=e.test(navigator.userAgent);return t},e.getIEVersion=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=0;return t>0&&(n=parseInt(e.substring(t+5,e.indexOf(".",t)))),n},e.isAndriod=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android")>-1;return t},e.isIOS=function(){var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;return e},e.getAndroidVersion=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android"),n=0;return t!=-1&&(n=parseFloat(e.match(/android\s+([\d\.]+)/)[1])),n},e.parseHTML=function(e,t,n){if($.parseHTML)return $.parseHTML(e);if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,i=r.exec(e),s=!n&&[];return i?[t.createElement(i[1])]:(i=$.buildFragment([e],t,s),s&&$(s).remove(),$.merge([],i.fragment.childNodes))},e.setCookie=function(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="; expires="+r.toGMTString()}else var i="";document.cookie=e+"="+t+i+"; path=/"},e.getCookie=function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null},e.delCookie=function(t){e.setCookie(t,"",-1)},e.setLangCode=function(t,n){var r="en",i,s,o,u,a,f,l=String(document.documentElement.ontouchmove)!="undefined"?!0:!1;l?i=localStorage.getItem(WIDGET_CONSTANTS.LOCALE_COOKIE_NAME):i=e.getCookie(WIDGET_CONSTANTS.LOCALE_COOKIE_NAME),s=i&&i.toString().length>0?i:r,f=require.s.contexts._.config.resourceBundle?require.s.contexts._.config.resourceBundle:"default",o=s?require.toUrl("./resourceBundle/"+f+"/Strings/Strings_"+s+"/"+n):"",s!=="en"&&(u=require.toUrl("./resourceBundle/"+f+"/Strings/Strings_"+r+"/"+n)),a=function(e){window[t]=e,t==="AppLang"&&(window[t].VERSION+=WIDGET_CONSTANTS.VERSION)},$.ajax({async:!1,url:o,dataType:"json"}).done(function(e,t,n){a(e),WIDGET_CONSTANTS.LOCALE=s}).fail(function(e,t){console.error("Failed to load url: "+o+" with message: "+t),t==="error"&&u&&$.ajax({async:!1,url:u,dataType:"json"}).done(function(e,t,n){a(e),WIDGET_CONSTANTS.LOCALE=r}).fail(function(e,t){console.error("Failed to load url: "+u+" with message: "+t)})})},e.getOffset=function(e){return{left:e.get(0).offsetLeft,top:e.get(0).offsetTop}},e.getCleanURL=function(e){var t;return e.indexOf("file:///")>=0?(t=e.substr(e.indexOf("file:///")+8),t=t.replace(/([^:]\/)\/+/g,"$1"),t="file:///"+t):t=e.replace(/([^:]\/)\/+/g,"$1"),t},e.showLoader=function(){$("#loading-indicator").modal({show:!0,keyboard:!1,backdrop:"static"}),$(".modal-backdrop").last().css("z-index","9000")},e.hideLoader=function(){$("#loading-indicator").modal("hide")},e.sortObjByKey=function(e){var t=e,n=[],r,i,s,o={};for(r in t)t.hasOwnProperty(r)&&n.push(r);n.sort(),s=n.length;for(i=0;i<s;i++)r=n[i],o[r]=t[r];return o},e.injectCSSFile=function(t){var n=document.getElementsByTagName("head")[0],r=require.s.contexts._.config.readerCss;for(i=0;i<r.length;i++){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href="widgets/"+r[i],n.appendChild(s)}iframeHeadTag=t.document.getElementsByTagName("head")[0];var o=window.location.origin,u=window.location.pathname.split("/");u.pop();var a=u.join("/")+"/widgets/",f=require.s.contexts._.config.iframeCss;for(i=0;i<f.length;i++){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=o+a+"/"+f[i],iframeHeadTag.appendChild(s)}if(parseFloat(e.getAndroidVersion())<4.4&&e.isAndriod()){var l=require.s.contexts._.config.iframeCss_android4;for(i=0;i<l.length;i++){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=o+a+"/"+l[i],iframeHeadTag.appendChild(s)}}},e.getSvcParams=function(e){var t={};return e.data&&(t.data=e.data),e.type&&(t.type=e.type),e.url&&(t.url=e.url),e.contentType&&(t.contentType=e.contentType),e.success&&(t.success=e.success),e.error&&(t.error=e.error),e.context&&(t.context=e.context),e.crossDomain&&(t.crossDomain=e.crossDomain),e.headers&&(t.headers=e.headers),e.mimeType&&(t.mimeType=e.mimeType),e.statusCode&&(t.statusCode=e.statusCode),t},e.getWidgetProperties=function(e){var t=window.location.pathname.split("/")[1],n=window.location.origin+"/"+t+"/pubservice/";$.get(n+"/widget/props.excel?type="+e.type,function(e,t){}).done(function(t){console.log("second success",t),e.successCallback(t)}).fail(function(){console.log("error")})},e}),define("com/es/utilities/utils",["com/es/utilities/services","com/es/text!templateBasePath/Editor/popups/confirmationPopupTemplate.html","com/es/widgets/WidgetUtils"],function(e,t,n){var r=new Object;return r.DEFAULT_TOASTER_DURATION=1e3,r.log=function(e){},r.rewriteProperty=function(e,t,n){if(typeof e!="object")return e;for(var r in e)e.hasOwnProperty(r)&&(e[r.replace(t,n)]=this.rewriteProperty(e[r],t,n),r.indexOf(t)>-1&&delete e[r]);return e},r.showLoader=function(){$("#loading-indicator").modal({show:!0,keyboard:!1,backdrop:"static"}),$(".modal-backdrop").last().css("z-index","9000")},r.hideLoader=function(){$("#loading-indicator").modal("hide")},r.showAlert=function(e){if(!e)return!1;var t=e.toLowerCase().toString(),n=$("#js-alert"),r=$(".alert-text",n);r.html(t),n.modal({show:!0,keyboard:!1,backdrop:"static"}),n.on("hidden.bs.modal",function(e){r&&r.html(""),$(this).off("hidden.bs.modal")})},r.hideAlert=function(){},r.showToasterMessage=function(e,t,n,i){if(t==undefined||t==null||t=="")t=r.DEFAULT_TOASTER_DURATION;$("#toastMsg").text(e);var s=$(window).height()/2-$("#toastContainer").outerHeight()/2;$("#toastContainer").css({top:s,margin:"auto"}),$(".popUpContainer").addClass("onshow"),$("#toastContainer").modal("show"),r.myTimer=setTimeout(r.hideToasterMessage.bind(r,n,i),t)},r.hideToasterMessage=function(e,t){clearTimeout(r.myTimer),$("#toastContainer").modal("hide"),$(".popUpContainer").removeClass("onshow"),e!=undefined&&e!=null&&e(t)},r.showConfirmPopUp=function(e,n,r,i){var s=$("#confirmPopupCover"),o=_.template(t,{});$("#confirmPopupCover").attr("tabindex","-1"),s.html("").append(o),r!=undefined&&r!=undefined&&r!=undefined&&_.each(r,function(e){s.find("#"+e).remove()}),$(".title",s).html(n),$(".message",s).html(e),$(".bottomBar",s).find(".btn").unbind().bind(AppEvent.CLICK,function(e){s.modal("hide"),i(e.target.id)}),s.off("hidden.bs.modal").on("hidden.bs.modal",function(){$(".bottomBar",s).find(".btn").unbind(),s.html(""),$("body").css("overflow","auto")}),$("body").css("overflow","hidden"),s.modal("show")},r.loadJsCssFile=function(e,t,n,r){var i,s;s=e.get(0).contentWindow,r=="js"?(i=s.document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",t+"/"+n+".js")):r=="css"&&(i=s.document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",t+"/"+n+".css")),typeof i!="undefined"&&s.document.getElementsByTagName("head")[0].appendChild(i)},r.checkAddJsCssFile=function(e,t,n,i){var s,o,u,a,f,l=!1;o=e.get(0).contentWindow,i=="js"?s=t+"/"+n+".js":i=="css"&&(s=t+"/"+n+".css"),u=i=="js"?"script":i=="css"?"link":"none",a=i=="js"?"src":i=="css"?"href":"none",f=o.document.getElementsByTagName(u),l||r.loadJsCssFile(e,t,n,i)},r.getIframePageHtml=function(){var e=["jquery-ui.css","widgets.css","widgets_iFrameWidgetEditor.css","widgets_iFrameWidget.css","widget_color.css","widget_global.css","iframeTheme"],t=document.getElementById("authoringIframe"),n=t.contentWindow.document.documentElement,i=$("body",$(t).contents()).width(),s=jQuery(n).clone(),o=r.removeExtraContent(e,s,i),u='<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html>'+o.prop("outerHTML");return u},r.removeCssFile=function(e,t){return _.each(e,function(e){$('link[href*="'+e+'"]',t).remove()}),t},r.removeExtraContent=function(e,t,n){var i=$("#authoringIframe").contents(),s=["block"];$("#tinyhippos-injected",t).remove(),$("body",t).removeAttr("contenteditable"),$("body",t).removeAttr("dropzone"),$(".widget-ui",t).remove();var o=$(".widget-placeholder",t);o.find(".dummyWidget").remove(),o.find(".ui-resizable-handle").remove(),o.find(".move-icon").remove(),o.removeAttr("draggable"),o.removeAttr("contenteditable"),o.removeClass("ui-resizable"),o.removeClass("widgetFrame");var u=o.length;if(AppConst.BOOK_TYPE=="reflowable"){o.css("height","");for(var a=0;a<u;a++){var f=$(o[a]),l=$("div[id='"+f.get(0).id+"']",i),c=l.parent(),h=0;while(c.css("display").toLowerCase()=="inline")h++,c=c.parent();var p=c.width(),d=l.width();f.data("align")=="fitToWidth"&&(f.data("type")=="image"||f.data("type")=="imageGal"||f.data("type")=="video"||f.data("type")=="assessment"&&f.data("mode")=="poster")?(d=$("#ui-"+f.get(0).id+" img",i).width()/$("#"+f.get(0).id,i).width()*100+"%",f.attr("data-width",d),f.css("height",f.data("height"))):d=d/p*100+"%",f.css("width",d)}}else for(var a=0;a<u;a++){var f=$(o[a]);if(f.data("mode")=="compact"&&f.data("border")){var d=$("#div-border-ui-"+f.attr("id"),$("#authoringIframe").contents()).width(),v=$("#div-border-ui-"+f.attr("id"),$("#authoringIframe").contents()).height();$("#div-border-ui-"+f.attr("id"),t).remove(),f.css("width",d),f.css("height",v)}}var m=r.removeCssFile(e,t);return m},r.getDateFormat=function(e){var t=new Date(e),n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],i=n[t.getDay()],s=r[t.getMonth()],o=i+", "+s+" "+t.getDate()+", "+t.getFullYear();return o},r.clone=function(e){if(Object.prototype.toString.call(e)==="[object Array]"){var t=[],n=0,r=e.length;for(;n<r;n++)t[n]=arguments.callee(e[n]);return t}if(typeof e=="object"){var t={},n;for(n in e)t[n]=arguments.callee(e[n]);return t}return e},r.isTouchDevice=function(){var e=String(document.documentElement.ontouchmove)!="undefined"?!0:!1;return e},r.string2Bin=function(e){var t=[];for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},r.arrayBufferToBinaryString=function(e){var t="",n=new Uint8Array(e),r=n.byteLength;for(var i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t},r.string2ArrayBuffer=function(e){var t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(var r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t},r.bin2String=function(e){return String.fromCharCode.apply(String,e)},r.encode_utf8=function(e){return unescape(encodeURIComponent(e))},r.makeOptionsSortable=function(e,t,n){$(e).addClass("sortableOptions"),$(e).sortable({handle:"span.dragIcon",containment:t,update:function(e,t){n&&n()},start:function(){}})},r.getURlQueryStringParams=function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++)t=n[r].split("="),e.push(t[0]),e[t[0]]=t[1];return e},r.removeNbsp=function(e){var t;return e?t=e.replace(/&nbsp;/g,"").trim():t="",t},r.userInputValidator=function(e,t){var n=!1,r="";return t?e.find("img").length>0?(n=!0,n):(r=e.text().replace(/&nbsp;/g,"").trim(),r=r.replace("​",""),r?(n=!0,n):(n=!1,n)):(r=e.text().replace(/&nbsp;/g,"").trim(),r=r.replace("​",""),r?(n=!0,n):(n=!1,n))},r.sortObjByKey=function(e){var t=e,n=[],r,i,s,o={};for(r in t)t.hasOwnProperty(r)&&n.push(r);n.sort(),s=n.length;for(i=0;i<s;i++)r=n[i],o[r]=t[r];return o},r.isIE=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("msie")>-1;return t},r.isPhone=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:!1},r.getQuestionTypeById=function(e){var t=[{quesTypeID:101,quesType:"MCQ Single Response"},{quesTypeID:102,quesType:"MCQ Multiple Response"},{quesTypeID:103,quesType:"FIB Text"},{quesTypeID:104,quesType:"FIB Tap and Place"},{quesTypeID:105,quesType:"FIB Drop Down"},{quesTypeID:106,quesType:"Matching"},{quesTypeID:107,quesType:"Grouping"},{quesTypeID:108,quesType:"True or False"},{quesTypeID:109,quesType:"Collection"}],n="";return n=_.findWhere(t,{quesTypeID:parseInt(e)})?_.findWhere(t,{quesTypeID:parseInt(e)}).quesType:"",n},r.mouseWheel=function(e){$(e).on("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent,n=t.wheelDelta||-t.detail;this.scrollTop+=(n<0?1:-1)*30,e.preventDefault()})},r.checkProtocol=function(e){var e=e,t=e.split("http:"),n="https:";if(window.location.protocol===n){var r=n+t[1];return r}return e},r}),define("com/es/utilities/services",["com/es/utilities/utils"],function(e){var t=new Object;return t.getBookMetadata=function(e){var t=e.model,n=e.successCallback,r=e.errorCallback;bookId=e.id,t.url=AppConst.SERVICE_BASE_URL+"book/"+bookId+"/details",t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.tocData=function(e){e.tocCollection.url=e.id+"/TOCData.json",e.tocCollection.fetch({success:function(t){e.successCallback(t)},error:function(t){e.errorCallback(t)}})},t.getAssetList=function(t){var n;t.assetListCollection.url=t.url,n={type:t.type,term:t.term,sortedby:t.sortedby,pageSize:t.pageSize,pageIndex:t.pageIndex},e.log("popupparams",t),t.assetListCollection.fetch({type:"POST",data:n,success:function(e){t.successCallback(e)},error:function(e){t.errorCallback(e)}})},t.getSelectedAssetData=function(e){var t="epub_content/assets/"+e.path;$.getJSON(t,{}).done(function(t){e.successCallback(t)}).fail(function(t,n,r){e.errorCallback(r)})},t.saveAndPublish=function(e){var t=unescape(AppConst.PAGE_NAME).split("#")[0],n={data:encodeURIComponent(e.data),page:t,enrichment:encodeURIComponent(e.enrichment),quiz:encodeURIComponent(e.quiz)};$.ajax({type:"POST",url:AppConst.SERVICE_BASE_URL+"book/"+AppConst.BOOK_ID+"/save",data:n,success:function(t){e.successCallback(e.callback,e.status)},error:function(t,n,r){e.errorCallback(n)}})},t.getUserInfo=function(e){var t=e.model,n=e.successCallback,r=e.errorCallback;t.url=AppConst.SERVICE_BASE_URL+AppConst.USER_SERVICE_SUB_URL+e.id,t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.getLinkList=function(e){var t=e.linkCollection,n=e.successCallback,r=e.errorCallback;t.url="epub_content/assetLists/linkList.json",t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.getGlossaryData=function(e){var t=e.glossaryCollection,n=e.successCallback,r=e.errorCallback;t.url="epub_content/glossary.json",t.fetch({success:function(e){n(e)},error:function(e){r(e)}})},t.getOPFData=function(e){$.ajax({type:"GET",url:e.baseUrl,dataType:"xml",success:function(t){var n=new X2JS,r=n.xml2json(t),i=r.package;e.successCallback(i)},error:function(t){e.errorCallback(t)}})},t.getSpineData=function(e){$.ajax({type:"GET",url:e.baseUrl,dataType:"xml",success:function(t){var n=new X2JS,r=n.xml2json(t),i=r.package.manifest.item;e.successCallback(i)},error:function(t){e.errorCallback(t)}})},t.unlockBook=function(e){$.ajax({type:"GET",url:AppConst.SERVICE_BASE_URL+"book/unlock/"+AppConst.BOOK_ID+"?userId="+e.userID,success:function(t){e.successCallback(t)},error:function(t,n,r){e.failureCallback(n)}})},t.saveTOCData=function(e){var t=JSON.stringify(e.data),n={data:t,isSampleBookDefined:e.isSampleBookDefined};$.ajax({type:"POST",url:AppConst.SERVICE_BASE_URL+"book/"+AppConst.BOOK_ID+"/toc",data:n,success:function(t){e.success()},error:function(t,n,r){console.log("error in saving updated toc data"),e.error()}})},t.redirectLibrary=function(n){if(n){var r={userID:AppConst.USER_ID,successCallback:function(t){var n=jQuery.parseJSON(t);if(n.status=="true"){var r=window.location.href,i;i=r.substring(0,r.indexOf("/QA/")+1),i+="bookdefault.excel",window.location.href=i}else e.showToasterMessage(AppLang.UNABLE_TO_UNLOCK_FILE_FOR_USER_MESSAGE+AppConst.USER_ID,2e3,function(){var e=window.location.href,t;t=e.substring(0,e.indexOf("/QA/")+1),t+="bookdefault.excel",window.location.href=t})},failureCallback:function(e){console.log("Error occured: ",e)}};t.unlockBook(r)}else{var i=window.location.href,s;s=i.substring(0,i.indexOf("/QA/")+1),s+="bookdefault.excel",window.location.href=s}},t.redirectLogout=function(){var e=window.location.href,t;t=e.substring(0,e.indexOf("/QA/")+1),window.location.href=t+AppConst.LOGOUT_SERVICE_SUB_URL},t.fetchGlossaryData=function(e){e.glossaryCollection.url="/pubportal/QA/com/es/data/glossary.json",e.glossaryCollection.fetch({success:function(t){e.successCallback(t)},error:function(t){e.errorCallback(t)}})},t.fetchQuestionData=function(e){$.ajax({type:"GET",url:e.url,success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}})},t.fetchLrnActivity=function(e){var t={type:"GET",url:e.url,success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}};WIDGET_CONSTANTS.APPLICATION_TYPE==="Reader"&&(t.headers={userId:WIDGET_CONSTANTS.USER_ID}),$.ajax(t)},t.fetchLrnSignature=function(e){var t={security:e.data.securityObj,request:e.data.requestObj},n=null,r;t=JSON.stringify(t),WIDGET_CONSTANTS.APPLICATION_TYPE==="Editor"?n="application/json":n="text/plain",r={type:"POST",data:t,url:e.url,contentType:n,success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}},WIDGET_CONSTANTS.APPLICATION_TYPE==="Reader"&&(r.headers={userId:WIDGET_CONSTANTS.USER_ID}),$.ajax(r)},t.fetchEowData=function(e){var t={type:"POST",data:JSON.stringify(e.data),url:e.url,contentType:"application/json",success:function(t){t=typeof t=="string"?JSON.parse(t):t,e.successCallback(t)},error:function(t,n,r){e.errorCallback(n)}};$.ajax(t)},t}),define("com/es/views/TocView",["com/es/text!templateBasePath/Editor/author/tocView/tocViewTemplate.html","com/es/text!templateBasePath/Editor/author/tocView/tocItemTemplate.html","com/es/models/TocModel","com/es/collections/TocCollection","com/es/utilities/services","com/es/utilities/utils"],function(e,t,n,r,i,s){var o=Backbone.View.extend({el:$("#container"),url:"",iScroll:null,events:{"click #editTocBtn":"editTocClicked"},prevOpenNode:null,initialize:function(e){_.bindAll(this,"closeAllNodes"),this.options=e||{},this.url=window.location.href;var t=this;_.delay(function(){t.render(t.options.tocData)},100)},render:function(n){$("#tocContainer").html(_.template(e)),this.el=$("#tocContainerContent");var r=this;tttRef=r;var i=[],o=$("#tocContainer").find(".bookMetaData");$(o).find(".title").html(n.title),n.author&&$(o).find(".author").html(n.author),n.cover&&$(o).find(".cover img").attr("src",n.baseUrl+"/"+n.cover),_.each(n.toc[0],function(e){s.rewriteProperty(e,"title","label"),s.rewriteProperty(e,"topics","children"),e.label=_.template(t,e),_.each(e.children,function(e){e.label=_.template(t,e)}),i.push(e)},this),$(r.el).tree({data:i,autoEscape:!1,autoOpen:!1,keyboardSupport:!1}),this.setHeight(),this.initScroll(),$(r.el).bind("tree.click",function(e){if(e.node){var t=e.node,n=$(r.el).tree("getSelectedNode");t!=n&&(e.preventDefault(),r.trigger(AppEvent.TOC_ITEM_CLICK,function(e){if(e.toLowerCase()==="cancel")return;if(t.element.classList.contains("jqtree-folder")||t.element.parentNode.classList.contains("jqtree-tree")){var n=$(r.el).tree("getTree").children,i=!1;if($(t.parent.element).hasClass("jqtree-folder")){var s=_.without(n,t.parent);r.closeAllNodes(s,t.parent)}else{var s=_.without(n,t);r.closeAllNodes(s,t)}$(r.el).tree("openNode",t)}$(".jqtree-folder",r.el).removeClass("jqtree-selected"),$(r.el).tree("selectNode",t),r.setSelection(t),r.trigger(AppEvent.TOC_ITEM_SELECT,t),r.prevOpenNode=t}))}}),$(r.el).bind("tree.open",function(e){r.iScroll.refresh()}),$(r.el).bind("tree.close",function(e){r.iScroll.refresh()});var u;AppConst.PAGE_ID&&(u=$(document.getElementById(AppConst.PAGE_ID)).attr("data-id")),u||(u=i[0].id);var a=$(r.el).tree("getNodeById",u);if(a.element.classList.contains("jqtree-folder")||a.element.parentNode.classList.contains("jqtree-tree")){var f=$(r.el).tree("getTree").children,l=!1;if($(a.parent.element).hasClass("jqtree-folder")){var c=_.without(f,a.parent);r.closeAllNodes(c,a.parent)}else{var c=_.without(f,a);r.closeAllNodes(c,a)}$(r.el).tree("openNode",a)}$(".jqtree-folder",r.el).removeClass("jqtree-selected"),$(r.el).tree("selectNode",a),r.setSelection(a),r.trigger(AppEvent.TOC_ITEM_SELECT,a),$(window).resize(function(){r.setHeight(),r.initScroll()}),r.prevOpenNode=a},closeAllNodes:function(e,t){var n=this;if(n.prevOpenNode===null)return;n.prevOpenNode.id!==t.id&&((n.prevOpenNode.topicId===undefined||n.prevOpenNode.topicId!==t.topicId)&&$(n.el).tree("closeNode",n.prevOpenNode),(n.prevOpenNode.chapterId===undefined||n.prevOpenNode.chapterId!==t.chapterId)&&$(n.el).tree("closeNode",n.prevOpenNode)),_.each(e,function(e){$(n.el).tree("closeNode",e);if(e.children.length>0)for(var t=0;t<e.children.length;t++){var r=e.children[t];$(n.el).tree("closeNode",r)}})},getAllNodes:function(e){},setHeight:function(){var e=$("#widgetsContainer").height();e+=parseFloat($("#widgetsContainer").css("margin-top")),e+=parseFloat($("#widgetsContainer").css("margin-bottom"));var t=$("body").height();$("#tocContainer").height(t)},fetchTocData:function(){var e=this,t=new r,n=function(t){s.log("success"),e.render(t)},o=function(){console.log(error)},u={tocCollection:t,id:this.options.baseUrl,successCallback:n,errorCallback:o};i.tocData(u)},initScroll:function(){var e=this,t=$(this.el).get(0),n=$("#tocContainer").height()-$("#tocContainer").find(".bookMetaData").outerHeight()-$("#tocContainer").find(".editTocContent").outerHeight()-$(".version-no").outerHeight();$(this.el).height(n),this.iScroll!=null&&this.iScroll.destroy(),this.iScroll=new IScroll($(this.el).get(0),{desktopCompatibility:!0,interactiveScrollbars:!0,scrollY:!0}),_.delay(function(){e.iScroll.refresh()},999),window.iscroll=this.iScroll},setState:function(e){var t={open_nodes:[],selected_node:"1"}},setSelection:function(e){e.parent&&(e.parent.id&&$(e.parent.element).addClass("jqtree-selected"),e.parent.parent&&e.parent.parent.id&&$(e.parent.parent.element).addClass("jqtree-selected"))},editTocClicked:function(e){this.trigger(AppEvent.EDIT_TOC_CLICK,function(e){})}});return o}),define("com/es/models/ContentAuthoringModel",[],function(){var e=Backbone.Model.extend({defaults:{editable:"true",topicId:"",chapterId:"",spineId:"",pageUrl:""}});return e}),define("com/es/text!templateBasePath/Editor/author/ContentAuthoringTemplate.html",[],function(){return'<iframe id="authoringIframe" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"\n    src=""\n    ></iframe>'});var WIDGET_EVENTS={INITIALIZED:"initialized",LAUNCHED:"launched",POPULATED:"populated",DESTROYED:"destroyed",SHOW:"show",HIDE:"hide",CLOSED:"close",INITTIALIZE_ERROR:"intializeEerror",ALL_WIDGETS_INITIALIZED:"allWidgetsInitialized",PLAY_CLICKED:"click",RENDER_COMPLETE:"renderComplete",ALL_RENDER_COMPLETE:"allRenderComplete",HEIGHT_UPDATED:"heightUpdated",EDITED:"edited",POPUP_HIDDEN:"hidden.bs.modal",POPUP_SHOWN:"shown.bs.modal",CLICK:"click",TOUCHSTART:"touchstart",TOUCHEND:"touchend",CHANGE:"change",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",TIME_UPDATE:"timeupdate",MOUSEUP:"mouseup",ENDED:"ended",ON_PAUSE:"onpause",ON_PLAY:"onplay",POPULATE_MORE:"populateMore",ON_DONE:"onDone",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",START_TEST_CLICK:"startTest",FETCH_PREVIUOUS_ATTEMPTS:"fetchPreviousAttempts",SEND_RESPONSE_DATA:"sendResponseData",SAVE_USER_RESPONSE_DATA:"saveUserResponseData",FETCH_USER_RESPONSE_DATA:"fetchUserResponseData",TEST_TRY_AGAIN_CLICK:"tryAgainClicked",TEST_FINISH_CLICK:"finishedTest",DOWNLOAD_ACTION:"downloadAction",LAUNCH_HTML_CLICKED:"launchHtml",LAUNCH_FILE_CLICKED:"launchFile",LAUNCH_LEARNOSITY_CLICKED:"launchLearnosity",DESTROY_WEBVIEW:"destroyWebview",VIDEO_TOUCHSTART:"videoTouchStart",VIDEO_TOUCHEND:"videoTouchEnd",VIDEO_CONTROL_TOUCHSTART:"videoControlTouchStart",VIDEO_CONTROL_TOUCHEND:"videoControlTouchEnd",SHOW_ALERT_MSG:"showAlert",INVOKE_SERVICE:"invokeService",FETCH_WIDGET_PROPERTIES:"fetchWidgetProperties",THIRD_PARTY_WIDGET_LAUNCH:"thirdPartyWidgetLaunch",XAPI_EVENT:"xapiEvent",LAUNCH_TPCONTENT:"TPLaunchEvent"};define("com/es/widgets/WidgetEvents",function(){}),function(e,t,n,r){var i=t.document,s=e(i),o=e(t),u=Array.prototype,a=1.35,f=!0,l=3e4,c=!1,h=navigator.userAgent.toLowerCase(),p=t.location.hash.replace(/#\//,""),d=t.location.protocol,v=Math,m=function(){},g=function(){return!1},y=function(){var e=3,t=i.createElement("div"),n=t.getElementsByTagName("i");do t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->";while(n[0]);return e>4?e:i.documentMode||r}(),b=function(){return{html:i.documentElement,body:i.body,head:i.getElementsByTagName("head")[0],title:i.title}},w=t.parent!==t.self,E="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",S=function(){var t=[];return e.each(E.split(" "),function(e,n){t.push(n),/_/.test(n)&&t.push(n.replace(/_/g,""))}),t}(),x=function(t){var n;return typeof t!="object"?t:(e.each(t,function(r,i){/^[a-z]+_/.test(r)&&(n="",e.each(r.split("_"),function(e,t){n+=e>0?t.substr(0,1).toUpperCase()+t.substr(1):t}),t[n]=i,delete t[r])}),t)},T=function(t){return e.inArray(t,S)>-1?n[t.toUpperCase()]:t},N={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(){return"http://www.youtube.com/embed/"+this.id},getUrl:function(){return d+"//gdata.youtube.com/feeds/api/videos/"+this.id+"?v=2&alt=json-in-script&callback=?"},get_thumb:function(e){return e.entry.media$group.media$thumbnail[2].url},get_image:function(e){return e.entry.yt$hd?d+"//img.youtube.com/vi/"+this.id+"/maxresdefault.jpg":e.entry.media$group.media$thumbnail[3].url}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(){return"http://player.vimeo.com/video/"+this.id},getUrl:function(){return d+"//vimeo.com/api/v2/video/"+this.id+".json?callback=?"},get_thumb:function(e){return e[0].thumbnail_medium},get_image:function(e){return e[0].thumbnail_large}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(){return d+"//www.dailymotion.com/embed/video/"+this.id},getUrl:function(){return"https://api.dailymotion.com/video/"+this.id+"?fields=thumbnail_240_url,thumbnail_720_url&callback=?"},get_thumb:function(e){return e.thumbnail_240_url},get_image:function(e){return e.thumbnail_720_url}},_inst:[]},C=function(t,n){for(var r=0;r<N._inst.length;r++)if(N._inst[r].id===n&&N._inst[r].type==t)return N._inst[r];this.type=t,this.id=n,this.readys=[],N._inst.push(this);var i=this;e.extend(this,N[t]),e.getJSON(this.getUrl(),function(t){i.data=t,e.each(i.readys,function(e,t){t(i.data)}),i.readys=[]}),this.getMedia=function(e,t,n){n=n||m;var r=this,i=function(n){t(r["get_"+e](n))};try{r.data?i(r.data):r.readys.push(i)}catch(s){n()}}},k=function(e){var t;for(var n in N){t=e&&N[n].reg&&e.match(N[n].reg);if(t&&t.length)return{id:t[2],provider:n}}return!1},L={support:function(){var e=b().html;return!w&&(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen)}(),callback:m,enter:function(e,t,n){this.instance=e,this.callback=t||m,n=n||b().html,n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullScreen&&n.webkitRequestFullScreen()},exit:function(e){this.callback=e||m,i.exitFullscreen?i.exitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitCancelFullScreen&&i.webkitCancelFullScreen()},instance:null,listen:function(){if(!this.support)return;var e=function(){if(!L.instance)return;var e=L.instance._fullscreen;i.fullscreen||i.mozFullScreen||i.webkitIsFullScreen?e._enter(L.callback):e._exit(L.callback)};i.addEventListener("fullscreenchange",e,!1),i.addEventListener("mozfullscreenchange",e,!1),i.addEventListener("webkitfullscreenchange",e,!1)}},A=[],O=[],M=!1,_=!1,D=[],P=function(t){n.theme=t,e.each(D,function(e,t){t._initialized||t._init.call(t)}),D=[]},H=function(){return{clearTimer:function(t){e.each(n.get(),function(){this.clearTimer(t)})},addTimer:function(t){e.each(n.get(),function(){this.addTimer(t)})},array:function(e){return u.slice.call(e,0)},create:function(e,t){t=t||"div";var n=i.createElement(t);return n.className=e,n},removeFromArray:function(t,n){return e.each(t,function(e,r){if(r==n)return t.splice(e,1),!1}),t},getScriptPath:function(t){t=t||e("script:last").attr("src");var n=t.split("/");return n.length==1?"":(n.pop(),n.join("/")+"/")},animate:function(){var r=function(e){var n="transition WebkitTransition MozTransition OTransition".split(" "),r;if(t.opera)return!1;for(r=0;n[r];r++)if(typeof e[n[r]]!="undefined")return n[r];return!1}((i.body||i.documentElement).style),s={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[r],o={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},u=function(t,n,r){var i={};r=r||"transition",e.each("webkit moz ms o".split(" "),function(){i["-"+this+"-"+r]=n}),t.css(i)},a=function(e){u(e,"none","transition"),n.WEBKIT&&n.TOUCH&&(u(e,"translate3d(0,0,0)","transform"),e.data("revert")&&(e.css(e.data("revert")),e.data("revert",null)))},f,l,c,h,p,d,v;return function(i,g,y){y=e.extend({duration:400,complete:m,stop:!1},y),i=e(i);if(!y.duration){i.css(g),y.complete.call(i[0]);return}if(!r){i.animate(g,y);return}y.stop&&(i.off(s),a(i)),f=!1,e.each(g,function(e,t){v=i.css(e),H.parseValue(v)!=H.parseValue(t)&&(f=!0),i.css(e,v)});if(!f){t.setTimeout(function(){y.complete.call(i[0])},y.duration);return}l=[],c=y.easing in o?o[y.easing]:o._default,h=" "+y.duration+"ms"+" cubic-bezier("+c.join(",")+")",t.setTimeout(function(t,r,i,s){return function(){t.one(r,function(e){return function(){a(e),y.complete.call(e[0])}}(t));if(n.WEBKIT&&n.TOUCH){p={},d=[0,0,0],e.each(["left","top"],function(e,n){n in i&&(d[e]=H.parseValue(i[n])-H.parseValue(t.css(n))+"px",p[n]=i[n],delete i[n])});if(d[0]||d[1])t.data("revert",p),l.push("-webkit-transform"+s),u(t,"translate3d("+d.join(",")+")","transform")}e.each(i,function(e,t){l.push(e+s)}),u(t,l.join(",")),t.css(i)}}(i,s,g,h),2),e("#widgetContent").css({height:e("#widgetContent").parent().height()})}}(),removeAlpha:function(e){e instanceof jQuery&&(e=e[0]);if(y<9&&e){var t=e.style,n=e.currentStyle,r=n&&n.filter||t.filter||"";/alpha/.test(r)&&(t.filter=r.replace(/alpha\([^)]*\)/i,""))}},forceStyles:function(t,n){t=e(t),t.attr("style")&&t.data("styles",t.attr("style")).removeAttr("style"),t.css(n)},revertStyles:function(){e.each(H.array(arguments),function(t,n){n=e(n),n.removeAttr("style"),n.attr("style",""),n.data("styles")&&n.attr("style",n.data("styles")).data("styles",null)})},moveOut:function(e){H.forceStyles(e,{position:"absolute",left:-1e4})},moveIn:function(){H.revertStyles.apply(H,H.array(arguments))},hide:function(t,n,r){r=r||m;var i=e(t);t=i[0],i.data("opacity")||i.data("opacity",i.css("opacity"));var s={opacity:0};if(n){var o=y<9&&t?function(){H.removeAlpha(t),t.style.visibility="hidden",r.call(t)}:r;H.animate(t,s,{duration:n,complete:o,stop:!0})}else y<9&&t?(H.removeAlpha(t),t.style.visibility="hidden"):i.css(s)},show:function(t,n,r){r=r||m;var i=e(t);t=i[0];var s=parseFloat(i.data("opacity"))||1,o={opacity:s};if(n){y<9&&(i.css("opacity",0),t.style.visibility="visible");var u=y<9&&t?function(){o.opacity==1&&H.removeAlpha(t),r.call(t)}:r;H.animate(t,o,{duration:n,complete:u,stop:!0})}else y<9&&o.opacity==1&&t?(H.removeAlpha(t),t.style.visibility="visible"):i.css(o)},wait:function(r){n._waiters=n._waiters||[],r=e.extend({until:g,success:m,error:function(){n.raise("Could not complete wait function.")},timeout:3e3},r);var i=H.timestamp(),s,o,u,a=function(){o=H.timestamp(),s=o-i,H.removeFromArray(n._waiters,u);if(r.until(s))return r.success(),!1;if(typeof r.timeout=="number"&&o>=i+r.timeout)return r.error(),!1;n._waiters.push(u=t.setTimeout(a,10))};n._waiters.push(u=t.setTimeout(a,10))},toggleQuality:function(e,t){if(y!==7&&y!==8||!e||e.nodeName.toUpperCase()!="IMG")return;typeof t=="undefined"&&(t=e.style.msInterpolationMode==="nearest-neighbor"),e.style.msInterpolationMode=t?"bicubic":"nearest-neighbor"},insertStyleTag:function(t,n){if(n&&e("#"+n).length)return;var r=i.createElement("style");n&&(r.id=n),b().head.appendChild(r);if(r.styleSheet)r.styleSheet.cssText=t;else{var s=i.createTextNode(t);r.appendChild(s)}},loadScript:function(t,n){var r=!1,i=e("<script>").attr({src:t,async:!0}).get(0);i.onload=i.onreadystatechange=function(){!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(r=!0,i.onload=i.onreadystatechange=null,typeof n=="function"&&n.call(this,this))},b().head.appendChild(i)},parseValue:function(e){if(typeof e=="number")return e;if(typeof e=="string"){var t=e.match(/\-?\d|\./g);return t&&t.constructor===Array?t.join("")*1:0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(t,s,o){var u,a;e("link[rel=stylesheet]").each(function(){if((new RegExp(t)).test(this.href))return u=this,!1}),typeof s=="function"&&(o=s,s=r),o=o||m;if(u)return o.call(u,u),u;a=i.styleSheets.length;if(e("#"+s).length)e("#"+s).attr("href",t),a--;else{u=e("<link>").attr({rel:"stylesheet",href:t,id:s}).get(0);var f=e('link[rel="stylesheet"], style');f.length?f.get(0).parentNode.insertBefore(u,f[0]):b().head.appendChild(u);if(y&&a>=31){n.raise("You have reached the browser stylesheet limit (31)",!0);return}}if(typeof o=="function"){var l=e("<s>").attr("id","galleria-loader").hide().appendTo(b().body);H.wait({until:function(){return l.height()==1},success:function(){l.remove(),o.call(u,u)},error:function(){l.remove(),n.raise("Theme CSS could not load after 20 sec. "+(n.QUIRK?"Your browser is in Quirks Mode, please add a correct doctype.":"Please download the latest theme at http://galleria.io/customer/."),!0)},timeout:5e3})}return u}}}(),B=function(t){var n=".galleria-videoicon{width:60px;height:60px;position:absolute;top:50%;left:50%;z-index:1;margin:-30px 0 0 -30px;cursor:pointer;background:#000;background:rgba(0,0,0,.8);border-radius:3px;-webkit-transition:all 150ms}.galleria-videoicon i{width:0px;height:0px;border-style:solid;border-width:10px 0 10px 16px;display:block;border-color:transparent transparent transparent #ffffff;margin:20px 0 0 22px}.galleria-image:hover .galleria-videoicon{background:#000}";return H.insertStyleTag(n,"galleria-videoicon"),e(H.create("galleria-videoicon")).html("<i></i>").appendTo(t).click(function(){e(this).siblings("img").mouseup()})},j=function(){var t=function(t,n,r,i){var s=this.getOptions("easing"),o=this.getStageWidth(),u={left:o*(t.rewind?-1:1)},a={left:0};r?(u.opacity=0,a.opacity=1):u.opacity=1,e(t.next).css(u),H.animate(t.next,a,{duration:t.speed,complete:function(e){return function(){n(),e.css({left:0})}}(e(t.next).add(t.prev)),queue:!1,easing:s}),i&&(t.rewind=!t.rewind),t.prev&&(u={left:0},a={left:o*(t.rewind?1:-1)},r&&(u.opacity=1,a.opacity=0),e(t.prev).css(u),H.animate(t.prev,a,{duration:t.speed,queue:!1,easing:s,complete:function(){e(this).css("opacity",0)}}))};return{active:!1,init:function(e,t,n){j.effects.hasOwnProperty(e)&&j.effects[e].call(this,t,n)},effects:{fade:function(t,n){e(t.next).css({opacity:0,left:0}),H.animate(t.next,{opacity:1},{duration:t.speed,complete:n}),t.prev&&(e(t.prev).css("opacity",1).show(),H.animate(t.prev,{opacity:0},{duration:t.speed}))},flash:function(t,n){e(t.next).css({opacity:0,left:0}),t.prev?H.animate(t.prev,{opacity:0},{duration:t.speed/2,complete:function(){H.animate(t.next,{opacity:1},{duration:t.speed,complete:n})}}):H.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},pulse:function(t,n){t.prev&&e(t.prev).hide(),e(t.next).css({opacity:0,left:0}).show(),H.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},slide:function(e,n){t.apply(this,H.array(arguments))},fadeslide:function(e,n){t.apply(this,H.array(arguments).concat([!0]))},doorslide:function(e,n){t.apply(this,H.array(arguments).concat([!1,!0]))}}}}();L.listen(),e.event.special["click:fast"]={propagate:!0,add:function(t){var r=this.propagate;n.TOUCH?e(this).on("touchstart.fast",function(r){var i=r.originalEvent,s,o,u=0;i.touches.length==1&&(s=i.touches[0].pageX,o=i.touches[0].pageY,e(this).on("touchmove.fast",function(e){var t=e.originalEvent.touches;t.length==1&&(u=v.max(v.abs(s-t[0].pageX),v.abs(o-t[0].pageY)))}),e(this).on("touchend.fast",function(){if(u>4)return e(this).off("touchend.fast touchmove.fast");t.handler.call(this,r),e(this).off("touchend.fast touchmove.fast")}))}):e(this).on("click.fast",t.handler)},remove:function(t){n.TOUCH?e(this).off("touchstart.fast touchmove.fast touchend.fast"):e(this).off("click.fast",t.handler)}},o.on("orientationchange",function(){e(this).resize()}),n=function(){var u=this;this._options={},this._playing=!1,this._playtime=5e3,this._active=null,this._queue={length:0},this._data=[],this._dom={},this._thumbnails=[],this._layers=[],this._initialized=!1,this._firstrun=!1,this._stageWidth=0,this._stageHeight=0,this._target=r,this._binds=[],this._id=parseInt(v.random()*1e4,10);var a="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",f="current total";e.each(a.split(" "),function(e,t){u._dom[t]=H.create("galleria-"+t)}),e.each(f.split(" "),function(e,t){u._dom[t]=H.create("galleria-"+t,"span")});var l=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(e){var t=e.keyCode||e.which;t in l.map&&typeof l.map[t]=="function"&&l.map[t].call(u,e)},attach:function(e){var t,n;for(t in e)e.hasOwnProperty(t)&&(n=t.toUpperCase(),n in l.keys?l.map[l.keys[n]]=e[t]:l.map[n]=e[t]);l.bound||(l.bound=!0,s.on("keydown",l.press))},detach:function(){l.bound=!1,l.map={},s.off("keydown",l.press)}},c=this._controls={0:r,1:r,active:0,swap:function(){c.active=c.active?0:1},getActive:function(){return u._options.swipe?c.slides[u._active]:c[c.active]},getNext:function(){return u._options.swipe?c.slides[u.getNext(u._active)]:c[1-c.active]},slides:[],frames:[],layers:[]},p=this._carousel={next:u.$("thumb-nav-right"),prev:u.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var t=0,n=0,r=[0];e.each(u._thumbnails,function(i,s){if(s.ready){t+=s.outerWidth||e(s.container).outerWidth(!0);var o=e(s.container).width();t+=o-v.floor(o),r[i+1]=t,n=v.max(n,s.outerHeight||e(s.container).outerHeight(!0))}}),u.$("thumbnails").css({width:t,height:n}),p.max=t,p.hooks=r,p.width=u.$("thumbnails-list").width(),p.setClasses(),u.$("thumbnails-container").toggleClass("galleria-carousel",t>p.width),p.width=u.$("thumbnails-list").width()},bindControls:function(){var e;p.next.on("click:fast",function(t){t.preventDefault();if(u._options.carouselSteps==="auto"){for(e=p.current;e<p.hooks.length;e++)if(p.hooks[e]-p.hooks[p.current]>p.width){p.set(e-2);break}}else p.set(p.current+u._options.carouselSteps)}),p.prev.on("click:fast",function(t){t.preventDefault();if(u._options.carouselSteps==="auto")for(e=p.current;e>=0;e--){if(p.hooks[p.current]-p.hooks[e]>p.width){p.set(e+2);break}if(e===0){p.set(0);break}}else p.set(p.current-u._options.carouselSteps)})},set:function(e){e=v.max(e,0);while(p.hooks[e-1]+p.width>=p.max&&e>=0)e--;p.current=e,p.animate()},getLast:function(e){return(e||p.current)-1},follow:function(e){if(e===0||e===p.hooks.length-2){p.set(e);return}var t=p.current;while(p.hooks[t]-p.hooks[p.current]<p.width&&t<=p.hooks.length)t++;e-1<p.current?p.set(e-1):e+2>t&&p.set(e-t+p.current+2)},setClasses:function(){p.prev.toggleClass("disabled",!p.current),p.next.toggleClass("disabled",p.hooks[p.current]+p.width>=p.max)},animate:function(t){p.setClasses();var n=p.hooks[p.current]*-1;if(isNaN(n))return;u.$("thumbnails").css("left",function(){return e(this).css("left")}),H.animate(u.get("thumbnails"),{left:n},{duration:u._options.carouselSpeed,easing:u._options.easing,queue:!1})}},d=this._tooltip={initialized:!1,open:!1,timer:"tooltip"+u._id,swapTimer:"swap"+u._id,init:function(){d.initialized=!0;var e=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";H.insertStyleTag(e,"galleria-tooltip"),u.$("tooltip").css({opacity:.8,visibility:"visible",display:"none"})},move:function(e){var t=u.getMousePosition(e).x,n=u.getMousePosition(e).y,r=u.$("tooltip"),i=t,s=n,o=r.outerHeight(!0)+1,a=r.outerWidth(!0),f=o+15,l=u.$("container").width()-a-2,c=u.$("container").height()-o-2;!isNaN(i)&&!isNaN(s)&&(i+=10,s-=o+8,i=v.max(0,v.min(l,i)),s=v.max(0,v.min(c,s)),n<f&&(s=f),r.css({left:i,top:s}))},bind:function(t,r){if(n.TOUCH)return;d.initialized||d.init();var i=function(){u.$("container").off("mousemove",d.move),u.clearTimer(d.timer),u.$("tooltip").stop().animate({opacity:0},200,function(){u.$("tooltip").hide(),u.addTimer(d.swapTimer,function(){d.open=!1},1e3)})},s=function(t,n){d.define(t,n),e(t).hover(function(){u.clearTimer(d.swapTimer),u.$("container").off("mousemove",d.move).on("mousemove",d.move).trigger("mousemove"),d.show(t),u.addTimer(d.timer,function(){u.$("tooltip").stop().show().animate({opacity:1}),d.open=!0},d.open?0:500)},i).click(i)};typeof r=="string"?s(t in u._dom?u.get(t):t,r):e.each(t,function(e,t){s(u.get(e),t)})},show:function(n){n=e(n in u._dom?u.get(n):n);var r=n.data("tt"),i=function(e){t.setTimeout(function(e){return function(){d.move(e)}}(e),10),n.off("mouseup",i)};r=typeof r=="function"?r():r;if(!r)return;u.$("tooltip").html(r.replace(/\s/,"&#160;")),n.on("mouseup",i)},define:function(t,n){if(typeof n!="function"){var r=n;n=function(){return r}}t=e(t in u._dom?u.get(t):t).data("tt",n),d.show(t)}},m=this._fullscreen={scrolled:0,crop:r,active:!1,prev:e(),beforeEnter:function(e){e()},beforeExit:function(e){e()},keymap:u._keyboard.map,parseCallback:function(t,n){return j.active?function(){typeof t=="function"&&t.call(u);var r=u._controls.getActive(),i=u._controls.getNext();u._scaleImage(i),u._scaleImage(r),n&&u._options.trueFullscreen&&e(r.container).add(i.container).trigger("transitionend")}:t},enter:function(e){m.beforeEnter(function(){e=m.parseCallback(e,!0),u._options.trueFullscreen&&L.support?(m.active=!0,H.forceStyles(u.get("container"),{width:"100%",height:"100%"}),u.rescale(),n.MAC?!n.SAFARI||!/version\/[1-5]/.test(h)?(u.$("container").css("opacity",0).addClass("fullscreen"),t.setTimeout(function(){m.scale(),u.$("container").css("opacity",1)},50)):(u.$("stage").css("opacity",0),t.setTimeout(function(){m.scale(),u.$("stage").css("opacity",1)},4)):u.$("container").addClass("fullscreen"),o.resize(m.scale),L.enter(u,e,u.get("container"))):(m.scrolled=o.scrollTop(),n.TOUCH||t.scrollTo(0,0),m._enter(e))})},_enter:function(s){m.active=!0,w&&(m.iframe=function(){var r,s=i.referrer,o=i.createElement("a"),u=t.location;return o.href=s,o.protocol!=u.protocol||o.hostname!=u.hostname||o.port!=u.port?(n.raise("Parent fullscreen not available. Iframe protocol, domains and ports must match."),!1):(m.pd=t.parent.document,e(m.pd).find("iframe").each(function(){var e=this.contentDocument||this.contentWindow.document;if(e===i)return r=this,!1}),r)}()),H.hide(u.getActiveImage()),w&&m.iframe&&(m.iframe.scrolled=e(t.parent).scrollTop(),t.parent.scrollTo(0,0));var a=u.getData(),f=u._options,l=!u._options.trueFullscreen||!L.support,c={height:"100%",overflow:"hidden",margin:0,padding:0};l&&(u.$("container").addClass("fullscreen"),m.prev=u.$("container").prev(),m.prev.length||(m.parent=u.$("container").parent()),u.$("container").appendTo("body"),H.forceStyles(u.get("container"),{position:n.TOUCH?"absolute":"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4}),H.forceStyles(b().html,c),H.forceStyles(b().body,c)),w&&m.iframe&&(H.forceStyles(m.pd.documentElement,c),H.forceStyles(m.pd.body,c),H.forceStyles(m.iframe,e.extend(c,{width:"100%",height:"100%",top:0,left:0,position:"fixed",zIndex:1e4,border:"none"}))),m.keymap=e.extend({},u._keyboard.map),u.attachKeyboard({escape:u.exitFullscreen,right:u.next,left:u.prev}),m.crop=f.imageCrop,f.fullscreenCrop!=r&&(f.imageCrop=f.fullscreenCrop);if(a&&a.big&&a.image!==a.big){var h=new n.Picture,p=h.isCached(a.big),d=u.getIndex(),v=u._thumbnails[d];u.trigger({type:n.LOADSTART,cached:p,rewind:!1,index:d,imageTarget:u.getActiveImage(),thumbTarget:v,galleriaData:a}),h.load(a.big,function(t){u._scaleImage(t,{complete:function(t){u.trigger({type:n.LOADFINISH,cached:p,index:d,rewind:!1,imageTarget:t.image,thumbTarget:v});var r=u._controls.getActive().image;r&&e(r).width(t.image.width).height(t.image.height).attr("style",e(t.image).attr("style")).attr("src",t.image.src)}})});var g=u.getNext(d),y=new n.Picture,E=u.getData(g);y.preload(u.isFullscreen()&&E.big?E.big:E.image)}u.rescale(function(){u.addTimer(!1,function(){l&&H.show(u.getActiveImage()),typeof s=="function"&&s.call(u),u.rescale()},100),u.trigger(n.FULLSCREEN_ENTER)}),l?o.resize(m.scale):H.show(u.getActiveImage())},scale:function(){u.rescale()},exit:function(e){m.beforeExit(function(){e=m.parseCallback(e),u._options.trueFullscreen&&L.support?L.exit(e):m._exit(e)})},_exit:function(e){m.active=!1;var r=!u._options.trueFullscreen||!L.support,i=u.$("container").removeClass("fullscreen");m.parent?m.parent.prepend(i):i.insertAfter(m.prev);if(r){H.hide(u.getActiveImage()),H.revertStyles(u.get("container"),b().html,b().body),n.TOUCH||t.scrollTo(0,m.scrolled);var s=u._controls.frames[u._controls.active];s&&s.image&&(s.image.src=s.image.src)}w&&m.iframe&&(H.revertStyles(m.pd.documentElement,m.pd.body,m.iframe),m.iframe.scrolled&&t.parent.scrollTo(0,m.iframe.scrolled)),u.detachKeyboard(),u.attachKeyboard(m.keymap),u._options.imageCrop=m.crop;var a=u.getData().big,f=u._controls.getActive().image;!u.getData().iframe&&f&&a&&a==f.src&&t.setTimeout(function(e){return function(){f.src=e}}(u.getData().image),1),u.rescale(function(){u.addTimer(!1,function(){r&&H.show(u.getActiveImage()),typeof e=="function"&&e.call(u),o.trigger("resize")},50),u.trigger(n.FULLSCREEN_EXIT)}),o.off("resize",m.scale)}},g=this._idle={trunk:[],bound:!1,active:!1,add:function(t,r,i,s){if(!t||n.TOUCH)return;g.bound||g.addEvent(),t=e(t),typeof i=="boolean"&&(s=i,i={}),i=i||{};var o={},u;for(u in r)r.hasOwnProperty(u)&&(o[u]=t.css(u));t.data("idle",{from:e.extend(o,i),to:r,complete:!0,busy:!1}),s?t.css(r):g.addTimer(),g.trunk.push(t)},remove:function(t){t=e(t),e.each(g.trunk,function(e,n){n&&n.length&&!n.not(t).length&&(t.css(t.data("idle").from),g.trunk.splice(e,1))}),g.trunk.length||(g.removeEvent(),u.clearTimer(g.timer))},addEvent:function(){g.bound=!0,u.$("container").on("mousemove click",g.showAll),u._options.idleMode=="hover"&&u.$("container").on("mouseleave",g.hide)},removeEvent:function(){g.bound=!1,u.$("container").on("mousemove click",g.showAll),u._options.idleMode=="hover"&&u.$("container").off("mouseleave",g.hide)},addTimer:function(){if(u._options.idleMode=="hover")return;u.addTimer("idle",function(){g.hide()},u._options.idleTime)},hide:function(){if(!u._options.idleMode||u.getIndex()===!1)return;u.trigger(n.IDLE_ENTER);var t=g.trunk.length;e.each(g.trunk,function(e,n){var r=n.data("idle");if(!r)return;n.data("idle").complete=!1,H.animate(n,r.to,{duration:u._options.idleSpeed,complete:function(){e==t-1&&(g.active=!1)}})})},showAll:function(){u.clearTimer("idle"),e.each(g.trunk,function(e,t){g.show(t)})},show:function(t){var r=t.data("idle");if(!g.active||!r.busy&&!r.complete)r.busy=!0,u.trigger(n.IDLE_EXIT),u.clearTimer("idle"),H.animate(t,r.from,{duration:u._options.idleSpeed/2,complete:function(){g.active=!0,e(t).data("idle").busy=!1,e(t).data("idle").complete=!0}});g.addTimer()}},E=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){if(E.initialized)return;E.initialized=!0;var t="overlay box content shadow title info close prevholder prev nextholder next counter image",r={},i=u._options,s="",o="position:absolute;",a="lightbox-",f={overlay:"position:fixed;display:none;opacity:"+i.overlayOpacity+";filter:alpha(opacity="+i.overlayOpacity*100+");top:0;left:0;width:100%;height:100%;background:"+i.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:o+"background:#000;width:100%;height:100%;",content:o+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:o+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:o+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:o+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:o+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:o+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},l=function(t){return t.hover(function(){e(this).css("color","#bbb")},function(){e(this).css("color","#444")})},c={},h="";y>7?h=y<9?"background:#000;filter:alpha(opacity=0);":"background:rgba(0,0,0,0);":h="z-index:99999",f.nextholder+=h,f.prevholder+=h,e.each(f,function(e,t){s+=".galleria-"+a+e+"{"+t+"}"}),s+=".galleria-"+a+"box.iframe .galleria-"+a+"prevholder,"+".galleria-"+a+"box.iframe .galleria-"+a+"nextholder{"+"width:100px;height:100px;top:50%;margin-top:-70px}",H.insertStyleTag(s,"galleria-lightbox"),e.each(t.split(" "),function(e,t){u.addElement("lightbox-"+t),r[t]=E.elems[t]=u.get("lightbox-"+t)}),E.image=new n.Picture,e.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(t,n){var r=[];e.each(n.split(" "),function(e,t){r.push(a+t)}),c[a+t]=r}),u.append(c),e(r.image).append(E.image.container),e(b().body).append(r.overlay,r.box),l(e(r.close).on("click:fast",E.hide).html("&#215;")),e.each(["Prev","Next"],function(t,i){var s=e(r[i.toLowerCase()]).html(/v/.test(i)?"&#8249;&#160;":"&#160;&#8250;"),o=e(r[i.toLowerCase()+"holder"]);o.on("click:fast",function(){E["show"+i]()});if(y<8||n.TOUCH){s.show();return}o.hover(function(){s.show()},function(e){s.stop().fadeOut(200)})}),e(r.overlay).on("click:fast",E.hide),n.IPAD&&(u._options.lightboxTransitionSpeed=0)},rescale:function(t){var r=v.min(o.width()-40,E.width),i=v.min(o.height()-60,E.height),s=v.min(r/E.width,i/E.height),a=v.round(E.width*s)+40,f=v.round(E.height*s)+60,l={width:a,height:f,"margin-top":v.ceil(f/2)*-1,"margin-left":v.ceil(a/2)*-1};t?e(E.elems.box).css(l):e(E.elems.box).animate(l,{duration:u._options.lightboxTransitionSpeed,easing:u._options.easing,complete:function(){var t=E.image,r=u._options.lightboxFadeSpeed;u.trigger({type:n.LIGHTBOX_IMAGE,imageTarget:t.image}),e(t.container).show(),e(t.image).animate({opacity:1},r),H.show(E.elems.info,r)}})},hide:function(){E.image.image=null,o.off("resize",E.rescale),e(E.elems.box).hide().find("iframe").remove(),H.hide(E.elems.info),u.detachKeyboard(),u.attachKeyboard(E.keymap),E.keymap=!1,H.hide(E.elems.overlay,200,function(){e(this).hide().css("opacity",u._options.overlayOpacity),u.trigger(n.LIGHTBOX_CLOSE)})},showNext:function(){E.show(u.getNext(E.active))},showPrev:function(){E.show(u.getPrev(E.active))},show:function(r){E.active=r=typeof r=="number"?r:u.getIndex()||0,E.initialized||E.init(),u.trigger(n.LIGHTBOX_OPEN),E.keymap||(E.keymap=e.extend({},u._keyboard.map),u.attachKeyboard({escape:E.hide,right:E.showNext,left:E.showPrev})),o.off("resize",E.rescale);var i=u.getData(r),s=u.getDataLength(),a=u.getNext(r),f,l,c;H.hide(E.elems.info);try{for(c=u._options.preload;c>0;c--)l=new n.Picture,f=u.getData(a),l.preload(f.big?f.big:f.image),a=u.getNext(a)}catch(h){}E.image.isIframe=i.iframe&&!i.image,e(E.elems.box).toggleClass("iframe",E.image.isIframe),e(E.image.container).find(".galleria-videoicon").remove(),E.image.load(i.big||i.image||i.iframe,function(n){if(n.isIframe){var a=e(t).width(),f=e(t).height();if(n.video&&u._options.maxVideoSize){var l=v.min(u._options.maxVideoSize/a,u._options.maxVideoSize/f);l<1&&(a*=l,f*=l)}E.width=a,E.height=f}else E.width=n.original.width,E.height=n.original.height;e(n.image).css({width:n.isIframe?"100%":"100.1%",height:n.isIframe?"100%":"100.1%",top:0,bottom:0,zIndex:99998,opacity:0,visibility:"visible"}).parent().height("100%"),E.elems.title.innerHTML=i.title||"",E.elems.counter.innerHTML=r+1+" / "+s,o.resize(E.rescale),E.rescale();if(i.image&&i.iframe){e(E.elems.box).addClass("iframe");if(i.video){var c=B(n.container).hide();t.setTimeout(function(){c.fadeIn(200)},200)}e(n.image).css("cursor","pointer").mouseup(function(t,n){return function(r){e(E.image.container).find(".galleria-videoicon").remove(),r.preventDefault(),n.isIframe=!0,n.load(t.iframe+(t.video?"&autoplay=1":""),{width:"100%",height:y<8?e(E.image.container).height():"100%"})}}(i,n))}}),e(E.elems.overlay).show().css("visibility","visible"),e(E.elems.box).show()}},S=this._timer={trunk:{},add:function(e,n,r,i){e=e||(new Date).getTime(),i=i||!1,this.clear(e);if(i){var s=n;n=function(){s(),S.add(e,n,r)}}this.trunk[e]=t.setTimeout(n,r)},clear:function(e){var n=function(e){t.clearTimeout(this.trunk[e]),delete this.trunk[e]},r;if(!!e&&e in this.trunk)n.call(this,e);else if(typeof e=="undefined")for(r in this.trunk)this.trunk.hasOwnProperty(r)&&n.call(this,r)}};return this},n.prototype={constructor:n,init:function(t,i){i=x(i),this._original={target:t,options:i,data:null},this._target=this._dom.target=t.nodeName?t:e(t).get(0),this._original.html=this._target.innerHTML,O.push(this);if(!this._target){n.raise("Target not found",!0);return}return this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(e){return{}},dataSelector:"img",dataSort:!1,dataSource:this._target,debug:r,dummy:r,easing:"galleria",extend:function(e){},fullscreenCrop:r,fullscreenDoubleTap:!1,fullscreenTransition:r,height:0,idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:r,initialTransition:r,keepSource:!1,layerFollow:!0,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:!0,maxScaleRatio:r,maxVideoSize:r,minScaleRatio:r,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,queue:!0,responsive:!0,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:"auto",thumbCrop:!0,thumbEventType:"click:fast",thumbMargin:0,thumbQuality:"auto",thumbDisplayOrder:!0,thumbPosition:"50%",thumbnails:!0,touchTransition:r,transition:"fade",transitionInitial:r,transitionSpeed:400,trueFullscreen:!0,useCanvas:!1,variation:"",videoPoster:!0,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5e3,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}},this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial,i&&i.debug===!1&&(f=!1),i&&typeof i.imageTimeout=="number"&&(l=i.imageTimeout),i&&typeof i.dummy=="string"&&(c=i.dummy),e(this._target).children().hide(),n.QUIRK&&n.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML and add a correct doctype."),typeof n.theme=="object"?this._init():D.push(this),this},_init:function(){var s=this,u=this._options;if(this._initialized)return n.raise("Init failed: Gallery instance already initialized."),this;this._initialized=!0;if(!n.theme)return n.raise("Init failed: No theme found.",!0),this;e.extend(!0,u,n.theme.defaults,this._original.options,n.configure.options),u.swipe=function(e){return e=="enforced"?!0:e===!1||e=="disabled"?!1:!!n.TOUCH}(u.swipe),u.swipe&&(u.clicknext=!1,u.imagePan=!1),function(e){if(!("getContext"in e)){e=null;return}_=_||{elem:e,context:e.getContext("2d"),cache:{},length:0}}(i.createElement("canvas")),this.bind(n.DATA,function(){t.screen&&t.screen.width&&Array.prototype.forEach&&this._data.forEach(function(e){var n="devicePixelRatio"in t?t.devicePixelRatio:1,r=v.max(t.screen.width,t.screen.height);r*n<1024&&(e.big=e.image)}),this._original.data=this._data,this.get("total").innerHTML=this.getDataLength();var e=this.$("container");s._options.height<2&&(s._userRatio=s._ratio=s._options.height);var r={width:0,height:0},i=function(){return s.$("stage").height()};H.wait({until:function(){return r=s._getWH(),e.width(r.width).height(r.height),i()&&r.width&&r.height>50},success:function(){s._width=r.width,s._height=r.height,s._ratio=s._ratio||r.height/r.width,n.WEBKIT?t.setTimeout(function(){s._run()},1):s._run()},error:function(){i()?n.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+r.width+"px, height: "+r.height+"px.",!0):n.raise("Could not extract a stage height from the CSS. Traced height: "+i()+"px.",!0)},timeout:typeof this._options.wait=="number"?this._options.wait:!1})}),this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]}),H.hide(this.$("counter").append(this.get("current"),i.createTextNode(" / "),this.get("total"))),this.setCounter("&#8211;"),H.hide(s.get("tooltip")),this.$("container").addClass((n.TOUCH?"touch":"notouch")+" "+this._options.variation),this._options.swipe||e.each(new Array(2),function(t){var r=new n.Picture;e(r.container).css({position:"absolute",top:0,left:0}).prepend(s._layers[t]=e(H.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]),s.$("images").append(r.container),s._controls[t]=r;var i=new n.Picture;i.isIframe=!0,e(i.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(r.container),s._controls.frames[t]=i}),this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"}),u.swipe&&(this.$("images").css({position:"absolute",top:0,left:0,width:0,height:"100%"}),this.finger=new n.Finger(this.get("stage"),{onchange:function(e){s.pause().show(e)},oncomplete:function(t){var n=v.max(0,v.min(parseInt(t,10),s.getDataLength()-1)),r=s.getData(n);e(s._thumbnails[n].container).addClass("active").siblings(".active").removeClass("active");if(!r)return;s.$("images").find("iframe").remove(),s.$("images").find(".galleria-frame").css("opacity",0).hide(),s._options.carousel&&s._options.carouselFollow&&s._carousel.follow(n)}}),this.bind(n.RESCALE,function(){this.finger.setup()}),this.$("stage").on("click",function(n){var i=s.getData();if(!i)return;if(i.iframe){s.isPlaying()&&s.pause();var o=s._controls.frames[s._active],u=s._stageWidth,a=s._stageHeight;if(e(o.container).find("iframe").length)return;e(o.container).css({width:u,height:a,opacity:0}).show().animate({opacity:1},200),t.setTimeout(function(){o.load(i.iframe+(i.video?"&autoplay=1":""),{width:u,height:a},function(e){s.$("container").addClass("videoplay"),e.scale({width:s._stageWidth,height:s._stageHeight,iframelimit:i.video?s._options.maxVideoSize:r})})},100);return}if(i.link){if(s._options.popupLinks)var f=t.open(i.link,"_blank");else t.location.href=i.link;return}}),this.bind(n.IMAGE,function(t){s.setCounter(t.index),s.setInfo(t.index);var n=this.getNext(),r=this.getPrev(),i=[r,n];i.push(this.getNext(n),this.getPrev(r),s._controls.slides.length-1);var o=[];e.each(i,function(t,n){e.inArray(n,o)==-1&&o.push(n)}),e.each(o,function(t,n){var r=s.getData(n),i=s._controls.slides[n],o=s.isFullscreen()&&r.big?r.big:r.image||r.iframe;r.iframe&&!r.image&&(i.isIframe=!0),i.ready||s._controls.slides[n].load(o,function(t){t.isIframe||e(t.image).css("visibility","hidden"),s._scaleImage(t,{complete:function(t){t.isIframe||e(t.image).css({opacity:0,visibility:"visible"}).animate({opacity:1},200)}})})})})),this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"}),this.$("image-nav-right, image-nav-left").on("click:fast",function(e){u.pauseOnInteraction&&s.pause();var t=/right/.test(this.className)?"next":"prev";s[t]()}).on("click",function(e){e.preventDefault(),(u.clicknext||u.swipe)&&e.stopPropagation()}),e.each(["info","counter","image-nav"],function(e,t){u["show"+t.substr(0,1).toUpperCase()+t.substr(1).replace(/-/,"")]===!1&&H.moveOut(s.get(t.toLowerCase()))}),this.load(),!u.keepSource&&!y&&(this._target.innerHTML=""),this.get("errors")&&this.appendChild("target","errors"),this.appendChild("target","container");if(u.carousel){var a=0,f=u.show;this.bind(n.THUMBNAIL,function(){this.updateCarousel(),++a==this.getDataLength()&&typeof f=="number"&&f>0&&this._carousel.follow(f)})}return u.responsive&&o.on("resize",function(){s.isFullscreen()||s.resize()}),u.fullscreenDoubleTap&&this.$("stage").on("touchstart",function(){var e,t,n,r,i,o,u=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e};return s.$("stage").on("touchmove",function(){e=0}),function(a){if(/(-left|-right)/.test(a.target.className))return;o=H.timestamp(),t=u(a).pageX,n=u(a).pageY;if(a.originalEvent.touches.length<2&&o-e<300&&t-r<20&&n-i<20){s.toggleFullscreen(),a.preventDefault();return}e=o,r=t,i=n}}()),e.each(n.on.binds,function(t,n){e.inArray(n.hash,s._binds)==-1&&s.bind(n.type,n.callback)}),this},addTimer:function(){return this._timer.add.apply(this._timer,H.array(arguments)),this},clearTimer:function(){return this._timer.clear.apply(this._timer,H.array(arguments)),this},_getWH:function(){var t=this.$("container"),n=this.$("target"),r=this,i={},s;return e.each(["width","height"],function(e,o){r._options[o]&&typeof r._options[o]=="number"?i[o]=r._options[o]:(s=[H.parseValue(t.css(o)),H.parseValue(n.css(o)),t[o](),n[o]()],r["_"+o]||s.splice(s.length,H.parseValue(t.css("min-"+o)),H.parseValue(n.css("min-"+o))),i[o]=v.max.apply(v,s))}),r._userRatio&&(i.height=i.width*r._userRatio),i},_createThumbnails:function(r){this.get("total").innerHTML=this.getDataLength();var s,o,u,a,f=this,l=this._options,c=r?this._data.length-r.length:0,h=c,p=[],d=0,v=y<8?"http://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif":"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",m=function(){var e=f.$("thumbnails").find(".active");return e.length?e.find("img").attr("src"):!1}(),g=typeof l.thumbnails=="string"?l.thumbnails.toLowerCase():null,b=function(e){return i.defaultView&&i.defaultView.getComputedStyle?i.defaultView.getComputedStyle(o.container,null)[e]:a.css(e)},w=function(t,r,i){return function(){e(i).append(t),f.trigger({type:n.THUMBNAIL,thumbTarget:t,index:r,galleriaData:f.getData(r)})}},E=function(t){l.pauseOnInteraction&&f.pause();var n=e(t.currentTarget).data("index");f.getIndex()!==n&&f.show(n),t.preventDefault()},S=function(t,r){e(t.container).css("visibility","visible"),f.trigger({type:n.THUMBNAIL,thumbTarget:t.image,index:t.data.order,galleriaData:f.getData(t.data.order)}),typeof r=="function"&&r.call(f,t)},x=function(t,n){t.scale({width:t.data.width,height:t.data.height,crop:l.thumbCrop,margin:l.thumbMargin,canvas:l.useCanvas,position:l.thumbPosition,complete:function(t){var r=["left","top"],i=["Width","Height"],s,o,u=f.getData(t.index);e.each(i,function(n,i){s=i.toLowerCase();if(l.thumbCrop!==!0||l.thumbCrop===s)o={},o[s]=t[s],e(t.container).css(o),o={},o[r[n]]=0,e(t.image).css(o);t["outer"+i]=e(t.container)["outer"+i](!0)}),H.toggleQuality(t.image,l.thumbQuality===!0||l.thumbQuality==="auto"&&t.original.width<t.width*3),l.thumbDisplayOrder&&!t.lazy?e.each(p,function(e,t){if(e===d&&t.ready&&!t.displayed){d++,t.displayed=!0,S(t,n);return}}):S(t,n)}})};r||(this._thumbnails=[],this.$("thumbnails").empty());for(;this._data[c];c++)u=this._data[c],s=u.thumb||u.image,l.thumbnails!==!0&&g!="lazy"||!u.thumb&&!u.image?u.iframe||g==="empty"||g==="numbers"?(o={container:H.create("galleria-image"),image:H.create("img","span"),ready:!0,data:{order:c}},g==="numbers"&&e(o.image).text(c+1),u.iframe&&e(o.image).addClass("iframe"),this.$("thumbnails").append(o.container),t.setTimeout(w(o.image,c,o.container),50+c*20)):o={container:null,image:null}:(o=new n.Picture(c),o.index=c,o.displayed=!1,o.lazy=!1,o.video=!1,this.$("thumbnails").append(o.container),a=e(o.container),a.css("visibility","hidden"),o.data={width:H.parseValue(b("width")),height:H.parseValue(b("height")),order:c,src:s},a.css({width:"auto",height:"auto"}),g=="lazy"?(a.addClass("lazy"),o.lazy=!0,o.load(v,{height:o.data.height,width:o.data.width})):o.load(s,x),l.preload==="all"&&o.preload(u.image)),e(o.container).add(l.keepSource&&l.linkSourceImages?u.original:null).data("index",c).on(l.thumbEventType,E).data("thumbload",x),m===s&&e(o.container).addClass("active"),this._thumbnails.push(o);return p=this._thumbnails.slice(h),this},lazyLoad:function(t,n){var r=t.constructor==Array?t:[t],i=this,s=0;return e.each(r,function(t,o){if(o>i._thumbnails.length-1)return;var u=i._thumbnails[o],a=u.data,f=function(){++s==r.length&&typeof n=="function"&&n.call(i)},l=e(u.container).data("thumbload");u.video?l.call(i,u,f):u.load(a.src,function(e){l.call(i,e,f)})}),this},lazyLoadChunks:function(e,n){var r=this.getDataLength(),i=0,s=0,o=[],u=[],a=this;n=n||0;for(;i<r;i++){u.push(i);if(++s==e||i==r-1)o.push(u),s=0,u=[]}var f=function(e){var r=o.shift();r&&t.setTimeout(function(){a.lazyLoad(r,function(){f(!0)})},n&&e?n:0)};return f(!1),this},_run:function(){var i=this;i._createThumbnails(),H.wait({timeout:1e4,until:function(){return n.OPERA&&i.$("stage").css("display","inline-block"),i._stageWidth=i.$("stage").width(),i._stageHeight=i.$("stage").height(),i._stageWidth&&i._stageHeight>50},success:function(){A.push(i);if(i._options.swipe){var s=i.$("images").width(i.getDataLength()*i._stageWidth);e.each(new Array(i.getDataLength()),function(t){var r=new n.Picture,o=i.getData(t);e(r.container).css({position:"absolute",top:0,left:i._stageWidth*t}).prepend(i._layers[t]=e(H.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]).appendTo(s),o.video&&B(r.container),i._controls.slides.push(r);var u=new n.Picture;u.isIframe=!0,e(u.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(r.container),i._controls.frames.push(u)}),i.finger.setup()}H.show(i.get("counter")),i._options.carousel&&i._carousel.bindControls(),i._options.autoplay&&(i.pause(),typeof i._options.autoplay=="number"&&(i._playtime=i._options.autoplay),i._playing=!0);if(i._firstrun){i._options.autoplay&&i.trigger(n.PLAY),typeof i._options.show=="number"&&i.show(i._options.show);return}i._firstrun=!0,n.History&&n.History.change(function(e){isNaN(e)?t.history.go(-1):i.show(e,r,!0)}),i.trigger(n.READY),n.theme.init.call(i,i._options),e.each(n.ready.callbacks,function(e,t){typeof t=="function"&&t.call(i,i._options)}),i._options.extend.call(i,i._options),/^[0-9]{1,4}$/.test(p)&&n.History?i.show(p,r,!0):i._data[i._options.show]&&i.show(i._options.show),i._options.autoplay&&i.trigger(n.PLAY)},error:function(){n.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+i._stageWidth+"px, height: "+i._stageHeight+"px.",!0)}})},load:function(t,r,i){var s=this,o=this._options;return this._data=[],this._thumbnails=[],this.$("thumbnails").empty(),typeof r=="function"&&(i=r,r=null),t=t||o.dataSource,r=r||o.dataSelector,i=i||o.dataConfig,e.isPlainObject(t)&&(t=[t]),e.isArray(t)?this.validate(t)?this._data=t:n.raise("Load failed: JSON Array not valid."):(r+=",.video,.iframe",e(t).find(r).each(function(t,n){n=e(n);var r={},o=n.parent(),u=o.attr("href"),a=o.attr("rel");u&&(n[0].nodeName=="IMG"||n.hasClass("video"))&&k(u)?r.video=u:u&&n.hasClass("iframe")?r.iframe=u:r.image=r.big=u,a&&(r.big=a),e.each("big title description link layer image".split(" "),function(e,t){n.data(t)&&(r[t]=n.data(t).toString())}),r.big||(r.big=r.image),s._data.push(e.extend({title:n.attr("title")||"",thumb:n.attr("src"),image:n.attr("src"),big:n.attr("src"),description:n.attr("alt")||"",link:n.attr("longdesc"),original:n.get(0)},r,i(n)))})),typeof o.dataSort=="function"?u.sort.call(this._data,o.dataSort):o.dataSort=="random"&&this._data.sort(function(){return v.round(v.random())-.5}),this.getDataLength()&&this._parseData(function(){this.trigger(n.DATA)}),this},_parseData:function(t){var n=this,i,s=!1,o=function(){var r=!0;e.each(n._data,function(e,t){if(t.loading)return r=!1,!1}),r&&!s&&(s=!0,t.call(n))};return e.each(this._data,function(t,s){i=n._data[t],"thumb"in s==0&&(i.thumb=s.image),s.big||(i.big=s.image);if("video"in s){var u=k(s.video);u&&(i.iframe=(new C(u.provider,u.id)).embed()+function(){if(typeof n._options[u.provider]=="object"){var t="?",r=[];return e.each(n._options[u.provider],function(e,t){r.push(e+"="+t)}),u.provider=="youtube"&&(r=["wmode=opaque"].concat(r)),t+r.join("&")}return""}(),(!i.thumb||!i.image)&&e.each(["thumb","image"],function(e,t){if(t=="image"&&!n._options.videoPoster){i.image=r;return}var s=new C(u.provider,u.id);i[t]||(i.loading=!0,s.getMedia(t,function(e,t){return function(n){e[t]=n,t=="image"&&!e.big&&(e.big=e.image),delete e.loading,o()}}(i,t)))}))}}),o(),this},destroy:function(){return this.$("target").data("galleria",null),this.$("container").off("galleria"),this.get("target").innerHTML=this._original.html,this.clearTimer(),H.removeFromArray(O,this),H.removeFromArray(A,this),n._waiters.length&&e.each(n._waiters,function(e,n){n&&t.clearTimeout(n)}),this},splice:function(){var e=this,n=H.array(arguments);return t.setTimeout(function(){u.splice.apply(e._data,n),e._parseData(function(){e._createThumbnails()})},2),e},push:function(){var e=this,n=H.array(arguments);return n.length==1&&n[0].constructor==Array&&(n=n[0]),t.setTimeout(function(){u.push.apply(e._data,n),e._parseData(function(){e._createThumbnails(n)})},2),e},_getActive:function(){return this._controls.getActive()},validate:function(e){return!0},bind:function(e,t){return e=T(e),this.$("container").on(e,this.proxy(t)),this},unbind:function(e){return e=T(e),this.$("container").off(e),this},trigger:function(t){return t=typeof t=="object"?e.extend(t,{scope:this}):{type:T(t),scope:this},this.$("container").trigger(t),this},addIdleState:function(e,t,n,r){return this._idle.add.apply(this._idle,H.array(arguments)),this},removeIdleState:function(e){return this._idle.remove.apply(this._idle,H.array(arguments)),this},enterIdleMode:function(){return this._idle.hide(),this},exitIdleMode:function(){return this._idle.showAll(),this},enterFullscreen:function(e){return this._fullscreen.enter.apply(this,H.array(arguments)),this},exitFullscreen:function(e){return this._fullscreen.exit.apply(this,H.array(arguments)),this},toggleFullscreen:function(e){return this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,H.array(arguments)),this},bindTooltip:function(e,t){return this._tooltip.bind.apply(this._tooltip,H.array(arguments)),this},defineTooltip:function(e,t){return this._tooltip.define.apply(this._tooltip,H.array(arguments)),this},refreshTooltip:function(e){return this._tooltip.show.apply(this._tooltip,H.array(arguments)),this},openLightbox:function(){return this._lightbox.show.apply(this._lightbox,H.array(arguments)),this},closeLightbox:function(){return this._lightbox.hide.apply(this._lightbox,H.array(arguments)),this},hasVariation:function(t){return e.inArray(t,this._options.variation.split(/\s+/))>-1},getActiveImage:function(){var e=this._getActive();return e?e.image:r},getActiveThumb:function(){return this._thumbnails[this._active].image||r},getMousePosition:function(e){return{x:e.pageX-this.$("container").offset().left,y:e.pageY-this.$("container").offset().top}},addPan:function(t){if(this._options.imageCrop===!1)return;t=e(t||this.getActiveImage());var n=this,r=t.width()/2,i=t.height()/2,s=parseInt(t.css("left"),10),o=parseInt(t.css("top"),10),u=s||0,a=o||0,f=0,l=0,c=!1,h=H.timestamp(),p=0,d=0,m=function(e,n,r){if(e>0){d=v.round(v.max(e*-1,v.min(0,n)));if(p!==d){p=d;if(y===8)t.parent()["scroll"+r](d*-1);else{var i={};i[r.toLowerCase()]=d,t.css(i)}}}},g=function(e){if(H.timestamp()-h<50)return;c=!0,r=n.getMousePosition(e).x,i=n.getMousePosition(e).y},b=function(e){if(!c)return;f=t.width()-n._stageWidth,l=t.height()-n._stageHeight,s=r/n._stageWidth*f*-1,o=i/n._stageHeight*l*-1,u+=(s-u)/n._options.imagePanSmoothness,a+=(o-a)/n._options.imagePanSmoothness,m(l,a,"Top"),m(f,u,"Left")};return y===8&&(t.parent().scrollTop(a*-1).scrollLeft(u*-1),t.css({top:0,left:0})),this.$("stage").off("mousemove",g).on("mousemove",g),this.addTimer("pan"+n._id,b,50,!0),this},proxy:function(e,t){return typeof e!="function"?m:(t=t||this,function(){return e.apply(t,H.array(arguments))})},removePan:function(){return this.$("stage").off("mousemove"),this.clearTimer("pan"+this._id),this},addElement:function(t){var n=this._dom;return e.each(H.array(arguments),function(e,t){n[t]=H.create("galleria-"+t)}),this},attachKeyboard:function(e){return this._keyboard.attach.apply(this._keyboard,H.array(arguments)),this},detachKeyboard:function(){return this._keyboard.detach.apply(this._keyboard,H.array(arguments)),this},appendChild:function(e,t){return this.$(e).append(this.get(t)||t),this},prependChild:function(e,t){return this.$(e).prepend(this.get(t)||t),this},remove:function(e){return this.$(H.array(arguments).join(",")).remove(),this},append:function(e){var t,n;for(t in e)if(e.hasOwnProperty(t))if(e[t].constructor===Array)for(n=0;e[t][n];n++)this.appendChild(t,e[t][n]);else this.appendChild(t,e[t]);return this},_scaleImage:function(t,n){t=t||this._controls.getActive();if(!t)return;var r,i=function(t){e(t.container).children(":first").css({top:v.max(0,H.parseValue(t.image.style.top)),left:v.max(0,H.parseValue(t.image.style.left)),width:H.parseValue(t.image.width),height:H.parseValue(t.image.height)})};return n=e.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition,iframelimit:this._options.maxVideoSize},n),this._options.layerFollow&&this._options.imageCrop!==!0?typeof n.complete=="function"?(r=n.complete,n.complete=function(){r.call(t,t),i(t)}):n.complete=i:e(t.container).children(":first").css({top:0,left:0}),t.scale(n),this},updateCarousel:function(){return this._carousel.update(),this},resize:function(t,n){typeof t=="function"&&(n=t,t=r),t=e.extend({width:0,height:0},t);var i=this,s=this.$("container");return e.each(t,function(e,n){n||(s[e]("auto"),t[e]=i._getWH()[e])}),e.each(t,function(e,t){s[e](t)}),this.rescale(n)},rescale:function(t,i,s){var o=this;typeof t=="function"&&(s=t,t=r);var u=function(){o._stageWidth=t||o.$("stage").width(),o._stageHeight=i||o.$("stage").height(),o._options.swipe?(e.each(o._controls.slides,function(t,n){o._scaleImage(n),e(n.container).css("left",o._stageWidth*t)}),o.$("images").css("width",o._stageWidth*o.getDataLength())):o._scaleImage(),o._options.carousel&&o.updateCarousel();var r=o._controls.frames[o._controls.active];r&&o._controls.frames[o._controls.active].scale({width:o._stageWidth,height:o._stageHeight,iframelimit:o._options.maxVideoSize}),o.trigger(n.RESCALE),typeof s=="function"&&s.call(o)};return u.call(o),this},refreshImage:function(){return this._scaleImage(),this._options.imagePan&&this.addPan(),this},_preload:function(){if(this._options.preload){var e,t,r=this.getNext(),i;try{for(t=this._options.preload;t>0;t--)e=new n.Picture,i=this.getData(r),e.preload(this.isFullscreen()&&i.big?i.big:i.image),r=this.getNext(r)}catch(s){}}},show:function(r,i,s){var o=this._options.swipe;if(!o&&(this._queue.length>3||r===!1||!this._options.queue&&this._queue.stalled))return;r=v.max(0,v.min(parseInt(r,10),this.getDataLength()-1)),i=typeof i!="undefined"?!!i:r<this.getIndex(),s=s||!1;if(!s&&n.History){n.History.set(r.toString());return}this.finger&&r!==this._active&&(this.finger.to=-(r*this.finger.width),this.finger.index=r),this._active=r;if(o){var a=this.getData(r),f=this;if(!a)return;var l=this.isFullscreen()&&a.big?a.big:a.image||a.iframe,c=this._controls.slides[r],h=c.isCached(l),p=this._thumbnails[r],d={cached:h,index:r,rewind:i,imageTarget:c.image,thumbTarget:p.image,galleriaData:a};this.getDataLength()>1&&e(".more-less-description").html()===WIDGET_CONSTANTS.DESCRIPTION_COLLAPSE&&e(".more-less-description",this._options.widgetRef).trigger(WIDGET_EVENTS.CLICK),e(f._thumbnails[r].container).addClass("active").siblings(".active").removeClass("active"),this.trigger(e.extend(d,{type:n.LOADSTART})),f.$("container").removeClass("videoplay");var m=function(){f._layers[r].innerHTML=f.getData().layer||"",f.trigger(e.extend(d,{type:n.LOADFINISH})),f._playCheck()};f._preload(),t.setTimeout(function(){!c.ready||e(c.image).attr("src")!=l?(a.iframe&&!a.image&&(c.isIframe=!0),c.load(l,function(t){f._scaleImage(t,m).trigger(e.extend(d,{type:n.IMAGE})),m()})):(f.trigger(e.extend(d,{type:n.IMAGE})),m())},100)}else u.push.call(this._queue,{index:r,rewind:i}),this._queue.stalled||this._show();return this},_show:function(){var i=this,s=this._queue[0],o=this.getData(s.index);if(!o)return;var a=this.isFullscreen()&&o.big?o.big:o.image||o.iframe,f=this._controls.getActive(),l=this._controls.getNext(),c=l.isCached(a),h=this._thumbnails[s.index],p=function(){e(l.image).trigger("mouseup")};i.$("container").toggleClass("iframe",!!o.isIframe).removeClass("videoplay");var d=function(s,o,a,f,l){return function(){var c;j.active=!1,H.toggleQuality(o.image,i._options.imageQuality),i._layers[i._controls.active].innerHTML="",e(a.container).css({zIndex:0,opacity:0}).show(),e(a.container).find("iframe, .galleria-videoicon").remove(),e(i._controls.frames[i._controls.active].container).hide(),e(o.container).css({zIndex:1,left:0,top:0}).show(),i._controls.swap(),i._options.imagePan&&i.addPan(o.image),(s.iframe&&s.image||s.link||i._options.lightbox||i._options.clicknext)&&e(o.image).css({cursor:"pointer"}).on("mouseup",function(o){if(typeof o.which=="number"&&o.which>1)return;if(s.iframe){i.isPlaying()&&i.pause();var u=i._controls.frames[i._controls.active],a=i._stageWidth,f=i._stageHeight;e(u.container).css({width:a,height:f,opacity:0}).show().animate({opacity:1},200),t.setTimeout(function(){u.load(s.iframe+(s.video?"&autoplay=1":""),{width:a,height:f},function(e){i.$("container").addClass("videoplay"),e.scale({width:i._stageWidth,height:i._stageHeight,iframelimit:s.video?i._options.maxVideoSize:r})})},100);return}if(i._options.clicknext&&!n.TOUCH){i._options.pauseOnInteraction&&i.pause(),i.next();return}if(s.link){i._options.popupLinks?c=t.open(s.link,"_blank"):t.location.href=s.link;return}i._options.lightbox&&i.openLightbox()}),i._playCheck(),i.trigger({type:n.IMAGE,index:f.index,imageTarget:o.image,thumbTarget:l.image,galleriaData:s}),u.shift.call(i._queue),i._queue.stalled=!1,i._queue.length&&i._show()}}(o,l,f,s,h);this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(s.index),i._preload(),H.show(l.container),l.isIframe=o.iframe&&!o.image,e(i._thumbnails[s.index].container).addClass("active").siblings(".active").removeClass("active"),i.trigger({type:n.LOADSTART,cached:c,index:s.index,rewind:s.rewind,imageTarget:l.image,thumbTarget:h.image,galleriaData:o}),i._queue.stalled=!0,l.load(a,function(t){var u=e(i._layers[1-i._controls.active]).html(o.layer||"").hide();i.getDataLength()>1&&e(".more-less-description").html()===WIDGET_CONSTANTS.DESCRIPTION_COLLAPSE&&e(".more-less-description",i._options.widgetRef).trigger(WIDGET_EVENTS.CLICK),i._scaleImage(t,{complete:function(t){"image"in f&&H.toggleQuality(f.image,!1),H.toggleQuality(t.image,!1),i.removePan(),i.setInfo(s.index),i.setCounter(s.index),o.layer&&(u.show(),(o.iframe&&o.image||o.link||i._options.lightbox||i._options.clicknext)&&u.css("cursor","pointer").off("mouseup").mouseup(p)),o.video&&o.image&&B(t.container);var a=i._options.transition;e.each({initial:f.image===null,touch:n.TOUCH,fullscreen:i.isFullscreen()},function(e,t){if(t&&i._options[e+"Transition"]!==r)return a=i._options[e+"Transition"],!1});if(a in j.effects==0)d();else{var l={prev:f.container,next:t.container,rewind:s.rewind,speed:i._options.transitionSpeed||400};j.active=!0,j.init.call(i,a,l,d)}i.trigger({type:n.LOADFINISH,cached:c,index:s.index,rewind:s.rewind,imageTarget:t.image,thumbTarget:i._thumbnails[s.index].image,galleriaData:i.getData(s.index)})}})})},getNext:function(e){return e=typeof e=="number"?e:this.getIndex(),e===this.getDataLength()-1?0:e+1},getPrev:function(e){return e=typeof e=="number"?e:this.getIndex(),e===0?this.getDataLength()-1:e-1},next:function(){return this.getDataLength()>1&&this.show(this.getNext(),!1),this},prev:function(){return this.getDataLength()>1&&this.show(this.getPrev(),!0),this},get:function(e){return e in this._dom?this._dom[e]:null},getData:function(e){return e in this._data?this._data[e]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active=="number"?this._active:!1},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(e){return typeof e=="undefined"?this._options:this._options[e]},setOptions:function(t,n){return typeof t=="object"?e.extend(this._options,t):this._options[t]=n,this},play:function(e){return this._playing=!0,this._playtime=e||this._playtime,this._playCheck(),this.trigger(n.PLAY),this},pause:function(){return this._playing=!1,this.trigger(n.PAUSE),this},playToggle:function(e){return this._playing?this.pause():this.play(e)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var e=this,t=0,r=20,i=H.timestamp(),s="play"+this._id;if(this._playing){this.clearTimer(s);var o=function(){t=H.timestamp()-i;if(t>=e._playtime&&e._playing){e.clearTimer(s),e.next();return}e._playing&&(e.trigger({type:n.PROGRESS,percent:v.ceil(t/e._playtime*100),seconds:v.floor(t/1e3),milliseconds:t}),e.addTimer(s,o,r))};e.addTimer(s,o,r)}},setPlaytime:function(e){return this._playtime=e,this},setIndex:function(e){return this._active=e,this},setCounter:function(e){typeof e=="number"?e++:typeof e=="undefined"&&(e=this.getIndex()+1),this.get("current").innerHTML=e;if(y){var t=this.$("counter"),n=t.css("opacity");parseInt(n,10)===1?H.removeAlpha(t[0]):this.$("counter").css("opacity",n)}return this},setInfo:function(t){var n=this,r=this.getData(t);return e.each(["title","description"],function(e,t){var i=n.$("info-"+t);r[t]?i[r[t].length?"show":"hide"]().html(r[t]):i.empty().hide()}),this},hasInfo:function(e){var t="title description".split(" "),n;for(n=0;t[n];n++)if(!!this.getData(e)[t[n]])return!0;return!1},jQuery:function(t){var n=this,r=[];e.each(t.split(","),function(t,i){i=e.trim(i),n.get(i)&&r.push(i)});var i=e(n.get(r.shift()));return e.each(r,function(e,t){i=i.add(n.get(t))}),i},$:function(e){return this.jQuery.apply(this,H.array(arguments))}},e.each(S,function(e,t){var r=/_/.test(t)?t.replace(/_/g,""):t;n[t.toUpperCase()]="galleria."+r}),e.extend(n,{IE9:y===9,IE8:y===8,IE7:y===7,IE6:y===6,IE:y,WEBKIT:/webkit/.test(h),CHROME:/chrome/.test(h),SAFARI:/safari/.test(h)&&!/chrome/.test(h),QUIRK:y&&i.compatMode&&i.compatMode==="BackCompat",MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!t.opera,IPHONE:/iphone/.test(h),IPAD:/ipad/.test(h),ANDROID:/android/.test(h),TOUCH:"ontouchstart"in i}),n.addTheme=function(r){r.name||n.raise("No theme name specified"),typeof r.defaults!="object"?r.defaults={}:r.defaults=x(r.defaults);var i=!1,s;return typeof r.css=="string"?(e("link").each(function(e,t){s=new RegExp(r.css);if(s.test(t.href))return i=!0,P(r),!1}),i||e(function(){var o=0,u=function(){e("script").each(function(e,n){s=new RegExp("galleria\\."+r.name.toLowerCase()+"\\."),s.test(n.src)&&(i=n.src.replace(/[^\/]*$/,"")+r.css,t.setTimeout(function(){H.loadCSS(i,"galleria-theme",function(){P(r)})},1))}),i||(o++>5?n.raise("No theme CSS loaded"):t.setTimeout(u,500))};u()})):P(r),r},n.loadTheme=function(r,i){if(e("script").filter(function(){return e(this).attr("src")==r}).length)return;var s=!1,o;return e(t).load(function(){s||(o=t.setTimeout(function(){!s&&!n.theme&&n.raise("Galleria had problems loading theme at "+r+". Please check theme path or load manually.",!0)},2e4))}),n.unloadTheme(),H.loadScript(r,function(){s=!0,t.clearTimeout(o)}),n},n.unloadTheme=function(){return typeof n.theme=="object"&&(e("script").each(function(t,r){(new RegExp("galleria\\."+n.theme.name+"\\.")).test(r.src)&&e(r).remove()}),n.theme=r),n},n.get=function(e){if(!!O[e])return O[e];if(typeof e!="number")return O;n.raise("Gallery index "+e+" not found")},n.configure=function(t,r){var i={};return typeof t=="string"&&r?(i[t]=r,t=i):e.extend(i,t),n.configure.options=i,e.each(n.get(),function(e,t){t.setOptions(i)}),n},n.configure.options={},n.on=function(t,r){if(!t)return;r=r||m;var i=t+r.toString().replace(/\s/g,"")+H.timestamp();return e.each(n.get(),function(e,n){n._binds.push(i),n.bind(t,r)}),n.on.binds.push({type:t,callback:r,hash:i}),n},n.on.binds=[],n.run=function(t,r){return e.isFunction(r)&&(r={extend:r}),e(t||"#galleria").galleria(r),n},n.addTransition=function(e,t){return j.effects[e]=t,n},n.utils=H,n.log=function(){var n=H.array(arguments);if(!("console"in t&&"log"in t.console))return t.alert(n.join("<br>"));try{return t.console.log.apply(t.console,n)}catch(r){e.each(n,function(){t.console.log(this)})}},n.ready=function(t){return typeof t!="function"?n:(e.each(A,function(e,n){t.call(n,n._options)}),n.ready.callbacks.push(t),n)},n.ready.callbacks=[],n.raise=function(e,t){var n=t?"Fatal error":"Error",r={color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5},i=function(e){};if(f){i(e);if(t)throw new Error(n+": "+e)}else if(t){if(M)return;M=!0,t=!1,i("Gallery could not load.")}},n.version=a,n.requires=function(e,t){return t=t||"You need to upgrade Galleria to version "+e+" to use one or more components.",n.version<e&&n.raise(t,!0),n},n.Picture=function(t){this.id=t||null,this.image=null,this.container=H.create("galleria-image"),e(this.container).css({overflow:"hidden",position:"relative"}),this.original={width:0,height:0},this.ready=!1,this.isIframe=!1},n.Picture.prototype={cache:{},show:function(){H.show(this.image)},hide:function(){H.moveOut(this.image)},clear:function(){this.image=null},isCached:function(e){return!!this.cache[e]},preload:function(t){e(new Image).load(function(e,t){return function(){t[e]=e}}(t,this.cache)).attr("src",t)},load:function(r,i,s){typeof i=="function"&&(s=i,i=null);if(this.isIframe){var o="if"+(new Date).getTime(),u=this.image=e("<iframe>",{src:r,frameborder:0,id:o,allowfullscreen:!0,css:{visibility:"hidden"}})[0];return i&&e(u).css(i),e(this.container).find("iframe,img").remove(),this.container.appendChild(this.image),e("#"+o).load(function(n,r){return function(){t.setTimeout(function(){e(n.image).css("visibility","visible"),typeof r=="function"&&r.call(n,n)},10)}}(this,s)),this.container}this.image=new Image,n.IE8&&e(this.image).css("filter","inherit");var a=!1,f=!1,l=e(this.container),h=e(this.image),p=function(){a?c?e(this).attr("src",c):n.raise("Image not found: "+r):(a=!0,t.setTimeout(function(e,t){return function(){e.attr("src",t+(t.indexOf("?")>-1?"&":"?")+H.timestamp())}}(e(this),r),50))},d=function(r,s,o){return function(){var u=function(){e(this).off("load"),r.original=i||{height:this.height,width:this.width},n.HAS3D&&(this.style.MozTransform=this.style.webkitTransform="translate3d(0,0,0)"),l.append(this),r.cache[o]=o,typeof s=="function"&&t.setTimeout(function(){s.call(r,r)},1)};!this.width||!this.height?function(t){H.wait({until:function(){return t.width&&t.height},success:function(){u.call(t)},error:function(){f?n.raise("Could not extract width/height from image: "+t.src+". Traced measures: width:"+t.width+"px, height: "+t.height+"px."):(e(new Image).load(d).attr("src",t.src),f=!0)},timeout:100})}(this):u.call(this)}}(this,s,r);return l.find("iframe,img").remove(),h.css("display","block"),H.hide(this.image),e.each("minWidth minHeight maxWidth maxHeight".split(" "),function(e,t){h.css(t,/min/.test(t)?"0":"none")}),h.load(d).on("error",p).attr("src",r),this.container},scale:function(t){var i=this;t=e.extend({width:0,height:0,min:r,max:r,margin:0,complete:m,position:"center",crop:!1,canvas:!1,iframelimit:r},t);if(this.isIframe){var s=t.width,o=t.height,u,a;if(t.iframelimit){var f=v.min(t.iframelimit/s,t.iframelimit/o);f<1?(u=s*f,a=o*f,e(this.image).css({top:o/2-a/2,left:s/2-u/2,position:"absolute"})):e(this.image).css({top:0,left:0})}e(this.image).width(u||s).height(a||o).removeAttr("width").removeAttr("height"),e(this.container).width(s).height(o),t.complete.call(i,i);try{this.image.contentWindow&&e(this.image.contentWindow).trigger("resize")}catch(l){}return this.container}if(!this.image)return this.container;var c,h,p=e(i.container),d;return H.wait({until:function(){return c=t.width||p.width()||H.parseValue(p.css("width")),h=t.height||p.height()||H.parseValue(p.css("height")),c&&h},success:function(){var n=(c-t.margin*2)/i.original.width,r=(h-t.margin*2)/i.original.height,s=v.min(n,r),o=v.max(n,r),u={"true":o,width:n,height:r,"false":s,landscape:i.original.width>i.original.height?o:s,portrait:i.original.width<i.original.height?o:s},a=u[t.crop.toString()],f="";t.max&&(a=v.min(t.max,a)),t.min&&(a=v.max(t.min,a)),e.each(["width","height"],function(t,n){e(i.image)[n](i[n]=i.image[n]=v.round(i.original[n]*a))}),e(i.container).width(c).height(h),t.canvas&&_&&(_.elem.width=i.width,_.elem.height=i.height,f=i.image.src+":"+i.width+"x"+i.height,i.image.src=_.cache[f]||function(e){_.context.drawImage(i.image,0,0,i.original.width*a,i.original.height*a);try{return d=_.elem.toDataURL(),_.length+=d.length,_.cache[e]=d,d}catch(t){return i.image.src}}(f));var l={},p={},m=function(t,n,r){var s=0;if(/\%/.test(t)){var o=parseInt(t,10)/100,u=i.image[n]||e(i.image)[n]();s=v.ceil(u*-1*o+r*o)}else s=H.parseValue(t);return s},g={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};e.each(t.position.toLowerCase().split(" "),function(e,t){t==="center"&&(t="50%"),l[e?"top":"left"]=t}),e.each(l,function(t,n){g.hasOwnProperty(n)&&e.extend(p,g[n])}),l=l.top?e.extend(l,p):p,l=e.extend({top:"50%",left:"50%"},l),e(i.image).css({position:"absolute",top:m(l.top,"height",h),left:m(l.left,"width",c)}),i.show(),i.ready=!0,t.complete.call(i,i)},error:function(){n.raise("Could not scale image: "+i.image.src)},timeout:1e3}),this}},e.extend(e.easing,{galleria:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},galleriaIn:function(e,t,n,r,i){return r*(t/=i)*t+n},galleriaOut:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n}}),n.Finger=function(){var r=v.abs,o=n.HAS3D=function(){var t=i.createElement("p"),n,r=["webkit","O","ms","Moz",""],s,o=0,u="transform";b().html.insertBefore(t,null);for(;r[o];o++)s=r[o]?r[o]+"Transform":u,t.style[s]!==undefined&&(t.style[s]="translate3d(1px,1px,1px)",n=e(t).css(r[o]?"-"+r[o].toLowerCase()+"-"+u:u));return b().html.removeChild(t),n!==undefined&&n.length>0&&n!=="none"}(),u=function(){var e="RequestAnimationFrame";return t.requestAnimationFrame||t["webkit"+e]||t["moz"+e]||t["o"+e]||t["ms"+e]||function(e){t.setTimeout(e,1e3/60)}}(),a=function(n,r){this.config={start:0,duration:500,onchange:function(){},oncomplete:function(){},easing:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n}},this.easeout=function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n};if(!n.children.length)return;var i=this;e.extend(this.config,r),this.elem=n,this.child=n.children[0],this.to=this.pos=0,this.touching=!1,this.start={},this.index=this.config.start,this.anim=0,this.easing=this.config.easing,o||(this.child.style.position="absolute",this.elem.style.position="relative"),e.each(["ontouchstart","ontouchmove","ontouchend","setup"],function(e,t){i[t]=function(e){return function(){e.apply(i,arguments)}}(i[t])}),this.setX=function(){var e=i.child.style;if(!o){e.left=i.pos+"px";return}e.MozTransform=e.webkitTransform="translate3d("+i.pos+"px,0,0)";return},e(n).on("touchstart",this.ontouchstart),e(t).on("resize",this.setup),e(t).on("orientationchange",this.setup),this.setup(),function s(){u(s),i.loop.call(i)}()};return a.prototype={constructor:a,setup:function(){this.width=e(this.elem).width(),this.length=v.ceil(e(this.child).width()/this.width),this.index!==0&&(this.index=v.max(0,v.min(this.index,this.length-1)),this.pos=this.to=-this.width*this.index)},setPosition:function(e){this.pos=e,this.to=e},ontouchstart:function(e){var t=e.originalEvent.touches;this.start={pageX:t[0].pageX,pageY:t[0].pageY,time:+(new Date)},this.isScrolling=null,this.touching=!0,this.deltaX=0,s.on("touchmove",this.ontouchmove),s.on("touchend",this.ontouchend)},ontouchmove:function(e){var t=e.originalEvent.touches;if(t&&t.length>1||e.scale&&e.scale!==1)return;this.deltaX=t[0].pageX-this.start.pageX,this.isScrolling===null&&(this.isScrolling=!!(this.isScrolling||v.abs(this.deltaX)<v.abs(t[0].pageY-this.start.pageY))),this.isScrolling||(e.preventDefault(),this.deltaX/=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0?v.abs(this.deltaX)/this.width+1.8:1,this.to=this.deltaX-this.index*this.width),e.stopPropagation()},ontouchend:function(e){this.touching=!1;var t=+(new Date)-this.start.time<250&&v.abs(this.deltaX)>40||v.abs(this.deltaX)>this.width/2,n=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0,r=this.index+(t&&!n?this.deltaX<0?1:-1:0);t&&r==this.index&&parseInt(this.index,10)===parseInt(this.length-1,10)?r=0:t&&r==this.index&&parseInt(this.index,10)===0&&(r=parseInt(this.length-1,10)),this.isScrolling||this.show(r),s.off("touchmove",this.ontouchmove),s.off("touchend",this.ontouchend)},show:function(e){e!=this.index?this.config.onchange.call(this,e):this.to=-(e*this.width)},moveTo:function(e){e!=this.index&&(this.pos=this.to=-(e*this.width),this.index=e)},loop:function(){var e=this.to-this.pos,t=1;this.width&&e&&(t=v.max(.5,v.min(1.5,v.abs(e/this.width))));if(this.touching||v.abs(e)<=1)this.pos=this.to,e=0,this.anim&&!this.touching&&this.config.oncomplete(this.index),this.anim=0,this.easing=this.config.easing;else{this.anim||(this.anim={start:this.pos,time:+(new Date),distance:e,factor:t,destination:this.to});var n=+(new Date)-this.anim.time,r=this.config.duration*this.anim.factor;if(n>r||this.anim.destination!=this.to){this.anim=0,this.easing=this.easeout;return}this.pos=this.easing(null,n,this.anim.start,this.anim.distance,r)}this.setX()}},a}(),e.fn.galleria=function(t){var r=this.selector;return e(this).length?this.each(function(){e.data(this,"galleria")&&(e.data(this,"galleria").destroy(),e(this).find("*").hide()),e.data(this,"galleria",(new n).init(this,t))}):(e(function(){e(r).length?e(r).galleria(t):n.utils.wait({until:function(){return e(r).length},success:function(){e(r).galleria(t)},error:function(){n.raise('Init failed: Galleria could not find the element "'+r+'".')},timeout:5e3})}),this)},typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=n:(t.Galleria=n,typeof define=="function"&&define.amd&&define("galleria",["jquery"],function(){return n}))}(jQuery,this),define("com/external/galleria/galleria-1.2.9",function(){}),function(e){Galleria.addTheme({name:"classic",author:"Galleria",css:"galleria.classic.css",defaults:{transition:"slide",thumbCrop:"height",_toggleInfo:!0},init:function(t){Galleria.requires(1.33,"This version of Classic theme requires Galleria 1.3.3 or later"),touch=Galleria.TOUCH,this.bind("loadstart",function(n){n.cached||this.$("loader").show().fadeTo(200,.4),this.$("info").toggle(this.hasInfo()),e(n.thumbTarget).css("opacity",1).parent().siblings().children().css("opacity",.6);var r=".galleria-info-description";e(r,t.widgetRef).css("opacity",0)}),this.bind("image",function(n){if(n.imageTarget&&n.imageTarget.parentElement){var r=e(n.imageTarget.parentElement);r.css("opacity",1),r.next().length>0&&r.next().css("opacity",0),r.prev().length>0&&r.prev().css("opacity",0)}e(".gallary-img-caption").html(unescape(n.galleriaData.title));var i=".galleria-info-description",s=e(n.galleriaData.description).html();_.delay(function(){t.widgetInstance.trigger(WIDGET_EVENTS.POPULATE_MORE,s,i,t.widgetRef),e(".more-less-description").removeClass("overflowed-content")},500)}),this.bind("loadfinish",function(t){if(t.imageTarget&&t.imageTarget.parentElement){var n=e(t.imageTarget.parentElement);n.css("opacity",1),n.next().length>0&&n.next().css("opacity",0),n.prev().length>0&&n.prev().css("opacity",0)}this.$("loader").fadeOut(200)}),e(".galleria-image-nav-left, .galleria-image-nav-right").addClass("icon")}})}(jQuery),define("com/external/galleria/galleria.classic",function(){}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/galleryPopupViewTemplate.html",[],function(){return'<% var i = 0;var count = obj.images.length; _.each(obj.images, function(o){%>\n	<% i++; %>\n	<a href="<%= obj.resourceURL + o.src %>" style="width: <%= o.width %>px">\n		<img src="" width="100%" data-big="<%=o.src %>" data-title="<span class=fig-title><%=unescape(o.title) %></span>" data-description="<div class=\'gal-fig-description\'><%=o.description%></div>" />\n	</a>\n<%})%>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/inlineViewTemplate.html",[],function(){return"<div id='<%= id %>' style='width:<%= width %>px'>\r\n  	<div class='ui-button-div'>\r\n        <div class='ui-maximize ui-play-button icon icon-ic-play'></div>\r\n	</div>\r\n	<img src='<%= src %>' width='100%'/>\r\n	<div class='ui-bottom-controller'>\r\n			<div class='inline-widget-footer'>\r\n				<!--<div class='ui-gal-icon'></div>-->\r\n               <div class=\"ui-gal-icon icon icon-ic-slideshow\"></div>\r\n				<div class='ui-gal-text-left'><%=unescape(galTitle) %></div>\r\n                <div class=\"ui-maximize ui-right-div icon icon-ic-fullscreen\"></div>\r\n			</div>\r\n            <div class='image-bar-fixed-width'>\r\n                <div class='ui-bottom-mid'>\r\n                    <div class='ui-left-div'><span class='ui-gal-text-right'>1/<%= noOfImages %></span></div>\r\n                    <!--<div class='ui-maximize ui-right-div'></div>-->\r\n                    <div class=\"ui-maximize ui-right-div icon icon-ic-fullscreen\"></div>\r\n                </div>\r\n            </div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\n	<div class='print-widget-header'>\n		<!--<div class='ui-file-icon'></div>-->\n        <div class=\"ui-play-button icon icon-ic-play\"></div>\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\n	</div>\n	<% _.each(images,function(o){%>\n	<div class='print-gallery-main'>\n		<div class='print-gallery-title'><%=unescape(o.title)%></div>\n		<img src='<%=(resourceURL+o.src)%>'/>\n		<p class=\"print-widget-desc\"><%=unescape(o.description)%></p>\n	</div>\n	<%}) %>\n</div>\n"}),define("com/es/widgets/imageGallery/ImageGalleryWidget",["com/es/widgets/WidgetUtils","com/external/galleria/galleria-1.2.9","com/external/galleria/galleria.classic","com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/galleryPopupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/imgGalleryView/printViewTemplate.html"],function(e,t,n,r,i,s,o){var u=function(t){var n,u,a,f,l,c,h,p,d,v,m,g,y,b={},w=WIDGET_CONSTANTS.IMAGE_GAL_MIN_WIDTH,E=WIDGET_CONSTANTS.IMAGE_GAL_MIN_HEIGHT,S;window._iScroll=null;var x=!1,T=!1,N,C=!1,k=function(){e.log("init image gal",n),g=h.bookFrameContent,y=h.bookFrameContentRootEl;if(h.data_json){var t=h.data_json,r=_bookURL.split("/");r.pop(),r=r.join("/")+"/"+h.dataURL;var i=r.split("/");i.pop(),f=i.join("/")+"/",A(t)}else L()},L=function(){var t=_bookURL.split("/");t.pop(),t=t.join("/")+"/"+d;var r=t.split("/");r.pop(),f=r.join("/")+"/",$.getJSON(t,{}).done(function(e){A(e)}).fail(function(t,r,i){e.log("error",i),n.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,i.message)})},A=function(e){v=e,v.formattedTitle&&(v.title=v.formattedTitle),WIDGET_CONSTANTS.PRINT_MODE?j():x||B(),n.trigger(WIDGET_EVENTS.INITIALIZED,n)},O=function(e){c.addClass("img-gal-popup");var t={type:"image-gallery"};n.trigger(WIDGET_EVENTS.LAUNCHED,n),n.trigger(WIDGET_EVENTS.XAPI_EVENT,n,t)},M=function(){T=!0,a=$("#widgetContent",c);var t=v;e.log("imageData",t);var r=t.title,s=i,o=c;t.resourceURL=f;var l=t;$("#widgetContent").html(_.template(s,l)),$("#widgetContent").galleria({widgetRef:a,widgetInstance:n}),u=Galleria.get(0),$("#widgetContent").QAprepend("<div class='gallary-img-caption'></div>"),$("#widgetPopup").bind(WIDGET_EVENTS.KEYDOWN,function(e){e.keyCode==37?u.prev():e.keyCode==39&&u.next()}),$("#widgetPopup").removeClass("hide"),$(".gal-title",c).html(unescape(v.title)),n.trigger(WIDGET_EVENTS.POPULATED,n);var h=$(".galleria-counter");$(".galleria-info-title",c).remove(),$(".galleria-info-description",c).css("visibility","visible"),$(".galleria-info-description",c).css("display","block"),$(".galleria-info-description",c).after(h),$(".galleria-info-text",c).addClass("info-text"),$(".galleria-info-description",c).addClass("info-description");var p=$(".galleria-thumbnails-list");$(".galleria-info-text",c).after(h),$(".galleria-info-text",c).after(p)},D=function(){$(m.get(0)).addClass("ui-hover-class")},P=function(){$(m.get(0)).removeClass("ui-hover-class")},H=function(){if(h.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t=h.bookFrameContent;xPos=e.getOffset($("#"+l.id,t)).left,yPos=e.getOffset($("#"+l.id,t)).top,_width=$("#"+l.id,t).width(),_height=$("#"+l.id,t).height(),$("#"+l.id,g).data("height")==undefined&&h.align=="fitToWidth"&&(_height=_height>E?_height:E,$("#"+l.id,g).css("height",_height+"px"));var n=$("#ui-"+l.id,h.bookFrameContent);$(n[0]).css({top:yPos,left:xPos,width:_width+"px",height:_height+"px",position:"absolute"}),h.align=="fitToWidth"&&($("#"+l.id,g).attr("data-height",_height+"px"),$("#ui-"+l.id+" img",g).css({height:_height+"px",width:"auto"}),$("#ui-"+l.id,g).addClass("fitToWidth"))}},B=function(){z();var t="widget-"+l.id,r="ui-"+l.id;g.find("#"+r).length>0&&g.find("#"+r).remove();var i='<div class="widget-ui ui-img-gal ui-border invisible" id="'+r+'"></div>',o=$("#"+l.id,g).get(0).innerHTML;o=o.trim(),o.length==0?($("#"+l.id,g).get(0).innerHTML=i,y.append($("#"+r,g))):y.append(i),b={id:t,uiId:r,width:$("#"+l.id,g).width(),src:f+v.images[0].src,noOfImages:v.images.length,galTitle:v.title},b.src=e.getCleanURL(b.src);var u=_.template(s,b),a=$("#"+r,g);m=a,$(a[0]).html(u),$("#"+l.id,g).attr("data-align")==="fitToWidth"&&$("#"+l.id,g).data("width")!=undefined?($("#ui-"+l.id,g).addClass("widget-fitToWidth"),$("#widget-"+l.id,g).addClass("widget-fitToWidth"),$("#ui-"+l.id+" img",g).css("width",$("#"+l.id,g).data("width"))):($("#"+l.id,g).css("width",$("#"+l.id,g).data("width")),$("#widget-"+l.id,g).removeClass("widget-fitToWidth").css("width","auto")),$(".ui-img-gal #"+t+" img",g).on("load",function(e){F(e)}),$(".ui-img-gal #"+t+" img",g).on("error",function(e){C=!0,n.trigger(WIDGET_EVENTS.RENDER_COMPLETE,n,S,w)})},j=function(){z(),b={uiId:"ui-"+l.id,title:v.title,width:$("#"+l.id,g).width()+"px",images:v.images,resourceURL:f};var t=_.template(o,b);e.log("str",t),$("#"+b.uiId,g).remove(),h.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?y.QAappend(t):($("#"+l.id,g).empty().addClass("reflow-print").QAappend(t),$("#"+l.id,g).find(".icon").addClass("reflow-print")),n.trigger(WIDGET_EVENTS.RENDER_COMPLETE,n)},F=function(t){S=t.target.naturalWidth>y.width()?y.width():t.target.naturalWidth,S=S>w?S:w,e.log("image loaded ",S),$("#"+l.id,g).removeClass("widget-loader"),$("#"+l.id,g).find(".move-icon").removeClass("move-icon-compact"),_.delay(function(){U()},100);var i=$("#ui-"+l.id,g).get(0);if(h.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED&&T===!1){R();var s=$("#"+l.id,g).height();s<E&&($("#"+l.id,g).height(E),$("#ui-"+l.id,g).height(E));var o=$("#"+l.id,g).width();o<w&&($("#"+l.id,g).width(w),$("#ui-"+l.id,g).width(w)),$(".ui-img-gal #widget-"+l.id,g).css({height:"100%"});if(h.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(h.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){var u=_.template(r,{id:b.uiId}),a=$("#"+l.id,g).get(0).innerHTML;a=a.trim(),a.length==0?($("#"+l.id,g).get(0).innerHTML=u,y.append($("#div-border-"+b.uiId,g))):y.append(u),$("#div-border-"+b.uiId,g).css({width:$(i).width()+"px",height:$(i).height()+"px",top:i.style.top,left:i.style.left,position:"absolute"}),$("#div-border-"+b.uiId,g).addClass("transparentWidget ui-hover-class"),$("#div-border-"+b.uiId,g).css({"pointer-events":"none"})}$(".ui-button-div",i).remove(),$("#"+l.id,g).find(".move-icon").addClass("move-icon-compact"),$("img",i).remove(),$(".ui-bottom-controller",i).remove(),$(i).QAappend('<div class="ui-clickable-icon ui-gal-icon icon-font"></div>'),$(i).addClass("transparentWidget"),$(i).removeClass("ui-border"),$(i).css({width:$(".ui-clickable-icon",i).width()+"px",height:$(".ui-clickable-icon",i).height()+"px"}),$("#"+l.id+" .dummyWidget",g).show(),h.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+l.id,g).css({width:$(".ui-clickable-icon",i).width()+"px",height:$(".ui-clickable-icon",i).height()+"px"}),$("#"+l.id+" .dummyWidget",g).hide()),$(".ui-gal-icon",i).click({},O)}else h.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?($(i).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize quiz-play-button'></div></div>"),$("img",i).remove(),$(".ui-maximize",i).click({},O)):h.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&$(".ui-maximize",i).click({},O)}else $(".ui-maximize",i).click({},O);C=!0,n.trigger(WIDGET_EVENTS.RENDER_COMPLETE,n,S,w)},I=function(){h.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_SHOW?$(m.get(0)).addClass("ui-hover-class"):$(m.get(0)).hover(D,P)},q=function(){C&&(h.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&h.align!="fitToWidth"&&(z(),U()),h.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?H():R())},R=function(){$("#"+l.id,g).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+l.id,g)).left,n=e.getOffset($("#"+l.id,g)).top,r=$("#"+l.id,g).width(),i=$("#"+l.id,g).height(),N=$("#ui-"+l.id,g).get(0),h.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(N).css({top:n+"px",left:t+"px",position:"absolute"}):$(N).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),h.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+b.uiId,g).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},U=function(){if(h.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE){var e=$("#"+l.id,h.bookFrameContent).width();$("#ui-"+l.id,h.bookFrameContent).width(e);if(h.align=="fitToWidth")var t=$("#"+l.id,g).data("height");else var t=$("#ui-"+l.id+" img",g).height()+"px";$("#"+l.id,h.bookFrameContent).css({height:t})}},z=function(){if(h.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+l.id,g).width();e<w&&$("#"+l.id,g).width(w),e>S&&$("#"+l.id,g).width(S)}},W=function(){z(),U(),H()},X=function(){},V=function(){u.resize()},J=function(){window._iScroll!=null&&(window._iScroll.destroy(),window._iScroll=null),$(".gal-title",c).html(""),u.destroy(),$("#widgetPopup").unbind("keydown"),a.empty(),c.removeClass("img-gal-popup"),T=!1,n.trigger(WIDGET_EVENTS.DESTROYED,n)},K=function(){return WIDGET_CONSTANTS.GALLERY_WIDGET},Q=function(){$(".ui-img-gal #"+b.id+" img",g).off(),$("#"+l.id,g).remove(),$("#ui-"+l.id,g).remove()},G=Backbone.View.extend({initialize:function(t){_.extend(this,Backbone.Events),e.log("_options",t.options),t.directLaunch?x=!0:l=t.obj,h=t.options,c=t.popupView,n=this,_bookURL=h.bookURL,d=h.dataURL},initCurrWidget:k,destroy:J,resize:V,relayout:q,widgetType:K,widgetResize:W,launch:O,onPopupShown:M,destroyView:Q});return new G(t)};return u}),function(e,t){t(e.jQuery)}(this,function(e){function d(e,t){var n=e.length;while(--n)if(+e[n]!==+t[n])return!1;return!0}function v(t){var n={range:!0,animate:!0};return typeof t=="boolean"?n.animate=t:e.extend(n,t),n}function m(t,n,r,i,s,o,u,a,f){e.type(t)==="array"?this.elements=[+t[0],+t[2],+t[4],+t[1],+t[3],+t[5],0,0,1]:this.elements=[t,n,r,i,s,o,u||0,a||0,f||1]}function g(e,t,n){this.elements=[e,t,n]}function y(t,n){if(!(this instanceof y))return new y(t,n);t.nodeType!==1&&e.error("Panzoom called on non-Element node"),e.contains(document,t)||e.error("Panzoom element must be attached to the document");var r=e.data(t,s);if(r)return r;this.options=n=e.extend({},y.defaults,n),this.elem=t;var i=this.$elem=e(t);this.$set=n.$set&&n.$set.length?n.$set:i,this.$doc=e(t.ownerDocument||document),this.$parent=i.parent(),this.isSVG=f.test(t.namespaceURI)&&t.nodeName.toLowerCase()!=="svg",this.panning=!1,this._buildTransform(),this.isSVG||(this._transform=e.cssProps.transform.replace(a,"-$1").toLowerCase()),this._buildTransition(),this.resetDimensions();var o=e(),u=this;e.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(e,t){u[t]=n[t]||o}),this.enable(),e.data(t,s,this)}var t="over out down up move enter leave cancel".split(" "),n=e.extend({},e.event.mouseHooks),r={};if(window.PointerEvent)e.each(t,function(t,i){e.event.fixHooks[r[i]="pointer"+i]=n});else{var i=n.props;n.props=i.concat(["touches","changedTouches","targetTouches","altKey","ctrlKey","metaKey","shiftKey"]),n.filter=function(e,t){var n,r=i.length;if(!t.pageX&&t.touches&&(n=t.touches[0]))while(r--)e[i[r]]=n[i[r]];return e},e.each(t,function(t,i){if(t<2)r[i]="mouse"+i;else{var s="touch"+(i==="down"?"start":i==="up"?"end":i);e.event.fixHooks[s]=n,r[i]=s+" mouse"+i}})}e.pointertouch=r;var s="__pz__",o=Array.prototype.slice,u=!!window.PointerEvent,a=/([A-Z])/g,f=/^http:[\w\.\/]+svg$/,l=/^inline/,c="(\\-?[\\d\\.e]+)",h="\\,?\\s*",p=new RegExp("^matrix\\("+c+h+c+h+c+h+c+h+c+h+c+"\\)$");return m.prototype={x:function(e){var t=e instanceof g,n=this.elements,r=e.elements;return t&&r.length===3?new g(n[0]*r[0]+n[1]*r[1]+n[2]*r[2],n[3]*r[0]+n[4]*r[1]+n[5]*r[2],n[6]*r[0]+n[7]*r[1]+n[8]*r[2]):r.length===n.length?new m(n[0]*r[0]+n[1]*r[3]+n[2]*r[6],n[0]*r[1]+n[1]*r[4]+n[2]*r[7],n[0]*r[2]+n[1]*r[5]+n[2]*r[8],n[3]*r[0]+n[4]*r[3]+n[5]*r[6],n[3]*r[1]+n[4]*r[4]+n[5]*r[7],n[3]*r[2]+n[4]*r[5]+n[5]*r[8],n[6]*r[0]+n[7]*r[3]+n[8]*r[6],n[6]*r[1]+n[7]*r[4]+n[8]*r[7],n[6]*r[2]+n[7]*r[5]+n[8]*r[8]):!1},inverse:function(){var e=1/this.determinant(),t=this.elements;return new m(e*(t[8]*t[4]-t[7]*t[5]),e*-(t[8]*t[1]-t[7]*t[2]),e*(t[5]*t[1]-t[4]*t[2]),e*-(t[8]*t[3]-t[6]*t[5]),e*(t[8]*t[0]-t[6]*t[2]),e*-(t[5]*t[0]-t[3]*t[2]),e*(t[7]*t[3]-t[6]*t[4]),e*-(t[7]*t[0]-t[6]*t[1]),e*(t[4]*t[0]-t[3]*t[1]))},determinant:function(){var e=this.elements;return e[0]*(e[8]*e[4]-e[7]*e[5])-e[3]*(e[8]*e[1]-e[7]*e[2])+e[6]*(e[5]*e[1]-e[4]*e[2])}},g.prototype.e=m.prototype.e=function(e){return this.elements[e]},y.rmatrix=p,y.events=e.pointertouch,y.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,increment:.3,minScale:.4,maxScale:5,rangeStep:.05,duration:200,easing:"ease-in-out",contain:!1},y.prototype={constructor:y,instance:function(){return this},enable:function(){this._initStyle(),this._bind(),this.disabled=!1},disable:function(){this.disabled=!0,this._resetStyle(),this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable(),e.removeData(this.elem,s)},resetDimensions:function(){var t=this.$parent;this.container={width:t.width(),height:t.height()};var n=this.elem,r=this.$elem,i=this.dimensions=this.isSVG?{left:n.getAttribute("x")||0,top:n.getAttribute("y")||0,width:n.getAttribute("width")||r.outerWidth(),height:n.getAttribute("height")||r.outerHeight(),margin:{left:0,top:0}}:{left:e.css(n,"left",!0)||0,top:e.css(n,"top",!0)||0,width:r.outerWidth(),height:r.outerHeight(),margin:{top:e.css(n,"marginTop",!0)||0,left:e.css(n,"marginLeft",!0)||0}};i.widthBorder=e.css(n,"borderLeftWidth",!0)+e.css(n,"borderRightWidth",!0)||0,i.heightBorder=e.css(n,"borderTopWidth",!0)+e.css(n,"borderBottomWidth",!0)||0},reset:function(e){e=v(e);var t=this.setMatrix(this._origTransform,e);e.silent||this._trigger("reset",t)},resetZoom:function(e){e=v(e);var t=this.getMatrix(this._origTransform);e.dValue=t[3],this.zoom(t[0],e)},resetPan:function(e){var t=this.getMatrix(this._origTransform);this.pan(t[4],t[5],v(e))},setTransform:function(t){var n=this.isSVG?"attr":"style",r=this.$set,i=r.length;while(i--)e[n](r[i],"transform",t)},getTransform:function(t){var n=this.$set[0];return t?this.setTransform(t):t=e[this.isSVG?"attr":"style"](n,"transform"),t!=="none"&&!p.test(t)&&!this.isSVG&&this.setTransform(t=e.css(n,"transform")),t||"none"},getMatrix:function(e){var t=p.exec(e||this.getTransform());return t&&t.shift(),t||[1,0,0,1,0,0]},setMatrix:function(t,n){if(this.disabled)return;n||(n={}),typeof t=="string"&&(t=this.getMatrix(t));var r,i,s,o,u,a,f,c,h=+t[0],p=this.$parent,d=typeof n.contain!="undefined"?n.contain:this.options.contain,v=t[4],m=t[5];return d&&(r=this._checkDims(),i=this.container,s=(r.width*h-i.width)/2,o=(r.height*h-i.height)/2,d==="invert"?(u=r.width>i.width?r.width-i.width:0,a=r.height>i.height?r.height-i.height:0,s+=(i.width-r.width)/2,o+=(i.height-r.height)/2,f=r.left+r.margin.left,c=r.top+r.margin.top,t[4]=Math.max(Math.min(t[4],s-f),-s-f-u),t[5]=Math.max(Math.min(t[5],o-c),-o-c-a+r.heightBorder)):(a=i.height>r.height?i.height-r.height:0,p.css("textAlign")!=="center"||!l.test(e.css(this.elem,"display"))?(u=i.width>r.width?i.width-r.width:0,s=o=0):u=0,t[4]=Math.min(Math.max(t[4],s-r.left),-s-r.left+u),t[5]=Math.min(Math.max(t[5],o-r.top),-o-r.top+a)),t[4]=isNaN(t[4])?v:t[4],t[5]=isNaN(t[5])?m:t[5]),n.animate!=="skip"&&this.transition(!n.animate),n.range&&this.$zoomRange.val(h),this.setTransform("matrix("+t.join(",")+")"),n.silent||this._trigger("change",t),t},isPanning:function(){return this.panning},transition:function(t){var n=t||!this.options.transition?"none":this._transition,r=this.$set,i=r.length;while(i--)e.style(r[i],"transition")!==n&&e.style(r[i],"transition",n)},pan:function(e,t,n){if(this.options.disablePan)return;n||(n={});var r=n.matrix;r||(r=this.getMatrix()),n.relative&&(e+=+r[4],t+=+r[5]),r[4]=e,r[5]=t,this.setMatrix(r,n),n.silent||this._trigger("pan",r[4],r[5])},zoom:function(t,n){typeof t=="object"?(n=t,t=null):n||(n={});var r=e.extend({},this.options,n);if(r.disableZoom)return;var i=!1,s=r.matrix||this.getMatrix();typeof t!="number"&&(t=+s[0]+r.increment*(t?-1:1),i=!0),t>r.maxScale?t=r.maxScale:t<r.minScale&&(t=r.minScale);var o=r.focal;if(o&&!r.disablePan){i=!1;var u=this._checkDims(),a=o.clientX-u.width/2,f=o.clientY-u.height/2,l=new g(a,f,1),c=new m(s),h=this.$parent.offset(),p=new m(1,0,h.left-this.$doc.scrollLeft(),0,1,h.top-this.$doc.scrollTop()),d=c.inverse().x(p.inverse().x(l)),v=t/s[0];c=c.x(new m([v,0,0,v,0,0])),l=p.x(c.x(d)),s[4]=+s[4]+(a-l.e(0)),s[5]=+s[5]+(f-l.e(1))}s[0]=t,s[3]=typeof r.dValue=="number"?r.dValue:t,this.setMatrix(s,{animate:typeof r.animate=="boolean"?r.animate:i,range:!r.noSetRange}),r.silent||this._trigger("zoom",s[0],r)},option:function(t,n){var r;if(!t)return e.extend({},this.options);if(typeof t=="string"){if(arguments.length===1)return this.options[t]!==undefined?this.options[t]:null;r={},r[t]=n}else r=t;this._setOptions(r)},_setOptions:function(t){e.each(t,e.proxy(function(t,n){switch(t){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}this.options[t]=n;switch(t){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[t]=n;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":e.style(this.elem,"cursor",n);break;case"minScale":this.$zoomRange.attr("min",n);break;case"maxScale":this.$zoomRange.attr("max",n);break;case"rangeStep":this.$zoomRange.attr("step",n);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"$set":n instanceof e&&n.length&&(this.$set=n)}},this))},_initStyle:function(){this.options.disablePan||this.$elem.css("cursor",this.options.cursor);var t=this.$parent;if(t.length&&!e.nodeName(t[0],"body")){var n={overflow:"hidden"};t.css("position")==="static"&&(n.position="relative"),t.css(n)}},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_bind:function(){var t=this,n=this.options,r=n.eventNamespace,i=u?"pointerdown"+r:"touchstart"+r+" mousedown"+r,s=u?"pointerup"+r:"touchend"+r+" click"+r,o=u?"pointerup"+r:"touchend"+r+" mouseup"+r,a=" mouseleave"+r,f={},l=this.$reset,c=this.$zoomRange;e.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var t=n["on"+this];e.isFunction(t)&&(f["panzoom"+this.toLowerCase()+r]=t)});if(!n.disablePan||!n.disableZoom)f[i]=function(e){var r;if(e.type==="touchstart"?(r=e.touches)&&(r.length===1&&!n.disablePan||r.length===2):!n.disablePan&&e.which===1)e.preventDefault(),e.stopPropagation(),t._startMove(e,r)},f[o]=f[a]=function(n){console.log("----str_stop --- on mouse leave");var i=t.getMatrix(),s=i.slice(0);n.preventDefault(),e(document).off(r),t.panning=!1,n.type="panzoomend",t._trigger(n,i,!d(i,s))};this.$elem.on(f),l.length&&l.on(s,function(e){e.preventDefault(),t.reset()}),c.length&&c.attr({step:n.rangeStep===y.defaults.rangeStep&&c.attr("step")||n.rangeStep,min:n.minScale,max:n.maxScale}).prop({value:this.getMatrix()[0]});if(n.disableZoom)return;var h=this.$zoomIn,p=this.$zoomOut;h.length&&p.length&&(h.on(s,function(e){e.preventDefault(),t.zoom()}),p.on(s,function(e){e.preventDefault(),t.zoom(!0)})),c.length&&(f={},f[(u?"pointerdown":"mousedown")+r]=function(){t.transition(!0)},f["change"+r]=function(){t.zoom(+this.value,{noSetRange:!0})},c.on(f))},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){var e=this.options;this._transform&&(this._transition=this._transform+" "+e.duration+"ms "+e.easing)},_checkDims:function(){var e=this.dimensions;return(e.width===e.widthBorder||e.height===e.heightBorder)&&this.resetDimensions(),this.dimensions},_getDistance:function(e){var t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))},_getMiddle:function(e){var t=e[0],n=e[1];return{clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY}},_trigger:function(e){typeof e=="string"&&(e="panzoom"+e),this.$elem.triggerHandler(e,[this].concat(o.call(arguments,1)))},_startMove:function(t,n){var r,i,s,o,a,f,l,c,h=this,p=this.options,v=p.eventNamespace,m=this.getMatrix(),g=m.slice(0),y=+g[4],b=+g[5],w={matrix:m,animate:"skip"};u?(i="pointermove",s="pointerup"):t.type==="touchstart"?(i="touchmove",s="touchend"):(i="mousemove",s="mouseup"),i+=v,s+=v,this.transition(!0),this.panning=!0,this._trigger("start",t,n),n&&n.length===2?(o=this._getDistance(n),a=+m[0],f=this._getMiddle(n),r=function(e){e.preventDefault();var t=h._getMiddle(n=e.touches),r=h._getDistance(n)-o;h.zoom(r*(p.increment/100)+a,{focal:t,matrix:m}),h.pan(+m[4]+t.clientX-f.clientX,+m[5]+t.clientY-f.clientY,w),f=t}):(l=t.pageX,c=t.pageY,r=function(e){e.preventDefault(),h.pan(y+e.pageX-l,b+e.pageY-c,w)}),e(document).off(v).on(i,r).on(s,function(t){t.preventDefault(),e(this).off(v),h.panning=!1,t.type="panzoomend",h._trigger(t,m,!d(m,g))})}},e.Panzoom=y,e.fn.panzoom=function(t){var n,r,i,u;return typeof t=="string"?(u=[],r=o.call(arguments,1),this.each(function(){n=e.data(this,s),n?t.charAt(0)!=="_"&&typeof (i=n[t])=="function"&&(i=i.apply(n,r))!==undefined&&u.push(i):u.push(undefined)}),u.length?u.length===1?u[0]:u:this):this.each(function(){new y(this,t)})},y}),define("com/external/jquery.panzoom",function(){}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/inlineViewTemplate.html",[],function(){return"<div class='widget-ui ui-img-gal ui-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<img src='<%=src%>'/>\r\n	<div class='inline-widget-footer'>\r\n		<!--<div class='ui-img-icon'></div>-->\r\n        <div class=\"ui-img-icon icon icon-ic-image widget-img-icon-style\"></div>\r\n		<div class='ui-gal-text-left img-widget-text-style'><%=unescape(title)%></div>\r\n		<!--<div class='ui-maximize ui-right-div'></div>-->\r\n        <div class=\"ui-maximize ui-right-div icon icon-ic-fullscreen\"></div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/popupViewTemplate.html",[],function(){return"<div class='image-container'>\n    <div class='image-content'>\n        <img src='<%=resourceURL+src%>' class='' />\n	</div>\n</div>\n<div class='image-info-text info-text'>\n    <!--div class='image-info-title'><span class='fig-title'><%=unescape(imageTitle)%></span></div-->\n    <div class='image-info-description info-description'>\n        <div><%=unescape(description)%></div>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/zoomControlsTemplate.html",[],function(){return"<div class='zoom-controls'>\r\n    <button class='zoom-out icon icon-zoom-out'>  </button>\r\n    <input type='range' min='1' max='10' class='zoom-range' />\r\n    <button class='zoom-in icon icon-zoom-in'>  </button>\r\n    <span class='reset zoom-reset icon icon-refresh'></span>\r\n     <div class='range-tooltip'><span class='zoom-value '>1.00</span></div>\r\n    <!--button class='reset zoom-reset'></button-->\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='print-widget-header'>\r\n		<!--<div class='ui-img-icon'></div>-->\r\n		<div class=\"ui-img-icon icon icon-ic-image widget-img-icon-style\"></div>\r\n		<div class='ui-gal-text-left img-widget-text-style'><%=unescape(title)%></div>\r\n	</div>\r\n	<img src='<%=src%>'/>\r\n	<div class=\"print-widget-desc\">\r\n		<%=unescape(description)%>\r\n	</div>\r\n</div>\r\n"}),define("com/es/widgets/image/ImageWidget",["com/es/widgets/WidgetUtils","com/es/widgets/WidgetEvents","com/external/jquery.panzoom","com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/zoomControlsTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/imgView/printViewTemplate.html"],function(e,t,n,r,i,s,o,u){var a=function(t){var n,a,f,l,c,h,p,d,v,m=null,g,y={},b=!1,w=!1,E,S=WIDGET_CONSTANTS.IMAGE_MIN_WIDTH,x=WIDGET_CONSTANTS.IMAGE_MIN_HEIGHT,T=null,N=null,C=!1,k,L=require.s.contexts._.config.theme,A=function(){e.log("init image",n),d=a.bookFrameContent,v=a.bookFrameContentRootEl;if(a.data_json){var t=a.data_json,r=f.split("/");r.pop(),r=r.join("/")+"/"+a.dataURL;var i=r.split("/");i.pop(),l=i.join("/")+"/",M(t)}else O()},O=function(){var t=f.split("/");t.pop(),t=t.join("/")+"/"+a.dataURL,e.log("url",t);var r=t.split("/");r.pop(),l=r.join("/")+"/",e.log("_resourceURL",l),$.getJSON(t,{}).done(function(e){M(e)}).fail(function(t,r,i){e.log("error",i),n.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,i.message)})},M=function(e){p=e,p.formattedTitle&&(p.title=p.formattedTitle),WIDGET_CONSTANTS.PRINT_MODE?D():b||R(),n.trigger(WIDGET_EVENTS.INITIALIZED,n)},D=function(){J(),y={uiId:"ui-"+c.id,src:e.getCleanURL(l+p.src),title:p.title,description:p.description,width:$("#"+c.id,d).width()+"px"};var t=_.template(u,y);e.log("str",t),$("#"+y.uiId,d).remove(),a.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?v.QAappend(t):($("#"+c.id,d).empty().addClass("reflow-print").QAappend(t),$("#"+c.id,d).find(".icon").addClass("reflow-print")),n.trigger(WIDGET_EVENTS.RENDER_COMPLETE,n)},P=function(e){h.addClass("img-popup"),n.trigger(WIDGET_EVENTS.LAUNCHED,n),n.trigger(WIDGET_EVENTS.XAPI_EVENT,n)},H=function(){w=!0,k=$("#widgetContent",h),p.resourceURL=l,e.log("imageData",p),$("#widgetContent").html(_.template(s,p)),$(".gal-title",h).html(unescape(p.title)),$(".gal-title",h).after(o);var t=".image-info-description";n.trigger(WIDGET_EVENTS.POPULATE_MORE,p.description,t,k),j();var r=$("#widgetContent",h);r.find(".image-content").panzoom({contain:"invert",$zoomIn:$("#widget-header",h).find(".zoom-in"),$zoomOut:$("#widget-header",h).find(".zoom-out"),$zoomRange:$("#widget-header",h).find(".zoom-range"),increment:L=="cup"?1:.25,minScale:1,maxScale:L=="cup"?10:2,rangeStep:L=="cup"?1:.25,onChange:B}),e.isTouchDevice()&&$(".zoom-controls",h).hide(),n.trigger(WIDGET_EVENTS.POPULATED,n,T,N)},B=function(t){var n=$(".zoom-range",h).get(0).value;n>1?$(".zoom-reset").css("opacity",1):$(".zoom-reset").css("opacity",.3);var r=$("#widgetContent",h),i=r.find(".image-content").panzoom("instance");_.delay(function(){i.$reset.length==0&&r.find(".image-content").panzoom("option",{$reset:$("#widget-header",h).find(".reset")})},200);var s,o,u;s=n+" : 1",o=n,u=(n-1)*100,n>1&&(u-=3),o.length<3&&(o+=".0"),o.length<4&&(o+="0"),$(".zoom-value").length>0&&$(".zoom-value").html(s),$(".zoom-value").length>0&&($(".zoom-value").html(o),L=="cup"?(n=n=="1"?0:n,$(".zoom-value").css("left",9.2*n+"%")):$(".zoom-value").css("left",u+"%"));var a=L=="cup"?9:1;e.fillRange($(".zoom-range",h),(n-1)/a)},j=function(){var e=$("#widget-header").height(),t=$("#widgetContent").find("img").get(0).naturalHeight,n=parseFloat($(".image-content").css("padding-top"))+parseFloat($(".image-content").css("padding-bottom")),r=parseFloat($(".image-content").css("margin-top"))+parseFloat($(".image-content").css("margin-bottom")),i=parseFloat($(".image-content").css("top")),s=$(".image-info-text").height();N=e+t+n+r+i+s,T=$("#widgetContent").find("img").width()},F=function(){m!=null&&m.destroy();var e=$(".image-info-text").height()-$(".image-info-title").height();$(".image-info-description").height(e),m=new IScroll($(".image-info-description").get(0),{desktopCompatibility:!0,vScroll:!0,hScroll:!1}),_.delay(function(){m&&m.refresh()},999)},I=function(){$(g).addClass("ui-hover-class")},q=function(){$(g).removeClass("ui-hover-class")},R=function(){J(),y={uiId:"ui-"+c.id,widgetId:"widget-"+c.id,src:l+p.src,title:p.title,imageTitle:p.imageTitle,width:$("#"+c.id,d).width()+"px"},y.src=e.getCleanURL(y.src);var t=_.template(r,y);e.log("str",t),$("#"+y.uiId,d).remove();var i=$("#"+c.id,d).get(0).innerHTML;i=i.trim(),i.length==0?($("#"+c.id,d).get(0).innerHTML=t,v.append($("#"+y.uiId,d))):v.append(t);var s=y.uiId;$("#"+c.id,d).attr("data-align")==="fitToWidth"&&($("#ui-"+c.id,d).addClass("widget-fitToWidth"),$("#ui-"+c.id+" img",d).width($("#"+c.id,d).data("width"))),$(".ui-img-gal#"+s+" img",d).on("load",function(e){U(e)}),$(".ui-img-gal#"+s+" img",d).on("error",function(e){C=!0,n.trigger(WIDGET_EVENTS.RENDER_COMPLETE,n,E,S)})},U=function(t){E=t.target.naturalWidth>v.width()?v.width():t.target.naturalWidth,E=E>S?E:S,e.log("image loaded ",E),$("#"+c.id,d).removeClass("widget-loader"),$("#"+c.id,d).find(".move-icon").removeClass("move-icon-compact"),_.delay(function(){V()},100);var r=$("#ui-"+c.id,d).get(0);if(a.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED&&w===!1){W();var s=$("#"+c.id,d).height();s<x&&($("#"+c.id,d).height(x),$("#ui-"+c.id,d).height(x));var o=$("#"+c.id,d).width();o<S&&($("#"+c.id,d).width(S),$("#ui-"+c.id,d).width(S));if(a.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){var u=_.template(i,{id:y.uiId}),f=$("#"+c.id,d).get(0).innerHTML;f=f.trim(),f.length==0?($("#"+c.id,d).get(0).innerHTML=u,v.append($("#div-border-"+y.uiId,d))):v.append(u),$("#div-border-"+y.uiId,d).css({width:$(r).width()+"px",height:$(r).height()+"px",top:r.style.top,left:r.style.left,position:"absolute"}),$("#div-border-"+y.uiId,d).addClass("transparentWidget ui-hover-class"),$("#div-border-"+y.uiId,d).css({"pointer-events":"none"})}$("img",r).remove(),$(".inline-widget-footer",r).remove(),$(r).QAappend('<div class="ui-clickable-icon ui-img-icon icon-font"></div>'),$(r).addClass("transparentWidget"),$(r).removeClass("ui-border"),$(r).css({width:$(".ui-clickable-icon",r).width()+"px",height:$(".ui-clickable-icon",r).height()+"px"}),$("#"+c.id,d).find(".move-icon").addClass("move-icon-compact"),$("#"+c.id+" .dummyWidget",d).show(),a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+c.id,d).css({"min-width":"0px",width:$(".ui-clickable-icon",r).width()+"px",height:$(".ui-clickable-icon",r).height()+"px"}),$("#"+c.id+" .dummyWidget",d).hide()),$(".ui-img-icon, img",r).on("click",P)}else a.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?($(r).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize quiz-play-button'></div></div>"),$("img",r).remove(),$(".ui-maximize, img",r).on("click",P)):a.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&$(".ui-maximize, img",r).on("click",P)}else $(".ui-maximize, img",r).on("click",P);C=!0,n.trigger(WIDGET_EVENTS.RENDER_COMPLETE,n,E,S)},z=function(){C&&(a.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&a.align!="fitToWidth"&&(J(),V()),a.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?X():W())},W=function(){e.log("_setDimensions-------------------------"),$("#"+c.id,d).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+c.id,d)).left,n=e.getOffset($("#"+c.id,d)).top,r=$("#"+c.id,d).width(),i=$("#"+c.id,d).height(),g=$("#ui-"+c.id,d).get(0),a.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(g).css({top:n+"px",left:t+"px",position:"absolute"}):$(g).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+y.uiId,d).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},X=function(){if(a.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t=a.bookFrameContent,n,r,i,s;n=e.getOffset($("#"+c.id,t)).left,r=e.getOffset($("#"+c.id,t)).top,i=$("#"+c.id,t).width(),s=$("#"+c.id,t).height(),$("#"+c.id,d).data("height")==undefined&&a.align=="fitToWidth"&&(s=s>x?s:x,$("#"+c.id,d).css("height",s+"px")),g=$("#ui-"+c.id,t).get(0),$(g).css({top:r,left:n,width:i,height:s+"px",position:"absolute"}),a.align=="fitToWidth"&&($("#"+c.id,d).attr("data-height",s+"px"),$("#ui-"+c.id+" img",d).css({height:s+"px",width:"auto"}))}},V=function(){if(a.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE){var e=$("#"+c.id,a.bookFrameContent),t=e.width();$("#ui-"+c.id,a.bookFrameContent).width(t);if(a.align=="fitToWidth"&&$("#"+c.id,d).data("height")!=undefined)var n=$("#"+c.id,d).data("height");else var n=$(".ui-img-gal#"+y.uiId+" img",d).get(0).clientHeight;y.height=n,$("#"+c.id,d).css("height",y.height+"px")}},J=function(){if(a.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+c.id,d).width();e<S&&$("#"+c.id,d).width(S),e>E&&$("#"+c.id,d).width(E)}},K=function(){J(),V(),X()},Q=function(){a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_SHOW?$(g).addClass("ui-hover-class"):$(g).hover(I,q)},G=function(){},Y=function(){$("#widgetContent",h).find(".image-content").panzoom("destroy"),k.empty(),h.removeClass("img-popup"),w=!1,$(".gal-title",h).html(""),$(".zoom-controls",h).remove(),m!=null&&(m.destroy(),m=null),n.trigger(WIDGET_EVENTS.DESTROYED,n)},Z=function(){return WIDGET_CONSTANTS.IMAGE_WIDGET},et=function(){$(".ui-img-gal#"+y.uiId+" img",d).off(),$("#"+c.id,d).remove(),$("#ui-"+c.id,d).remove()},tt=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?b=!0:c=e.obj,a=e.options,h=e.popupView,n=this,f=a.bookURL},initCurrWidget:A,destroy:Y,relayout:z,widgetType:Z,widgetResize:K,launch:P,onPopupShown:H,destroyView:et});return new tt(t)};return a}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/inlineViewTemplate.html",[],function(){return"<div id='<%= id %>' style='width:100%;height: 100%;'>\n	<!--div class='ui-button-div'>\n        <div class='ui-duration ui-video-play-button'></div>\n	</div-->\n	<video poster='<%=poster %>' class='video-js vjs-default-skin vjs-big-play-centered' id='player-<%= id %>' style='width:100%;' data-setup='{}' controls='true'>\n		<source src='<%=src %>' type='<%=mimeType %>' />\n		<% _.each(captions, function(item){%>\n			<track kind='captions' src='<%=(resourceURL + item.src )%>' srclang='<%=item.lang %>' label='<%=item.label %>'></track>\n		<%});%>\n	</video>\n<!--    <div class='ui-video-controls' id='control-<%=id %>' style='display:none'>\n        <div class='ui-video-play-pause-control'></div>\n-->        <!--div class='ui-video-duration-control'><span id='time-comp'>00:00</span> / <%=duration%> </div-->\n<!--        <span id='time-comp'>00:00</span>\n        <div class='ui-video-slider-control'><input type='range' id='seek-bar' value='0' /></div>\n        <span id='duration'><%=duration%> </span>\n-->        <!--span class='ui-video-stop-control '>ST</span-->\n        <!--button type='button' class='mute-btn'>Mute</button-->\n<!--        <div class='volume-div'>\n			<span class='mute-btn volume-btn' ></span>\n			<div class='volume-up-down video-vol' style='display:none;'>\n				<input type='range'  class='volume-bar' min='0' max='10' step='0.1' value='10' />\n			</div>\n		</div>\n        <div class='ui-maximize ui-right-div-control'></div>\n    </div>\n-->    <div class='inline-widget-footer'>\n		<div class='ui-video-icon'></div>\n        <div class='ui-gal-text-left'><%=unescape(title)%></div>\n        <!--div class='ui-duration ui-right-div-video'><%=duration%></div-->\n        <div class='video-context-div'>\n			<div class='icon- show-context-popup'></div>\n			<div class='video-context-popup' style='display: none;'>\n				<!--div class='icon- video-info-btn' data-toggle=\"popover\">\n				</div-->\n				<%  if(captions && captions.length){ %>\n				<div class='icon- video-captions-btn'></div>\n				<%  }%>\n				<%  if(captions && captions.length > 1){ %>\n				<div class='icon- video-settings-btn'></div>\n				<%  }%>\n			</div>\n			<div class='video-settings-popup' style='display: none;'>\n				<div class=\"select-lang\"><%=WidgetLang.SELECT_LANG_TEXT%></div>\n				<% _.each(captions, function(item){%>\n					<div class='select-captions-lang' data-lang='<%=item.lang %>'>\n						<%  if(WidgetLang[\"LANGUAGE_LABEL_\" + item.lang.toUpperCase()]){  %>\n								<%=WidgetLang[\"LANGUAGE_LABEL_\" + item.lang.toUpperCase()] %> \n						<%	}else{ %>\n								<%=WidgetLang.UNKNOWN_LANGUAGE_LABEL %> \n						<%	} %>\n					</div>\n				<%});%>\n			</div>\n		</div>	\n		<div class='ui-maximize ui-right-div-control'></div>\n    </div>\n</div>\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/popupViewTemplate.html",[],function(){return"<div class='ui-overlay'>\n	<span class='loader'><%=WidgetLang.METADATA_LOADING_TEXT%></span>\n</div>\n\n<div class='video-content' id='ui-pop-vid'>\n	<video width='100%' poster='<%=poster %>' class='video-player resize video-js vjs-default-skin vjs-big-play-centered' id='player-<%= id %>'  data-setup='{}' controls='true'>\n		<source src=\"<%=src %>\" type='<%=mimeType %>' />\n		<% _.each(captions, function(item){%>\n			<track kind='captions' src='<%=(resourceURL + item.src )%>' srclang='<%=item.lang %>' label='<%=item.label %>'></track>\n		<%});%>\n	</video>\n<!--	<div class='ui-video-controls' id='control-<%=id %>' style='margin:0 auto'>\n		<div class='slider_wrapper'>\n			<div class='slider_cont'>\n				<div class='ui-video-slider-control'>\n					<input type='range' id='seek-bar' value='0' />\n				</div>\n			</div>\n		</div>\n		<div class='control_wrapper'>\n-->			<!--div class='ui-video-backward'></div-->\n<!--			<div class='ui-video-play-pause-control'></div>\n-->			<!--div class='ui-video-forward'></div-->\n<!--			<div class='ui-video-duration-control'>\n				<span id='time-comp'>00:00</span>\n                <span id='end-time'> <%=duration%></span>\n			</div>\n		</div>\n		\n        <span class=\"icon icon-ic-stop ui-video-stop-control video-popUp-stop-icon-style\"></span>\n		<div class='volume-div volume-div-video'>\n			<span class='mute-btn icon icon-volume-icon-unmute' ></span>\n			<div class='volume-up-down video-vol' style='display:none;'>\n				<input type='range'  class='video-volume-bar' min='0' max='10' step='0.1' value='10' />\n			</div>\n		</div>\n		<div class='fullscreen-div'>\n			<div class='ui-maximize ui-right-div-control icon icon-ic-fullscreen ui-fullscreen video-fullscreen-icon'></div>\n		</div>\n	</div>\n-->\n	\n	<div class='video-context-div'>\n		<%  if(captions && captions.length){ %>\n			<div class='icon- video-captions-btn'></div>\n		<%  }%>\n		<%  if(captions && captions.length > 1){ %>\n			<div class='icon- video-settings-btn'></div>\n		<%  }%>\n		<div class='video-settings-popup' style='display: none;'>\n			<div class=\"select-lang\"><%=WidgetLang.SELECT_LANG_TEXT%></div>\n			<% _.each(captions, function(item){%>\n				<div class='select-captions-lang' data-lang='<%=item.lang %>'>\n					<%  if(WidgetLang[\"LANGUAGE_LABEL_\" + item.lang.toUpperCase()]){  %>\n							<%=WidgetLang[\"LANGUAGE_LABEL_\" + item.lang.toUpperCase()] %> \n					<%	}else{ %>\n							<%=WidgetLang.UNKNOWN_LANGUAGE_LABEL %> \n					<%	} %>\n				</div>\n			<%});%>\n		</div>\n	</div>	\n	\n</div>\n\n<div class='video-footer-info-text info-text'>\n	<!--div class='video-footer-info-title'><span class='fig-title'><%=unescape(title)%></span></div-->\n	<div class='video-footer-info-description info-description' style='float: left;'><%=unescape(description)%></div>\n</div>\n\n<div id=\"video-loader\" class=\"video-loader\" >\n	<img src=\"images/loading.gif\"/>\n</div>\n	\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/popupViewMobileTemplate.html",[],function(){return"<div class='ui-overlay'>\n    <span class='loader'><%=WidgetLang.METADATA_LOADING_TEXT%></span>\n</div>\n<div class='mobile-video-info' style='display:none; background:white;color:black;position:absolute;top:0px;left:0px;height:100%;width:100%;'>\n    <span class='info-close-btn' style='color:red;font-size:35px;'><%=WidgetLang.CLOSE_ICON_LABEL%></span>\n    <%=unescape(description)%>\n</div>\n<div class='ui-video-controls' id='control-<%=id %>' style='margin:0 auto'>\n    <span class='ui-video-done-control' style='color:white;display:inline-block;margin-left: 10px;'><%=WidgetLang.DONE%></span>\n    <span id='time-comp' style='color:white;display:inline-block;margin-left: 10px;'>00:00</span>\n    <div class='ui-video-slider-control' style='display: inline-block;width: 90%;'>\n        <input type='range' id='seek-bar' value='0' />\n    </div>\n    <span style='color:white;display:inline-block;margin-left: 10px;'><%=duration%></span>\n</div>\n<div class='video-content' id='ui-pop-vid'>\n    <video width='100%' poster='<%=poster %>' class='video-player resize' id='player-<%= id %>'>\n        <source type='<%=mimeType %>' />\n    </video>\n</div>\n<div class='ui-video-controls' id='control-<%=id %>' style='margin:0 auto'>\n    <div class='ui-video-play-pause-control'></div>\n    <div class='video-info-btn' style='color:white;display:inline-block;margin-left: 10px;'><%=WidgetLang.INFO_LABEL%></div>\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/inlinePopupViewTemplate.html",[],function(){return'<div class="modal popover-widgets" tabindex="-1">\n  <div class="modal-dialog">\n  	<!--div class="arrow up"></div-->\n    <div class="modal-content">\n		<div class="modal-header clearfix">\n		</div>     \n          \n		<div class="modal-body">       \n		</div>\n\n    </div>\n    <!--div class="arrow down"></div-->\n  </div>\n</div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=id%>' style='width: <%=width%>;' >\r\n	<div class='print-widget-header'>\r\n		<div class='icon ui-video-icon'></div>\r\n        <div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n	</div>\r\n	<div class=\"print-widget-note\"><%=WidgetLang.VIDEO_PRINT_NOTE%></div>\r\n</div>\r\n"}),document.createElement("video"),document.createElement("audio"),document.createElement("track");var vjs=function(e,t,n){var r;if(typeof e=="string"){e.indexOf("#")===0&&(e=e.slice(1));if(vjs.players[e])return t&&vjs.log.warn('Player "'+e+'" is already initialised. Options will not be applied.'),n&&vjs.players[e].ready(n),vjs.players[e];r=vjs.el(e)}else r=e;if(!r||!r.nodeName)throw new TypeError("The element or ID supplied is not valid. (videojs)");return r.player||new vjs.Player(r,t,n)},videojs=window.videojs=vjs;vjs.CDN_VERSION="4.12",vjs.ACCESS_PROTOCOL="https:"==document.location.protocol?"https://":"http://",vjs.VERSION="4.12.5",vjs.options={techOrder:["html5","flash"],html5:{},flash:{},width:300,height:150,defaultVolume:0,playbackRates:[],inactivityTimeout:2e3,children:{mediaLoader:{},posterImage:{},loadingSpinner:{},textTrackDisplay:{},bigPlayButton:{},controlBar:{},errorDisplay:{},textTrackSettings:{}},language:document.getElementsByTagName("html")[0].getAttribute("lang")||navigator.languages&&navigator.languages[0]||navigator.userLanguage||navigator.language||"en",languages:{},notSupportedMessage:"No compatible source was found for this video."},vjs.CDN_VERSION!=="GENERATED_CDN_VSN"&&(videojs.options.flash.swf=vjs.ACCESS_PROTOCOL+"vjs.zencdn.net/"+vjs.CDN_VERSION+"/video-js.swf"),vjs.addLanguage=function(e,t){return vjs.options.languages[e]!==undefined?vjs.options.languages[e]=vjs.util.mergeOptions(vjs.options.languages[e],t):vjs.options.languages[e]=t,vjs.options.languages},vjs.players={},typeof define=="function"&&define.amd?define("videojs",[],function(){return videojs}):typeof exports=="object"&&typeof module=="object"&&(module.exports=videojs),vjs.CoreObject=vjs.CoreObject=function(){},vjs.CoreObject.extend=function(e){var t,n;e=e||{},t=e.init||e.init||this.prototype.init||this.prototype.init||function(){},n=function(){t.apply(this,arguments)},n.prototype=vjs.obj.create(this.prototype),n.prototype.constructor=n,n.extend=vjs.CoreObject.extend,n.create=vjs.CoreObject.create;for(var r in e)e.hasOwnProperty(r)&&(n.prototype[r]=e[r]);return n},vjs.CoreObject.create=function(){var e=vjs.obj.create(this.prototype);return this.apply(e,arguments),e},vjs.on=function(e,t,n){if(vjs.obj.isArray(t))return _handleMultipleEvents(vjs.on,e,t,n);var r=vjs.getData(e);r.handlers||(r.handlers={}),r.handlers[t]||(r.handlers[t]=[]),n.guid||(n.guid=vjs.guid++),r.handlers[t].push(n),r.dispatcher||(r.disabled=!1,r.dispatcher=function(t){if(r.disabled)return;t=vjs.fixEvent(t);var n=r.handlers[t.type];if(n){var i=n.slice(0);for(var s=0,o=i.length;s<o;s++){if(t.isImmediatePropagationStopped())break;i[s].call(e,t)}}}),r.handlers[t].length==1&&(e.addEventListener?e.addEventListener(t,r.dispatcher,!1):e.attachEvent&&e.attachEvent("on"+t,r.dispatcher))},vjs.off=function(e,t,n){if(!vjs.hasData(e))return;var r=vjs.getData(e);if(!r.handlers)return;if(vjs.obj.isArray(t))return _handleMultipleEvents(vjs.off,e,t,n);var i=function(t){r.handlers[t]=[],vjs.cleanUpEvents(e,t)};if(!t){for(var s in r.handlers)i(s);return}var o=r.handlers[t];if(!o)return;if(!n){i(t);return}if(n.guid)for(var u=0;u<o.length;u++)o[u].guid===n.guid&&o.splice(u--,1);vjs.cleanUpEvents(e,t)},vjs.cleanUpEvents=function(e,t){var n=vjs.getData(e);n.handlers[t].length===0&&(delete n.handlers[t],e.removeEventListener?e.removeEventListener(t,n.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,n.dispatcher)),vjs.isEmpty(n.handlers)&&(delete n.handlers,delete n.dispatcher,delete n.disabled),vjs.isEmpty(n)&&vjs.removeData(e)},vjs.fixEvent=function(e){function t(){return!0}function n(){return!1}if(!e||!e.isPropagationStopped){var r=e||window.event;e={};for(var i in r)i!=="layerX"&&i!=="layerY"&&i!=="keyLocation"&&(i!="returnValue"||!r.preventDefault)&&(e[i]=r[i]);e.target||(e.target=e.srcElement||document),e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement,e.preventDefault=function(){r.preventDefault&&r.preventDefault(),e.returnValue=!1,e.isDefaultPrevented=t,e.defaultPrevented=!0},e.isDefaultPrevented=n,e.defaultPrevented=!1,e.stopPropagation=function(){r.stopPropagation&&r.stopPropagation(),e.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=n,e.stopImmediatePropagation=function(){r.stopImmediatePropagation&&r.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=n;if(e.clientX!=null){var s=document.documentElement,o=document.body;e.pageX=e.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=e.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)}e.which=e.charCode||e.keyCode,e.button!=null&&(e.button=e.button&1?0:e.button&4?1:e.button&2?2:0)}return e},vjs.trigger=function(e,t){var n=vjs.hasData(e)?vjs.getData(e):{},r=e.parentNode||e.ownerDocument;typeof t=="string"&&(t={type:t,target:e}),t=vjs.fixEvent(t),n.dispatcher&&n.dispatcher.call(e,t);if(r&&!t.isPropagationStopped()&&t.bubbles!==!1)vjs.trigger(r,t);else if(!r&&!t.defaultPrevented){var i=vjs.getData(t.target);t.target[t.type]&&(i.disabled=!0,typeof t.target[t.type]=="function"&&t.target[t.type](),i.disabled=!1)}return!t.defaultPrevented},vjs.one=function(e,t,n){if(vjs.obj.isArray(t))return _handleMultipleEvents(vjs.one,e,t,n);var r=function(){vjs.off(e,t,r),n.apply(this,arguments)};r.guid=n.guid=n.guid||vjs.guid++,vjs.on(e,t,r)},vjs.getAndroidVersion=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android"),n=0;return t!=-1&&(n=parseFloat(e.match(/android\s+([\d\.]+)/)[1])),n};var hasOwnProp=Object.prototype.hasOwnProperty;vjs.createEl=function(e,t){var n;return e=e||"div",t=t||{},n=document.createElement(e),vjs.obj.each(t,function(e,t){e.indexOf("aria-")!==-1||e=="role"?n.setAttribute(e,t):n[e]=t}),n},vjs.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},vjs.obj={},vjs.obj.create=Object.create||function(e){function t(){}return t.prototype=e,new t},vjs.obj.each=function(e,t,n){for(var r in e)hasOwnProp.call(e,r)&&t.call(n||this,r,e[r])},vjs.obj.merge=function(e,t){if(!t)return e;for(var n in t)hasOwnProp.call(t,n)&&(e[n]=t[n]);return e},vjs.obj.deepMerge=function(e,t){var n,r,i;e=vjs.obj.copy(e);for(n in t)hasOwnProp.call(t,n)&&(r=e[n],i=t[n],vjs.obj.isPlain(r)&&vjs.obj.isPlain(i)?e[n]=vjs.obj.deepMerge(r,i):e[n]=t[n]);return e},vjs.obj.copy=function(e){return vjs.obj.merge({},e)},vjs.obj.isPlain=function(e){return!!e&&typeof e=="object"&&e.toString()==="[object Object]"&&e.constructor===Object},vjs.obj.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},vjs.isNaN=function(e){return e!==e},vjs.bind=function(e,t,n){t.guid||(t.guid=vjs.guid++);var r=function(){return t.apply(e,arguments)};return r.guid=n?n+"_"+t.guid:t.guid,r},vjs.cache={},vjs.guid=1,vjs.expando="vdata"+(new Date).getTime(),vjs.getData=function(e){var t=e[vjs.expando];return t||(t=e[vjs.expando]=vjs.guid++),vjs.cache[t]||(vjs.cache[t]={}),vjs.cache[t]},vjs.hasData=function(e){var t=e[vjs.expando];return!!t&&!vjs.isEmpty(vjs.cache[t])},vjs.removeData=function(e){var t=e[vjs.expando];if(!t)return;delete vjs.cache[t];try{delete e[vjs.expando]}catch(n){e.removeAttribute?e.removeAttribute(vjs.expando):e[vjs.expando]=null}},vjs.isEmpty=function(e){for(var t in e)if(e[t]!==null)return!1;return!0},vjs.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")!==-1},vjs.addClass=function(e,t){vjs.hasClass(e,t)||(e.className=e.className===""?t:e.className+" "+t)},vjs.removeClass=function(e,t){var n,r;if(!vjs.hasClass(e,t))return;n=e.className.split(" ");for(r=n.length-1;r>=0;r--)n[r]===t&&n.splice(r,1);e.className=n.join(" ")},vjs.TEST_VID=vjs.createEl("video"),function(){var e=document.createElement("track");e.kind="captions",e.srclang="en",e.label="English",vjs.TEST_VID.appendChild(e)}(),vjs.USER_AGENT=navigator.userAgent,vjs.IS_IPHONE=/iPhone/i.test(vjs.USER_AGENT),vjs.IS_IPAD=/iPad/i.test(vjs.USER_AGENT),vjs.IS_IPOD=/iPod/i.test(vjs.USER_AGENT),vjs.IS_IOS=vjs.IS_IPHONE||vjs.IS_IPAD||vjs.IS_IPOD,vjs.IOS_VERSION=function(){var e=vjs.USER_AGENT.match(/OS (\d+)_/i);if(e&&e[1])return e[1]}(),vjs.IS_ANDROID=/Android/i.test(vjs.USER_AGENT),vjs.ANDROID_VERSION=function(){var e=vjs.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i),t,n;return e?(t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]),t&&n?parseFloat(e[1]+"."+e[2]):t?t:null):null}(),vjs.IS_OLD_ANDROID=vjs.IS_ANDROID&&/webkit/i.test(vjs.USER_AGENT)&&vjs.ANDROID_VERSION<2.3,vjs.IS_FIREFOX=/Firefox/i.test(vjs.USER_AGENT),vjs.IS_CHROME=/Chrome/i.test(vjs.USER_AGENT),vjs.IS_IE8=/MSIE\s8\.0/.test(vjs.USER_AGENT),vjs.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),vjs.BACKGROUND_SIZE_SUPPORTED="backgroundSize"in vjs.TEST_VID.style,vjs.setElementAttributes=function(e,t){vjs.obj.each(t,function(t,n){n===null||typeof n=="undefined"||n===!1?e.removeAttribute(t):e.setAttribute(t,n===!0?"":n)})},vjs.getElementAttributes=function(e){var t,n,r,i,s;t={},n=",autoplay,controls,loop,muted,default,";if(e&&e.attributes&&e.attributes.length>0){r=e.attributes;for(var o=r.length-1;o>=0;o--){i=r[o].name,s=r[o].value;if(typeof e[i]=="boolean"||n.indexOf(","+i+",")!==-1)s=s!==null?!0:!1;t[i]=s}}return t},vjs.getComputedDimension=function(e,t){var n="";return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,"").getPropertyValue(t):e.currentStyle&&(n=e["client"+t.substr(0,1).toUpperCase()+t.substr(1)]+"px"),n},vjs.insertFirst=function(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)},vjs.browser={},vjs.el=function(e){return e.indexOf("#")===0&&(e=e.slice(1)),document.getElementById(e)},vjs.formatTime=function(e,t){t=t||e;var n=Math.floor(e%60),r=Math.floor(e/60%60),i=Math.floor(e/3600),s=Math.floor(t/60%60),o=Math.floor(t/3600);if(isNaN(e)||e===Infinity)i=r=n="-";return i=i>0||o>0?i+":":"",r=((i||s>=10)&&r<10?"0"+r:r)+":",n=n<10?"0"+n:n,i+r+n},vjs.blockTextSelection=function(){document.body.focus(),document.onselectstart=function(){return!1}},vjs.unblockTextSelection=function(){document.onselectstart=function(){return!0}},vjs.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},vjs.round=function(e,t){return t||(t=0),Math.round(e*Math.pow(10,t))/Math.pow(10,t)},vjs.createTimeRange=function(e,t){return{length:1,start:function(){return e},end:function(){return t}}},vjs.setLocalStorage=function(e,t){try{var n=window.localStorage||!1;if(!n)return;n[e]=t}catch(r){r.code==22||r.code==1014?vjs.log("LocalStorage Full (VideoJS)",r):r.code==18?vjs.log("LocalStorage not allowed (VideoJS)",r):vjs.log("LocalStorage Error (VideoJS)",r)}},vjs.getAbsoluteURL=function(e){return e.match(/^https?:\/\//)||(e=vjs.createEl("div",{innerHTML:'<a href="'+e+'">x</a>'}).firstChild.href),e},vjs.parseUrl=function(e){var t,n,r,i,s;i=["protocol","hostname","port","pathname","search","hash","host"],n=vjs.createEl("a",{href:e}),r=n.host===""&&n.protocol!=="file:",r&&(t=vjs.createEl("div"),t.innerHTML='<a href="'+e+'"></a>',n=t.firstChild,t.setAttribute("style","display:none; position:absolute;"),document.body.appendChild(t)),s={};for(var o=0;o<i.length;o++)s[i[o]]=n[i[o]];return s.protocol==="http:"&&(s.host=s.host.replace(/:80$/,"")),s.protocol==="https:"&&(s.host=s.host.replace(/:443$/,"")),r&&document.body.removeChild(t),s},vjs.log=function(){_logType(null,arguments)},vjs.log.history=[],vjs.log.error=function(){_logType("error",arguments)},vjs.log.warn=function(){_logType("warn",arguments)},vjs.findPosition=function(e){var t,n,r,i,s,o,u,a,f;return e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),t?(n=document.documentElement,r=document.body,i=n.clientLeft||r.clientLeft||0,s=window.pageXOffset||r.scrollLeft,o=t.left+s-i,u=n.clientTop||r.clientTop||0,a=window.pageYOffset||r.scrollTop,f=t.top+a-u,{left:vjs.round(o),top:vjs.round(f)}):{left:0,top:0}},vjs.arr={},vjs.arr.forEach=function(e,t,n){if(vjs.obj.isArray(e)&&t instanceof Function)for(var r=0,i=e.length;r<i;++r)t.call(n||vjs,e[r],r,e);return e},vjs.xhr=function(e,t){var n,r,i,s,o,u,a,f,l;typeof e=="string"&&(e={uri:e}),videojs.util.mergeOptions({method:"GET",timeout:45e3},e),t=t||function(){},f=function(){window.clearTimeout(a),t(null,r,r.response||r.responseText)},l=function(e){window.clearTimeout(a);if(!e||typeof e=="string")e=new Error(e);t(e,r)},n=window.XMLHttpRequest,typeof n=="undefined"&&(n=function(){try{return new window.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new window.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(n){}throw new Error("This browser does not support XMLHttpRequest.")}),r=new n,r.uri=e.uri,i=vjs.parseUrl(e.uri),s=window.location,u=i.protocol+i.host!==s.protocol+s.host,!u||!window.XDomainRequest||"withCredentials"in r?(o=i.protocol=="file:"||s.protocol=="file:",r.onreadystatechange=function(){if(r.readyState===4){if(r.timedout)return l("timeout");r.status===200||o&&r.status===0?f():l()}},e.timeout&&(a=window.setTimeout(function(){r.readyState!==4&&(r.timedout=!0,r.abort())},e.timeout))):(r=new window.XDomainRequest,r.onload=f,r.onerror=l,r.onprogress=function(){},r.ontimeout=function(){});try{r.open(e.method||"GET",e.uri,!0)}catch(c){return l(c)}e.withCredentials&&(r.withCredentials=!0),e.responseType&&(r.responseType=e.responseType);try{r.send()}catch(c){return l(c)}return r},vjs.util={},vjs.util.mergeOptions=function(e,t){var n,r,i;e=vjs.obj.copy(e);for(n in t)t.hasOwnProperty(n)&&(r=e[n],i=t[n],vjs.obj.isPlain(r)&&vjs.obj.isPlain(i)?e[n]=vjs.util.mergeOptions(r,i):e[n]=t[n]);return e},vjs.EventEmitter=function(){},vjs.EventEmitter.prototype.allowedEvents_={},vjs.EventEmitter.prototype.on=function(e,t){var n=this.addEventListener;this.addEventListener=Function.prototype,vjs.on(this,e,t),this.addEventListener=n},vjs.EventEmitter.prototype.addEventListener=vjs.EventEmitter.prototype.on,vjs.EventEmitter.prototype.off=function(e,t){vjs.off(this,e,t)},vjs.EventEmitter.prototype.removeEventListener=vjs.EventEmitter.prototype.off,vjs.EventEmitter.prototype.one=function(e,t){vjs.one(this,e,t)},vjs.EventEmitter.prototype.trigger=function(e){var t=e.type||e;typeof e=="string"&&(e={type:t}),e=vjs.fixEvent(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),vjs.trigger(this,e)},vjs.EventEmitter.prototype.dispatchEvent=vjs.EventEmitter.prototype.trigger,vjs.Component=vjs.CoreObject.extend({init:function(e,t,n){this.player_=e,this.options_=vjs.obj.copy(this.options_),t=this.options(t),this.id_=t.id||t.el&&t.el.id,this.id_||(this.id_=(e.id&&e.id()||"no_player")+"_component_"+vjs.guid++),this.name_=t.name||null,this.el_=t.el||this.createEl(),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.initChildren(),this.ready(n),t.reportTouchActivity!==!1&&this.enableTouchActivity()}}),vjs.Component.prototype.dispose=function(){this.trigger({type:"dispose",bubbles:!1});if(this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.off(),this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),vjs.removeData(this.el_),this.el_=null},vjs.Component.prototype.player_=!0,vjs.Component.prototype.player=function(){return this.player_},vjs.Component.prototype.options_,vjs.Component.prototype.options=function(e){return e===undefined?this.options_:this.options_=vjs.util.mergeOptions(this.options_,e)},vjs.Component.prototype.el_,vjs.Component.prototype.createEl=function(e,t){return vjs.createEl(e,t)},vjs.Component.prototype.localize=function(e){var t=this.player_.language(),n=this.player_.languages();return n&&n[t]&&n[t][e]?n[t][e]:e},vjs.Component.prototype.el=function(){return this.el_},vjs.Component.prototype.contentEl_,vjs.Component.prototype.contentEl=function(){return this.contentEl_||this.el_},vjs.Component.prototype.id_,vjs.Component.prototype.id=function(){return this.id_},vjs.Component.prototype.name_,vjs.Component.prototype.name=function(){return this.name_},vjs.Component.prototype.children_,vjs.Component.prototype.children=function(){return this.children_},vjs.Component.prototype.childIndex_,vjs.Component.prototype.getChildById=function(e){return this.childIndex_[e]},vjs.Component.prototype.childNameIndex_,vjs.Component.prototype.getChild=function(e){return this.childNameIndex_[e]},vjs.Component.prototype.addChild=function(e,t){var n,r,i;return typeof e=="string"?(i=e,t=t||{},r=t.componentClass||vjs.capitalize(i),t.name=i,n=new window.videojs[r](this.player_||this,t)):n=e,this.children_.push(n),typeof n.id=="function"&&(this.childIndex_[n.id()]=n),i=i||n.name&&n.name(),i&&(this.childNameIndex_[i]=n),typeof n.el=="function"&&n.el()&&this.contentEl().appendChild(n.el()),n},vjs.Component.prototype.removeChild=function(e){typeof e=="string"&&(e=this.getChild(e));if(!e||!this.children_)return;var t=!1;for(var n=this.children_.length-1;n>=0;n--)if(this.children_[n]===e){t=!0,this.children_.splice(n,1);break}if(!t)return;this.childIndex_[e.id()]=null,this.childNameIndex_[e.name()]=null;var r=e.el();r&&r.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())},vjs.Component.prototype.initChildren=function(){var e,t,n,r,i,s,o;e=this,t=e.options(),n=t.children;if(n){o=function(n,r){t[n]!==undefined&&(r=t[n]);if(r===!1)return;e[n]=e.addChild(n,r)};if(vjs.obj.isArray(n))for(var u=0;u<n.length;u++)r=n[u],typeof r=="string"?(i=r,s={}):(i=r.name,s=r),o(i,s);else vjs.obj.each(n,o)}},vjs.Component.prototype.buildCSSClass=function(){return""},vjs.Component.prototype.on=function(e,t,n){var r,i,s,o,u,a;return typeof e=="string"||vjs.obj.isArray(e)?vjs.on(this.el_,e,vjs.bind(this,t)):(r=e,i=t,s=vjs.bind(this,n),a=this,o=function(){a.off(r,i,s)},o.guid=s.guid,this.on("dispose",o),u=function(){a.off("dispose",o)},u.guid=s.guid,e.nodeName?(vjs.on(r,i,s),vjs.on(r,"dispose",u)):typeof e.on=="function"&&(r.on(i,s),r.on("dispose",u))),this},vjs.Component.prototype.off=function(e,t,n){var r,i,s,o,u;return!e||typeof e=="string"||vjs.obj.isArray(e)?vjs.off(this.el_,e,t):(r=e,s=t,o=vjs.bind(this,n),this.off("dispose",o),e.nodeName?(vjs.off(r,s,o),vjs.off(r,"dispose",o)):(r.off(s,o),r.off("dispose",o))),this},vjs.Component.prototype.one=function(e,t,n){var r,i,s,o,u;return typeof e=="string"||vjs.obj.isArray(e)?vjs.one(this.el_,e,vjs.bind(this,t)):(r=e,i=t,s=vjs.bind(this,n),o=this,u=function(){o.off(r,i,u),s.apply(this,arguments)},u.guid=s.guid,this.on(r,i,u)),this},vjs.Component.prototype.trigger=function(e){return vjs.trigger(this.el_,e),this},vjs.Component.prototype.isReady_,vjs.Component.prototype.isReadyOnInitFinish_=!0,vjs.Component.prototype.readyQueue_,vjs.Component.prototype.ready=function(e){return e&&(this.isReady_?e.call(this):(this.readyQueue_===undefined&&(this.readyQueue_=[]),this.readyQueue_.push(e))),this},vjs.Component.prototype.triggerReady=function(){this.isReady_=!0;var e=this.readyQueue_;if(e&&e.length>0){for(var t=0,n=e.length;t<n;t++)e[t].call(this);this.readyQueue_=[],this.trigger("ready")}},vjs.Component.prototype.hasClass=function(e){return vjs.hasClass(this.el_,e)},vjs.Component.prototype.addClass=function(e){return vjs.addClass(this.el_,e),this},vjs.Component.prototype.removeClass=function(e){return vjs.removeClass(this.el_,e),this},vjs.Component.prototype.show=function(){return this.removeClass("vjs-hidden"),this},vjs.Component.prototype.hide=function(){return this.addClass("vjs-hidden"),this},vjs.Component.prototype.lockShowing=function(){return this.addClass("vjs-lock-showing"),this},vjs.Component.prototype.unlockShowing=function(){return this.removeClass("vjs-lock-showing"),this},vjs.Component.prototype.disable=function(){this.hide(),this.show=function(){}},vjs.Component.prototype.width=function(e,t){return this.dimension("width",e,t)},vjs.Component.prototype.height=function(e,t){return this.dimension("height",e,t)},vjs.Component.prototype.dimensions=function(e,t){return this.width(e,!0).height(t)},vjs.Component.prototype.dimension=function(e,t,n){if(t!==undefined){if(t===null||vjs.isNaN(t))t=0;return(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?this.el_.style[e]=t:t==="auto"?this.el_.style[e]="":this.el_.style[e]=t+"px",n||this.trigger("resize"),this}if(!this.el_)return 0;var r=this.el_.style[e],i=r.indexOf("px");return i!==-1?parseInt(r.slice(0,i),10):parseInt(this.el_["offset"+vjs.capitalize(e)],10)},vjs.Component.prototype.onResize,vjs.Component.prototype.emitTapEvents=function(){var e,t,n,r,i,s,o,u,a,f;e=0,t=null,a=10,f=200,this.on("touchstart",function(n){n.touches.length===1&&(t=vjs.obj.copy(n.touches[0]),e=(new Date).getTime(),r=!0)}),this.on("touchmove",function(e){e.touches.length>1?r=!1:t&&(s=e.touches[0].pageX-t.pageX,o=e.touches[0].pageY-t.pageY,u=Math.sqrt(s*s+o*o),u>a&&(r=!1))}),i=function(){r=!1},this.on("touchleave",i),this.on("touchcancel",i),this.on("touchend",function(i){t=null,r===!0&&(n=(new Date).getTime()-e,n<f&&(i.preventDefault(),this.trigger("tap")))})},vjs.Component.prototype.enableTouchActivity=function(){var e,t,n;if(!this.player().reportUserActivity)return;e=vjs.bind(this.player(),this.player().reportUserActivity),this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)}),n=function(n){e(),this.clearInterval(t)},this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)},vjs.Component.prototype.setTimeout=function(e,t){e=vjs.bind(this,e);var n=setTimeout(e,t),r=function(){this.clearTimeout(n)};return r.guid="vjs-timeout-"+n,this.on("dispose",r),n},vjs.Component.prototype.clearTimeout=function(e){clearTimeout(e);var t=function(){};return t.guid="vjs-timeout-"+e,this.off("dispose",t),e},vjs.Component.prototype.setInterval=function(e,t){e=vjs.bind(this,e);var n=setInterval(e,t),r=function(){this.clearInterval(n)};return r.guid="vjs-interval-"+n,this.on("dispose",r),n},vjs.Component.prototype.clearInterval=function(e){clearInterval(e);var t=function(){};return t.guid="vjs-interval-"+e,this.off("dispose",t),e},vjs.Button=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.emitTapEvents(),this.on("tap",this.onClick),this.on("click",this.onClick),this.on("focus",this.onFocus),this.on("blur",this.onBlur)}}),vjs.Button.prototype.createEl=function(e,t){var n;return t=vjs.obj.merge({className:this.buildCSSClass(),role:"button","aria-live":"polite",tabIndex:0},t),n=vjs.Component.prototype.createEl.call(this,e,t),t.innerHTML||(this.contentEl_=vjs.createEl("div",{className:"vjs-control-content"}),this.controlText_=vjs.createEl("span",{className:"vjs-control-text",innerHTML:this.localize(this.buttonText)||"Need Text"}),this.contentEl_.appendChild(this.controlText_),n.appendChild(this.contentEl_)),n},vjs.Button.prototype.buildCSSClass=function(){return"vjs-control "+vjs.Component.prototype.buildCSSClass.call(this)},vjs.Button.prototype.onClick=function(){},vjs.Button.prototype.onFocus=function(){vjs.on(document,"keydown",vjs.bind(this,this.onKeyPress))},vjs.Button.prototype.onKeyPress=function(e){if(e.which==32||e.which==13)e.preventDefault(),this.onClick()},vjs.Button.prototype.onBlur=function(){vjs.off(document,"keydown",vjs.bind(this,this.onKeyPress))},vjs.Slider=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.bar=this.getChild(this.options_.barName),this.handle=this.getChild(this.options_.handleName),this.on("mousedown",this.onMouseDown),this.on("touchstart",this.onMouseDown),this.on("focus",this.onFocus),this.on("blur",this.onBlur),this.on("click",this.onClick),this.on(e,"controlsvisible",this.update),this.on(e,this.playerEvent,this.update)}}),vjs.Slider.prototype.createEl=function(e,t){return t=t||{},t.className=t.className+" vjs-slider",t=vjs.obj.merge({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},t),vjs.Component.prototype.createEl.call(this,e,t)},vjs.Slider.prototype.onMouseDown=function(e){e.preventDefault(),vjs.blockTextSelection(),this.addClass("vjs-sliding"),this.on(this,"mousemove",this.onMouseMove),this.on($(this.contentEl()).closest("body"),"mouseup",this.onMouseUp),this.on(this,"touchmove",this.onMouseMove),this.on(this,"touchend",this.onMouseUp),this.onMouseMove(e)},vjs.Slider.prototype.onMouseMove=function(){},vjs.Slider.prototype.onMouseUp=function(){vjs.unblockTextSelection(),this.removeClass("vjs-sliding"),this.off(this,"mousemove",this.onMouseMove),this.off($(this.contentEl()).closest("body"),"mouseup",this.onMouseUp),this.off(this,"touchmove",this.onMouseMove),this.off(this,"touchend",this.onMouseUp),this.update()},vjs.Slider.prototype.update=function(){if(!this.el_)return;var e,t=this.getPercent(),n=this.handle,r=this.bar;if(typeof t!="number"||t!==t||t<0||t===Infinity)t=0;e=t;if(n){var i=this.el_,s=i.offsetWidth,o=n.el().offsetWidth,u=o?o/s:0,a=1-u,f=t*a;e=f+u/2,n.el().style.left=vjs.round(f*100,2)+"%"}r&&(r.el().style.width=vjs.round(e*100,2)+"%")},vjs.Slider.prototype.calculateDistance=function(e){var t,n,r,i,s,o,u,a,f;t=this.el_,n=vjs.findPosition(t),s=o=t.offsetWidth,u=this.handle;if(this.options().vertical){i=n.top,e.changedTouches?f=e.changedTouches[0].pageY:f=e.pageY;if(u){var l=u.el().offsetHeight;i+=l/2,o-=l}return Math.max(0,Math.min(1,(i-f+o)/o))}r=n.left,e.changedTouches?a=e.changedTouches[0].pageX:a=e.pageX;if(u){var c=u.el().offsetWidth;r+=c/2,s-=c}return Math.max(0,Math.min(1,(a-r)/s))},vjs.Slider.prototype.onFocus=function(){this.on(document,"keydown",this.onKeyPress)},vjs.Slider.prototype.onKeyPress=function(e){if(e.which==37||e.which==40)e.preventDefault(),this.stepBack();else if(e.which==38||e.which==39)e.preventDefault(),this.stepForward()},vjs.Slider.prototype.onBlur=function(){this.off(document,"keydown",this.onKeyPress)},vjs.Slider.prototype.onClick=function(e){e.stopImmediatePropagation(),e.preventDefault()},vjs.SliderHandle=vjs.Component.extend(),vjs.SliderHandle.prototype.defaultValue=0,vjs.SliderHandle.prototype.createEl=function(e,t){return t=t||{},t.className=t.className+" vjs-slider-handle",t=vjs.obj.merge({innerHTML:'<span class="vjs-control-text">'+this.defaultValue+"</span>"},t),vjs.Component.prototype.createEl.call(this,"div",t)},vjs.Menu=vjs.Component.extend(),vjs.Menu.prototype.addItem=function(e){this.addChild(e),e.on("click",vjs.bind(this,function(){this.unlockShowing()}))},vjs.Menu.prototype.createEl=function(){var e=this.options().contentElType||"ul";this.contentEl_=vjs.createEl(e,{className:"vjs-menu-content"});var t=vjs.Component.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),vjs.on(t,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),t},vjs.MenuItem=vjs.Button.extend({init:function(e,t){vjs.Button.call(this,e,t),this.selected(t.selected)}}),vjs.MenuItem.prototype.createEl=function(e,t){return vjs.Button.prototype.createEl.call(this,"li",vjs.obj.merge({className:"vjs-menu-item",innerHTML:this.localize(this.options_.label)},t))},vjs.MenuItem.prototype.onClick=function(){this.selected(!0)},vjs.MenuItem.prototype.selected=function(e){e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-selected",!0)):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-selected",!1))},vjs.MenuButton=vjs.Button.extend({init:function(e,t){vjs.Button.call(this,e,t),this.update(),this.on("keydown",this.onKeyPress),this.el_.setAttribute("aria-haspopup",!0),this.el_.setAttribute("role","button")}}),vjs.MenuButton.prototype.update=function(){var e=this.createMenu();this.menu&&this.removeChild(this.menu),this.menu=e,this.addChild(e),this.items&&this.items.length===0?this.hide():this.items&&this.items.length>1&&this.show()},vjs.MenuButton.prototype.buttonPressed_=!1,vjs.MenuButton.prototype.createMenu=function(){var e=new vjs.Menu(this.player_);this.options().title&&e.contentEl().appendChild(vjs.createEl("li",{className:"vjs-menu-title",innerHTML:vjs.capitalize(this.options().title),tabindex:-1})),this.items=this.createItems();if(this.items)for(var t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e},vjs.MenuButton.prototype.createItems=function(){},vjs.MenuButton.prototype.buildCSSClass=function(){return this.className+" vjs-menu-button "+vjs.Button.prototype.buildCSSClass.call(this)},vjs.MenuButton.prototype.onFocus=function(){},vjs.MenuButton.prototype.onBlur=function(){},vjs.MenuButton.prototype.onClick=function(){this.one("mouseout",vjs.bind(this,function(){this.menu.unlockShowing(),this.el_.blur()})),this.buttonPressed_?this.unpressButton():this.pressButton()},vjs.MenuButton.prototype.onKeyPress=function(e){e.which==32||e.which==13?(this.buttonPressed_?this.unpressButton():this.pressButton(),e.preventDefault()):e.which==27&&(this.buttonPressed_&&this.unpressButton(),e.preventDefault())},vjs.MenuButton.prototype.pressButton=function(){this.buttonPressed_=!0,this.menu.lockShowing(),this.el_.setAttribute("aria-pressed",!0),this.items&&this.items.length>0&&this.items[0].el().focus()},vjs.MenuButton.prototype.unpressButton=function(){this.buttonPressed_=!1,this.menu.unlockShowing(),this.el_.setAttribute("aria-pressed",!1)},vjs.MediaError=function(e){typeof e=="number"?this.code=e:typeof e=="string"?this.message=e:typeof e=="object"&&vjs.obj.merge(this,e),this.message||(this.message=vjs.MediaError.defaultMessages[this.code]||"")},vjs.MediaError.prototype.code=0,vjs.MediaError.prototype.message="",vjs.MediaError.prototype.status=null,vjs.MediaError.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],vjs.MediaError.defaultMessages={1:"You aborted the video playback",2:"A network error caused the video download to fail part-way.",3:"The video playback was aborted due to a corruption problem or because the video used features your browser did not support.",4:"The video could not be loaded, either because the server or network failed or because the format is not supported.",5:"The video is encrypted and we do not have the keys to decrypt it."};for(var errNum=0;errNum<vjs.MediaError.errorTypes.length;errNum++)vjs.MediaError[vjs.MediaError.errorTypes[errNum]]=errNum,vjs.MediaError.prototype[vjs.MediaError.errorTypes[errNum]]=errNum;(function(){var e,t,n,r;vjs.browser.fullscreenAPI,e=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],t=e[0];for(r=0;r<e.length;r++)if(e[r][1]in document){n=e[r];break}if(n){vjs.browser.fullscreenAPI={};for(r=0;r<n.length;r++)vjs.browser.fullscreenAPI[t[r]]=n[r]}})(),vjs.Player=vjs.Component.extend({init:function(e,t,n){this.tag=e,e.id=e.id||"vjs_video_"+vjs.guid++,this.tagAttributes=e&&vjs.getElementAttributes(e),t=vjs.obj.merge(this.getTagSettings(e),t),this.language_=t.language||vjs.options.language,this.languages_=t.languages||vjs.options.languages,this.cache_={},this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,t.reportTouchActivity=!1,this.isAudio(this.tag.nodeName.toLowerCase()==="audio"),vjs.Component.call(this,this,t,n),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.isAudio()&&this.addClass("vjs-audio"),vjs.players[this.id_]=this,t.plugins&&vjs.obj.each(t.plugins,function(e,t){this[e](t)},this),this.listenForUserActivity()}}),vjs.Player.prototype.language_,vjs.Player.prototype.language=function(e){return e===undefined?this.language_:(this.language_=e,this)},vjs.Player.prototype.languages_,vjs.Player.prototype.languages=function(){return this.languages_},vjs.Player.prototype.options_=vjs.options,vjs.Player.prototype.dispose=function(){this.trigger("dispose"),this.off("dispose"),vjs.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech&&this.tech.dispose(),vjs.Component.prototype.dispose.call(this)},vjs.Player.prototype.getTagSettings=function(e){var t,n,r={sources:[],tracks:[]};t=vjs.getElementAttributes(e),n=t["data-setup"],n!==null&&vjs.obj.merge(t,vjs.JSON.parse(n||"{}")),vjs.obj.merge(r,t);if(e.hasChildNodes()){var i,s,o,u,a;i=e.childNodes;for(u=0,a=i.length;u<a;u++)s=i[u],o=s.nodeName.toLowerCase(),o==="source"?r.sources.push(vjs.getElementAttributes(s)):o==="track"&&r.tracks.push(vjs.getElementAttributes(s))}return r},vjs.Player.prototype.createEl=function(){var e=this.el_=vjs.Component.prototype.createEl.call(this,"div"),t=this.tag,n;return t.removeAttribute("width"),t.removeAttribute("height"),n=vjs.getElementAttributes(t),vjs.obj.each(n,function(t){t=="class"?e.className=n[t]:e.setAttribute(t,n[t])}),t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused"),this.width(this.options_.width,!0),this.height(this.options_.height,!0),t.initNetworkState_=t.networkState,t.parentNode&&t.parentNode.insertBefore(e,t),vjs.insertFirst(t,e),this.el_=e,this.on("loadstart",this.onLoadStart),this.on("waiting",this.onWaiting),this.on(["canplay","canplaythrough","playing","ended"],this.onWaitEnd),this.on("seeking",this.onSeeking),this.on("seeked",this.onSeeked),this.on("ended",this.onEnded),this.on("play",this.onPlay),this.on("firstplay",this.onFirstPlay),this.on("pause",this.onPause),this.on("progress",this.onProgress),this.on("durationchange",this.onDurationChange),this.on("fullscreenchange",this.onFullscreenChange),e},vjs.Player.prototype.loadTech=function(e,t){this.tech&&this.unloadTech(),e!=="Html5"&&this.tag&&(vjs.Html5.disposeMediaElement(this.tag),this.tag=null),this.techName=e,this.isReady_=!1;var n=function(){this.player_.triggerReady()},r=vjs.obj.merge({source:t,parentEl:this.el_},this.options_[e.toLowerCase()]);t&&(this.currentType_=t.type,t.src==this.cache_.src&&this.cache_.currentTime>0&&(r.startTime=this.cache_.currentTime),this.cache_.src=t.src),this.tech=new window.videojs[e](this,r),this.tech.ready(n)},vjs.Player.prototype.unloadTech=function(){this.isReady_=!1,this.tech.dispose(),this.tech=!1},vjs.Player.prototype.onLoadStart=function(){this.removeClass("vjs-ended"),this.error(null),this.paused()?this.hasStarted(!1):this.trigger("firstplay")},vjs.Player.prototype.hasStarted_=!1,vjs.Player.prototype.hasStarted=function(e){return e!==undefined?(this.hasStarted_!==e&&(this.hasStarted_=e,e?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started")),this):this.hasStarted_},vjs.Player.prototype.onLoadedMetaData,vjs.Player.prototype.onLoadedData,vjs.Player.prototype.onLoadedAllData,vjs.Player.prototype.onPlay=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0)},vjs.Player.prototype.onWaiting=function(){this.addClass("vjs-waiting")},vjs.Player.prototype.onWaitEnd=function(){this.removeClass("vjs-waiting")},vjs.Player.prototype.onSeeking=function(){this.addClass("vjs-seeking")},vjs.Player.prototype.onSeeked=function(){this.removeClass("vjs-seeking")},vjs.Player.prototype.onFirstPlay=function(){this.options_.starttime&&this.currentTime(this.options_.starttime),this.addClass("vjs-has-started")},vjs.Player.prototype.onPause=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused")},vjs.Player.prototype.onTimeUpdate,vjs.Player.prototype.onProgress=function(){this.bufferedPercent()==1&&this.trigger("loadedalldata")},vjs.Player.prototype.onEnded=function(){this.addClass("vjs-ended"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause()},vjs.Player.prototype.onDurationChange=function(){var e=this.techGet("duration");e&&(e<0&&(e=Infinity),this.duration(e),e===Infinity?this.addClass("vjs-live"):this.removeClass("vjs-live"))},vjs.Player.prototype.onVolumeChange,vjs.Player.prototype.onFullscreenChange=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},vjs.Player.prototype.onError,vjs.Player.prototype.cache_,vjs.Player.prototype.getCache=function(){return this.cache_},vjs.Player.prototype.techCall=function(e,t){if(this.tech&&!this.tech.isReady_)this.tech.ready(function(){this[e](t)});else try{this.tech[e](t)}catch(n){throw vjs.log(n),n}},vjs.Player.prototype.techGet=function(e){if(this.tech&&this.tech.isReady_)try{return this.tech[e]()}catch(t){throw this.tech[e]===undefined?vjs.log("Video.js: "+e+" method not defined for "+this.techName+" playback technology.",t):t.name=="TypeError"?(vjs.log("Video.js: "+e+" unavailable on "+this.techName+" playback technology element.",t),this.tech.isReady_=!1):vjs.log(t),t}return},vjs.Player.prototype.play=function(){return this.techCall("play"),this},vjs.Player.prototype.pause=function(){return this.techCall("pause"),this},vjs.Player.prototype.paused=function(){return this.techGet("paused")===!1?!1:!0},vjs.Player.prototype.currentTime=function(e){return e!==undefined?(this.techCall("setCurrentTime",e),this):this.cache_.currentTime=this.techGet("currentTime")||0},vjs.Player.prototype.duration=function(e){return e!==undefined?(this.cache_.duration=parseFloat(e),this):(this.cache_.duration===undefined&&this.onDurationChange(),this.cache_.duration||0)},vjs.Player.prototype.remainingTime=function(){return this.duration()-this.currentTime()},vjs.Player.prototype.buffered=function(){var e=this.techGet("buffered");if(!e||!e.length)e=vjs.createTimeRange(0,0);return e},vjs.Player.prototype.bufferedPercent=function(){var e=this.duration(),t=this.buffered(),n=0,r,i;if(!e)return 0;for(var s=0;s<t.length;s++)r=t.start(s),i=t.end(s),i>e&&(i=e),n+=i-r;return n/e},vjs.Player.prototype.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),n=e.end(e.length-1);return n>t&&(n=t),n},vjs.Player.prototype.volume=function(e){var t;return e!==undefined?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall("setVolume",t),vjs.setLocalStorage("volume",t),this):(t=parseFloat(this.techGet("volume")),isNaN(t)?1:t)},vjs.Player.prototype.muted=function(e){return e!==undefined?(this.techCall("setMuted",e),this):this.techGet("muted")||!1},vjs.Player.prototype.supportsFullScreen=function(){return this.techGet("supportsFullScreen")||!1},vjs.Player.prototype.isFullscreen_=!1,vjs.Player.prototype.isFullscreen=function(e){return e!==undefined?(this.isFullscreen_=!!e,this):this.isFullscreen_},vjs.Player.prototype.isFullScreen=function(e){return vjs.log.warn('player.isFullScreen() has been deprecated, use player.isFullscreen() with a lowercase "s")'),this.isFullscreen(e)},vjs.Player.prototype.requestFullscreen=function(){var e=vjs.browser.fullscreenAPI;return this.isFullscreen(!0),e?(vjs.on(document,e.fullscreenchange,vjs.bind(this,function(t){this.isFullscreen(document[e.fullscreenElement]),this.isFullscreen()===!1&&vjs.off(document,e.fullscreenchange,arguments.callee),this.trigger("fullscreenchange")})),this.el_[e.requestFullscreen]()):this.tech.supportsFullScreen()?this.techCall("enterFullScreen"):(this.enterFullWindow(),this.trigger("fullscreenchange")),this},vjs.Player.prototype.requestFullScreen=function(){return vjs.log.warn('player.requestFullScreen() has been deprecated, use player.requestFullscreen() with a lowercase "s")'),this.requestFullscreen()},vjs.Player.prototype.exitFullscreen=function(){var e=vjs.browser.fullscreenAPI;return this.isFullscreen(!1),e?document[e.exitFullscreen]():this.tech.supportsFullScreen()?this.techCall("exitFullScreen"):(this.exitFullWindow(),this.trigger("fullscreenchange")),this},vjs.Player.prototype.cancelFullScreen=function(){return vjs.log.warn("player.cancelFullScreen() has been deprecated, use player.exitFullscreen()"),this.exitFullscreen()},vjs.Player.prototype.enterFullWindow=function(){this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,vjs.on(document,"keydown",vjs.bind(this,this.fullWindowOnEscKey)),document.documentElement.style.overflow="hidden",vjs.addClass(document.body,"vjs-full-window"),this.trigger("enterFullWindow")},vjs.Player.prototype.fullWindowOnEscKey=function(e){e.keyCode===27&&(this.isFullscreen()===!0?this.exitFullscreen():this.exitFullWindow())},vjs.Player.prototype.exitFullWindow=function(){this.isFullWindow=!1,vjs.off(document,"keydown",this.fullWindowOnEscKey),document.documentElement.style.overflow=this.docOrigOverflow,vjs.removeClass(document.body,"vjs-full-window"),this.trigger("exitFullWindow")},vjs.Player.prototype.selectSource=function(e){for(var t=0,n=this.options_.techOrder;t<n.length;t++){var r=vjs.capitalize(n[t]),i=window.videojs[r];if(!i){vjs.log.error('The "'+r+'" tech is undefined. Skipped browser support check for that tech.');continue}if(i.isSupported())for(var s=0,o=e;s<o.length;s++){var u=o[s];if(i.canPlaySource(u))return{source:u,tech:r}}}return!1},vjs.Player.prototype.src=function(e){return e===undefined?this.techGet("src"):(vjs.obj.isArray(e)?this.sourceList_(e):typeof e=="string"?this.src({src:e}):e instanceof Object&&(e.type&&!window.videojs[this.techName].canPlaySource(e)?this.sourceList_([e]):(this.cache_.src=e.src,this.currentType_=e.type||"",this.ready(function(){window.videojs[this.techName].prototype.hasOwnProperty("setSource")?this.techCall("setSource",e):this.techCall("src",e.src),this.options_["preload"]=="auto"&&this.load(),this.options_.autoplay&&this.play()}))),this)},vjs.Player.prototype.sourceList_=function(e){var t=this.selectSource(e);t?t.tech===this.techName?this.src(t.source):this.loadTech(t.tech,t.source):(this.setTimeout(function(){this.error({code:4,message:this.localize(this.options().notSupportedMessage)})},0),this.triggerReady())},vjs.Player.prototype.load=function(){return this.techCall("load"),this},vjs.Player.prototype.currentSrc=function(){return this.techGet("currentSrc")||this.cache_.src||""},vjs.Player.prototype.currentType=function(){return this.currentType_||""},vjs.Player.prototype.preload=function(e){return e!==undefined?(this.techCall("setPreload",e),this.options_.preload=e,this):this.techGet("preload")},vjs.Player.prototype.autoplay=function(e){return e!==undefined?(this.techCall("setAutoplay",e),this.options_.autoplay=e,this):this.techGet("autoplay",e)},vjs.Player.prototype.loop=function(e){return e!==undefined?(this.techCall("setLoop",e),this.options_.loop=e,this):this.techGet("loop")},vjs.Player.prototype.poster_,vjs.Player.prototype.poster=function(e){return e===undefined?this.poster_:(e||(e=""),this.poster_=e,this.techCall("setPoster",e),this.trigger("posterchange"),this)},vjs.Player.prototype.controls_,vjs.Player.prototype.controls=function(e){return e!==undefined?(e=!!e,this.controls_!==e&&(this.controls_=e,e?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled")):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"))),this):this.controls_},vjs.Player.prototype.usingNativeControls_,vjs.Player.prototype.usingNativeControls=function(e){return e!==undefined?(e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,e?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols"))),this):this.usingNativeControls_},vjs.Player.prototype.error_=null,vjs.Player.prototype.error=function(e){return e===undefined?this.error_:e===null?(this.error_=e,this.removeClass("vjs-error"),this):(e instanceof vjs.MediaError?this.error_=e:this.error_=new vjs.MediaError(e),this.trigger("error"),this.addClass("vjs-error"),vjs.log.error("(CODE:"+this.error_.code+" "+vjs.MediaError.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this)},vjs.Player.prototype.ended=function(){return this.techGet("ended")},vjs.Player.prototype.seeking=function(){return this.techGet("seeking")},vjs.Player.prototype.userActivity_=!0,vjs.Player.prototype.reportUserActivity=function(e){this.userActivity_=!0},vjs.Player.prototype.userActive_=!0,vjs.Player.prototype.userActive=function(e){return e!==undefined?(e=!!e,e!==this.userActive_&&(this.userActive_=e,e?(this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive")):(this.userActivity_=!1,this.tech&&this.tech.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive"))),this):this.userActive_},vjs.Player.prototype.listenForUserActivity=function(){var e,t,n,r,i,s,o,u,a;e=vjs.bind(this,this.reportUserActivity),t=function(t){if(t.screenX!=u||t.screenY!=a)u=t.screenX,a=t.screenY,e()},n=function(){e(),this.clearInterval(r),r=this.setInterval(e,250)},i=function(t){e(),this.clearInterval(r)},this.on("mousedown",n),this.on("mousemove",t),this.on("mouseup",i),this.on("keydown",e),this.on("keyup",e),s=this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(o);var e=this.options().inactivityTimeout;e>0&&(o=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))}},250)},vjs.Player.prototype.playbackRate=function(e){return e!==undefined?(this.techCall("setPlaybackRate",e),this):this.tech&&this.tech.featuresPlaybackRate?this.techGet("playbackRate"):1},vjs.Player.prototype.isAudio_=!1,vjs.Player.prototype.isAudio=function(e){return e!==undefined?(this.isAudio_=!!e,this):this.isAudio_},vjs.Player.prototype.networkState=function(){return this.techGet("networkState")},vjs.Player.prototype.readyState=function(){return this.techGet("readyState")},vjs.Player.prototype.textTracks=function(){return this.tech&&this.tech.textTracks()},vjs.Player.prototype.remoteTextTracks=function(){return this.tech&&this.tech.remoteTextTracks()},vjs.Player.prototype.addTextTrack=function(e,t,n){return this.tech&&this.tech.addTextTrack(e,t,n)},vjs.Player.prototype.addRemoteTextTrack=function(e){return this.tech&&this.tech.addRemoteTextTrack(e)},vjs.Player.prototype.removeRemoteTextTrack=function(e){this.tech&&this.tech.removeRemoteTextTrack(e)},vjs.ControlBar=vjs.Component.extend(),vjs.ControlBar.prototype.options_={loadEvent:"play",children:{playToggle:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},remainingTimeDisplay:{},liveDisplay:{},progressControl:{},fullscreenToggle:{},volumeControl:{},muteToggle:{},playbackRateMenuButton:{},subtitlesButton:{},captionsButton:{},chaptersButton:{}}},vjs.ControlBar.prototype.createEl=function(){return vjs.createEl("div",{className:"vjs-control-bar"})},vjs.LiveDisplay=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t)}}),vjs.LiveDisplay.prototype.createEl=function(){var e=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-live-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+"</span>"+this.localize("LIVE"),"aria-live":"off"}),e.appendChild(this.contentEl_),e},vjs.PlayToggle=vjs.Button.extend({init:function(e,t){vjs.Button.call(this,e,t),this.on(e,"play",this.onPlay),this.on(e,"pause",this.onPause)}}),vjs.PlayToggle.prototype.buttonText="Play",vjs.PlayToggle.prototype.buildCSSClass=function(){return"vjs-play-control "+vjs.Button.prototype.buildCSSClass.call(this)},vjs.PlayToggle.prototype.onToggleClicked_=!1,vjs.PlayToggle.prototype.onClick=function(){if(this.onToggleClicked_)return;this.onToggleClicked_=!0,this.player_.paused()?this.player_.play():this.player_.pause();var e=this;setTimeout(function(){e.onToggleClicked_=!1},500)},vjs.PlayToggle.prototype.onPlay=function(){this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.el_.children[0].children[0].innerHTML=this.localize("Pause")},vjs.PlayToggle.prototype.onPause=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.el_.children[0].children[0].innerHTML=this.localize("Play")},vjs.CurrentTimeDisplay=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.on(e,"timeupdate",this.updateContent)}}),vjs.CurrentTimeDisplay.prototype.createEl=function(){var e=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-current-time vjs-time-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-current-time-display",innerHTML:'<span class="vjs-control-text">Current Time </span>0:00',"aria-live":"off"}),e.appendChild(this.contentEl_),e},vjs.CurrentTimeDisplay.prototype.updateContent=function(){var e=this.player_.scrubbing?this.player_.getCache().currentTime:this.player_.currentTime();this.contentEl_.innerHTML='<span class="vjs-control-text">'+this.localize("Current Time")+"</span> "+vjs.formatTime(e,this.player_.duration())},vjs.DurationDisplay=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.on(e,"timeupdate",this.updateContent)}}),vjs.DurationDisplay.prototype.createEl=function(){var e=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-duration vjs-time-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-duration-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Duration Time")+"</span> "+"0:00","aria-live":"off"}),e.appendChild(this.contentEl_),e},vjs.DurationDisplay.prototype.updateContent=function(){var e=this.player_.duration();e&&(this.contentEl_.innerHTML='<span class="vjs-control-text">'+this.localize("Duration Time")+"</span> "+vjs.formatTime(e))},vjs.TimeDivider=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t)}}),vjs.TimeDivider.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-time-divider",innerHTML:"<div><span>/</span></div>"})},vjs.RemainingTimeDisplay=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.on(e,"timeupdate",this.updateContent)}}),vjs.RemainingTimeDisplay.prototype.createEl=function(){var e=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-remaining-time vjs-time-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-remaining-time-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Remaining Time")+"</span> "+"-0:00","aria-live":"off"}),e.appendChild(this.contentEl_),e},vjs.RemainingTimeDisplay.prototype.updateContent=function(){this.player_.duration()&&(this.contentEl_.innerHTML='<span class="vjs-control-text">'+this.localize("Remaining Time")+"</span> "+"-"+vjs.formatTime(this.player_.remainingTime()))},vjs.FullscreenToggle=vjs.Button.extend({init:function(e,t){vjs.Button.call(this,e,t)}}),vjs.FullscreenToggle.prototype.buttonText="Fullscreen",vjs.FullscreenToggle.prototype.buildCSSClass=function(){return"vjs-fullscreen-control "+vjs.Button.prototype.buildCSSClass.call(this)};if(vjs.getAndroidVersion()>=5||vjs.getAndroidVersion()==0)vjs.FullscreenToggle.prototype.onClick=function(){this.player_.isFullscreen()?(this.player_.exitFullscreen(),this.controlText_.innerHTML=this.localize("Fullscreen")):(this.player_.requestFullscreen(),this.controlText_.innerHTML=this.localize("Non-Fullscreen"))};vjs.ProgressControl=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t)}}),vjs.ProgressControl.prototype.options_={children:{seekBar:{}}},vjs.ProgressControl.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},vjs.SeekBar=vjs.Slider.extend({init:function(e,t){vjs.Slider.call(this,e,t),this.on(e,"timeupdate",this.updateARIAAttributes),e.ready(vjs.bind(this,this.updateARIAAttributes))}}),vjs.SeekBar.prototype.options_={children:{loadProgressBar:{},playProgressBar:{},seekHandle:{}},barName:"playProgressBar",handleName:"seekHandle"},vjs.SeekBar.prototype.playerEvent="timeupdate",vjs.SeekBar.prototype.createEl=function(){return vjs.Slider.prototype.createEl.call(this,"div",{className:"vjs-progress-holder","aria-label":"video progress bar"})},vjs.SeekBar.prototype.updateARIAAttributes=function(){var e=this.player_.scrubbing?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.setAttribute("aria-valuenow",vjs.round(this.getPercent()*100,2)),this.el_.setAttribute("aria-valuetext",vjs.formatTime(e,this.player_.duration()))},vjs.SeekBar.prototype.getPercent=function(){return this.player_.currentTime()/this.player_.duration()},vjs.SeekBar.prototype.onMouseDown=function(e){vjs.Slider.prototype.onMouseDown.call(this,e),this.player_.scrubbing=!0,this.player_.addClass("vjs-scrubbing"),this.videoWasPlaying=!this.player_.paused(),this.player_.pause()},vjs.SeekBar.prototype.onMouseMove=function(e){var t=this.calculateDistance(e)*this.player_.duration();t==this.player_.duration()&&(t-=.1),this.player_.currentTime(t)},vjs.SeekBar.prototype.onMouseUp=function(e){vjs.Slider.prototype.onMouseUp.call(this,e),this.player_.scrubbing=!1,this.player_.removeClass("vjs-scrubbing"),this.videoWasPlaying&&this.player_.play()},vjs.SeekBar.prototype.stepForward=function(){this.player_.currentTime(this.player_.currentTime()+5)},vjs.SeekBar.prototype.stepBack=function(){this.player_.currentTime(this.player_.currentTime()-5)},vjs.LoadProgressBar=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.on(e,"progress",this.update)}}),vjs.LoadProgressBar.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Loaded")+"</span>: 0%</span>"})},vjs.LoadProgressBar.prototype.update=function(){var e,t,n,r,i=this.player_.buffered(),s=this.player_.duration(),o=this.player_.bufferedEnd(),u=this.el_.children,a=function(e,t){var n=e/t||0;return n*100+"%"};this.el_.style.width=a(o,s);for(e=0;e<i.length;e++)t=i.start(e),n=i.end(e),r=u[e],r||(r=this.el_.appendChild(vjs.createEl())),r.style.left=a(t,o),r.style.width=a(n-t,o);for(e=u.length;e>i.length;e--)this.el_.removeChild(u[e-1])},vjs.PlayProgressBar=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t)}}),vjs.PlayProgressBar.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-play-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Progress")+"</span>: 0%</span>"})},vjs.SeekHandle=vjs.SliderHandle.extend({init:function(e,t){vjs.SliderHandle.call(this,e,t),this.on(e,"timeupdate",this.updateContent)}}),vjs.SeekHandle.prototype.defaultValue="00:00",vjs.SeekHandle.prototype.createEl=function(){return vjs.SliderHandle.prototype.createEl.call(this,"div",{className:"vjs-seek-handle","aria-live":"off"})},vjs.SeekHandle.prototype.updateContent=function(){var e=this.player_.scrubbing?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.innerHTML='<span class="vjs-control-text">'+vjs.formatTime(e,this.player_.duration())+"</span>"},vjs.VolumeControl=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),e.tech&&e.tech.featuresVolumeControl===!1&&this.addClass("vjs-hidden"),this.on(e,"loadstart",function(){e.tech.featuresVolumeControl===!1?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")})}}),vjs.VolumeControl.prototype.options_={children:{volumeBar:{}}},vjs.VolumeControl.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control"})},vjs.VolumeBar=vjs.Slider.extend({init:function(e,t){vjs.Slider.call(this,e,t),this.on(e,"volumechange",this.updateARIAAttributes),e.ready(vjs.bind(this,this.updateARIAAttributes))}}),vjs.VolumeBar.prototype.updateARIAAttributes=function(){this.el_.setAttribute("aria-valuenow",vjs.round(this.player_.volume()*100,2)),this.el_.setAttribute("aria-valuetext",vjs.round(this.player_.volume()*100,2)+"%")},vjs.VolumeBar.prototype.options_={children:{volumeLevel:{},volumeHandle:{}},barName:"volumeLevel",handleName:"volumeHandle"},vjs.VolumeBar.prototype.playerEvent="volumechange",vjs.VolumeBar.prototype.createEl=function(){return vjs.Slider.prototype.createEl.call(this,"div",{className:"vjs-volume-bar","aria-label":"volume level"})},vjs.VolumeBar.prototype.onMouseMove=function(e){this.player_.muted()&&this.player_.muted(!1),this.player_.volume(this.calculateDistance(e))},vjs.VolumeBar.prototype.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},vjs.VolumeBar.prototype.stepForward=function(){this.player_.volume(this.player_.volume()+.1)},vjs.VolumeBar.prototype.stepBack=function(){this.player_.volume(this.player_.volume()-.1)},vjs.VolumeLevel=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t)}}),vjs.VolumeLevel.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})},vjs.VolumeHandle=vjs.SliderHandle.extend(),vjs.VolumeHandle.prototype.defaultValue="00:00",vjs.VolumeHandle.prototype.createEl=function(){return vjs.SliderHandle.prototype.createEl.call(this,"div",{className:"vjs-volume-handle"})},vjs.MuteToggle=vjs.Button.extend({init:function(e,t){vjs.Button.call(this,e,t),this.on(e,"volumechange",this.update),e.tech&&e.tech.featuresVolumeControl===!1&&this.addClass("vjs-hidden"),this.on(e,"loadstart",function(){e.tech.featuresVolumeControl===!1?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")})}}),vjs.MuteToggle.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div",{className:"vjs-mute-control vjs-control",innerHTML:'<div><span class="vjs-control-text">'+this.localize("Mute")+"</span></div>"})},vjs.MuteToggle.prototype.onClick=function(){this.player_.muted(this.player_.muted()?!1:!0)},vjs.MuteToggle.prototype.update=function(){var e=this.player_.volume(),t=3;e===0||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2),this.player_.muted()?this.el_.children[0].children[0].innerHTML!=this.localize("Unmute")&&(this.el_.children[0].children[0].innerHTML=this.localize("Unmute")):this.el_.children[0].children[0].innerHTML!=this.localize("Mute")&&(this.el_.children[0].children[0].innerHTML=this.localize("Mute"));for(var n=0;n<4;n++)vjs.removeClass(this.el_,"vjs-vol-"+n);vjs.addClass(this.el_,"vjs-vol-"+t)},vjs.VolumeMenuButton=vjs.MenuButton.extend({init:function(e,t){vjs.MenuButton.call(this,e,t),this.on(e,"volumechange",this.volumeUpdate),e.tech&&e.tech.featuresVolumeControl===!1&&this.addClass("vjs-hidden"),this.on(e,"loadstart",function(){e.tech.featuresVolumeControl===!1?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")}),this.addClass("vjs-menu-button")}}),vjs.VolumeMenuButton.prototype.createMenu=function(){var e=new vjs.Menu(this.player_,{contentElType:"div"}),t=new vjs.VolumeBar(this.player_,this.options_.volumeBar);return t.on("focus",function(){e.lockShowing()}),t.on("blur",function(){e.unlockShowing()}),e.addChild(t),e},vjs.VolumeMenuButton.prototype.onClick=function(){vjs.MuteToggle.prototype.onClick.call(this),vjs.MenuButton.prototype.onClick.call(this)},vjs.VolumeMenuButton.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div",{className:"vjs-volume-menu-button vjs-menu-button vjs-control",innerHTML:'<div><span class="vjs-control-text">'+this.localize("Mute")+"</span></div>"})},vjs.VolumeMenuButton.prototype.volumeUpdate=vjs.MuteToggle.prototype.update,vjs.PlaybackRateMenuButton=vjs.MenuButton.extend({init:function(e,t){vjs.MenuButton.call(this,e,t),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",this.updateVisibility),this.on(e,"ratechange",this.updateLabel)}}),vjs.PlaybackRateMenuButton.prototype.buttonText="Playback Rate",vjs.PlaybackRateMenuButton.prototype.className="vjs-playback-rate",vjs.PlaybackRateMenuButton.prototype.createEl=function(){var e=vjs.MenuButton.prototype.createEl.call(this);return this.labelEl_=vjs.createEl("div",{className:"vjs-playback-rate-value",innerHTML:1}),e.appendChild(this.labelEl_),e},vjs.PlaybackRateMenuButton.prototype.createMenu=function(){var e=new vjs.Menu(this.player()),t=this.player().options().playbackRates;if(t)for(var n=t.length-1;n>=0;n--)e.addChild(new vjs.PlaybackRateMenuItem(this.player(),{rate:t[n]+"x"}));return e},vjs.PlaybackRateMenuButton.prototype.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},vjs.PlaybackRateMenuButton.prototype.onClick=function(){var e=this.player().playbackRate(),t=this.player().options().playbackRates,n=t[0];for(var r=0;r<t.length;r++)if(t[r]>e){n=t[r];break}this.player().playbackRate(n)},vjs.PlaybackRateMenuButton.prototype.playbackRateSupported=function(){return this.player().tech&&this.player().tech.featuresPlaybackRate&&this.player().options().playbackRates&&this.player().options().playbackRates.length>0},vjs.PlaybackRateMenuButton.prototype.updateVisibility=function(){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},vjs.PlaybackRateMenuButton.prototype.updateLabel=function(){this.playbackRateSupported()&&(this.labelEl_.innerHTML=this.player().playbackRate()+"x")},vjs.PlaybackRateMenuItem=vjs.MenuItem.extend({contentElType:"button",init:function(e,t){var n=this.label=t.rate,r=this.rate=parseFloat(n,10);t.label=n,t.selected=r===1,vjs.MenuItem.call(this,e,t),this.on(e,"ratechange",this.update)}}),vjs.PlaybackRateMenuItem.prototype.onClick=function(){vjs.MenuItem.prototype.onClick.call(this),this.player().playbackRate(this.rate)},vjs.PlaybackRateMenuItem.prototype.update=function(){this.selected(this.player().playbackRate()==this.rate)},vjs.PosterImage=vjs.Button.extend({init:function(e,t){vjs.Button.call(this,e,t),this.update(),e.on("posterchange",vjs.bind(this,this.update))}}),vjs.PosterImage.prototype.dispose=function(){this.player().off("posterchange",this.update),vjs.Button.prototype.dispose.call(this)},vjs.PosterImage.prototype.createEl=function(){var e=vjs.createEl("div",{className:"vjs-poster",tabIndex:-1});return vjs.BACKGROUND_SIZE_SUPPORTED||(this.fallbackImg_=vjs.createEl("img"),e.appendChild(this.fallbackImg_)),e},vjs.PosterImage.prototype.update=function(){var e=this.player().poster();this.setSrc(e),e?this.show():this.hide()},vjs.PosterImage.prototype.setSrc=function(e){var t;this.fallbackImg_?this.fallbackImg_.src=e:(t="",e&&(t='url("'+e+'")'),this.el_.style.backgroundImage=t)},vjs.PosterImage.prototype.onClick=function(){this.player_.play()},vjs.LoadingSpinner=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t)}}),vjs.LoadingSpinner.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner"})},vjs.BigPlayButton=vjs.Button.extend(),vjs.BigPlayButton.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span aria-hidden="true"></span>',"aria-label":"play video"})},vjs.BigPlayButton.prototype.onClick=function(){this.player_.play()},vjs.ErrorDisplay=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.update(),this.on(e,"error",this.update)}}),vjs.ErrorDisplay.prototype.createEl=function(){var e=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-error-display"});return this.contentEl_=vjs.createEl("div"),e.appendChild(this.contentEl_),e},vjs.ErrorDisplay.prototype.update=function(){this.player().error()&&(this.contentEl_.innerHTML=this.localize(this.player().error().message))},function(){var e;vjs.MediaTechController=vjs.Component.extend({init:function(e,t,n){t=t||{},t.reportTouchActivity=!1,vjs.Component.call(this,e,t,n),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),this.initControlsListeners(),this.featuresNativeTextTracks||this.emulateTextTracks(),this.initTextTrackListeners()}}),vjs.MediaTechController.prototype.initControlsListeners=function(){var e,t;e=this.player(),t=function(){e.controls()&&!e.usingNativeControls()&&this.addControlsListeners()},this.ready(t),this.on(e,"controlsenabled",t),this.on(e,"controlsdisabled",this.removeControlsListeners),this.ready(function(){this.networkState&&this.networkState()>0&&this.player().trigger("loadstart")})},vjs.MediaTechController.prototype.addControlsListeners=function(){var e;this.on("mousedown",this.onClick),this.on("touchstart",function(t){e=this.player_.userActive()}),this.on("touchmove",function(t){e&&this.player().reportUserActivity()}),this.on("touchend",function(e){e.preventDefault()}),this.emitTapEvents(),this.on("tap",this.onTap)},vjs.MediaTechController.prototype.removeControlsListeners=function(){this.off("tap"),this.off("touchstart"),this.off("touchmove"),this.off("touchleave"),this.off("touchcancel"),this.off("touchend"),this.off("click"),this.off("mousedown")},vjs.MediaTechController.prototype.onClick=function(e){if(e.button!==0)return;this.player().controls()&&(this.player().paused()?this.player().play():this.player().pause())},vjs.MediaTechController.prototype.onTap=function(){this.player().controls()&&(this.player().paused()?this.player().play():this.player().userActive()?this.player().pause():this.player().userActive(!this.player().userActive()))},vjs.MediaTechController.prototype.manualProgressOn=function(){this.manualProgress=!0,this.trackProgress()},vjs.MediaTechController.prototype.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress()},vjs.MediaTechController.prototype.trackProgress=function(){this.progressInterval=this.setInterval(function(){var e=this.player().bufferedPercent();this.bufferedPercent_!=e&&this.player().trigger("progress"),this.bufferedPercent_=e,e===1&&this.stopTrackingProgress()},500)},vjs.MediaTechController.prototype.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},vjs.MediaTechController.prototype.manualTimeUpdatesOn=function(){var e=this.player_;this.manualTimeUpdates=!0,this.on(e,"play",this.trackCurrentTime),this.on(e,"pause",this.stopTrackingCurrentTime),this.one("timeupdate",function(){this.featuresTimeupdateEvents=!0,this.manualTimeUpdatesOff()})},vjs.MediaTechController.prototype.manualTimeUpdatesOff=function(){var e=this.player_;this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off(e,"play",this.trackCurrentTime),this.off(e,"pause",this.stopTrackingCurrentTime)},vjs.MediaTechController.prototype.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.player().trigger("timeupdate")},250)},vjs.MediaTechController.prototype.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.player().trigger("timeupdate")},vjs.MediaTechController.prototype.dispose=function(){this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),vjs.Component.prototype.dispose.call(this)},vjs.MediaTechController.prototype.setCurrentTime=function(){this.manualTimeUpdates&&this.player().trigger("timeupdate")},vjs.MediaTechController.prototype.initTextTrackListeners=function(){var e=this.player_,t,n=function(){var t=e.getChild("textTrackDisplay"),n;t&&t.updateDisplay()};t=this.textTracks();if(!t)return;t.addEventListener("removetrack",n),t.addEventListener("addtrack",n),this.on("dispose",vjs.bind(this,function(){t.removeEventListener("removetrack",n),t.removeEventListener("addtrack",n)}))},vjs.MediaTechController.prototype.emulateTextTracks=function(){var e=this.player_,t,n,r;window.WebVTT||(r=document.createElement("script"),r.src=e.options()["vtt.js"]||"../node_modules/vtt.js/dist/vtt.js",e.el().appendChild(r),window.WebVTT=!0),n=this.textTracks();if(!n)return;t=function(){var t,n,r;r=e.getChild("textTrackDisplay"),r.updateDisplay();for(t=0;t<this.length;t++)n=this[t],n.removeEventListener("cuechange",vjs.bind(r,r.updateDisplay)),n.mode==="showing"&&n.addEventListener("cuechange",vjs.bind(r,r.updateDisplay))},n.addEventListener("change",t),this.on("dispose",vjs.bind(this,function(){n.removeEventListener("change",t)}))},vjs.MediaTechController.prototype.textTracks_,vjs.MediaTechController.prototype.textTracks=function(){return this.player_.textTracks_=this.player_.textTracks_||new vjs.TextTrackList,this.player_.textTracks_},vjs.MediaTechController.prototype.remoteTextTracks=function(){return this.player_.remoteTextTracks_=this.player_.remoteTextTracks_||new vjs.TextTrackList,this.player_.remoteTextTracks_},e=function(e,t,n,r,i){var s=e.textTracks(),o;return i=i||{},i.kind=t,n&&(i.label=n),r&&(i.language=r),i.player=e.player_,o=new vjs.TextTrack(i),s.addTrack_(o),o},vjs.MediaTechController.prototype.addTextTrack=function(t,n,r){if(!t)throw new Error("TextTrack kind is required but was not provided");return e(this,t,n,r)},vjs.MediaTechController.prototype.addRemoteTextTrack=function(t){var n=e(this,t.kind,t.label,t.language,t);return this.remoteTextTracks().addTrack_(n),{track:n}},vjs.MediaTechController.prototype.removeRemoteTextTrack=function(e){this.textTracks().removeTrack_(e),this.remoteTextTracks().removeTrack_(e)},vjs.MediaTechController.prototype.setPoster=function(){},vjs.MediaTechController.prototype.featuresVolumeControl=!0,vjs.MediaTechController.prototype.featuresFullscreenResize=!1,vjs.MediaTechController.prototype.featuresPlaybackRate=!1,vjs.MediaTechController.prototype.featuresProgressEvents=!1,vjs.MediaTechController.prototype.featuresTimeupdateEvents=!1,vjs.MediaTechController.prototype.featuresNativeTextTracks=!1,vjs.MediaTechController.withSourceHandlers=function(e){e.registerSourceHandler=function(t,n){var r=e.sourceHandlers;r||(r=e.sourceHandlers=[]),n===undefined&&(n=r.length),r.splice(n,0,t)},e.selectSourceHandler=function(t){var n=e.sourceHandlers||[],r;for(var i=0;i<n.length;i++){r=n[i].canHandleSource(t);if(r)return n[i]}return null},e.canPlaySource=function(t){var n=e.selectSourceHandler(t);return n?n.canHandleSource(t):""},e.prototype.setSource=function(t){var n=e.selectSourceHandler(t);return n||(e.nativeSourceHandler?n=e.nativeSourceHandler:vjs.log.error("No source hander found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler),this.currentSource_=t,this.sourceHandler_=n.handleSource(t,this),this.on("dispose",this.disposeSourceHandler),this},e.prototype.disposeSourceHandler=function(){this.sourceHandler_&&this.sourceHandler_.dispose&&this.sourceHandler_.dispose()}},vjs.media={}}(),vjs.Html5=vjs.MediaTechController.extend({init:function(e,t,n){var r,i,s,o,u,a;if(t.nativeCaptions===!1||t.nativeTextTracks===!1)this.featuresNativeTextTracks=!1;vjs.MediaTechController.call(this,e,t,n),this.setupTriggers();var f=t.source;f&&(this.el_.currentSrc!==f.src||e.tag&&e.tag.initNetworkState_===3)&&this.setSource(f);if(this.el_.hasChildNodes()){r=this.el_.childNodes,i=r.length,a=[];while(i--)o=r[i],u=o.nodeName.toLowerCase(),u==="track"&&(this.featuresNativeTextTracks?this.remoteTextTracks().addTrack_(o.track):a.push(o));for(s=0;s<a.length;s++)this.el_.removeChild(a[s])}this.featuresNativeTextTracks&&this.on("loadstart",vjs.bind(this,this.hideCaptions)),vjs.TOUCH_ENABLED&&e.options().nativeControlsForTouch===!0&&this.useNativeControls(),e.ready(function(){this.tag&&this.options_.autoplay&&this.paused()&&(delete this.tag.poster,this.play())}),this.triggerReady()}}),vjs.Html5.prototype.dispose=function(){vjs.Html5.disposeMediaElement(this.el_),vjs.MediaTechController.prototype.dispose.call(this)},vjs.Html5.prototype.createEl=function(){var e=this.player_,t,n,r,i=e.tag,s,o,u;if(!i||this.movingMediaElementInDOM===!1){i?(u=i.cloneNode(!1),vjs.Html5.disposeMediaElement(i),i=u,e.tag=null):(i=vjs.createEl("video"),s=videojs.util.mergeOptions({},e.tagAttributes),(!vjs.TOUCH_ENABLED||e.options().nativeControlsForTouch!==!0)&&delete s.controls,vjs.setElementAttributes(i,vjs.obj.merge(s,{id:e.id()+"_html5_api","class":"vjs-tech"}))),i.player=e;if(e.options_.tracks)for(r=0;r<e.options_.tracks.length;r++)t=e.options_.tracks[r],n=document.createElement("track"),n.kind=t.kind,n.label=t.label,n.srclang=t.srclang,n.src=t.src,"default"in t&&n.setAttribute("default","default"),i.appendChild(n);vjs.insertFirst(i,e.el())}var a=["autoplay","preload","loop","muted"];for(r=a.length-1;r>=0;r--){var f=a[r],l={};typeof e.options_[f]!="undefined"&&(l[f]=e.options_[f]),vjs.setElementAttributes(i,l)}return i},vjs.Html5.prototype.hideCaptions=function(){var e=this.el_.querySelectorAll("track"),t,n=e.length,r={captions:1,subtitles:1};while(n--)t=e[n].track,t&&t.kind in r&&!e[n]["default"]&&(t.mode="disabled")},vjs.Html5.prototype.setupTriggers=function(){for(var e=vjs.Html5.Events.length-1;e>=0;e--)this.on(vjs.Html5.Events[e],this.eventHandler)},vjs.Html5.prototype.eventHandler=function(e){e.type=="error"&&this.error()?this.player().error(this.error().code):(e.bubbles=!1,this.player().trigger(e))},vjs.Html5.prototype.useNativeControls=function(){var e,t,n,r,i;e=this,t=this.player(),e.setControls(t.controls()),n=function(){e.setControls(!0)},r=function(){e.setControls(!1)},t.on("controlsenabled",n),t.on("controlsdisabled",r),i=function(){t.off("controlsenabled",n),t.off("controlsdisabled",r)},e.on("dispose",i),t.on("usingcustomcontrols",i),t.usingNativeControls(!0)},vjs.Html5.prototype.play=function(){this.el_.play()},vjs.Html5.prototype.pause=function(){this.el_.pause()},vjs.Html5.prototype.paused=function(){return this.el_.paused},vjs.Html5.prototype.currentTime=function(){return this.el_.currentTime},vjs.Html5.prototype.setCurrentTime=function(e){try{this.el_.currentTime=e}catch(t){vjs.log(t,"Video is not ready. (Video.js)")}},vjs.Html5.prototype.duration=function(){return this.el_.duration||0},vjs.Html5.prototype.buffered=function(){return this.el_.buffered},vjs.Html5.prototype.volume=function(){return this.el_.volume},vjs.Html5.prototype.setVolume=function(e){this.el_.volume=e},vjs.Html5.prototype.muted=function(){return this.el_.muted},vjs.Html5.prototype.setMuted=function(e){this.el_.muted=e},vjs.Html5.prototype.width=function(){return this.el_.offsetWidth},vjs.Html5.prototype.height=function(){return this.el_.offsetHeight},vjs.Html5.prototype.supportsFullScreen=function(){if(typeof this.el_.webkitEnterFullScreen=="function")if(/Android/.test(vjs.USER_AGENT)||!/Chrome|Mac OS X 10.5/.test(vjs.USER_AGENT))return!0;return!1},vjs.Html5.prototype.enterFullScreen=function(){var e=this.el_;"webkitDisplayingFullscreen"in e&&this.one("webkitbeginfullscreen",function(){this.player_.isFullscreen(!0),this.one("webkitendfullscreen",function(){this.player_.isFullscreen(!1),this.player_.trigger("fullscreenchange")}),this.player_.trigger("fullscreenchange")}),e.paused&&e.networkState<=e.HAVE_METADATA?(this.el_.play(),this.setTimeout(function(){e.pause(),e.webkitEnterFullScreen()},0)):e.webkitEnterFullScreen()},vjs.Html5.prototype.exitFullScreen=function(){this.el_.webkitExitFullScreen()},vjs.Html5.prototype.src=function(e){if(e===undefined)return this.el_.src;this.setSrc(e)},vjs.Html5.prototype.setSrc=function(e){this.el_.src=e},vjs.Html5.prototype.load=function(){this.el_.load()},vjs.Html5.prototype.currentSrc=function(){return this.el_.currentSrc},vjs.Html5.prototype.poster=function(){return this.el_.poster},vjs.Html5.prototype.setPoster=function(e){this.el_.poster=e},vjs.Html5.prototype.preload=function(){return this.el_.preload},vjs.Html5.prototype.setPreload=function(e){this.el_.preload=e},vjs.Html5.prototype.autoplay=function(){return this.el_.autoplay},vjs.Html5.prototype.setAutoplay=function(e){this.el_.autoplay=e},vjs.Html5.prototype.controls=function(){return this.el_.controls},vjs.Html5.prototype.setControls=function(e){this.el_.controls=!!e},vjs.Html5.prototype.loop=function(){return this.el_.loop},vjs.Html5.prototype.setLoop=function(e){this.el_.loop=e},vjs.Html5.prototype.error=function(){return this.el_.error},vjs.Html5.prototype.seeking=function(){return this.el_.seeking},vjs.Html5.prototype.ended=function(){return this.el_.ended},vjs.Html5.prototype.defaultMuted=function(){return this.el_.defaultMuted},vjs.Html5.prototype.playbackRate=function(){return this.el_.playbackRate},vjs.Html5.prototype.setPlaybackRate=function(e){this.el_.playbackRate=e},vjs.Html5.prototype.networkState=function(){return this.el_.networkState},vjs.Html5.prototype.readyState=function(){return this.el_.readyState},vjs.Html5.prototype.textTracks=function(){return this.featuresNativeTextTracks?this.el_.textTracks:vjs.MediaTechController.prototype.textTracks.call(this)},vjs.Html5.prototype.addTextTrack=function(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):vjs.MediaTechController.prototype.addTextTrack.call(this,e,t,n)},vjs.Html5.prototype.addRemoteTextTrack=function(e){if(!this.featuresNativeTextTracks)return vjs.MediaTechController.prototype.addRemoteTextTrack.call(this,e);var t=document.createElement("track");e=e||{},e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label);if(e.language||e.srclang)t.srclang=e.language||e.srclang;return e["default"]&&(t["default"]=e["default"]),e.id&&(t.id=e.id),e.src&&(t.src=e.src),this.el().appendChild(t),t.track.kind==="metadata"?t.track.mode="hidden":t.track.mode="disabled",t.onload=function(){var e=t.track;t.readyState>=2&&(e.kind==="metadata"&&e.mode!=="hidden"?e.mode="hidden":e.kind!=="metadata"&&e.mode!=="disabled"&&(e.mode="disabled"),t.onload=null)},this.remoteTextTracks().addTrack_(t.track),t},vjs.Html5.prototype.removeRemoteTextTrack=function(e){if(!this.featuresNativeTextTracks)return vjs.MediaTechController.prototype.removeRemoteTextTrack.call(this,e);var t,n;this.remoteTextTracks().removeTrack_(e),t=this.el().querySelectorAll("track");for(n=0;n<t.length;n++)if(t[n]===e||t[n].track===e){t[n].parentNode.removeChild(t[n]);break}},vjs.Html5.isSupported=function(){try{vjs.TEST_VID.volume=.5}catch(e){return!1}return!!vjs.TEST_VID.canPlayType},vjs.MediaTechController.withSourceHandlers(vjs.Html5),vjs.Html5.nativeSourceHandler={},vjs.Html5.nativeSourceHandler.canHandleSource=function(e){function r(e){try{return vjs.TEST_VID.canPlayType(e)}catch(t){return""}}var t,n;return e.type?r(e.type):e.src?(t=e.src.match(/\.([^.\/\?]+)(\?[^\/]+)?$/i),n=t&&t[1],r("video/"+n)):""},vjs.Html5.nativeSourceHandler.handleSource=function(e,t){t.setSrc(e.src)},vjs.Html5.nativeSourceHandler.dispose=function(){},vjs.Html5.registerSourceHandler(vjs.Html5.nativeSourceHandler),vjs.Html5.canControlVolume=function(){var e=vjs.TEST_VID.volume;return vjs.TEST_VID.volume=e/2+.1,e!==vjs.TEST_VID.volume},vjs.Html5.canControlPlaybackRate=function(){var e=vjs.TEST_VID.playbackRate;return vjs.TEST_VID.playbackRate=e/2+.1,e!==vjs.TEST_VID.playbackRate},vjs.Html5.supportsNativeTextTracks=function(){var e;return e=!!vjs.TEST_VID.textTracks,e&&vjs.TEST_VID.textTracks.length>0&&(e=typeof vjs.TEST_VID.textTracks[0].mode!="number"),e&&vjs.IS_FIREFOX&&(e=!1),e},vjs.Html5.prototype.featuresVolumeControl=vjs.Html5.canControlVolume(),vjs.Html5.prototype.featuresPlaybackRate=vjs.Html5.canControlPlaybackRate(),vjs.Html5.prototype.movingMediaElementInDOM=!vjs.IS_IOS,vjs.Html5.prototype.featuresFullscreenResize=!0,vjs.Html5.prototype.featuresProgressEvents=!0,vjs.Html5.prototype.featuresNativeTextTracks=vjs.Html5.supportsNativeTextTracks(),function(){var e,t=/^application\/(?:x-|vnd\.apple\.)mpegurl/i,n=/^video\/mp4/i;vjs.Html5.patchCanPlayType=function(){vjs.ANDROID_VERSION>=4&&(e||(e=vjs.TEST_VID.constructor.prototype.canPlayType),vjs.TEST_VID.constructor.prototype.canPlayType=function(n){return n&&t.test(n)?"maybe":e.call(this,n)}),vjs.IS_OLD_ANDROID&&(e||(e=vjs.TEST_VID.constructor.prototype.canPlayType),vjs.TEST_VID.constructor.prototype.canPlayType=function(t){return t&&n.test(t)?"maybe":e.call(this,t)})},vjs.Html5.unpatchCanPlayType=function(){var t=vjs.TEST_VID.constructor.prototype.canPlayType;return vjs.TEST_VID.constructor.prototype.canPlayType=e,e=null,t},vjs.Html5.patchCanPlayType()}(),vjs.Html5.Events="loadstart,suspend,abort,error,emptied,stalled,loadedmetadata,loadeddata,canplay,canplaythrough,playing,waiting,seeking,seeked,ended,durationchange,timeupdate,progress,play,pause,ratechange,volumechange".split(","),vjs.Html5.disposeMediaElement=function(e){if(!e)return;e.player=null,e.parentNode&&e.parentNode.removeChild(e);while(e.hasChildNodes())e.removeChild(e.firstChild);e.removeAttribute("src"),typeof e.load=="function"&&function(){try{e.load()}catch(t){}}()},vjs.Flash=vjs.MediaTechController.extend({init:function(e,t,n){vjs.MediaTechController.call(this,e,t,n);var r=t.source,i=t.parentEl,s=this.el_=vjs.createEl("div",{id:e.id()+"_temp_flash"}),o=e.id()+"_flash_api",u=e.options_,a=vjs.obj.merge({readyFunction:"videojs.Flash.onReady",eventProxyFunction:"videojs.Flash.onEvent",errorEventProxyFunction:"videojs.Flash.onError",autoplay:u.autoplay,preload:u.preload,loop:u.loop,muted:u.muted},t.flashVars),f=vjs.obj.merge({wmode:"opaque",bgcolor:"#000000"},t.params),l=vjs.obj.merge({id:o,name:o,"class":"vjs-tech"},t.attributes);r&&this.ready(function(){this.setSource(r)}),vjs.insertFirst(s,i),t.startTime&&this.ready(function(){this.load(),this.play(),this.currentTime(t.startTime)}),vjs.IS_FIREFOX&&this.ready(function(){this.on("mousemove",function(){this.player().trigger({type:"mousemove",bubbles:!1})})}),e.on("stageclick",e.reportUserActivity),this.el_=vjs.Flash.embed(t.swf,s,a,f,l)}}),vjs.Flash.prototype.dispose=function(){vjs.MediaTechController.prototype.dispose.call(this)},vjs.Flash.prototype.play=function(){this.el_.vjs_play()},vjs.Flash.prototype.pause=function(){this.el_.vjs_pause()},vjs.Flash.prototype.src=function(e){return e===undefined?this.currentSrc():this.setSrc(e)},vjs.Flash.prototype.setSrc=function(e){e=vjs.getAbsoluteURL(e),this.el_.vjs_src(e);if(this.player_.autoplay()){var t=this;this.setTimeout(function(){t.play()},0)}},vjs.Flash.prototype.setCurrentTime=function(e){this.lastSeekTarget_=e,this.el_.vjs_setProperty("currentTime",e),vjs.MediaTechController.prototype.setCurrentTime.call(this)},vjs.Flash.prototype.currentTime=function(e){return this.seeking()?this.lastSeekTarget_||0:this.el_.vjs_getProperty("currentTime")},vjs.Flash.prototype.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.vjs_getProperty("currentSrc")},vjs.Flash.prototype.load=function(){this.el_.vjs_load()},vjs.Flash.prototype.poster=function(){this.el_.vjs_getProperty("poster")},vjs.Flash.prototype.setPoster=function(){},vjs.Flash.prototype.buffered=function(){return vjs.createTimeRange(0,this.el_.vjs_getProperty("buffered"))},vjs.Flash.prototype.supportsFullScreen=function(){return!1},vjs.Flash.prototype.enterFullScreen=function(){return!1},function(){function i(t){var n=t.charAt(0).toUpperCase()+t.slice(1);e["set"+n]=function(e){return this.el_.vjs_setProperty(t,e)}}function s(t){e[t]=function(){return this.el_.vjs_getProperty(t)}}var e=vjs.Flash.prototype,t="rtmpConnection,rtmpStream,preload,defaultPlaybackRate,playbackRate,autoplay,loop,mediaGroup,controller,controls,volume,muted,defaultMuted".split(","),n="error,networkState,readyState,seeking,initialTime,duration,startOffsetTime,paused,played,seekable,ended,videoTracks,audioTracks,videoWidth,videoHeight".split(","),r;for(r=0;r<t.length;r++)s(t[r]),i(t[r]);for(r=0;r<n.length;r++)s(n[r])}(),vjs.Flash.isSupported=function(){return vjs.Flash.version()[0]>=10},vjs.MediaTechController.withSourceHandlers(vjs.Flash),vjs.Flash.nativeSourceHandler={},vjs.Flash.nativeSourceHandler.canHandleSource=function(e){var t;return e.type?(t=e.type.replace(/;.*/,"").toLowerCase(),t in vjs.Flash.formats?"maybe":""):""},vjs.Flash.nativeSourceHandler.handleSource=function(e,t){t.setSrc(e.src)},vjs.Flash.nativeSourceHandler.dispose=function(){},vjs.Flash.registerSourceHandler(vjs.Flash.nativeSourceHandler),vjs.Flash.formats={"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"},vjs.Flash.onReady=function(e){var t,n;t=vjs.el(e),n=t&&t.parentNode&&t.parentNode.player,n&&(t.player=n,vjs.Flash.checkReady(n.tech))},vjs.Flash.checkReady=function(e){if(!e.el())return;e.el().vjs_getProperty?e.triggerReady():this.setTimeout(function(){vjs.Flash.checkReady(e)},50)},vjs.Flash.onEvent=function(e,t){var n=vjs.el(e).player;n.trigger(t)},vjs.Flash.onError=function(e,t){var n=vjs.el(e).player,r="FLASH: "+t;t=="srcnotfound"?n.error({code:4,message:r}):n.error(r)},vjs.Flash.version=function(){var e="0,0,0";try{e=(new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(t){try{navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(e=(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1])}catch(n){}}return e.split(",")},vjs.Flash.embed=function(e,t,n,r,i){var s=vjs.Flash.getEmbedCode(e,n,r,i),o=vjs.createEl("div",{innerHTML:s}).childNodes[0],u=t.parentNode;t.parentNode.replaceChild(o,t);var a=u.childNodes[0];return setTimeout(function(){a.style.display="block"},1e3),o},vjs.Flash.getEmbedCode=function(e,t,n,r){var i='<object type="application/x-shockwave-flash" ',s="",o="",u="";return t&&vjs.obj.each(t,function(e,t){s+=e+"="+t+"&amp;"}),n=vjs.obj.merge({movie:e,flashvars:s,allowScriptAccess:"always",allowNetworking:"all"},n),vjs.obj.each(n,function(e,t){o+='<param name="'+e+'" value="'+t+'" />'}),r=vjs.obj.merge({data:e,width:"100%",height:"100%"},r),vjs.obj.each(r,function(e,t){u+=e+'="'+t+'" '}),i+u+">"+o+"</object>"},vjs.Flash.streamingFormats={"rtmp/mp4":"MP4","rtmp/flv":"FLV"},vjs.Flash.streamFromParts=function(e,t){return e+"&"+t},vjs.Flash.streamToParts=function(e){var t={connection:"",stream:""};if(!e)return t;var n=e.indexOf("&"),r;return n!==-1?r=n+1:(n=r=e.lastIndexOf("/")+1,n===0&&(n=r=e.length)),t.connection=e.substring(0,n),t.stream=e.substring(r,e.length),t},vjs.Flash.isStreamingType=function(e){return e in vjs.Flash.streamingFormats},vjs.Flash.RTMP_RE=/^rtmp[set]?:\/\//i,vjs.Flash.isStreamingSrc=function(e){return vjs.Flash.RTMP_RE.test(e)},vjs.Flash.rtmpSourceHandler={},vjs.Flash.rtmpSourceHandler.canHandleSource=function(e){return vjs.Flash.isStreamingType(e.type)||vjs.Flash.isStreamingSrc(e.src)?"maybe":""},vjs.Flash.rtmpSourceHandler.handleSource=function(e,t){var n=vjs.Flash.streamToParts(e.src);t.setRtmpConnection(n.connection),t.setRtmpStream(n.stream)},vjs.Flash.registerSourceHandler(vjs.Flash.rtmpSourceHandler),vjs.MediaLoader=vjs.Component.extend({init:function(e,t,n){vjs.Component.call(this,e,t,n);if(!e.options_.sources||e.options_.sources.length===0)for(var r=0,i=e.options_.techOrder;r<i.length;r++){var s=vjs.capitalize(i[r]),o=window.videojs[s];if(o&&o.isSupported()){e.loadTech(s);break}}else e.src(e.options_.sources)}}),vjs.TextTrackMode={disabled:"disabled",hidden:"hidden",showing:"showing"},vjs.TextTrackKind={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},function(){vjs.TextTrack=function(t){var r,i,s,o,u,a,f,l,c,h,p;t=t||{};if(!t.player)throw new Error("A player was not provided.");r=this;if(vjs.IS_IE8){r=document.createElement("custom");for(p in vjs.TextTrack.prototype)r[p]=vjs.TextTrack.prototype[p]}r.player_=t.player,s=vjs.TextTrackMode[t.mode]||"disabled",o=vjs.TextTrackKind[t.kind]||"subtitles",u=t.label||"",a=t.language||t.srclang||"",i=t.id||"vjs_text_track_"+vjs.guid++;if(o==="metadata"||o==="chapters")s="hidden";r.cues_=[],r.activeCues_=[],f=new vjs.TextTrackCueList(r.cues_),l=new vjs.TextTrackCueList(r.activeCues_),h=!1,c=vjs.bind(r,function(){this.activeCues,h&&(this.trigger("cuechange"),h=!1)}),s!=="disabled"&&r.player_.on("timeupdate",c),Object.defineProperty(r,"kind",{get:function(){return o},set:Function.prototype}),Object.defineProperty(r,"label",{get:function(){return u},set:Function.prototype}),Object.defineProperty(r,"language",{get:function(){return a},set:Function.prototype}),Object.defineProperty(r,"id",{get:function(){return i},set:Function.prototype}),Object.defineProperty(r,"mode",{get:function(){return s},set:function(e){if(!vjs.TextTrackMode[e])return;s=e,s==="showing"&&this.player_.on("timeupdate",c),this.trigger("modechange")}}),Object.defineProperty(r,"cues",{get:function(){return this.loaded_?f:null},set:Function.prototype}),Object.defineProperty(r,"activeCues",{get:function(){var e,t,r,i,s;if(!this.loaded_)return null;if(this.cues.length===0)return l;i=this.player_.currentTime(),e=0,t=this.cues.length,r=[];for(;e<t;e++)s=this.cues[e],s.startTime<=i&&s.endTime>=i?r.push(s):s.startTime===s.endTime&&s.startTime<=i&&s.startTime+.5>=i&&r.push(s);h=!1;if(r.length!==this.activeCues_.length)h=!0;else for(e=0;e<r.length;e++)n.call(this.activeCues_,r[e])===-1&&(h=!0);return this.activeCues_=r,l.setCues_(this.activeCues_),l},set:Function.prototype}),t.src?e(t.src,r):r.loaded_=!0;if(vjs.IS_IE8)return r},vjs.TextTrack.prototype=vjs.obj.create(vjs.EventEmitter.prototype),vjs.TextTrack.prototype.constructor=vjs.TextTrack,vjs.TextTrack.prototype.allowedEvents_={cuechange:"cuechange"},vjs.TextTrack.prototype.addCue=function(e){var t=this.player_.textTracks(),n=0;if(t)for(;n<t.length;n++)t[n]!==this&&t[n].removeCue(e);this.cues_.push(e),this.cues.setCues_(this.cues_)},vjs.TextTrack.prototype.removeCue=function(e){var t=0,n=this.cues_.length,r,i=!1;for(;t<n;t++)r=this.cues_[t],r===e&&(this.cues_.splice(t,1),i=!0);i&&this.cues.setCues_(this.cues_)};var e,t,n;e=function(e,n){vjs.xhr(e,vjs.bind(this,function(e,r,i){if(e)return vjs.log.error(e);n.loaded_=!0,t(i,n)}))},t=function(e,n){if(typeof window["WebVTT"]!="function")return window.setTimeout(function(){t(e,n)},25);var r=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder());r.oncue=function(e){n.addCue(e)},r.onparsingerror=function(e){vjs.log.error(e)},r.parse(e),r.flush()},n=function(e,t){var n;if(this==null)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(i===0)return-1;var s=+t||0;Math.abs(s)===Infinity&&(s=0);if(s>=i)return-1;n=Math.max(s>=0?s:i-Math.abs(s),0);while(n<i){if(n in r&&r[n]===e)return n;n++}return-1}}(),vjs.TextTrackList=function(e){var t=this,n,r=0;if(vjs.IS_IE8){t=document.createElement("custom");for(n in vjs.TextTrackList.prototype)t[n]=vjs.TextTrackList.prototype[n]}e=e||[],t.tracks_=[],Object.defineProperty(t,"length",{get:function(){return this.tracks_.length}});for(;r<e.length;r++)t.addTrack_(e[r]);if(vjs.IS_IE8)return t},vjs.TextTrackList.prototype=vjs.obj.create(vjs.EventEmitter.prototype),vjs.TextTrackList.prototype.constructor=vjs.TextTrackList,vjs.TextTrackList.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack"},function(){var e;for(e in vjs.TextTrackList.prototype.allowedEvents_)vjs.TextTrackList.prototype["on"+e]=null}(),vjs.TextTrackList.prototype.addTrack_=function(e){var t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.tracks_[t]}}),e.addEventListener("modechange",vjs.bind(this,function(){this.trigger("change")})),this.tracks_.push(e),this.trigger({type:"addtrack",track:e})},vjs.TextTrackList.prototype.removeTrack_=function(e){var t=0,n=this.length,r=null,i;for(;t<n;t++){i=this[t];if(i===e){this.tracks_.splice(t,1);break}}this.trigger({type:"removetrack",track:e})},vjs.TextTrackList.prototype.getTrackById=function(e){var t=0,n=this.length,r=null,i;for(;t<n;t++){i=this[t];if(i.id===e){r=i;break}}return r},vjs.TextTrackCueList=function(e){var t=this,n;if(vjs.IS_IE8){t=document.createElement("custom");for(n in vjs.TextTrackCueList.prototype)t[n]=vjs.TextTrackCueList.prototype[n]}vjs.TextTrackCueList.prototype.setCues_.call(t,e),Object.defineProperty(t,"length",{get:function(){return this.length_}});if(vjs.IS_IE8)return t},vjs.TextTrackCueList.prototype.setCues_=function(e){var t=this.length||0,n=0,r=e.length,i;this.cues_=e,this.length_=e.length,i=function(e){""+e in this||Object.defineProperty(this,""+e,{get:function(){return this.cues_[e]}})};if(t<r){n=t;for(;n<r;n++)i.call(this,n)}},vjs.TextTrackCueList.prototype.getCueById=function(e){var t=0,n=this.length,r=null,i;for(;t<n;t++){i=this[t];if(i.id===e){r=i;break}}return r},function(){vjs.TextTrackDisplay=vjs.Component.extend({init:function(e,t,n){vjs.Component.call(this,e,t,n),e.on("loadstart",vjs.bind(this,this.toggleDisplay)),e.ready(vjs.bind(this,function(){if(e.tech&&e.tech.featuresNativeTextTracks){this.hide();return}var t,n,r;e.on("fullscreenchange",vjs.bind(this,this.updateDisplay)),n=e.options_.tracks||[];for(t=0;t<n.length;t++)r=n[t],this.player_.addRemoteTextTrack(r)}))}}),vjs.TextTrackDisplay.prototype.toggleDisplay=function(){this.player_.tech&&this.player_.tech.featuresNativeTextTracks?this.hide():this.show()},vjs.TextTrackDisplay.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"})},vjs.TextTrackDisplay.prototype.clearDisplay=function(){typeof window["WebVTT"]=="function"&&window.WebVTT.processCues(window,[],this.el_)};var e=function(e,t){return"rgba("+parseInt(e[1]+e[1],16)+","+parseInt(e[2]+e[2],16)+","+parseInt(e[3]+e[3],16)+","+t+")"},t="#222",n="#ccc",r={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'},i=function(e,t,n){try{e.style[t]=n}catch(r){}};vjs.TextTrackDisplay.prototype.updateDisplay=function(){var e=this.player_.textTracks(),t=0,n;this.clearDisplay();if(!e)return;for(;t<e.length;t++)n=e[t],n.mode==="showing"&&this.updateForTrack(n)},vjs.TextTrackDisplay.prototype.updateForTrack=function(s){if(typeof window.WebVTT!="function"||!s.activeCues)return;var o=0,u,a,f=this.player_.textTrackSettings.getValues(),l,c=[];for(;o<s.activeCues.length;o++)c.push(s.activeCues[o]);window.WebVTT.processCues(window,s.activeCues,this.el_),o=c.length;while(o--)a=c[o].displayState,f.color&&(a.firstChild.style.color=f.color),f.textOpacity&&i(a.firstChild,"color",e(f.color||"#fff",f.textOpacity)),f.backgroundColor&&(a.firstChild.style.backgroundColor=f.backgroundColor),f.backgroundOpacity&&i(a.firstChild,"backgroundColor",e(f.backgroundColor||"#000",f.backgroundOpacity)),f.windowColor&&(f.windowOpacity?i(a,"backgroundColor",e(f.windowColor,f.windowOpacity)):a.style.backgroundColor=f.windowColor),f.edgeStyle&&(f.edgeStyle==="dropshadow"?a.firstChild.style.textShadow="2px 2px 3px "+t+", 2px 2px 4px "+t+", 2px 2px 5px "+t:f.edgeStyle==="raised"?a.firstChild.style.textShadow="1px 1px "+t+", 2px 2px "+t+", 3px 3px "+t:f.edgeStyle==="depressed"?a.firstChild.style.textShadow="1px 1px "+n+", 0 1px "+n+", -1px -1px "+t+", 0 -1px "+t:f.edgeStyle==="uniform"&&(a.firstChild.style.textShadow="0 0 4px "+t+", 0 0 4px "+t+", 0 0 4px "+t+", 0 0 4px "+t)),f.fontPercent&&f.fontPercent!==1&&(l=window.parseFloat(a.style.fontSize),a.style.fontSize=l*f.fontPercent+"px",a.style.height="auto",a.style.top="auto",a.style.bottom="2px"),f.fontFamily&&f.fontFamily!=="default"&&(f.fontFamily==="small-caps"?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=r[f.fontFamily])},vjs.TextTrackMenuItem=vjs.MenuItem.extend({init:function(e,t){var n=this.track=t.track,r=e.textTracks(),i,s;r&&(i=vjs.bind(this,function(){var e=this.track.mode==="showing",t,n,i;if(this instanceof vjs.OffTextTrackMenuItem){e=!0,n=0,i=r.length;for(;n<i;n++){t=r[n];if(t.kind===this.track.kind&&t.mode==="showing"){e=!1;break}}}this.selected(e)}),r.addEventListener("change",i),e.on("dispose",function(){r.removeEventListener("change",i)})),t.label=n.label||n.language||"Unknown",t.selected=n["default"]||n.mode==="showing",vjs.MenuItem.call(this,e,t),r&&r.onchange===undefined&&this.on(["tap","click"],function(){if(typeof window.Event!="object")try{s=new window.Event("change")}catch(e){}s||(s=document.createEvent("Event"),s.initEvent("change",!0,!0)),r.dispatchEvent(s)})}}),vjs.TextTrackMenuItem.prototype.onClick=function(){var e=this.track.kind,t=this.player_.textTracks(),n,r,i=0;vjs.MenuItem.prototype.onClick.call(this);if(!t)return;for(;i<t.length;i++){r=t[i];if(r.kind!==e)continue;r===this.track?r.mode="showing":r.mode="disabled"}},vjs.OffTextTrackMenuItem=vjs.TextTrackMenuItem.extend({init:function(e,t){t.track={kind:t.kind,player:e,label:t.kind+" off","default":!1,mode:"disabled"},vjs.TextTrackMenuItem.call(this,e,t),this.selected(!0)}}),vjs.CaptionSettingsMenuItem=vjs.TextTrackMenuItem.extend({init:function(e,t){t.track={kind:t.kind,player:e,label:t.kind+" settings","default":!1,mode:"disabled"},vjs.TextTrackMenuItem.call(this,e,t),this.addClass("vjs-texttrack-settings")}}),vjs.CaptionSettingsMenuItem.prototype.onClick=function(){this.player().getChild("textTrackSettings").show()},vjs.TextTrackButton=vjs.MenuButton.extend({init:function(e,t){var n,r;vjs.MenuButton.call(this,e,t),n=this.player_.textTracks(),this.items.length<=1&&this.hide();if(!n)return;r=vjs.bind(this,this.update),n.addEventListener("removetrack",r),n.addEventListener("addtrack",r),this.player_.on("dispose",function(){n.removeEventListener("removetrack",r),n.removeEventListener("addtrack",r)})}}),vjs.TextTrackButton.prototype.createItems=function(){var e=[],t,n;this instanceof vjs.CaptionsButton&&(!this.player().tech||!this.player().tech.featuresNativeTextTracks)&&e.push(new vjs.CaptionSettingsMenuItem(this.player_,{kind:this.kind_})),e.push(new vjs.OffTextTrackMenuItem(this.player_,{kind:this.kind_})),n=this.player_.textTracks();if(!n)return e;for(var r=0;r<n.length;r++)t=n[r],t.kind===this.kind_&&e.push(new vjs.TextTrackMenuItem(this.player_,{track:t}));return e},vjs.CaptionsButton=vjs.TextTrackButton.extend({init:function(e,t,n){vjs.TextTrackButton.call(this,e,t,n),this.el_.setAttribute("aria-label","Captions Menu")}}),vjs.CaptionsButton.prototype.kind_="captions",vjs.CaptionsButton.prototype.buttonText="Captions",vjs.CaptionsButton.prototype.className="vjs-captions-button",vjs.CaptionsButton.prototype.update=function(){var e=2;vjs.TextTrackButton.prototype.update.call(this),this.player().tech&&this.player().tech.featuresNativeTextTracks&&(e=1),this.items&&this.items.length>e?this.show():this.hide()},vjs.SubtitlesButton=vjs.TextTrackButton.extend({init:function(e,t,n){vjs.TextTrackButton.call(this,e,t,n),this.el_.setAttribute("aria-label","Subtitles Menu")}}),vjs.SubtitlesButton.prototype.kind_="subtitles",vjs.SubtitlesButton.prototype.buttonText="Subtitles",vjs.SubtitlesButton.prototype.className="vjs-subtitles-button",vjs.ChaptersButton=vjs.TextTrackButton.extend({init:function(e,t,n){vjs.TextTrackButton.call(this,e,t,n),this.el_.setAttribute("aria-label","Chapters Menu")}}),vjs.ChaptersButton.prototype.kind_="chapters",vjs.ChaptersButton.prototype.buttonText="Chapters",vjs.ChaptersButton.prototype.className="vjs-chapters-button",vjs.ChaptersButton.prototype.createItems=function(){var e=[],t,n;n=this.player_.textTracks();if(!n)return e;for(var r=0;r<n.length;r++)t=n[r],t.kind===this.kind_&&e.push(new vjs.TextTrackMenuItem(this.player_,{track:t}));return e},vjs.ChaptersButton.prototype.createMenu=function(){var e=this.player_.textTracks()||[],t=0,n=e.length,r,i,s=this.items=[];for(;t<n;t++){r=e[t];if(r["kind"]==this.kind_){if(!!r.cues){i=r;break}r.mode="hidden",window.setTimeout(vjs.bind(this,function(){this.createMenu()}),100)}}var o=this.menu;o===undefined&&(o=new vjs.Menu(this.player_),o.contentEl().appendChild(vjs.createEl("li",{className:"vjs-menu-title",innerHTML:vjs.capitalize(this.kind_),tabindex:-1})));if(i){var u=i.cues,a,f;t=0,n=u.length;for(;t<n;t++)a=u[t],f=new vjs.ChaptersTrackMenuItem(this.player_,{track:i,cue:a}),s.push(f),o.addChild(f);this.addChild(o)}return this.items.length>0&&this.show(),o},vjs.ChaptersTrackMenuItem=vjs.MenuItem.extend({init:function(e,t){var n=this.track=t.track,r=this.cue=t.cue,i=e.currentTime();t.label=r.text,t.selected=r.startTime<=i&&i<r.endTime,vjs.MenuItem.call(this,e,t),n.addEventListener("cuechange",vjs.bind(this,this.update))}}),vjs.ChaptersTrackMenuItem.prototype.onClick=function(){vjs.MenuItem.prototype.onClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},vjs.ChaptersTrackMenuItem.prototype.update=function(){var e=this.cue,t=this.player_.currentTime();this.selected(e.startTime<=t&&t<e.endTime)}}(),function(){function e(e){var t;return e.selectedOptions?t=e.selectedOptions[0]:e.options&&(t=e.options[e.options.selectedIndex]),t.value}function t(e,t){var n,r;if(!t)return;for(n=0;n<e.options.length;n++){r=e.options[n];if(r.value===t)break}e.selectedIndex=n}function n(){return'<div class="vjs-tracksettings"><div class="vjs-tracksettings-colors"><div class="vjs-fg-color vjs-tracksetting"><label class="vjs-label">Foreground</label><select><option value="">---</option><option value="#FFF">White</option><option value="#000">Black</option><option value="#F00">Red</option><option value="#0F0">Green</option><option value="#00F">Blue</option><option value="#FF0">Yellow</option><option value="#F0F">Magenta</option><option value="#0FF">Cyan</option></select><span class="vjs-text-opacity vjs-opacity"><select><option value="">---</option><option value="1">Opaque</option><option value="0.5">Semi-Opaque</option></select></span></div><div class="vjs-bg-color vjs-tracksetting"><label class="vjs-label">Background</label><select><option value="">---</option><option value="#FFF">White</option><option value="#000">Black</option><option value="#F00">Red</option><option value="#0F0">Green</option><option value="#00F">Blue</option><option value="#FF0">Yellow</option><option value="#F0F">Magenta</option><option value="#0FF">Cyan</option></select><span class="vjs-bg-opacity vjs-opacity"><select><option value="">---</option><option value="1">Opaque</option><option value="0.5">Semi-Transparent</option><option value="0">Transparent</option></select></span></div><div class="window-color vjs-tracksetting"><label class="vjs-label">Window</label><select><option value="">---</option><option value="#FFF">White</option><option value="#000">Black</option><option value="#F00">Red</option><option value="#0F0">Green</option><option value="#00F">Blue</option><option value="#FF0">Yellow</option><option value="#F0F">Magenta</option><option value="#0FF">Cyan</option></select><span class="vjs-window-opacity vjs-opacity"><select><option value="">---</option><option value="1">Opaque</option><option value="0.5">Semi-Transparent</option><option value="0">Transparent</option></select></span></div></div><div class="vjs-tracksettings-font"><div class="vjs-font-percent vjs-tracksetting"><label class="vjs-label">Font Size</label><select><option value="0.50">50%</option><option value="0.75">75%</option><option value="1.00" selected>100%</option><option value="1.25">125%</option><option value="1.50">150%</option><option value="1.75">175%</option><option value="2.00">200%</option><option value="3.00">300%</option><option value="4.00">400%</option></select></div><div class="vjs-edge-style vjs-tracksetting"><label class="vjs-label">Text Edge Style</label><select><option value="none">None</option><option value="raised">Raised</option><option value="depressed">Depressed</option><option value="uniform">Uniform</option><option value="dropshadow">Dropshadow</option></select></div><div class="vjs-font-family vjs-tracksetting"><label class="vjs-label">Font Family</label><select><option value="">Default</option><option value="monospaceSerif">Monospace Serif</option><option value="proportionalSerif">Proportional Serif</option><option value="monospaceSansSerif">Monospace Sans-Serif</option><option value="proportionalSansSerif">Proportional Sans-Serif</option><option value="casual">Casual</option><option value="script">Script</option><option value="small-caps">Small Caps</option></select></div></div></div><div class="vjs-tracksettings-controls"><button class="vjs-default-button">Defaults</button><button class="vjs-done-button">Done</button></div>'}vjs.TextTrackSettings=vjs.Component.extend({init:function(e,t){vjs.Component.call(this,e,t),this.hide(),vjs.on(this.el().querySelector(".vjs-done-button"),"click",vjs.bind(this,function(){this.saveSettings(),this.hide()})),vjs.on(this.el().querySelector(".vjs-default-button"),"click",vjs.bind(this,function(){this.el().querySelector(".vjs-fg-color > select").selectedIndex=0,this.el().querySelector(".vjs-bg-color > select").selectedIndex=0,this.el().querySelector(".window-color > select").selectedIndex=0,this.el().querySelector(".vjs-text-opacity > select").selectedIndex=0,this.el().querySelector(".vjs-bg-opacity > select").selectedIndex=0,this.el().querySelector(".vjs-window-opacity > select").selectedIndex=0,this.el().querySelector(".vjs-edge-style select").selectedIndex=0,this.el().querySelector(".vjs-font-family select").selectedIndex=0,this.el().querySelector(".vjs-font-percent select").selectedIndex=2,this.updateDisplay()})),vjs.on(this.el().querySelector(".vjs-fg-color > select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".vjs-bg-color > select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".window-color > select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".vjs-text-opacity > select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".vjs-bg-opacity > select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".vjs-window-opacity > select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".vjs-font-percent select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".vjs-edge-style select"),"change",vjs.bind(this,this.updateDisplay)),vjs.on(this.el().querySelector(".vjs-font-family select"),"change",vjs.bind(this,this.updateDisplay)),e.options().persistTextTrackSettings&&this.restoreSettings()}}),vjs.TextTrackSettings.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-caption-settings vjs-modal-overlay",innerHTML:n()})},vjs.TextTrackSettings.prototype.getValues=function(){var t,n,r,i,s,o,u,a,f,l,c,h;t=this.el(),s=e(t.querySelector(".vjs-edge-style select")),o=e(t.querySelector(".vjs-font-family select")),u=e(t.querySelector(".vjs-fg-color > select")),r=e(t.querySelector(".vjs-text-opacity > select")),a=e(t.querySelector(".vjs-bg-color > select")),n=e(t.querySelector(".vjs-bg-opacity > select")),f=e(t.querySelector(".window-color > select")),i=e(t.querySelector(".vjs-window-opacity > select")),h=window.parseFloat(e(t.querySelector(".vjs-font-percent > select"))),l={backgroundOpacity:n,textOpacity:r,windowOpacity:i,edgeStyle:s,fontFamily:o,color:u,backgroundColor:a,windowColor:f,fontPercent:h};for(c in l)(l[c]===""||l[c]==="none"||c==="fontPercent"&&l[c]===1)&&delete l[c];return l},vjs.TextTrackSettings.prototype.setValues=function(e){var n=this.el(),r;t(n.querySelector(".vjs-edge-style select"),e.edgeStyle),t(n.querySelector(".vjs-font-family select"),e.fontFamily),t(n.querySelector(".vjs-fg-color > select"),e.color),t(n.querySelector(".vjs-text-opacity > select"),e.textOpacity),t(n.querySelector(".vjs-bg-color > select"),e.backgroundColor),t(n.querySelector(".vjs-bg-opacity > select"),e.backgroundOpacity),t(n.querySelector(".window-color > select"),e.windowColor),t(n.querySelector(".vjs-window-opacity > select"),e.windowOpacity),r=e.fontPercent,r&&(r=r.toFixed(2)),t(n.querySelector(".vjs-font-percent > select"),r)},vjs.TextTrackSettings.prototype.restoreSettings=function(){var e;try{e=JSON.parse(window.localStorage.getItem("vjs-text-track-settings"))}catch(t){}e&&this.setValues(e)},vjs.TextTrackSettings.prototype.saveSettings=function(){var e;if(!this.player_.options().persistTextTrackSettings)return;e=this.getValues();try{vjs.isEmpty(e)?window.localStorage.removeItem("vjs-text-track-settings"):window.localStorage.setItem("vjs-text-track-settings",JSON.stringify(e))}catch(t){}},vjs.TextTrackSettings.prototype.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}}(),vjs.JSON;if(typeof window.JSON!="undefined"&&typeof window.JSON.parse=="function")vjs.JSON=window.JSON;else{vjs.JSON={};var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;vjs.JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse(): invalid or malformed JSON data")}}vjs.autoSetup=function(){var e,t,n,r,i,s=document.getElementsByTagName("video"),o=document.getElementsByTagName("audio"),u=[];if(s&&s.length>0)for(r=0,i=s.length;r<i;r++)u.push(s[r]);if(o&&o.length>0)for(r=0,i=o.length;r<i;r++)u.push(o[r]);if(u&&u.length>0)for(r=0,i=u.length;r<i;r++){t=u[r];if(!t||!t.getAttribute){vjs.autoSetupTimeout(1);break}t.player===undefined&&(e=t.getAttribute("data-setup"),e!==null&&(n=videojs(t)))}else vjs.windowLoaded||vjs.autoSetupTimeout(1)},vjs.autoSetupTimeout=function(e){setTimeout(vjs.autoSetup,e)},document.readyState==="complete"?vjs.windowLoaded=!0:vjs.one(window,"load",function(){vjs.windowLoaded=!0}),vjs.autoSetupTimeout(1),vjs.plugin=function(e,t){vjs.Player.prototype[e]=t},function(e){var t=e.vttjs={},n=t.VTTCue,r=t.VTTRegion,i=e.VTTCue,s=e.VTTRegion;t.shim=function(){t.VTTCue=n,t.VTTRegion=r},t.restore=function(){t.VTTCue=i,t.VTTRegion=s}}(this),function(e,t){function s(e){if(typeof e!="string")return!1;var t=r[e.toLowerCase()];return t?e.toLowerCase():!1}function o(e){if(typeof e!="string")return!1;var t=i[e.toLowerCase()];return t?e.toLowerCase():!1}function u(e){var t=1;for(;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function a(e,t,r){var i=this,a=/MSIE\s8\.0/.test(navigator.userAgent),f={};a?i=document.createElement("custom"):f.enumerable=!0,i.hasBeenReset=!1;var l="",c=!1,h=e,p=t,d=r,v=null,m="",g=!0,y="auto",b="start",w=50,E="middle",S=50,x="middle";Object.defineProperty(i,"id",u({},f,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(i,"pauseOnExit",u({},f,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(i,"startTime",u({},f,{get:function(){return h},set:function(e){if(typeof e!="number")throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"endTime",u({},f,{get:function(){return p},set:function(e){if(typeof e!="number")throw new TypeError("End time must be set to a number.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"text",u({},f,{get:function(){return d},set:function(e){d=""+e,this.hasBeenReset=!0}})),Object.defineProperty(i,"region",u({},f,{get:function(){return v},set:function(e){v=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"vertical",u({},f,{get:function(){return m},set:function(e){var t=s(e);if(t===!1)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"snapToLines",u({},f,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(i,"line",u({},f,{get:function(){return y},set:function(e){if(typeof e!="number"&&e!==n)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"lineAlign",u({},f,{get:function(){return b},set:function(e){var t=o(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"position",u({},f,{get:function(){return w},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"positionAlign",u({},f,{get:function(){return E},set:function(e){var t=o(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"size",u({},f,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(i,"align",u({},f,{get:function(){return x},set:function(e){var t=o(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");x=t,this.hasBeenReset=!0}})),i.displayState=undefined;if(a)return i}var n="auto",r={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};a.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.VTTCue=e.VTTCue||a,t.VTTCue=a}(this,this.vttjs||{}),function(e,t){function r(e){if(typeof e!="string")return!1;var t=n[e.toLowerCase()];return t?e.toLowerCase():!1}function i(e){return typeof e=="number"&&e>=0&&e<=100}function s(){var e=100,t=3,n=0,s=100,o=0,u=100,a="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!i(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if(typeof e!="number")throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!i(e))throw new Error("RegionAnchorX must be between 0 and 100.");s=e}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!i(e))throw new Error("RegionAnchorY must be between 0 and 100.");n=e}},viewportAnchorY:{enumerable:!0,get:function(){return u},set:function(e){if(!i(e))throw new Error("ViewportAnchorY must be between 0 and 100.");u=e}},viewportAnchorX:{enumerable:!0,get:function(){return o},set:function(e){if(!i(e))throw new Error("ViewportAnchorX must be between 0 and 100.");o=e}},scroll:{enumerable:!0,get:function(){return a},set:function(e){var t=r(e);if(t===!1)throw new SyntaxError("An invalid or illegal string was specified.");a=t}}})}var n={"":!0,up:!0};e.VTTRegion=e.VTTRegion||s,t.VTTRegion=s}(this,this.vttjs||{}),function(e){function n(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function r(e){function t(e,t,n,r){return(e|0)*3600+(t|0)*60+(n|0)+(r|0)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function i(){this.values=t(null)}function s(e,t,n,r){var i=r?e.split(r):[e];for(var s in i){if(typeof i[s]!="string")continue;var o=i[s].split(n);if(o.length!==2)continue;var u=o[0],a=o[1];t(u,a)}}function o(e,t,o){function a(){var t=r(e);if(t===null)throw new n(n.Errors.BadTimeStamp,"Malformed timestamp: "+u);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function f(e,t){var n=new i;s(e,function(e,t){switch(e){case"region":for(var r=o.length-1;r>=0;r--)if(o[r].id===t){n.set(e,o[r].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var i=t.split(","),s=i[0];n.integer(e,s),n.percent(e,s)?n.set("snapToLines",!1):null,n.alt(e,s,["auto"]),i.length===2&&n.alt("lineAlign",i[1],["start","middle","end"]);break;case"position":i=t.split(","),n.percent(e,i[0]),i.length===2&&n.alt("positionAlign",i[1],["start","middle","end"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start","middle","end","left","right"])}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical",""),t.line=n.get("line","auto"),t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align","middle"),t.position=n.get("position",{start:0,left:0,middle:50,end:100,right:100},t.align),t.positionAlign=n.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},t.align)}function l(){e=e.replace(/^\s+/,"")}var u=e;l(),t.startTime=a(),l();if(e.substr(0,3)!=="-->")throw new n(n.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+u);e=e.substr(3),l(),t.endTime=a(),l(),f(e,t)}function c(e,t){function n(){function e(e){return t=t.substr(e.length),e}if(!t)return null;var n=t.match(/^([^<]*)(<[^>]+>?)?/);return e(n[1]?n[1]:n[2])}function i(e){return u[e]}function s(e){while(y=e.match(/&(amp|lt|gt|lrm|rlm|nbsp);/))e=e.replace(y[0],i);return e}function o(e,t){return!l[t.localName]||l[t.localName]===e.localName}function c(t,n){var r=a[t];if(!r)return null;var i=e.document.createElement(r);i.localName=r;var s=f[t];return s&&n&&(i[s]=n.trim()),i}var h=e.document.createElement("div"),p=h,d,v=[];while((d=n())!==null){if(d[0]==="<"){if(d[1]==="/"){v.length&&v[v.length-1]===d.substr(2).replace(">","")&&(v.pop(),p=p.parentNode);continue}var m=r(d.substr(1,d.length-2)),g;if(m){g=e.document.createProcessingInstruction("timestamp",m),p.appendChild(g);continue}var y=d.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!y)continue;g=c(y[1],y[3]);if(!g)continue;if(!o(p,g))continue;y[2]&&(g.className=y[2].substr(1).replace("."," ")),v.push(y[1]),p.appendChild(g),p=g;continue}p.appendChild(e.document.createTextNode(s(d)))}return h}function p(e){function i(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function s(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var r=n.match(/^.*(\n|\r)/);return r?(e.length=0,r[0]):n}if(t.tagName==="ruby")return s(e);if(t.childNodes)return i(e,t),s(e)}var t=[],n="",r;if(!e||!e.childNodes)return"ltr";i(t,e);while(n=s(t))for(var o=0;o<n.length;o++){r=n.charCodeAt(o);for(var u=0;u<h.length;u++)if(h[u]===r)return"rtl"}return"ltr"}function d(e){if(typeof e.line=="number"&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;var t=e.track,n=t.textTrackList,r=0;for(var i=0;i<n.length&&n[i]!==t;i++)n[i].mode==="showing"&&r++;return++r*-1}function v(){}function m(e,t,n){var r=/MSIE\s8\.0/.test(navigator.userAgent),i="rgba(255, 255, 255, 1)",s="rgba(0, 0, 0, 0.8)";r&&(i="rgb(255, 255, 255)",s="rgb(0, 0, 0)"),v.call(this),this.cue=t,this.cueDiv=c(e,t.text);var o={color:i,backgroundColor:s,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};r||(o.writingMode=t.vertical===""?"horizontal-tb":t.vertical==="lr"?"vertical-lr":"vertical-rl",o.unicodeBidi="plaintext"),this.applyStyles(o,this.cueDiv),this.div=e.document.createElement("div"),o={textAlign:t.align==="middle"?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},r||(o.direction=p(this.cueDiv),o.writingMode=t.vertical===""?"horizontal-tb":t.vertical==="lr"?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(o),this.div.appendChild(this.cueDiv);var u=0;switch(t.positionAlign){case"start":u=t.position;break;case"middle":u=t.position-t.size/2;break;case"end":u=t.position-t.size}t.vertical===""?this.applyStyles({left:this.formatStyle(u,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(u,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function g(e){var t=/MSIE\s8\.0/.test(navigator.userAgent),n,r,i,s;if(e.div){r=e.div.offsetHeight,i=e.div.offsetWidth,s=e.div.offsetTop;var o=(o=e.div.childNodes)&&(o=o[0])&&o.getClientRects&&o.getClientRects();e=e.div.getBoundingClientRect(),n=o?Math.max(o[0]&&o[0].height||0,e.height/o.length):0}this.left=e.left,this.right=e.right,this.top=e.top||s,this.height=e.height||r,this.bottom=e.bottom||s+(e.height||r),this.width=e.width||i,this.lineHeight=n!==undefined?n:e.lineHeight,t&&!this.lineHeight&&(this.lineHeight=13)}function y(e,t,n,r){function i(e,t){var i,s=new g(e),o=1;for(var u=0;u<t.length;u++){while(e.overlapsOppositeAxis(n,t[u])||e.within(n)&&e.overlapsAny(r))e.move(t[u]);if(e.within(n))return e;var a=e.intersectPercentage(n);o>a&&(i=new g(e),o=a),e=new g(s)}return i||s}var s=new g(t),o=t.cue,u=d(o),a=[];if(o.snapToLines){var f;switch(o.vertical){case"":a=["+y","-y"],f="height";break;case"rl":a=["+x","-x"],f="width";break;case"lr":a=["-x","+x"],f="width"}var l=s.lineHeight,c=l*Math.round(u),h=n[f]+l,p=a[0];Math.abs(c)>h&&(c=c<0?-1:1,c*=Math.ceil(h/l)*l),u<0&&(c+=o.vertical===""?n.height:n.width,a=a.reverse()),s.move(p,c)}else{var v=s.lineHeight/n.height*100;switch(o.lineAlign){case"middle":u-=v/2;break;case"end":u-=v}switch(o.vertical){case"":t.applyStyles({top:t.formatStyle(u,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(u,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(u,"%")})}a=["+y","-x","+x","-y"],s=new g(t)}var m=i(s,a);t.move(m.toCSSCompatValues(n))}function b(){}var t=Object.create||function(){function e(){}return function(t){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();n.prototype=t(Error.prototype),n.prototype.constructor=n,n.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},i.prototype={set:function(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){var n;if(n=t.match(/^([\d]{1,3})(\.[\d]*)?%$/)){t=parseFloat(t);if(t>=0&&t<=100)return this.set(e,t),!0}return!1}};var u={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},a={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},f={v:"title",lang:"lang"},l={rt:"ruby"},h=[1470,1472,1475,1478,1488,1489,1490,1491,1492,1493,1494,1495,1496,1497,1498,1499,1500,1501,1502,1503,1504,1505,1506,1507,1508,1509,1510,1511,1512,1513,1514,1520,1521,1522,1523,1524,1544,1547,1549,1563,1566,1567,1568,1569,1570,1571,1572,1573,1574,1575,1576,1577,1578,1579,1580,1581,1582,1583,1584,1585,1586,1587,1588,1589,1590,1591,1592,1593,1594,1595,1596,1597,1598,1599,1600,1601,1602,1603,1604,1605,1606,1607,1608,1609,1610,1645,1646,1647,1649,1650,1651,1652,1653,1654,1655,1656,1657,1658,1659,1660,1661,1662,1663,1664,1665,1666,1667,1668,1669,1670,1671,1672,1673,1674,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1690,1691,1692,1693,1694,1695,1696,1697,1698,1699,1700,1701,1702,1703,1704,1705,1706,1707,1708,1709,1710,1711,1712,1713,1714,1715,1716,1717,1718,1719,1720,1721,1722,1723,1724,1725,1726,1727,1728,1729,1730,1731,1732,1733,1734,1735,1736,1737,1738,1739,1740,1741,1742,1743,1744,1745,1746,1747,1748,1749,1765,1766,1774,1775,1786,1787,1788,1789,1790,1791,1792,1793,1794,1795,1796,1797,1798,1799,1800,1801,1802,1803,1804,1805,1807,1808,1810,1811,1812,1813,1814,1815,1816,1817,1818,1819,1820,1821,1822,1823,1824,1825,1826,1827,1828,1829,1830,1831,1832,1833,1834,1835,1836,1837,1838,1839,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1969,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2036,2037,2042,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2074,2084,2088,2096,2097,2098,2099,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2112,2113,2114,2115,2116,2117,2118,2119,2120,2121,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,2133,2134,2135,2136,2142,2208,2210,2211,2212,2213,2214,2215,2216,2217,2218,2219,2220,8207,64285,64287,64288,64289,64290,64291,64292,64293,64294,64295,64296,64298,64299,64300,64301,64302,64303,64304,64305,64306,64307,64308,64309,64310,64312,64313,64314,64315,64316,64318,64320,64321,64323,64324,64326,64327,64328,64329,64330,64331,64332,64333,64334,64335,64336,64337,64338,64339,64340,64341,64342,64343,64344,64345,64346,64347,64348,64349,64350,64351,64352,64353,64354,64355,64356,64357,64358,64359,64360,64361,64362,64363,64364,64365,64366,64367,64368,64369,64370,64371,64372,64373,64374,64375,64376,64377,64378,64379,64380,64381,64382,64383,64384,64385,64386,64387,64388,64389,64390,64391,64392,64393,64394,64395,64396,64397,64398,64399,64400,64401,64402,64403,64404,64405,64406,64407,64408,64409,64410,64411,64412,64413,64414,64415,64416,64417,64418,64419,64420,64421,64422,64423,64424,64425,64426,64427,64428,64429,64430,64431,64432,64433,64434,64435,64436,64437,64438,64439,64440,64441,64442,64443,64444,64445,64446,64447,64448,64449,64467,64468,64469,64470,64471,64472,64473,64474,64475,64476,64477,64478,64479,64480,64481,64482,64483,64484,64485,64486,64487,64488,64489,64490,64491,64492,64493,64494,64495,64496,64497,64498,64499,64500,64501,64502,64503,64504,64505,64506,64507,64508,64509,64510,64511,64512,64513,64514,64515,64516,64517,64518,64519,64520,64521,64522,64523,64524,64525,64526,64527,64528,64529,64530,64531,64532,64533,64534,64535,64536,64537,64538,64539,64540,64541,64542,64543,64544,64545,64546,64547,64548,64549,64550,64551,64552,64553,64554,64555,64556,64557,64558,64559,64560,64561,64562,64563,64564,64565,64566,64567,64568,64569,64570,64571,64572,64573,64574,64575,64576,64577,64578,64579,64580,64581,64582,64583,64584,64585,64586,64587,64588,64589,64590,64591,64592,64593,64594,64595,64596,64597,64598,64599,64600,64601,64602,64603,64604,64605,64606,64607,64608,64609,64610,64611,64612,64613,64614,64615,64616,64617,64618,64619,64620,64621,64622,64623,64624,64625,64626,64627,64628,64629,64630,64631,64632,64633,64634,64635,64636,64637,64638,64639,64640,64641,64642,64643,64644,64645,64646,64647,64648,64649,64650,64651,64652,64653,64654,64655,64656,64657,64658,64659,64660,64661,64662,64663,64664,64665,64666,64667,64668,64669,64670,64671,64672,64673,64674,64675,64676,64677,64678,64679,64680,64681,64682,64683,64684,64685,64686,64687,64688,64689,64690,64691,64692,64693,64694,64695,64696,64697,64698,64699,64700,64701,64702,64703,64704,64705,64706,64707,64708,64709,64710,64711,64712,64713,64714,64715,64716,64717,64718,64719,64720,64721,64722,64723,64724,64725,64726,64727,64728,64729,64730,64731,64732,64733,64734,64735,64736,64737,64738,64739,64740,64741,64742,64743,64744,64745,64746,64747,64748,64749,64750,64751,64752,64753,64754,64755,64756,64757,64758,64759,64760,64761,64762,64763,64764,64765,64766,64767,64768,64769,64770,64771,64772,64773,64774,64775,64776,64777,64778,64779,64780,64781,64782,64783,64784,64785,64786,64787,64788,64789,64790,64791,64792,64793,64794,64795,64796,64797,64798,64799,64800,64801,64802,64803,64804,64805,64806,64807,64808,64809,64810,64811,64812,64813,64814,64815,64816,64817,64818,64819,64820,64821,64822,64823,64824,64825,64826,64827,64828,64829,64848,64849,64850,64851,64852,64853,64854,64855,64856,64857,64858,64859,64860,64861,64862,64863,64864,64865,64866,64867,64868,64869,64870,64871,64872,64873,64874,64875,64876,64877,64878,64879,64880,64881,64882,64883,64884,64885,64886,64887,64888,64889,64890,64891,64892,64893,64894,64895,64896,64897,64898,64899,64900,64901,64902,64903,64904,64905,64906,64907,64908,64909,64910,64911,64914,64915,64916,64917,64918,64919,64920,64921,64922,64923,64924,64925,64926,64927,64928,64929,64930,64931,64932,64933,64934,64935,64936,64937,64938,64939,64940,64941,64942,64943,64944,64945,64946,64947,64948,64949,64950,64951,64952,64953,64954,64955,64956,64957,64958,64959,64960,64961,64962,64963,64964,64965,64966,64967,65008,65009,65010,65011,65012,65013,65014,65015,65016,65017,65018,65019,65020,65136,65137,65138,65139,65140,65142,65143,65144,65145,65146,65147,65148,65149,65150,65151,65152,65153,65154,65155,65156,65157,65158,65159,65160,65161,65162,65163,65164,65165,65166,65167,65168,65169,65170,65171,65172,65173,65174,65175,65176,65177,65178,65179,65180,65181,65182,65183,65184,65185,65186,65187,65188,65189,65190,65191,65192,65193,65194,65195,65196,65197,65198,65199,65200,65201,65202,65203,65204,65205,65206,65207,65208,65209,65210,65211,65212,65213,65214,65215,65216,65217,65218,65219,65220,65221,65222,65223,65224,65225,65226,65227,65228,65229,65230,65231,65232,65233,65234,65235,65236,65237,65238,65239,65240,65241,65242,65243,65244,65245,65246,65247,65248,65249,65250,65251,65252,65253,65254,65255,65256,65257,65258,65259,65260,65261,65262,65263,65264,65265,65266,65267,65268,65269,65270,65271,65272,65273,65274,65275,65276,67584,67585,67586,67587,67588,67589,67592,67594,67595,67596,67597,67598,67599,67600,67601,67602,67603,67604,67605,67606,67607,67608,67609,67610,67611,67612,67613,67614,67615,67616,67617,67618,67619,67620,67621,67622,67623,67624,67625,67626,67627,67628,67629,67630,67631,67632,67633,67634,67635,67636,67637,67639,67640,67644,67647,67648,67649,67650,67651,67652,67653,67654,67655,67656,67657,67658,67659,67660,67661,67662,67663,67664,67665,67666,67667,67668,67669,67671,67672,67673,67674,67675,67676,67677,67678,67679,67840,67841,67842,67843,67844,67845,67846,67847,67848,67849,67850,67851,67852,67853,67854,67855,67856,67857,67858,67859,67860,67861,67862,67863,67864,67865,67866,67867,67872,67873,67874,67875,67876,67877,67878,67879,67880,67881,67882,67883,67884,67885,67886,67887,67888,67889,67890,67891,67892,67893,67894,67895,67896,67897,67903,67968,67969,67970,67971,67972,67973,67974,67975,67976,67977,67978,67979,67980,67981,67982,67983,67984,67985,67986,67987,67988,67989,67990,67991,67992,67993,67994,67995,67996,67997,67998,67999,68e3,68001,68002,68003,68004,68005,68006,68007,68008,68009,68010,68011,68012,68013,68014,68015,68016,68017,68018,68019,68020,68021,68022,68023,68030,68031,68096,68112,68113,68114,68115,68117,68118,68119,68121,68122,68123,68124,68125,68126,68127,68128,68129,68130,68131,68132,68133,68134,68135,68136,68137,68138,68139,68140,68141,68142,68143,68144,68145,68146,68147,68160,68161,68162,68163,68164,68165,68166,68167,68176,68177,68178,68179,68180,68181,68182,68183,68184,68192,68193,68194,68195,68196,68197,68198,68199,68200,68201,68202,68203,68204,68205,68206,68207,68208,68209,68210,68211,68212,68213,68214,68215,68216,68217,68218,68219,68220,68221,68222,68223,68352,68353,68354,68355,68356,68357,68358,68359,68360,68361,68362,68363,68364,68365,68366,68367,68368,68369,68370,68371,68372,68373,68374,68375,68376,68377,68378,68379,68380,68381,68382,68383,68384,68385,68386,68387,68388,68389,68390,68391,68392,68393,68394,68395,68396,68397,68398,68399,68400,68401,68402,68403,68404,68405,68416,68417,68418,68419,68420,68421,68422,68423,68424,68425,68426,68427,68428,68429,68430,68431,68432,68433,68434,68435,68436,68437,68440,68441,68442,68443,68444,68445,68446,68447,68448,68449,68450,68451,68452,68453,68454,68455,68456,68457,68458,68459,68460,68461,68462,68463,68464,68465,68466,68472,68473,68474,68475,68476,68477,68478,68479,68608,68609,68610,68611,68612,68613,68614,68615,68616,68617,68618,68619,68620,68621,68622,68623,68624,68625,68626,68627,68628,68629,68630,68631,68632,68633,68634,68635,68636,68637,68638,68639,68640,68641,68642,68643,68644,68645,68646,68647,68648,68649,68650,68651,68652,68653,68654,68655,68656,68657,68658,68659,68660,68661,68662,68663,68664,68665,68666,68667,68668,68669,68670,68671,68672,68673,68674,68675,68676,68677,68678,68679,68680,126464,126465,126466,126467,126469,126470,126471,126472,126473,126474,126475,126476,126477,126478,126479,126480,126481,126482,126483,126484,126485,126486,126487,126488,126489,126490,126491,126492,126493,126494,126495,126497,126498,126500,126503,126505,126506,126507,126508,126509,126510,126511,126512,126513,126514,126516,126517,126518,126519,126521,126523,126530,126535,126537,126539,126541,126542,126543,126545,126546,126548,126551,126553,126555,126557,126559,126561,126562,126564,126567,126568,126569,126570,126572,126573,126574,126575,126576,126577,126578,126580,126581,126582,126583,126585,126586,126587,126588,126590,126592,126593,126594,126595,126596,126597,126598,126599,126600,126601,126603,126604,126605,126606,126607,126608,126609,126610,126611,126612,126613,126614,126615,126616,126617,126618,126619,126625,126626,126627,126629,126630,126631,126632,126633,126635,126636,126637,126638,126639,126640,126641,126642,126643,126644,126645,126646,126647,126648,126649,126650,126651,1114109];v.prototype.applyStyles=function(e,t){t=t||this.div;for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},v.prototype.formatStyle=function(e,t){return e===0?0:e+t},m.prototype=t(v.prototype),m.prototype.constructor=m,g.prototype.move=function(e,t){t=t!==undefined?t:this.lineHeight;switch(e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},g.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},g.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},g.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},g.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},g.prototype.intersectPercentage=function(e){var t=Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left)),n=Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top)),r=t*n;return r/(this.height*this.width)},g.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},g.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,r=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e;var i={left:e.left,right:e.right,top:e.top||r,height:e.height||t,bottom:e.bottom||r+(e.height||t),width:e.width||n};return i},b.StringDecoder=function(){return{decode:function(e){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},b.convertCueToDOMTree=function(e,t){return!e||!t?null:c(e,t)};var w=.05,E="sans-serif",S="1.5%";b.processCues=function(e,t,n){function i(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}if(!e||!t||!n)return null;while(n.firstChild)n.removeChild(n.firstChild);var r=e.document.createElement("div");r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",r.style.margin=S,n.appendChild(r);if(!i(t)){for(var s=0;s<t.length;s++)r.appendChild(t[s].displayState);return}var o=[],u=g.getSimpleBoxPosition(r),a=Math.round(u.height*w*100)/100,f={font:a+"px "+E};(function(){var n,i;for(var s=0;s<t.length;s++)i=t[s],n=new m(e,i,f),r.appendChild(n.div),y(e,n,u,o),i.displayState=n.div,o.push(g.getSimpleBoxPosition(n))})()},b.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]},b.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof n))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){function r(){var e=t.buffer,n=0;while(n<e.length&&e[n]!=="\r"&&e[n]!=="\n")++n;var r=e.substr(0,n);return e[n]==="\r"&&++n,e[n]==="\n"&&++n,t.buffer=e.substr(n),r}function u(e){var n=new i;s(e,function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var r=t.split(",");if(r.length!==2)break;var s=new i;s.percent("x",r[0]),s.percent("y",r[1]);if(!s.has("x")||!s.has("y"))break;n.set(e+"X",s.get("x")),n.set(e+"Y",s.get("y"));break;case"scroll":n.alt(e,t,["up"])}},/=/,/\s/);if(n.has("id")){var r=new(t.vttjs.VTTRegion||t.window.VTTRegion);r.width=n.get("width",100),r.lines=n.get("lines",3),r.regionAnchorX=n.get("regionanchorX",0),r.regionAnchorY=n.get("regionanchorY",100),r.viewportAnchorX=n.get("viewportanchorX",0),r.viewportAnchorY=n.get("viewportanchorY",100),r.scroll=n.get("scroll",""),t.onregion&&t.onregion(r),t.regionList.push({id:n.get("id"),region:r})}}function a(e){s(e,function(e,t){switch(e){case"Region":u(t)}},/:/)}var t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var f;if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;f=r();var l=f.match(/^WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new n(n.Errors.BadSignature);t.state="HEADER"}var c=!1;while(t.buffer){if(!/\r\n|\n/.test(t.buffer))return this;c?c=!1:f=r();switch(t.state){case"HEADER":/:/.test(f)?a(f):f||(t.state="ID");continue;case"NOTE":f||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){t.state="NOTE";break}if(!f)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,""),t.state="CUE";if(f.indexOf("-->")===-1){t.cue.id=f;continue};case"CUE":try{o(f,t.cue,t.regionList)}catch(h){t.reportOrThrowError(h),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var p=f.indexOf("-->")!==-1;if(!f||p&&(c=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=f;continue;case"BADCUE":f||(t.state="ID");continue}}}catch(h){t.reportOrThrowError(h),t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{e.buffer+=e.decoder.decode();if(e.cue||e.state==="HEADER")e.buffer+="\n\n",e.parse();if(e.state==="INITIAL")throw new n(n.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},e.WebVTT=b}(this,this.vttjs||{}),define("com/external/videojs/video-dev",function(){}),define("com/es/widgets/video/VideoWidget",["com/es/widgets/WidgetUtils","com/es/utilities/utils","com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/popupViewMobileTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/inlinePopupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/videoView/printViewTemplate.html","com/external/videojs/video-dev"],function(e,t,n,r,s,o,u,a,f){var l=function(o){var f,l,c,h,p,d,v,m,g,y,b,w,E,S,x={},T,N=WIDGET_CONSTANTS.VIDEO_MIN_WIDTH,C=WIDGET_CONSTANTS.VIDEO_MIN_HEIGHT,k=!1,L=!1,A=!1,O=!1,M,D,P,H=null,B=null,j=!1,F=jQuery.browser.mobile,I=null,q=!1,R,U=[],z=!1,W=!1,X=e.isiPhoneOriPod(),V={},J,K,Q=WIDGET_CONSTANTS.LOCALE,G=!1,Y=!1,Z=function(){e.log("init video",f),w=l.bookFrameContent,E=l.bookFrameContentRootEl;if(l.data_json){var t=l.data_json,n=c.split("/");n.pop(),n=n.join("/")+"/"+l.dataURL;var r=n.split("/");r.pop(),h=r.join("/")+"/",tt(t)}else et()},et=function(){var t=c.split("/");t.pop(),t=t.join("/")+"/"+l.dataURL,e.log("url",t);var n=t.split("/");n.pop(),h=n.join("/")+"/",e.log("_resourceURL",h),$.getJSON(t,{}).done(function(e){tt(e)}).fail(function(t,n,r){e.log("error",r),f.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},tt=function(t){v=t,v.formattedTitle&&(v.title=v.formattedTitle),l.view!==undefined?e.log("default view pre-injected",l.view):WIDGET_CONSTANTS.PRINT_MODE?nt():k||Lt(),f.trigger(WIDGET_EVENTS.INITIALIZED,f)},nt=function(){Zt(),x={id:"widget-"+p.id,width:$("#"+p.id,w).width()+"px",title:v.title},$("#"+x.id,w).remove();var e=_.template(a,x);l.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?E.QAappend(e):($("#"+p.id,w).empty().addClass("reflow-print").QAappend(e),$("#"+p.id,w).find(".icon").addClass("reflow-print")),f.trigger(WIDGET_EVENTS.RENDER_COMPLETE,f)},rt=function(){if(F&&X)return g.play(),!1;g&&(g.paused||ct()),d.addClass("video-popup"),f.trigger(WIDGET_EVENTS.LAUNCHED,f)},it=function(){R=$("#widgetContent",d);var t=Wt(v.data.duration),n="",r="",i;!k||U.length?(n=p.id,i=$(".video-captions-btn",m).hasClass("enabled")):(n=(new Date).getTime(),v.data.captions&&v.data.captions.length>1&&(_.findWhere(v.data.captions,{lang:Q})||(Q=v.data.captions[0].lang)));var o={id:n,src:WIDGET_CONSTANTS.ASSETS_URL+v.data.src+"?"+(new Date).getTime(),title:v.title,description:v.description,poster:h+v.data.poster,mimeType:v.data.type,captions:v.data.captions,resourceURL:h,duration:t};WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&U[0].downloadStatus==3&&(o.src=WIDGET_CONSTANTS.DOWNLOADED_ASSETS_URL+v.data.src),o.poster=e.getCleanURL(o.poster),o.src=e.getCleanURL(o.src),F?navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?g.play():$("#widgetContent").html(_.template(s,o)):$("#widgetContent").html(_.template(s,o)),y=$(".video-player")[0],K=videojs(y,{children:{controlBar:{children:{volumeMenuButton:{volumeBar:{vertical:!0}},muteToggle:!1,volumeControl:!1}}}},function(){$(".vjs-control-bar",d).QAappend($(".video-context-div",d)),$(".video-captions-btn",d).off().on("click",Ht.bind(f,y,d)),$(".video-settings-btn",d).off().on("click",function(){$(".video-settings-popup",d).toggle(),$(".select-captions-lang",d).off().on("click",function(e){$(".select-captions-lang",d).removeClass("lang-selected"),$(e.target).addClass("lang-selected"),Q=$(e.target).attr("data-lang"),jt(y,d),$(".video-settings-popup",d).hide()})}),$(".select-captions-lang",d).removeClass("lang-selected"),$(".select-captions-lang[data-lang='"+Q+"']",d).addClass("lang-selected"),i&&_.delay(function(){Ht(y,d)},500)}),K.on("play",lt),K.on("pause",lt),K.on("fullscreenchange",st),d.on("hide.bs.modal",ot);var u=e.getAndroidVersion();WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&($("#widget-header",d).QAappend("<span class='download-widget-icon'></span>"),$("#widget-header .download-widget-icon",d).addClass("download-status-"+U[0].downloadStatus),$("#widget-header .download-widget-icon",d).unbind("click").bind("click",Rt)),k||J.paused()||J.pause();var a=".video-footer-info-description";f.trigger(WIDGET_EVENTS.POPULATE_MORE,v.description,a,R),e.getAndroidVersion()<5&&e.getAndroidVersion()>0&&$(".vjs-fullscreen-control").on(WIDGET_EVENTS.TOUCHSTART,function(){console.log("call fullscreen applied"),Tt()}),$(".video-info-btn").bind(WIDGET_EVENTS.CLICK,function(e){vt()}),$(".info-close-btn").bind(WIDGET_EVENTS.CLICK,function(e){mt()}),$(".gal-title",d).html(unescape(v.title)),ft(),f.trigger(WIDGET_EVENTS.POPULATED,f,H,B)},st=function(e){K.isFullscreen()?Y=!0:setTimeout(function(){Y=!1},500)},ot=function(e){console.log(e);if(Y)return!1},ut=function(){y.paused!==!0&&y.pause()},at=function(e,t){$(e).attr({"data-fileSize":t.data.size,"data-downloadable":!0,"data-launchFile":"","data-downloadUrl":t.data.src})},ft=function(){var e=$("#widget-header").height(),t=$("#widgetContent").find("video").height(),n=$("#widgetContent").find(".ui-video-controls").height(),r=$(".video-footer-info-text").height(),i=parseFloat($(".video-footer-info-text").css("padding-top"))+parseFloat($(".video-footer-info-text").css("padding-bottom")),s=parseFloat($(".video-content").css("margin-top"))+parseFloat($(".video-content").css("margin-bottom"));B=e+t+n+r+i+s,H=$("#widgetContent").find("video").width()},lt=function(){f.trigger(WIDGET_EVENTS.PLAY_CLICKED,f),K.paused()||f.trigger(WIDGET_EVENTS.XAPI_EVENT,f),e.isTouchDevice()&&$(".vjs-volume-menu-button").attr("style","display: none !important")},ct=function(){$(".inline-widget-footer",m[0]).hide(),e.isTouchDevice()&&$(".vjs-volume-menu-button",m[0]).attr("style","display: none !important"),G||f.trigger(WIDGET_EVENTS.PLAY_CLICKED,f),J.paused()||f.trigger(WIDGET_EVENTS.XAPI_EVENT,f),G=!1},ht=function(e){e&&typeof e=="object"&&e.mode==="popout"?(y.pause(),y.load()):(g.load(),j=!0,$(".inline-widget-footer",m[0]).show(),X||($(".ui-button-div",m[0]).show(),$(".ui-video-play-button",m[0]).show(),$(".ui-video-play-button",m[0]).css("opacity",1)),$(".ui-video-controls",m).hide())},pt=function(e,t){t.muted==0?(t.muted=!0,$(e).addClass("mute"),$(e).hasClass("icon-volume-icon-unmute")&&$(e).removeClass("icon-volume-icon-unmute").addClass("icon-volume-icon-mute")):(t.muted=!1,$(e).removeClass("mute"),$(e).hasClass("icon-volume-icon-mute")&&$(e).removeClass("icon-volume-icon-mute").addClass("icon-volume-icon-unmute"))};_volumeController=function(t,n){var r=t.target.value/10;n.volume=r,e.fillRange(t.target,r),n.muted&&(n.muted=!1,$(t.target.parentNode).siblings().removeClass("mute"))};var dt=function(){f.trigger(WIDGET_EVENTS.ON_DONE,f)},vt=function(){$(".mobile-video-info").show()},mt=function(){$(".mobile-video-info").hide()},gt=function(){if(y==undefined){if(isNaN(g.duration))return;var e=100/g.duration*g.currentTime;$("#seek-bar",m[0]).val(e);var t=e/100,n=$("#seek-bar",m[0]).attr("style");t*=100;var r=$(".ui-video-slider-control input",m[0]).css("color"),i=$(".ui-video-slider-control input",m[0]).css("border-color");i||(i=$(".ui-video-slider-control input",m[0]).css("border-top-color"));var s="background: -webkit-linear-gradient(left, "+r+" 0%, "+r+" "+t+"%, "+i+" "+t+"%, "+i+" 100%);";s+="background: -moz-linear-gradient(left, "+r+" 0%, "+r+" "+t+"%, "+i+" "+t+"%, "+i+" 100%);",s+="background: -o-linear-gradient(left, "+r+" 0%, "+r+" "+t+"%, "+i+" "+t+"%, "+i+" 100%);";var o=n?n+" "+s:s;$("#seek-bar",m[0]).attr("style",o);var u=g.currentTime*1e3;$("#time-comp",m[0]).html(Wt(u))}else{if(isNaN(y.duration))return;$("#seek-bar").attr("step")||($("#seek-bar").attr("step","0.01"),$("#seek-bar").attr("max",$("#seek-bar").width()));var e=(y.currentTime/y.duration*$("#seek-bar").attr("max")).toFixed(2),t=(y.currentTime/y.duration).toFixed(2),n=$("#seek-bar").attr("style");t*=100;var r=$("#seek-bar").parent().css("color"),i=$("#seek-bar").css("color"),s="background: -webkit-linear-gradient(left, "+r+" 0%, "+r+" "+t+"%, "+i+" "+t+"%, "+i+" 100%);";s+="background: -moz-linear-gradient(left, "+r+" 0%, "+r+" "+t+"%, "+i+" "+t+"%, "+i+" 100%);",s+="background: -o-linear-gradient(left, "+r+" 0%, "+r+" "+t+"%, "+i+" "+t+"%, "+i+" 100%);";var o=n?n+" "+s:s;$("#seek-bar").attr("style",o),$("#seek-bar").val(e);var u=y.currentTime*1e3;$("#time-comp").html(Wt(u))}},yt=function(){if($("#widgetContent").html()===""){var e=g.duration*($("#seek-bar",m[0]).val()/100);g.currentTime=e}else{var e=y.duration*($("#seek-bar").val()/$("#seek-bar").attr("max"));y.currentTime=Math.round(e),_.delay(function(){gt()},0)}},bt=function(e){L=!0;if(y){var t=$(".ui-video-play-pause-control");t.removeClass("ui-video-pause-control"),t.hasClass("icon-ic-play-video")&&t.removeClass("icon-ic-play-video").addClass("icon-ic-play"),y.pause()}else{$(m[0]).find(".ui-video-play-button").show();var t=$(".ui-video-play-pause-control",m[0]);t.removeClass("ui-video-pause-control"),t.hasClass("icon-ic-play-video")&&t.removeClass("icon-ic-play-video").addClass("icon-ic-play")}ht(e),_.delay(function(){gt()},50)},wt=function(){G=!0,g!==undefined&&(J.pause(),g.pause(),Et());if(y){y.pause(),_.delay(function(){gt()},0);var e=$(".ui-video-play-pause-control");e.removeClass("ui-video-pause-control"),e.hasClass("icon-ic-play-video")&&e.removeClass("icon-ic-play-video").addClass("icon-ic-play")}},Et=function(){$(".ui-video-play-button",m).show(),$(".ui-video-play-button",m).css("opacity",1);var e=$(".ui-video-play-pause-control",m);e.removeClass("ui-video-pause-control"),e.hasClass("icon-ic-play-video")&&e.removeClass("icon-ic-play-video").addClass("icon-ic-play")},St=function(){y.currentTime<y.duration&&(y.currentTime+=WIDGET_CONSTANTS.SEEK)},xt=function(){y.currentTime>=0&&(y.currentTime-=WIDGET_CONSTANTS.SEEK)},Tt=function(){var e;e=y.requestFullScreen||y.webkitRequestFullScreen||y.mozRequestFullScreen||y.msRequestFullScreen,typeof e!="undefined"&&e?e.call(y):y.webkitEnterFullScreen&&(y.play(),y.webkitEnterFullScreen.call(y)),Ct(),Nt()},Nt=function(){document.addEventListener("fullscreenchange",kt),document.addEventListener("webkitfullscreenchange",kt),document.addEventListener("mozfullscreenchange",kt)},Ct=function(){document.removeEventListener("fullscreenchange",kt),document.removeEventListener("webkitfullscreenchange",kt),document.removeEventListener("mozfullscreenchange",kt)},kt=function(){if(!(document.webkitIsFullScreen||window.fullScreen||document.mozFullScreen)){y.controls=!1,Ct();if(y.paused==1){var e=$(".ui-video-play-pause-control");e.removeClass("ui-video-pause-control"),e.hasClass("icon-ic-play-video")&&e.removeClass("icon-ic-play-video").addClass("icon-ic-play")}else{var e=$(".ui-video-play-pause-control");e.addClass("ui-video-pause-control"),e.hasClass("icon-ic-play")&&e.removeClass("icon-ic-play").addClass("icon-ic-play-video")}}_.delay(function(){if(document.webkitIsFullScreen||window.fullScreen||document.mozFullScreen)y.controls=!0,$("#widgetPopup").blur();else{y.controls=!1,Ct();if(y.paused==1){var e=$(".ui-video-play-pause-control");e.removeClass("ui-video-pause-control"),e.hasClass("icon-ic-play-video")&&e.removeClass("icon-ic-play-video").addClass("icon-ic-play")}else{var e=$(".ui-video-play-pause-control");e.addClass("ui-video-pause-control"),e.hasClass("icon-ic-play")&&e.removeClass("icon-ic-play").addClass("icon-ic-play-video")}_.delay(function(){$("#widgetPopup").focus()},200)}},100)},Lt=function(){Zt();var t="widget-"+p.id,r="ui-"+p.id;e.log("_resourceURL",h),w.find("#"+r).length>0&&w.find("#"+r).remove();var i='<div class="ui-video-gal widget-ui ui-border invisible" id="'+r+'"></div>',s=$("#"+p.id,w).get(0).innerHTML;s=s.trim(),s.length==0?($("#"+p.id,w).get(0).innerHTML=i,E.append($("#"+r,w))):E.append(i),at($("#"+p.id,w),v);var o=Wt(v.data.duration);x={id:t,width:l.width,src:WIDGET_CONSTANTS.ASSETS_URL+v.data.src+"?"+(new Date).getTime(),title:v.title,poster:h+v.data.poster,mimeType:v.data.type,captions:v.data.captions,resourceURL:h,duration:o,desc:v.description},v.data.captions&&v.data.captions.length>1&&(_.findWhere(v.data.captions,{lang:Q})||(Q=v.data.captions[0].lang)),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&U[0].downloadStatus==3&&(x.src=WIDGET_CONSTANTS.DOWNLOADED_ASSETS_URL+v.data.src),x.poster=e.getCleanURL(x.poster),x.src=e.getCleanURL(x.src);var a=_.template(n,x);m=$("#"+r,w);var f=navigator.userAgent.toLowerCase();$(m[0]).html(a),g=$(".video-js",m[0])[0],b="#player-"+x.id;if(!x.captions||!x.captions.length)$(".video-context-div",m.get(0)).hide(),$(".ui-maximize.ui-right-div-control",m.get(0)).css({right:0});!$(".popover-widgets").length&&x.desc&&$("body").append(_.template(u)),$(g).bind("contextmenu",function(e){return!1}),e.isIOS()&&v.data.height&&v.data.width&&($(g).height(v.data.height),$(g).width(v.data.width)),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&($("#ui-"+p.id,w).QAappend("<div class='download-widget-blue-corner' ><span class='download-widget-icon'></span></div>"),$("#ui-"+p.id+" .download-widget-icon",w).addClass("white-download-status-"+U[0].downloadStatus),$("#ui-"+p.id+" .download-widget-icon",w).unbind("click").bind("click",Rt)),J=videojs($(b,w).get(0),{children:{controlBar:{children:{volumeMenuButton:{volumeBar:{vertical:!0}},muteToggle:!1,volumeControl:!1}}}},function(){$(".vjs-control-bar",m).QAappend($(".video-context-div",m).get(0).outerHTML),$(".vjs-control-bar",m).QAappend($(".ui-maximize.ui-right-div-control",m).get(0).outerHTML),(!x.captions||!x.captions.length)&&$(".vjs-volume-menu-button",m.get(0)).css({right:"30px"}),_.delay(function(){Mt()},500)})},At=function(){M=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")},Ot=function(){if(navigator.plugins)for(i=0;i<navigator.plugins.length;i++){if(navigator.plugins[i].name.indexOf("QuickTime")>=0){O=!0;return}O=!1}},Mt=function(){if(j){j=!1;return}var t=$(".ui-video-gal#ui-"+p.id+" video",w).get(0);T=t.clientWidth>E.width()?E.width():t.clientWidth,T=T>N?T:N,$("#"+p.id,w).removeClass("widget-loader"),$("#"+p.id,w).find(".move-icon").removeClass("move-icon-compact"),J.on("play",ct),J.on("pause",ct),_.delay(function(){$(".vjs-control-bar",m[0]).parent().on(WIDGET_EVENTS.TOUCHSTART,function(e){console.log("touchstart"),f.trigger(WIDGET_EVENTS.VIDEO_TOUCHSTART)}),$(".vjs-control-bar",m[0]).parent().on(WIDGET_EVENTS.TOUCHEND,function(e){console.log("touchend"),f.trigger(WIDGET_EVENTS.VIDEO_TOUCHEND)})},0),It();if(l.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){Ft(),qt();var n=$("#"+p.id,w).width();n<N&&($("#"+p.id,w).width(N),$("#ui-"+p.id,w).width(N));if(l.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(l.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){x.uiId="ui-"+p.id;var i=_.template(r,{id:x.uiId}),s=$("#"+p.id,w).get(0).innerHTML;s=s.trim(),s.length==0?($("#"+p.id,w).get(0).innerHTML=i,E.append($("#div-border-"+x.uiId,w))):E.append(i),$("#div-border-"+x.uiId,w).css({width:$(P).width()+"px",height:$(P).height()+"px",top:P.style.top,left:P.style.left,position:"absolute"}),$("#div-border-"+x.uiId,w).addClass("transparentWidget ui-hover-class"),$("#div-border-"+x.uiId,w).css({"pointer-events":"none"})}e.log("inline",$(".inline-widget-footer",m.get(0))),$(".inline-widget-footer",m.get(0)).remove(),$("video",m.get(0)).remove(),$(".ui-video-play-button",m.get(0)).remove(),$(".ui-video-controls",m.get(0)).remove(),$(".ui-button-div",m.get(0)).remove(),$("#"+p.id,w).find(".move-icon").addClass("move-icon-compact"),$("#ui-"+p.id,w).html('<div class="ui-clickable-icon ui-video-icon icon-font"></div>'),m.addClass("transparentWidget"),m.removeClass("ui-border"),$(m).css({width:$(".ui-clickable-icon",m).width()+"px",height:$(".ui-clickable-icon",m).height()+"px"}),$("#"+p.id+" .dummyWidget",w).show(),l.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+p.id,w).css({width:$(".ui-clickable-icon",P).width()+"px",height:$(".ui-clickable-icon",P).height()+"px"}),$("#"+p.id+" .dummyWidget",w).hide()),$(".ui-video-icon",m.get(0)).click({},rt)}else if(l.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER){var o=$("#widget-"+p.id,m.get(0));D=o,$(o).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize ui-video-play-button'></div></div>"),$("video",o).remove(),$(".ui-video-controls",o).remove(),$(".ui-video-play-button",m).click({},rt),$(".ui-maximize",o).click({},rt)}else l.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&It();$(".ui-maximize",m.get(0)).click({},rt)}else $(".ui-maximize",m.get(0)).click({},rt);$(".show-context-popup",m.get(0)).off().on("click",function(){var e=f,t=v,n=R;$(".video-context-popup",m.get(0)).css("display")=="block"||$(".video-settings-popup",m.get(0)).css("display")=="block"?($(".video-context-popup",m.get(0)).hide(),$(".video-settings-popup",m.get(0)).hide()):($(".video-context-popup",m.get(0)).show(),$(".video-settings-btn",m.get(0)).off().on("click",function(){$(".video-context-popup",m.get(0)).hide(),$(".video-settings-popup",m.get(0)).show(),$(".select-captions-lang",m.get(0)).off().on("click",function(e){$(".select-captions-lang",m.get(0)).removeClass("lang-selected"),$(e.target).addClass("lang-selected"),Q=$(e.target).attr("data-lang"),jt(g,m.get(0)),$(".video-settings-popup",m.get(0)).hide()})}),$(".select-captions-lang",m.get(0)).removeClass("lang-selected"),$(".select-captions-lang[data-lang='"+Q+"']",m.get(0)).addClass("lang-selected"),$(".video-captions-btn",m.get(0)).off().on("click",Ht.bind(f,g,m.get(0))))});if(x.desc){var u=$(".popover-widgets");e.isIE()&&u.removeClass("fade"),u.hide(),$(".popover-widgets .modal-dialog").css({top:-250,left:-250});var a=String(document.documentElement.ontouchmove)!="undefined"?"touchend":"click";$(".video-info-btn",m).off("click").on(a,_t)}else $(".video-info-btn",m).hide();q=!0,f.trigger(WIDGET_EVENTS.RENDER_COMPLETE,f,T,N)},_t=function(e){e.preventDefault();var n=$(".popover-widgets"),r=$(".popover-widgets .modal-dialog"),i=String(document.documentElement.ontouchmove)!="undefined"?"touchend":"click";n.show(),n.find(".modal-body").html(x.desc),Pt(e,E),n.on("shown.bs.modal",function(e){$(".modal-backdrop").bind(i,Dt)}),t.mouseWheel(n.find(".modal-body")),n.on("hidden.bs.modal",function(e){$(".modal-backdrop").removeClass("transparent"),$(".modal-backdrop").unbind(),n.off(),r.css({top:-250,left:-250}),n.find(".modal-body").html("")}),n.modal("show"),$(".modal-backdrop").addClass("transparent")},Dt=function(e){$(".popover-widgets").modal("hide")},Pt=function(t,n){var r=$(".popover-widgets .modal-dialog"),i=115,s,o;t.type=="touchend"&&(t.changedTouches?t=t.changedTouches[0]:t.touches&&(t=t.touches[0]),i=0),s=t.clientX,o=t.screenY,r.css({left:s,top:o-r.height()-i});var u=s+r.width(),a=$(n).offset().left+parseInt($(n).css("padding-left")),f=a+$(n).width();if(u>f){var l=s-r.width();r.css("left",l)}if(r.offset().top<0){var c=o-i+30;r.css("top",c)}e.isPhone()&&r.css({left:"25%",width:"50%"})},Ht=function(e,t){$(".video-captions-btn",t).hasClass("enabled")?Bt(e,t):jt(e,t),$(".video-context-popup",t).hide()},Bt=function(e,t){if(e.textTracks)for(var n=0;n<e.textTracks.length;n++)e.textTracks[n].mode="hidden";$(".video-captions-btn",t).removeClass("enabled")},jt=function(e,t){if(e.textTracks)for(var n=0;n<e.textTracks.length;n++)e.textTracks[n].language==Q?(e.textTracks[n].mode="showing",$(".video-captions-btn",t).addClass("enabled")):e.textTracks[n].mode="hidden"},Ft=function(){e.log("_options",l),$("#"+p.id,w).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+p.id,w)).left,n=e.getOffset($("#"+p.id,w)).top,r=$("#"+p.id,w).width(),i=$("#"+p.id,w).height(),P=$("#ui-"+p.id,w).get(0),l.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(P).css({top:n+"px",left:t+"px",position:"absolute"}):$(P).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),l.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+x.uiId,w).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},It=function(){if(l.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE){var t,n,r=$(".ui-video-gal#ui-"+p.id+" video",w);e.isIOS()?v.data.height&&v.data.width?(t=$("#"+p.id,w).width()/v.data.width,n=v.data.height*t):n=r.height():l.align=="fitToWidth"?($("#"+p.id,w).data("width")!=undefined?($("#"+p.id,w).css("width",$("#"+p.id,w).data("width")),t=$("#"+p.id,w).data("width").split("px")[0]/r.get(0).videoWidth):($("#ui-"+p.id,w).css("width","37.6411543287327%"),t=$("#ui-"+p.id,w).width()/r.get(0).videoWidth),n=r.get(0).videoHeight*t):r.get(0).videoWidth&&r.get(0).videoHeight?(t=$("#"+p.id,w).width()/r.get(0).videoWidth,n=r.get(0).videoHeight*t):(t=$("#"+p.id,w).width()/J.width(),n=J.height()*t),$("#"+p.id,w).css({height:n+"px"}),qt()}},qt=function(){var e=$("#"+p.id,w).height();e<C&&($("#"+p.id,w).height(C),$("#ui-"+p.id,w).height(C))},Rt=function(e){var t=U[0].id,n=U[0].downloadStatus;switch(parseInt(n)){case 0:n=1;break;case 1:case 2:n=2;break;case 3:n=3;break;default:}f.trigger(WIDGET_EVENTS.DOWNLOAD_ACTION,p.id,t,n)},Ut=function(e,t,n){U[0].downloadStatus=t,$("#ui-"+p.id+" .download-widget-icon",w).removeClass("white-download-status-0 white-download-status-1 white-download-status-2 white-download-status-3"),$("#ui-"+p.id+" .download-widget-icon",w).addClass("white-download-status-"+t);if(R){var r=R.find("#player-"+p.id);r.length>0&&($("#widget-header .download-widget-icon",d).removeClass("download-status-0 download-status-1 download-status-2 download-status-3"),$("#widget-header .download-widget-icon",d).addClass("download-status-"+t))}},zt=function(){if(!k){if(y.currentTime>0&&y.duration>y.currentTime)if(l.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED)if(l.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT)g.pause();else if(l.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER)g.pause(),$(".ui-video-play-button",m).show(),$(".ui-video-play-button",m).css("opacity",1);else{var e=y.currentTime.toString();g.currentTime=e,ct()}else if(y.paused==0){var e=y.currentTime.toString();g.currentTime=e,ct()}else{var e=y.currentTime.toString();g.currentTime=e,Et(),g.pause()}y.currentTime===y.duration&&(y.currentTime=0,g.currentTime=0,bt())}},Wt=function(e){var t,n,r,i;return i=Math.floor(e/1e3),r=Math.floor(i/60),i%=60,n=Math.floor(r/60),r%=60,i===0?i="00":i<10&&(i="0"+i),r===0?r="00":r<10&&(r="0"+r),n===0&&(n="00"),r+":"+i},Xt=function(){},Vt=function(){},$t=function(){k||($(".video-captions-btn",d).hasClass("enabled")?jt(g,m.get(0)):Bt(g,m.get(0))),$(".gal-title",d).html(""),y.src="",$(y).unbind(),K.off("fullscreenchange",st),d.off("hide.bs.modal",ot),$("#widget-header .download-widget-icon",d).unbind(),$("#seek-bar").unbind(),$(".ui-video-play-pause-control").unbind(),$(".ui-video-backward").unbind(),$(".ui-video-forward").unbind(),$(".ui-fullscreen").unbind(),$(".ui-video-done-control").unbind(),$(".video-info-btn").unbind(),$(".info-close-btn").unbind(),$(".mute-btn",R).unbind(),$(".volume-div",R).unbind("mouseenter mouseleave").unbind(),$(".video-volume-bar").unbind(),y.load(),R.empty(),d.removeClass("video-popup"),f.trigger(WIDGET_EVENTS.DESTROYED,f),y=undefined},Jt=function(){return WIDGET_CONSTANTS.VIDEO_WIDGET},Kt=function(){q&&(l.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&l.align!="fitToWidth"&&(Zt(),It()),l.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?Qt():Ft())},Qt=function(){if(l.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t=l.bookFrameContent,n,r,i,s;n=e.getOffset($("#"+p.id,t)).left,r=e.getOffset($("#"+p.id,t)).top,i=$("#"+p.id,t).width(),s=$("#"+p.id,t).height();var o=$("#ui-"+p.id,t).get(0);$(o).css({top:r,left:n,width:i+"px",height:s+"px",position:"absolute"}),l.align=="fitToWidth"&&$("#"+p.id,t).attr("data-height",s+"px")}},Gt=function(){if(g!==undefined){if(O){g.pause(),$(".ui-video-play-button",m).show(),$(".ui-video-play-button",m).css("opacity",1);var e=$(".ui-video-play-pause-control",m);e.removeClass("ui-video-pause-control"),e.hasClass("icon-ic-play-video")&&e.removeClass("icon-ic-play-video").addClass("icon-ic-play")}g.paused!==!0&&ct()}$(".popover-widgets").length&&Dt()},Yt=function(){g&&(g.src="")},Zt=function(){if(l.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+p.id,w).width();e<N&&$("#"+p.id,w).width(N),e>T&&$("#"+p.id,w).width(T)}},en=function(){Zt(),It(),Qt(),$("#seek-bar").length===1&&$("#seek-bar").attr("max",$("#seek-bar").width())},tn=function(){$(b,w).off(),$(".ui-video-play-button,.ui-video-play-pause-control",m[0]).off(),$(".ui-video-controls",m[0]).off(),$(g).unbind(),g&&$(g).off(),y&&$(y).off(),$(".ui-video-stop-control",m[0]).unbind(),$(".mute-btn",m[0]).unbind(),$(".volume-bar",m[0]).unbind(),$(".volume-div",m[0]).unbind("mouseenter mouseleave").unbind(),$("#seek-bar",m[0]).unbind(),$("#"+p.id,w).remove(),$("#ui-"+p.id,w).remove()},nn=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(k=!0,e.widgetEnrichmentArr.length&&(p={},p.id=_.findWhere(e.widgetEnrichmentArr,{level:0}).widgetId)):p=e.obj,l=e.options,d=e.popupView,f=this,c=l.bookURL,U=e.widgetEnrichmentArr},initCurrWidget:Z,destroy:$t,resize:Vt,relayout:Kt,pause:wt,onCloseAllWidgets:Gt,widgetType:Jt,activeteInlinePlayer:zt,widgetResize:en,launch:rt,onPopupShown:it,removeMedia:Yt,updateDownloadStatus:Ut,destroyView:tn});return new nn(o)};return l}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/inlineViewTemplate.html",[],function(){return'<div id="<%= obj.id %>">\r\n    <div class="circleplayer">\r\n        <div id="jquery_jplayer_1" class="cp-jplayer" style="width: 0px; height: 0px;">\r\n            <audio  id="jp_audio_1" preload="metadata" src="<%=obj.src %>"></audio>\r\n        </div>\r\n        <div id="cp_container_1" class="cp-container">\r\n            <div class="cp-buffer-holder cp-gt50" style="display: block;">\r\n				<div class="cp-buffer-1" style="-webkit-transform: rotate(180deg);"></div>\r\n				<div class="cp-buffer-2" style="display: block; -webkit-transform: rotate(233.98626334791908deg);"></div>\r\n            </div>\r\n            <div class="cp-progress-holder" style="display: block;">\r\n				<div class="cp-progress-1" style="-webkit-transform: rotate(0deg);"></div>\r\n				<div class="cp-progress-2" style="-webkit-transform: rotate(0deg); display: none;"></div>\r\n            </div>\r\n            <div class="cp-circle-control"></div>\r\n            <div class=\'ui-duration ui-right-div-audio\'><%=unescape(obj.duration)%></div>\r\n            <ul class="cp-controls">\r\n				<!--li><div class=\'ui-duration ui-right-div-audio\'><%=unescape(obj.duration)%></div></li-->\r\n				<li><a class="cp-pp-ctrl cp-play icon icon-ic-play" tabindex="1"></a></li>\r\n				<li><a class="cp-pp-ctrl cp-pause icon icon-ic-play-video" style="display: none;" tabindex="1"></a></li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    <div class=\'inline-widget-footer\'>\r\n		<div class="ui-audio-icon icon icon-ic-headphone widget-audio-icon-style"></div>\r\n		<div class=\'ui-gal-text-left audio-widget-text-style\'><%=unescape(obj.title)%></div>\r\n		<div class=\'volume-div\'>\r\n			<!--<span class=\'volume-btn mute-btn\'></span>-->\r\n            <div class="mute-btn icon icon-volume-icon-unmute"></div>\r\n			<div class=\'volume-up-down\' style=\'display:none;\'>\r\n				<input type=\'range\' class=\'volume-bar\' min=\'0\' max=\'10\' step=\'0.1\' value=\'10\' />\r\n			</div>\r\n		</div>\r\n		<!--<div class=\'ui-maximize ui-right-div\'></div>-->\r\n        <div class="ui-maximize ui-right-div icon icon-ic-fullscreen"></div>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/popupViewTemplate.html",[],function(){return'<div class="audio-pop-up-widget-img">\r\n<div class="ui-audio-icon icon icon-ic-headphone widget-audio-icon-style"></div>\r\n</div>\r\n<div id="<%= obj.id %>"  class="ui-audio-circle" style="background-color:#c0c0c0">\r\n    <audio id="jp_audio_1" class="popup-audio" preload="metadata" src="<%= obj.src %>"></audio>\r\n    <div id="audio-controls">\r\n    	<div class="audio-controls-popup-btn">\r\n            <button type="button" class="audio-btn play-pause-btn icon video-popup-play-pause-icon-style icon-ic-play">\r\n            </button>\r\n            <button type="button" class="icon stop-btn icon-ic-stop"></button>\r\n        </div>\r\n        <div class=\'ui-duration current-time\'>00:00</div>\r\n        <input type="range" class="seek-bar" value="0" min="0" max="100" step="0.1" />\r\n        <div class=\'ui-duration total-time\'><%=unescape(obj.duration)%></div>\r\n        <div class=\'volume-div vol-audio pop-up-audio-volume-btn\'>\r\n			<span class=\'mute-btn icon icon-volume-icon-unmute\'></span>\r\n            <div class=\'volume-up-down\' style=\'display:none;\'>\r\n				<input type=\'range\' class=\'volume-bar\' min=\'0\' max=\'10\' step=\'0.1\' value=\'10\' />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="audio-info-text info-text">\r\n	<!--div class="audio-info-title"><span class="fig-title"><%=unescape(obj.title)%></span></div-->\r\n    <div class="audio-info-description info-description">\r\n		<span class="fig-description">\r\n			<div><%=unescape(obj.description)%></div>\r\n		</span>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=id%>' style='width: <%=width%>;' >\r\n	<div class='print-widget-header'>\r\n		<div class=\"ui-audio-icon icon icon-ic-headphone widget-audio-icon-style\"></div>\r\n		<div class='ui-gal-text-left audio-widget-text-style'><%=unescape(title)%></div>\r\n	</div>\r\n	<div class=\"print-widget-note\"><%=WidgetLang.AUDIO_PRINT_NOTE%></div>\r\n</div>\r\n"}),function(e,t,n,r,i){function T(t){t=t.split(")");var n=e.trim,i=-1,s=t.length-1,o,u,a,f=h?new Float32Array(6):[],l=h?new Float32Array(6):[],c=h?new Float32Array(6):[1,0,0,1,0,0];f[0]=f[3]=c[0]=c[3]=1,f[1]=f[2]=f[4]=f[5]=0;while(++i<s){o=t[i].split("("),u=n(o[0]),a=o[1],l[0]=l[3]=1,l[1]=l[2]=l[4]=l[5]=0;switch(u){case b+"X":l[4]=parseInt(a,10);break;case b+"Y":l[5]=parseInt(a,10);break;case b:a=a.split(","),l[4]=parseInt(a[0],10),l[5]=parseInt(a[1]||0,10);break;case w:a=M(a),l[0]=r.cos(a),l[1]=r.sin(a),l[2]=-r.sin(a),l[3]=r.cos(a);break;case E+"X":l[0]=+a;break;case E+"Y":l[3]=a;break;case E:a=a.split(","),l[0]=a[0],l[3]=a.length>1?a[1]:a[0];break;case S+"X":l[2]=r.tan(M(a));break;case S+"Y":l[1]=r.tan(M(a));break;case x:a=a.split(","),l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[4]=parseInt(a[4],10),l[5]=parseInt(a[5],10)}c[0]=f[0]*l[0]+f[2]*l[1],c[1]=f[1]*l[0]+f[3]*l[1],c[2]=f[0]*l[2]+f[2]*l[3],c[3]=f[1]*l[2]+f[3]*l[3],c[4]=f[0]*l[4]+f[2]*l[5]+f[4],c[5]=f[1]*l[4]+f[3]*l[5]+f[5],f=[c[0],c[1],c[2],c[3],c[4],c[5]]}return c}function N(e){var t,n,i,s=e[0],o=e[1],u=e[2],a=e[3];return s*a-o*u?(t=r.sqrt(s*s+o*o),s/=t,o/=t,i=s*u+o*a,u-=s*i,a-=o*i,n=r.sqrt(u*u+a*a),u/=n,a/=n,i/=n,s*a<o*u&&(s=-s,o=-o,i=-i,t=-t)):t=n=i=0,[[b,[+e[4],+e[5]]],[w,r.atan2(o,s)],[S+"X",r.atan(i)],[E,[t,n]]]}function C(t,n){var r={start:[],end:[]},i=-1,s,o,u,a;(t=="none"||L(t))&&(t=""),(n=="none"||L(n))&&(n=""),t&&n&&!n.indexOf("matrix")&&_(t).join()==_(n.split(")")[0]).join()&&(r.origin=t,t="",n=n.slice(n.indexOf(")")+1));if(!t&&!n)return;if(!t||!n||A(t)==A(n)){t&&(t=t.split(")"))&&(s=t.length),n&&(n=n.split(")"))&&(s=n.length);while(++i<s-1)t[i]&&(o=t[i].split("(")),n[i]&&(u=n[i].split("(")),a=e.trim((o||u)[0]),O(r.start,k(a,o?o[1]:0)),O(r.end,k(a,u?u[1]:0))}else r.start=N(T(t)),r.end=N(T(n));return r}function k(e,t){var n=+!e.indexOf(E),r,i=e.replace(/e[XY]/,"e");switch(e){case b+"Y":case E+"Y":t=[n,t?parseFloat(t):n];break;case b+"X":case b:case E+"X":r=1;case E:t=t?(t=t.split(","))&&[parseFloat(t[0]),parseFloat(t.length>1?t[1]:e==E?r||t[0]:n+"")]:[n,n];break;case S+"X":case S+"Y":case w:t=t?M(t):0;break;case x:return N(t?_(t):[1,0,0,1,0,0])}return[[i,t]]}function L(e){return m.test(e)}function A(e){return e.replace(/(?:\([^)]*\))|\s/g,"")}function O(e,t,n){while(n=t.shift())e.push(n)}function M(e){return~e.indexOf("deg")?parseInt(e,10)*(r.PI*2/360):~e.indexOf("grad")?parseInt(e,10)*(r.PI/200):parseFloat(e)}function _(e){return e=/([^,]*),([^,]*),([^,]*),([^,]*),([^,p]*)(?:px)?,([^)p]*)(?:px)?/.exec(e),[e[1],e[2],e[3],e[4],e[5],e[6]]}var s=n.createElement("div"),o=s.style,u="Transform",a=["O"+u,"ms"+u,"Webkit"+u,"Moz"+u],f=a.length,l,c,h="Float32Array"in t,p,d,v=/Matrix([^)]*)/,m=/^\s*matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*(?:,\s*0(?:px)?\s*){2}\)\s*$/,g="transform",y="transformOrigin",b="translate",w="rotate",E="scale",S="skew",x="matrix";while(f--)if(a[f]in o){e.support[g]=l=a[f],e.support[y]=l+"Origin";continue}l||(e.support.matrixFilter=c=o.filter===""),e.cssNumber[g]=e.cssNumber[y]=!0,l&&l!=g?(e.cssProps[g]=l,e.cssProps[y]=l+"Origin",l=="Moz"+u?p={get:function(t,n){return n?e.css(t,l).split("px").join(""):t.style[l]},set:function(e,t){e.style[l]=/matrix\([^)p]*\)/.test(t)?t.replace(/matrix((?:[^,]*,){4})([^,]*),([^)]*)/,x+"$1$2px,$3px"):t}}:/^1\.[0-5](?:\.|$)/.test(e.fn.jquery)&&(p={get:function(t,n){return n?e.css(t,l.replace(/^ms/,"Ms")):t.style[l]}})):c&&(p={get:function(t,n,r){var s=n&&t.currentStyle?t.currentStyle:t.style,o,u;return s&&v.test(s.filter)?(o=RegExp.$1.split(","),o=[o[0].split("=")[1],o[2].split("=")[1],o[1].split("=")[1],o[3].split("=")[1]]):o=[1,0,0,1],e.cssHooks[y]?(u=e._data(t,"transformTranslate",i),o[4]=u?u[0]:0,o[5]=u?u[1]:0):(o[4]=s?parseInt(s.left,10)||0:0,o[5]=s?parseInt(s.top,10)||0:0),r?o:x+"("+o+")"},set:function(t,n,r){var i=t.style,s,o,u,a;r||(i.zoom=1),n=T(n),o=["Matrix(M11="+n[0],"M12="+n[2],"M21="+n[1],"M22="+n[3],"SizingMethod='auto expand'"].join(),u=(s=t.currentStyle)&&s.filter||i.filter||"",i.filter=v.test(u)?u.replace(v,o):u+" progid:DXImageTransform.Microsoft."+o+")";if(!e.cssHooks[y]){if(a=e.transform.centerOrigin)i[a=="margin"?"marginLeft":"left"]=-(t.offsetWidth/2)+t.clientWidth/2+"px",i[a=="margin"?"marginTop":"top"]=-(t.offsetHeight/2)+t.clientHeight/2+"px";i.left=n[4]+"px",i.top=n[5]+"px"}else e.cssHooks[y].set(t,n)}}),p&&(e.cssHooks[g]=p),d=p&&p.get||e.css,e.fx.step.transform=function(t){var n=t.elem,i=t.start,s=t.end,o=t.pos,u="",a=1e5,f,h,v,m;if(!i||typeof i=="string")i||(i=d(n,l)),c&&(n.style.zoom=1),s=s.split("+=").join(i),e.extend(t,C(i,s)),i=t.start,s=t.end;f=i.length;while(f--){h=i[f],v=s[f],m=0;switch(h[0]){case b:m="px";case E:m||(m=""),u=h[0]+"("+r.round((h[1][0]+(v[1][0]-h[1][0])*o)*a)/a+m+","+r.round((h[1][1]+(v[1][1]-h[1][1])*o)*a)/a+m+")"+u;break;case S+"X":case S+"Y":case w:u=h[0]+"("+r.round((h[1]+(v[1]-h[1])*o)*a)/a+"rad)"+u}}t.origin&&(u=t.origin+u),p&&p.set?p.set(n,u,1):n.style[l]=u},e.transform={centerOrigin:"margin"}}(jQuery,window,document,Math),define("com/external/jplayer/jquery.transform2d",function(){}),function(e){function f(t,n,r){if(n.substr(0,5)!=="touch")return e(t).unbind(n,r);var i,s;for(s=0;s<l._binds.length;s++)l._binds[s].elem===t&&l._binds[s].type===n&&l._binds[s].func===r&&(document.addEventListener?t.removeEventListener(n,l._binds[s].fnc,!1):t.detachEvent("on"+n,l._binds[s].fnc),l._binds.splice(s--,1))}function l(t,n,r,i){if(n.substr(0,5)!=="touch")return e(t).bind(n,i,r);var s,o;if(l[n])return l[n].bind(t,n,r,i);s=function(e){e||(e=window.event),e.stopPropagation||(e.stopPropagation=function(){this.cancelBubble=!0}),e.data=i,r.call(t,e)},document.addEventListener?t.addEventListener(n,s,!1):t.attachEvent("on"+n,s),l._binds.push({elem:t,type:n,func:r,fnc:s})}function c(r,i){var o={move:{x:0,y:0},offset:{x:0,y:0},position:{x:0,y:0},start:{x:0,y:0},affects:e(i.containerRef),stopPropagation:!1,preventDefault:!0,touch:!0};t(o,i),o.element=e(i.containerRef).find(r),l(r,n,p,o),o.touch&&l(r,s,m,o)}function h(e){f(e,n,n)}function p(e){e.data.position.x=e.pageX,e.data.position.y=e.pageY,e.data.start.x=e.pageX,e.data.start.y=e.pageY,e.data.event=e;if(e.data.onstart&&e.data.onstart.call(e.data.element,e.data))return;e.preventDefault&&e.data.preventDefault&&e.preventDefault(),e.stopPropagation&&e.data.stopPropagation&&e.stopPropagation(),l(e.data.affects,r,d,e.data),l(e.data.affects,i,v,e.data)}function d(e){e.preventDefault&&e.data.preventDefault&&e.preventDefault(),e.stopPropagation&&e.data.preventDefault&&e.stopPropagation(),e.data.move.x=e.pageX-e.data.position.x,e.data.move.y=e.pageY-e.data.position.y,e.data.position.x=e.pageX,e.data.position.y=e.pageY,e.data.offset.x=e.pageX-e.data.start.x,e.data.offset.y=e.pageY-e.data.start.y,e.data.event=e,e.data.onmove&&e.data.onmove.call(e.data.element,e.data)}function v(e){e.preventDefault&&e.data.preventDefault&&e.preventDefault(),e.stopPropagation&&e.data.stopPropagation&&e.stopPropagation(),f(e.data.affects,r,d),f(e.data.affects,i,v),e.data.event=e,e.data.onfinish&&e.data.onfinish.call(e.data.element,e.data)}function m(e){e.data.position.x=e.touches[0].pageX,e.data.position.y=e.touches[0].pageY,e.data.start.x=e.touches[0].pageX,e.data.start.y=e.touches[0].pageY,e.data.event=e;if(e.data.onstart&&e.data.onstart.call(e.data.element,e.data))return;e.preventDefault&&e.data.preventDefault&&e.preventDefault(),e.stopPropagation&&e.data.stopPropagation&&e.stopPropagation(),l(e.data.affects,o,g,e.data),l(e.data.affects,u,y,e.data)}function g(e){e.preventDefault&&e.data.preventDefault&&e.preventDefault(),e.stopPropagation&&e.data.stopPropagation&&e.stopPropagation(),e.data.move.x=e.touches[0].pageX-e.data.position.x,e.data.move.y=e.touches[0].pageY-e.data.position.y,e.data.position.x=e.touches[0].pageX,e.data.position.y=e.touches[0].pageY,e.data.offset.x=e.touches[0].pageX-e.data.start.x,e.data.offset.y=e.touches[0].pageY-e.data.start.y,e.data.event=e,e.data.onmove&&e.data.onmove.call(e.data.elem,e.data)}function y(e){e.preventDefault&&e.data.preventDefault&&e.preventDefault(),e.stopPropagation&&e.data.stopPropagation&&e.stopPropagation(),f(e.data.affects,o,g),f(e.data.affects,u,y),e.data.event=e,e.data.onfinish&&e.data.onfinish.call(e.data.element,e.data)}var t=e.extend,n="mousedown",r="mousemove",i="mouseup",s="touchstart",o="touchmove",u="touchend",a="touchcancel";l._binds=[],e.fn.grab=function(e,t){return this.each(function(){return c(this,e,t)})},e.fn.ungrab=function(e){return this.each(function(){return h(this,e)})}}(jQuery),define("com/external/jplayer/jquery.grab",function(){}),function(e,t){e.jQuery?t(e.jQuery):t(e.Zepto)}(this,function(e,t){e.fn.jPlayer=function(n){var r="jPlayer",i=typeof n=="string",s=Array.prototype.slice.call(arguments,1),o=this;return n=!i&&s.length?e.extend.apply(null,[!0,n].concat(s)):n,i&&n.charAt(0)==="_"?o:(i?this.each(function(){var i=e(this).data(r),u=i&&e.isFunction(i[n])?i[n].apply(i,s):i;if(u!==i&&u!==t)return o=u,!1}):this.each(function(){var t=e(this).data(r);t?t.option(n||{}):e(this).data(r,new e.jPlayer(n,this))}),o)},e.jPlayer=function(t,n){if(arguments.length){this.element=e(n),this.options=e.extend(!0,{},this.options,t);var r=this;this.element.bind("remove.jPlayer",function(){r.destroy()}),this._init()}},typeof e.fn.stop!="function"&&(e.fn.stop=function(){}),e.jPlayer.emulateMethods="load play pause",e.jPlayer.emulateStatus="src readyState networkState currentTime duration paused ended playbackRate",e.jPlayer.emulateOptions="muted volume",e.jPlayer.reservedEvent="ready flashreset resize repeat error warning",e.jPlayer.event={},e.each(["ready","flashreset","resize","repeat","click","error","warning","loadstart","progress","suspend","abort","emptied","stalled","play","pause","loadedmetadata","loadeddata","waiting","playing","canplay","canplaythrough","seeking","seeked","timeupdate","ended","ratechange","durationchange","volumechange"],function(){e.jPlayer.event[this]="jPlayer_"+this}),e.jPlayer.htmlEvent=["loadstart","abort","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","ratechange"],e.jPlayer.pause=function(){e.each(e.jPlayer.prototype.instances,function(e,t){t.data("jPlayer").status.srcSet&&t.jPlayer("pause")})},e.jPlayer.timeFormat={showHour:!1,showMin:!0,showSec:!0,padHour:!1,padMin:!0,padSec:!0,sepHour:":",sepMin:":",sepSec:""};var n=function(){this.init()};n.prototype={init:function(){this.options={timeFormat:e.jPlayer.timeFormat}},time:function(e){e=e&&typeof e=="number"?e:0;var t=new Date(e*1e3),n=t.getUTCHours(),r=this.options.timeFormat.showHour?t.getUTCMinutes():t.getUTCMinutes()+n*60,i=this.options.timeFormat.showMin?t.getUTCSeconds():t.getUTCSeconds()+r*60,s=this.options.timeFormat.padHour&&n<10?"0"+n:n,o=this.options.timeFormat.padMin&&r<10?"0"+r:r,u=this.options.timeFormat.padSec&&i<10?"0"+i:i,a="";return a+=this.options.timeFormat.showHour?s+this.options.timeFormat.sepHour:"",a+=this.options.timeFormat.showMin?o+this.options.timeFormat.sepMin:"",a+=this.options.timeFormat.showSec?u+this.options.timeFormat.sepSec:"",a}};var r=new n;e.jPlayer.convertTime=function(e){return r.time(e)},e.jPlayer.uaBrowser=function(e){var t=e.toLowerCase(),n=/(webkit)[ \/]([\w.]+)/,r=/(opera)(?:.*version)?[ \/]([\w.]+)/,i=/(msie) ([\w.]+)/,s=/(mozilla)(?:.*? rv:([\w.]+))?/,o=n.exec(t)||r.exec(t)||i.exec(t)||t.indexOf("compatible")<0&&s.exec(t)||[];return{browser:o[1]||"",version:o[2]||"0"}},e.jPlayer.uaPlatform=function(e){var t=e.toLowerCase(),n=/(ipad|iphone|ipod|android|blackberry|playbook|windows ce|webos)/,r=/(ipad|playbook)/,i=/(android)/,s=/(mobile)/,o=n.exec(t)||[],u=r.exec(t)||!s.exec(t)&&i.exec(t)||[];return o[1]&&(o[1]=o[1].replace(/\s/g,"_")),{platform:o[1]||"",tablet:u[1]||""}},e.jPlayer.browser={},e.jPlayer.platform={};var i=e.jPlayer.uaBrowser(navigator.userAgent);i.browser&&(e.jPlayer.browser[i.browser]=!0,e.jPlayer.browser.version=i.version);var s=e.jPlayer.uaPlatform(navigator.userAgent);s.platform&&(e.jPlayer.platform[s.platform]=!0,e.jPlayer.platform.mobile=!s.tablet,e.jPlayer.platform.tablet=!!s.tablet),e.jPlayer.getDocMode=function(){var t;return e.jPlayer.browser.msie&&(document.documentMode?t=document.documentMode:(t=5,document.compatMode&&document.compatMode==="CSS1Compat"&&(t=7))),t},e.jPlayer.browser.documentMode=e.jPlayer.getDocMode(),e.jPlayer.nativeFeatures={init:function(){var e=document,t=e.createElement("video"),n={w3c:["fullscreenEnabled","fullscreenElement","requestFullscreen","exitFullscreen","fullscreenchange","fullscreenerror"],moz:["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],webkit:["","webkitCurrentFullScreenElement","webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange",""],webkitVideo:["webkitSupportsFullscreen","webkitDisplayingFullscreen","webkitEnterFullscreen","webkitExitFullscreen","",""]},r=["w3c","moz","webkit","webkitVideo"],i,s,o;this.fullscreen=i={support:{w3c:!!e[n.w3c[0]],moz:!!e[n.moz[0]],webkit:typeof e[n.webkit[3]]=="function",webkitVideo:typeof t[n.webkitVideo[2]]=="function"},used:{}};for(s=0,o=r.length;s<o;s++){var u=r[s];if(i.support[u]){i.spec=u,i.used[u]=!0;break}}if(i.spec){var a=n[i.spec];i.api={fullscreenEnabled:!0,fullscreenElement:function(t){return t=t?t:e,t[a[1]]},requestFullscreen:function(e){return e[a[2]]()},exitFullscreen:function(t){return t=t?t:e,t[a[3]]()}},i.event={fullscreenchange:a[4],fullscreenerror:a[5]}}else i.api={fullscreenEnabled:!1,fullscreenElement:function(){return null},requestFullscreen:function(){},exitFullscreen:function(){}},i.event={}}},e.jPlayer.nativeFeatures.init(),e.jPlayer.focus=null,e.jPlayer.keyIgnoreElementNames="INPUT TEXTAREA";var o=function(t){var n=e.jPlayer.focus,r;n&&(e.each(e.jPlayer.keyIgnoreElementNames.split(/\s+/g),function(e,n){if(t.target.nodeName.toUpperCase()===n.toUpperCase())return r=!0,!1}),r||e.each(n.options.keyBindings,function(r,i){if(i&&t.which===i.key&&e.isFunction(i.fn))return t.preventDefault(),i.fn(n),!1}))};e.jPlayer.keys=function(t){var n="keydown.jPlayer";e(document.documentElement).unbind(n),t&&e(document.documentElement).bind(n,o)},e.jPlayer.keys(!0),e.jPlayer.prototype={count:0,version:{script:"2.4.0",needFlash:"2.4.0",flash:"unknown"},options:{swfPath:"js",solution:"html, flash",supplied:"mp3",preload:"metadata",volume:.8,muted:!1,wmode:"opaque",backgroundColor:"#000000",cssSelectorAncestor:"#jp_container_1",cssSelector:{videoPlay:".jp-video-play",play:".jp-play",pause:".jp-pause",stop:".jp-stop",seekBar:".jp-seek-bar",playBar:".jp-play-bar",mute:".jp-mute",unmute:".jp-unmute",volumeBar:".jp-volume-bar",volumeBarValue:".jp-volume-bar-value",volumeMax:".jp-volume-max",currentTime:".jp-current-time",duration:".jp-duration",fullScreen:".jp-full-screen",restoreScreen:".jp-restore-screen",repeat:".jp-repeat",repeatOff:".jp-repeat-off",gui:".jp-gui",noSolution:".jp-no-solution"},smoothPlayBar:!1,fullScreen:!1,fullWindow:!1,autohide:{restored:!1,full:!0,fadeIn:200,fadeOut:600,hold:1e3},loop:!1,repeat:function(t){t.jPlayer.options.loop?e(this).unbind(".jPlayerRepeat").bind(e.jPlayer.event.ended+".jPlayer.jPlayerRepeat",function(){e(this).jPlayer("play")}):e(this).unbind(".jPlayerRepeat")},nativeVideoControls:{},noFullWindow:{msie:/msie [0-6]\./,ipad:/ipad.*?os [0-4]\./,iphone:/iphone/,ipod:/ipod/,android_pad:/android [0-3]\.(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/},noVolume:{ipad:/ipad/,iphone:/iphone/,ipod:/ipod/,android_pad:/android(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/,playbook:/playbook/},timeFormat:{},keyEnabled:!1,audioFullScreen:!1,keyBindings:{play:{key:32,fn:function(e){e.status.paused?e.play():e.pause()}},fullScreen:{key:13,fn:function(e){(e.status.video||e.options.audioFullScreen)&&e._setOption("fullScreen",!e.options.fullScreen)}},muted:{key:8,fn:function(e){e._muted(!e.options.muted)}},volumeUp:{key:38,fn:function(e){e.volume(e.options.volume+.1)}},volumeDown:{key:40,fn:function(e){e.volume(e.options.volume-.1)}}},verticalVolume:!1,idPrefix:"jp",noConflict:"jQuery",emulateHtml:!1,errorAlerts:!1,warningAlerts:!1},optionsAudio:{size:{width:"0px",height:"0px",cssClass:""},sizeFull:{width:"0px",height:"0px",cssClass:""}},optionsVideo:{size:{width:"480px",height:"270px",cssClass:"jp-video-270p"},sizeFull:{width:"100%",height:"100%",cssClass:"jp-video-full"}},instances:{},status:{src:"",media:{},paused:!0,format:{},formatType:"",waitForPlay:!0,waitForLoad:!0,srcSet:!1,video:!1,seekPercent:0,currentPercentRelative:0,currentPercentAbsolute:0,currentTime:0,duration:0,videoWidth:0,videoHeight:0,readyState:0,networkState:0,playbackRate:1,ended:0},internal:{ready:!1},solution:{html:!0,flash:!0},format:{mp3:{codec:'audio/mpeg; codecs="mp3"',flashCanPlay:!0,media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:!0,media:"audio"},oga:{codec:'audio/ogg; codecs="vorbis"',flashCanPlay:!1,media:"audio"},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:!1,media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:!1,media:"audio"},fla:{codec:"audio/x-flv",flashCanPlay:!0,media:"audio"},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"audio"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:!0,media:"video"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:!1,media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:!1,media:"video"},flv:{codec:"video/x-flv",flashCanPlay:!0,media:"video"},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"video"}},_init:function(){var n=this;this.element.empty(),this.status=e.extend({},this.status),this.internal=e.extend({},this.internal),this.options.timeFormat=e.extend({},e.jPlayer.timeFormat,this.options.timeFormat),this.internal.cmdsIgnored=e.jPlayer.platform.ipad||e.jPlayer.platform.iphone||e.jPlayer.platform.ipod,this.internal.domNode=this.element.get(0),this.options.keyEnabled&&!e.jPlayer.focus&&(e.jPlayer.focus=this),this.formats=[],this.solutions=[],this.require={},this.htmlElement={},this.html={},this.html.audio={},this.html.video={},this.flash={},this.css={},this.css.cs={},this.css.jq={},this.ancestorJq=[],this.options.volume=this._limitValue(this.options.volume,0,1),e.each(this.options.supplied.toLowerCase().split(","),function(t,r){var i=r.replace(/^\s+|\s+$/g,"");if(n.format[i]){var s=!1;e.each(n.formats,function(e,t){if(i===t)return s=!0,!1}),s||n.formats.push(i)}}),e.each(this.options.solution.toLowerCase().split(","),function(t,r){var i=r.replace(/^\s+|\s+$/g,"");if(n.solution[i]){var s=!1;e.each(n.solutions,function(e,t){if(i===t)return s=!0,!1}),s||n.solutions.push(i)}}),this.internal.instance="jp_"+this.count,this.instances[this.internal.instance]=this.element,this.element.attr("id")||this.element.attr("id",this.options.idPrefix+"_jplayer_"+this.count),this.internal.self=e.extend({},{id:this.element.attr("id"),jq:this.element}),this.internal.audio=e.extend({},{id:this.options.idPrefix+"_audio_"+this.count,jq:t}),this.internal.video=e.extend({},{id:this.options.idPrefix+"_video_"+this.count,jq:t}),this.internal.flash=e.extend({},{id:this.options.idPrefix+"_flash_"+this.count,jq:t,swf:this.options.swfPath+(this.options.swfPath.toLowerCase().slice(-4)!==".swf"?(this.options.swfPath&&this.options.swfPath.slice(-1)!=="/"?"/":"")+"Jplayer.swf":"")}),this.internal.poster=e.extend({},{id:this.options.idPrefix+"_poster_"+this.count,jq:t}),e.each(e.jPlayer.event,function(e,r){n.options[e]!==t&&(n.element.bind(r+".jPlayer",n.options[e]),n.options[e]=t)}),this.require.audio=!1,this.require.video=!1,e.each(this.formats,function(e,t){n.require[n.format[t].media]=!0}),this.require.video?this.options=e.extend(!0,{},this.optionsVideo,this.options):this.options=e.extend(!0,{},this.optionsAudio,this.options),this._setSize(),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this.status.noVolume=this._uaBlocklist(this.options.noVolume),e.jPlayer.nativeFeatures.fullscreen.api.fullscreenEnabled&&this._fullscreenAddEventListeners(),this._restrictNativeVideoControls(),this.htmlElement.poster=document.createElement("img"),this.htmlElement.poster.id=this.internal.poster.id,this.htmlElement.poster.onload=function(){(!n.status.video||n.status.waitForPlay)&&n.internal.poster.jq.show()},this.element.append(this.htmlElement.poster),this.internal.poster.jq=e("#"+this.internal.poster.id),this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),this.internal.poster.jq.hide(),this.internal.poster.jq.bind("click.jPlayer",function(){n._trigger(e.jPlayer.event.click)}),this.html.audio.available=!1,this.require.audio&&(this.htmlElement.audio=document.createElement("audio"),this.htmlElement.audio.id=this.internal.audio.id,this.html.audio.available=!!this.htmlElement.audio.canPlayType&&this._testCanPlayType(this.htmlElement.audio)),this.html.video.available=!1,this.require.video&&(this.htmlElement.video=document.createElement("video"),this.htmlElement.video.id=this.internal.video.id,this.html.video.available=!!this.htmlElement.video.canPlayType&&this._testCanPlayType(this.htmlElement.video)),this.flash.available=this._checkForFlash(10.1),this.html.canPlay={},this.flash.canPlay={},e.each(this.formats,function(e,t){n.html.canPlay[t]=n.html[n.format[t].media].available&&""!==n.htmlElement[n.format[t].media].canPlayType(n.format[t].codec),n.flash.canPlay[t]=n.format[t].flashCanPlay&&n.flash.available}),this.html.desired=!1,this.flash.desired=!1,e.each(this.solutions,function(t,r){if(t===0)n[r].desired=!0;else{var i=!1,s=!1;e.each(n.formats,function(e,t){n[n.solutions[0]].canPlay[t]&&(n.format[t].media==="video"?s=!0:i=!0)}),n[r].desired=n.require.audio&&!i||n.require.video&&!s}}),this.html.support={},this.flash.support={},e.each(this.formats,function(e,t){n.html.support[t]=n.html.canPlay[t]&&n.html.desired,n.flash.support[t]=n.flash.canPlay[t]&&n.flash.desired}),this.html.used=!1,this.flash.used=!1,e.each(this.solutions,function(t,r){e.each(n.formats,function(e,t){if(n[r].support[t])return n[r].used=!0,!1})}),this._resetActive(),this._resetGate(),this._cssSelectorAncestor(this.options.cssSelectorAncestor),!this.html.used&&!this.flash.used?(this._error({type:e.jPlayer.error.NO_SOLUTION,context:"{solution:'"+this.options.solution+"', supplied:'"+this.options.supplied+"'}",message:e.jPlayer.errorMsg.NO_SOLUTION,hint:e.jPlayer.errorHint.NO_SOLUTION}),this.css.jq.noSolution.length&&this.css.jq.noSolution.show()):this.css.jq.noSolution.length&&this.css.jq.noSolution.hide();if(this.flash.used){var r,i="jQuery="+encodeURI(this.options.noConflict)+"&id="+encodeURI(this.internal.self.id)+"&vol="+this.options.volume+"&muted="+this.options.muted;if(e.jPlayer.browser.msie&&(Number(e.jPlayer.browser.version)<9||e.jPlayer.browser.documentMode<9)){var s='<object id="'+this.internal.flash.id+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="0" height="0" tabindex="-1"></object>',o=['<param name="movie" value="'+this.internal.flash.swf+'" />','<param name="FlashVars" value="'+i+'" />','<param name="allowScriptAccess" value="always" />','<param name="bgcolor" value="'+this.options.backgroundColor+'" />','<param name="wmode" value="'+this.options.wmode+'" />'];r=document.createElement(s);for(var u=0;u<o.length;u++)r.appendChild(document.createElement(o[u]))}else{var a=function(e,t,n){var r=document.createElement("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)};r=document.createElement("object"),r.setAttribute("id",this.internal.flash.id),r.setAttribute("name",this.internal.flash.id),r.setAttribute("data",this.internal.flash.swf),r.setAttribute("type","application/x-shockwave-flash"),r.setAttribute("width","1"),r.setAttribute("height","1"),r.setAttribute("tabindex","-1"),a(r,"flashvars",i),a(r,"allowscriptaccess","always"),a(r,"bgcolor",this.options.backgroundColor),a(r,"wmode",this.options.wmode)}this.element.append(r),this.internal.flash.jq=e(r)}this.html.used&&(this.html.audio.available&&(this._addHtmlEventListeners(this.htmlElement.audio,this.html.audio),this.element.append(this.htmlElement.audio),this.internal.audio.jq=e("#"+this.internal.audio.id)),this.html.video.available&&(this._addHtmlEventListeners(this.htmlElement.video,this.html.video),this.element.append(this.htmlElement.video),this.internal.video.jq=e("#"+this.internal.video.id),this.status.nativeVideoControls?this.internal.video.jq.css({width:this.status.width,height:this.status.height}):this.internal.video.jq.css({width:"0px",height:"0px"}),this.internal.video.jq.bind("click.jPlayer",function(){n._trigger(e.jPlayer.event.click)}))),this.options.emulateHtml&&this._emulateHtmlBridge(),this.html.used&&!this.flash.used&&setTimeout(function(){n.internal.ready=!0,n.version.flash="n/a",n._trigger(e.jPlayer.event.repeat),n._trigger(e.jPlayer.event.ready)},100),this._updateNativeVideoControls(),this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),e.jPlayer.prototype.count++},destroy:function(){this.clearMedia(),this._removeUiClass(),this.css.jq.currentTime.length&&this.css.jq.currentTime.text(""),this.css.jq.duration.length&&this.css.jq.duration.text(""),e.each(this.css.jq,function(e,t){t.length&&t.unbind(".jPlayer")}),this.internal.poster.jq.unbind(".jPlayer"),this.internal.video.jq&&this.internal.video.jq.unbind(".jPlayer"),this._fullscreenRemoveEventListeners(),this===e.jPlayer.focus&&(e.jPlayer.focus=null),this.options.emulateHtml&&this._destroyHtmlBridge(),this.element.removeData("jPlayer"),this.element.unbind(".jPlayer"),this.element.empty(),delete this.instances[this.internal.instance]},enable:function(){},disable:function(){},_testCanPlayType:function(e){try{return e.canPlayType(this.format.mp3.codec),!0}catch(t){return!1}},_uaBlocklist:function(t){var n=navigator.userAgent.toLowerCase(),r=!1;return e.each(t,function(e,t){if(t&&t.test(n))return r=!0,!1}),r},_restrictNativeVideoControls:function(){this.require.audio&&this.status.nativeVideoControls&&(this.status.nativeVideoControls=!1,this.status.noFullWindow=!0)},_updateNativeVideoControls:function(){this.html.video.available&&this.html.used&&(this.htmlElement.video.controls=this.status.nativeVideoControls,this._updateAutohide(),this.status.nativeVideoControls&&this.require.video?(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})):this.status.waitForPlay&&this.status.video&&(this.internal.poster.jq.show(),this.internal.video.jq.css({width:"0px",height:"0px"})))},_addHtmlEventListeners:function(t,n){var r=this;t.preload=this.options.preload,t.muted=this.options.muted,t.volume=this.options.volume,t.addEventListener("progress",function(){n.gate&&(r.internal.cmdsIgnored&&this.readyState>0&&(r.internal.cmdsIgnored=!1),r._getHtmlStatus(t),r._updateInterface(),r._trigger(e.jPlayer.event.progress))},!1),t.addEventListener("timeupdate",function(){n.gate&&(r._getHtmlStatus(t),r._updateInterface(),r._trigger(e.jPlayer.event.timeupdate))},!1),t.addEventListener("durationchange",function(){n.gate&&(r._getHtmlStatus(t),r._updateInterface(),r._trigger(e.jPlayer.event.durationchange))},!1),t.addEventListener("play",function(){n.gate&&(r._updateButtons(!0),r._html_checkWaitForPlay(),r._trigger(e.jPlayer.event.play))},!1),t.addEventListener("playing",function(){n.gate&&(r._updateButtons(!0),r._seeked(),r._trigger(e.jPlayer.event.playing))},!1),t.addEventListener("pause",function(){n.gate&&(r._updateButtons(!1),r._trigger(e.jPlayer.event.pause))},!1),t.addEventListener("waiting",function(){n.gate&&(r._seeking(),r._trigger(e.jPlayer.event.waiting))},!1),t.addEventListener("seeking",function(){n.gate&&(r._seeking(),r._trigger(e.jPlayer.event.seeking))},!1),t.addEventListener("seeked",function(){n.gate&&(r._seeked(),r._trigger(e.jPlayer.event.seeked))},!1),t.addEventListener("volumechange",function(){n.gate&&(r.options.volume=t.volume,r.options.muted=t.muted,r._updateMute(),r._updateVolume(),r._trigger(e.jPlayer.event.volumechange))},!1),t.addEventListener("suspend",function(){n.gate&&(r._seeked(),r._trigger(e.jPlayer.event.suspend))},!1),t.addEventListener("ended",function(){n.gate&&(e.jPlayer.browser.webkit||(r.htmlElement.media.currentTime=0),r.htmlElement.media.pause(),r._updateButtons(!1),r._getHtmlStatus(t,!0),r._updateInterface(),r._trigger(e.jPlayer.event.ended))},!1),t.addEventListener("error",function(){n.gate&&(r._updateButtons(!1),r._seeked(),r.status.srcSet&&(clearTimeout(r.internal.htmlDlyCmdId),r.status.waitForLoad=!0,r.status.waitForPlay=!0,r.status.video&&!r.status.nativeVideoControls&&r.internal.video.jq.css({width:"0px",height:"0px"}),r._validString(r.status.media.poster)&&!r.status.nativeVideoControls&&r.internal.poster.jq.show(),r.css.jq.videoPlay.length&&r.css.jq.videoPlay.show(),r._error({type:e.jPlayer.error.URL,context:r.status.src,message:e.jPlayer.errorMsg.URL,hint:e.jPlayer.errorHint.URL})))},!1),e.each(e.jPlayer.htmlEvent,function(i,s){t.addEventListener(this,function(){n.gate&&r._trigger(e.jPlayer.event[s])},!1)})},_getHtmlStatus:function(e,t){var n=0,r=0,i=0,s=0;isFinite(e.duration)&&(this.status.duration=e.duration),n=e.currentTime,r=this.status.duration>0?100*n/this.status.duration:0,typeof e.seekable=="object"&&e.seekable.length>0?(i=this.status.duration>0?100*e.seekable.end(e.seekable.length-1)/this.status.duration:100,s=this.status.duration>0?100*e.currentTime/e.seekable.end(e.seekable.length-1):0):(i=100,s=r),t&&(n=0,s=0,r=0),this.status.seekPercent=i,this.status.currentPercentRelative=s,this.status.currentPercentAbsolute=r,this.status.currentTime=n,this.status.videoWidth=e.videoWidth,this.status.videoHeight=e.videoHeight,this.status.readyState=e.readyState,this.status.networkState=e.networkState,this.status.playbackRate=e.playbackRate,this.status.ended=e.ended},_resetStatus:function(){this.status=e.extend({},this.status,e.jPlayer.prototype.status)},_trigger:function(t,n,r){var i=e.Event(t);i.jPlayer={},i.jPlayer.version=e.extend({},this.version),i.jPlayer.options=e.extend(!0,{},this.options),i.jPlayer.status=e.extend(!0,{},this.status),i.jPlayer.html=e.extend(!0,{},this.html),i.jPlayer.flash=e.extend(!0,{},this.flash),n&&(i.jPlayer.error=e.extend({},n)),r&&(i.jPlayer.warning=e.extend({},r)),this.element.trigger(i)},jPlayerFlashEvent:function(t,n){if(t===e.jPlayer.event.ready)if(!this.internal.ready)this.internal.ready=!0,this.internal.flash.jq.css({width:"0px",height:"0px"}),this.version.flash=n.version,this.version.needFlash!==this.version.flash&&this._error({type:e.jPlayer.error.VERSION,context:this.version.flash,message:e.jPlayer.errorMsg.VERSION+this.version.flash,hint:e.jPlayer.errorHint.VERSION}),this._trigger(e.jPlayer.event.repeat),this._trigger(t);else if(this.flash.gate){if(this.status.srcSet){var r=this.status.currentTime,i=this.status.paused;this.setMedia(this.status.media),r>0&&(i?this.pause(r):this.play(r))}this._trigger(e.jPlayer.event.flashreset)}if(this.flash.gate)switch(t){case e.jPlayer.event.progress:this._getFlashStatus(n),this._updateInterface(),this._trigger(t);break;case e.jPlayer.event.timeupdate:this._getFlashStatus(n),this._updateInterface(),this._trigger(t);break;case e.jPlayer.event.play:this._seeked(),this._updateButtons(!0),this._trigger(t);break;case e.jPlayer.event.pause:this._updateButtons(!1),this._trigger(t);break;case e.jPlayer.event.ended:this._updateButtons(!1),this._trigger(t);break;case e.jPlayer.event.click:this._trigger(t);break;case e.jPlayer.event.error:this.status.waitForLoad=!0,this.status.waitForPlay=!0,this.status.video&&this.internal.flash.jq.css({width:"0px",height:"0px"}),this._validString(this.status.media.poster)&&this.internal.poster.jq.show(),this.css.jq.videoPlay.length&&this.status.video&&this.css.jq.videoPlay.show(),this.status.video?this._flash_setVideo(this.status.media):this._flash_setAudio(this.status.media),this._updateButtons(!1),this._error({type:e.jPlayer.error.URL,context:n.src,message:e.jPlayer.errorMsg.URL,hint:e.jPlayer.errorHint.URL});break;case e.jPlayer.event.seeking:this._seeking(),this._trigger(t);break;case e.jPlayer.event.seeked:this._seeked(),this._trigger(t);break;case e.jPlayer.event.ready:break;default:this._trigger(t)}return!1},_getFlashStatus:function(e){this.status.seekPercent=e.seekPercent,this.status.currentPercentRelative=e.currentPercentRelative,this.status.currentPercentAbsolute=e.currentPercentAbsolute,this.status.currentTime=e.currentTime,this.status.duration=e.duration,this.status.videoWidth=e.videoWidth,this.status.videoHeight=e.videoHeight,this.status.readyState=4,this.status.networkState=0,this.status.playbackRate=1,this.status.ended=!1},_updateButtons:function(e){e===t?e=!this.status.paused:this.status.paused=!e,this.css.jq.play.length&&this.css.jq.pause.length&&(e?(this.css.jq.play.hide(),this.css.jq.pause.show()):(this.css.jq.play.show(),this.css.jq.pause.hide())),this.css.jq.restoreScreen.length&&this.css.jq.fullScreen.length&&(this.status.noFullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.hide()):this.options.fullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.show()):(this.css.jq.fullScreen.show(),this.css.jq.restoreScreen.hide())),this.css.jq.repeat.length&&this.css.jq.repeatOff.length&&(this.options.loop?(this.css.jq.repeat.hide(),this.css.jq.repeatOff.show()):(this.css.jq.repeat.show(),this.css.jq.repeatOff.hide()))},_updateInterface:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.width(this.status.seekPercent+"%"),this.css.jq.playBar.length&&(this.options.smoothPlayBar?this.css.jq.playBar.stop().animate({width:this.status.currentPercentAbsolute+"%"},250,"linear"):this.css.jq.playBar.width(this.status.currentPercentRelative+"%")),this.css.jq.currentTime.length&&this.css.jq.currentTime.text(this._convertTime(this.status.currentTime)),this.css.jq.duration.length&&this.css.jq.duration.text(this._convertTime(this.status.duration))},_convertTime:n.prototype.time,_seeking:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.addClass("jp-seeking-bg")},_seeked:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.removeClass("jp-seeking-bg")},_resetGate:function(){this.html.audio.gate=!1,this.html.video.gate=!1,this.flash.gate=!1},_resetActive:function(){this.html.active=!1,this.flash.active=!1},setMedia:function(t){var n=this,r=!1,i=this.status.media.poster!==t.poster;this._resetMedia(),this._resetGate(),this._resetActive(),e.each(this.formats,function(i,s){var o=n.format[s].media==="video";e.each(n.solutions,function(e,i){if(n[i].support[s]&&n._validString(t[s])){var u=i==="html";return o?(u?(n.html.video.gate=!0,n._html_setVideo(t),n.html.active=!0):(n.flash.gate=!0,n._flash_setVideo(t),n.flash.active=!0),n.css.jq.videoPlay.length&&n.css.jq.videoPlay.show(),n.status.video=!0):(u?(n.html.audio.gate=!0,n._html_setAudio(t),n.html.active=!0):(n.flash.gate=!0,n._flash_setAudio(t),n.flash.active=!0),n.css.jq.videoPlay.length&&n.css.jq.videoPlay.hide(),n.status.video=!1),r=!0,!1}});if(r)return!1}),r?((!this.status.nativeVideoControls||!this.html.video.gate)&&this._validString(t.poster)&&(i?this.htmlElement.poster.src=t.poster:this.internal.poster.jq.show()),this.status.srcSet=!0,this.status.media=e.extend({},t),this._updateButtons(!1),this._updateInterface()):this._error({type:e.jPlayer.error.NO_SUPPORT,context:"{supplied:'"+this.options.supplied+"'}",message:e.jPlayer.errorMsg.NO_SUPPORT,hint:e.jPlayer.errorHint.NO_SUPPORT})},_resetMedia:function(){this._resetStatus(),this._updateButtons(!1),this._updateInterface(),this._seeked(),this.internal.poster.jq.hide(),clearTimeout(this.internal.htmlDlyCmdId),this.html.active?this._html_resetMedia():this.flash.active&&this._flash_resetMedia()},clearMedia:function(){this._resetMedia(),this.html.active?this._html_clearMedia():this.flash.active&&this._flash_clearMedia(),this._resetGate(),this._resetActive()},load:function(){this.status.srcSet?this.html.active?this._html_load():this.flash.active&&this._flash_load():this._urlNotSetError("load")},focus:function(){this.options.keyEnabled&&(e.jPlayer.focus=this)},play:function(e){e=typeof e=="number"?e:NaN,this.status.srcSet?(this.focus(),this.html.active?this._html_play(e):this.flash.active&&this._flash_play(e)):this._urlNotSetError("play")},videoPlay:function(){this.play()},pause:function(e){e=typeof e=="number"?e:NaN,this.status.srcSet?this.html.active?this._html_pause(e):this.flash.active&&this._flash_pause(e):this._urlNotSetError("pause")},pauseOthers:function(){var t=this;e.each(this.instances,function(e,n){t.element!==n&&n.data("jPlayer").status.srcSet&&n.jPlayer("pause")})},stop:function(){this.status.srcSet?this.html.active?this._html_pause(0):this.flash.active&&this._flash_pause(0):this._urlNotSetError("stop")},playHead:function(e){e=this._limitValue(e,0,100),this.status.srcSet?this.html.active?this._html_playHead(e):this.flash.active&&this._flash_playHead(e):this._urlNotSetError("playHead")},_muted:function(t){this.options.muted=t,this.html.used&&this._html_mute(t),this.flash.used&&this._flash_mute(t),!this.html.video.gate&&!this.html.audio.gate&&(this._updateMute(t),this._updateVolume(this.options.volume),this._trigger(e.jPlayer.event.volumechange))},mute:function(e){e=e===t?!0:!!e,this._muted(e)},unmute:function(e){e=e===t?!0:!!e,this._muted(!e)},_updateMute:function(e){e===t&&(e=this.options.muted),this.css.jq.mute.length&&this.css.jq.unmute.length&&(this.status.noVolume?(this.css.jq.mute.hide(),this.css.jq.unmute.hide()):e?(this.css.jq.mute.hide(),this.css.jq.unmute.show()):(this.css.jq.mute.show(),this.css.jq.unmute.hide()))},volume:function(t){t=this._limitValue(t,0,1),this.options.volume=t,this.html.used&&this._html_volume(t),this.flash.used&&this._flash_volume(t),!this.html.video.gate&&!this.html.audio.gate&&(this._updateVolume(t),this._trigger(e.jPlayer.event.volumechange))},volumeBar:function(t){if(this.css.jq.volumeBar.length){var n=e(t.currentTarget),r=n.offset(),i=t.pageX-r.left,s=n.width(),o=n.height()-t.pageY+r.top,u=n.height();this.options.verticalVolume?this.volume(o/u):this.volume(i/s)}this.options.muted&&this._muted(!1)},volumeBarValue:function(){},_updateVolume:function(e){e===t&&(e=this.options.volume),e=this.options.muted?0:e,this.status.noVolume?(this.css.jq.volumeBar.length&&this.css.jq.volumeBar.hide(),this.css.jq.volumeBarValue.length&&this.css.jq.volumeBarValue.hide(),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.hide()):(this.css.jq.volumeBar.length&&this.css.jq.volumeBar.show(),this.css.jq.volumeBarValue.length&&(this.css.jq.volumeBarValue.show(),this.css.jq.volumeBarValue[this.options.verticalVolume?"height":"width"](e*100+"%")),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.show())},volumeMax:function(){this.volume(1),this.options.muted&&this._muted(!1)},_cssSelectorAncestor:function(t){var n=this;this.options.cssSelectorAncestor=t,this._removeUiClass(),this.ancestorJq=t?e(t):[],t&&this.ancestorJq.length!==1&&this._warning({type:e.jPlayer.warning.CSS_SELECTOR_COUNT,context:t,message:e.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.ancestorJq.length+" found for cssSelectorAncestor.",hint:e.jPlayer.warningHint.CSS_SELECTOR_COUNT}),this._addUiClass(),e.each(this.options.cssSelector,function(e,t){n._cssSelector(e,t)}),this._updateInterface(),this._updateButtons(),this._updateAutohide(),this._updateVolume(),this._updateMute()},_cssSelector:function(t,n){var r=this;if(typeof n=="string")if(e.jPlayer.prototype.options.cssSelector[t]){this.css.jq[t]&&this.css.jq[t].length&&this.css.jq[t].unbind(".jPlayer"),this.options.cssSelector[t]=n,this.css.cs[t]=this.options.cssSelectorAncestor+" "+n,n?this.css.jq[t]=e(this.css.cs[t]):this.css.jq[t]=[];if(this.css.jq[t].length){var i=function(n){n.preventDefault(),r[t](n),e(this).blur()};this.css.jq[t].bind("click.jPlayer",i)}n&&this.css.jq[t].length!==1&&this._warning({type:e.jPlayer.warning.CSS_SELECTOR_COUNT,context:this.css.cs[t],message:e.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.css.jq[t].length+" found for "+t+" method.",hint:e.jPlayer.warningHint.CSS_SELECTOR_COUNT})}else this._warning({type:e.jPlayer.warning.CSS_SELECTOR_METHOD,context:t,message:e.jPlayer.warningMsg.CSS_SELECTOR_METHOD,hint:e.jPlayer.warningHint.CSS_SELECTOR_METHOD});else this._warning({type:e.jPlayer.warning.CSS_SELECTOR_STRING,context:n,message:e.jPlayer.warningMsg.CSS_SELECTOR_STRING,hint:e.jPlayer.warningHint.CSS_SELECTOR_STRING})},seekBar:function(t){if(this.css.jq.seekBar.length){var n=e(t.currentTarget),r=n.offset(),i=t.pageX-r.left,s=n.width(),o=100*i/s;this.playHead(o)}},playBar:function(){},repeat:function(){this._loop(!0)},repeatOff:function(){this._loop(!1)},_loop:function(t){this.options.loop!==t&&(this.options.loop=t,this._updateButtons(),this._trigger(e.jPlayer.event.repeat))},currentTime:function(){},duration:function(){},gui:function(){},noSolution:function(){},option:function(n,r){var i=n;if(arguments.length===0)return e.extend(!0,{},this.options);if(typeof n=="string"){var s=n.split(".");if(r===t){var o=e.extend(!0,{},this.options);for(var u=0;u<s.length;u++){if(o[s[u]]===t)return this._warning({type:e.jPlayer.warning.OPTION_KEY,context:n,message:e.jPlayer.warningMsg.OPTION_KEY,hint:e.jPlayer.warningHint.OPTION_KEY}),t;o=o[s[u]]}return o}i={};var a=i;for(var f=0;f<s.length;f++)f<s.length-1?(a[s[f]]={},a=a[s[f]]):a[s[f]]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(t,n){var r=this;switch(t){case"volume":this.volume(n);break;case"muted":this._muted(n);break;case"cssSelectorAncestor":this._cssSelectorAncestor(n);break;case"cssSelector":e.each(n,function(e,t){r._cssSelector(e,t)});break;case"fullScreen":if(this.options[t]!==n){var i=e.jPlayer.nativeFeatures.fullscreen.used.webkitVideo;if(!i||i&&!this.status.waitForPlay)i||(this.options[t]=n),n?this._requestFullscreen():this._exitFullscreen(),i||this._setOption("fullWindow",n)}break;case"fullWindow":this.options[t]!==n&&(this._removeUiClass(),this.options[t]=n,this._refreshSize());break;case"size":!this.options.fullWindow&&this.options[t].cssClass!==n.cssClass&&this._removeUiClass(),this.options[t]=e.extend({},this.options[t],n),this._refreshSize();break;case"sizeFull":this.options.fullWindow&&this.options[t].cssClass!==n.cssClass&&this._removeUiClass(),this.options[t]=e.extend({},this.options[t],n),this._refreshSize();break;case"autohide":this.options[t]=e.extend({},this.options[t],n),this._updateAutohide();break;case"loop":this._loop(n);break;case"nativeVideoControls":this.options[t]=e.extend({},this.options[t],n),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this._restrictNativeVideoControls(),this._updateNativeVideoControls();break;case"noFullWindow":this.options[t]=e.extend({},this.options[t],n),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this._restrictNativeVideoControls(),this._updateButtons();break;case"noVolume":this.options[t]=e.extend({},this.options[t],n),this.status.noVolume=this._uaBlocklist(this.options.noVolume),this._updateVolume(),this._updateMute();break;case"emulateHtml":this.options[t]!==n&&(this.options[t]=n,n?this._emulateHtmlBridge():this._destroyHtmlBridge());break;case"timeFormat":this.options[t]=e.extend({},this.options[t],n);break;case"keyEnabled":this.options[t]=n,!n&&this===e.jPlayer.focus&&(e.jPlayer.focus=null);break;case"keyBindings":this.options[t]=e.extend(!0,{},this.options[t],n);break;case"audioFullScreen":this.options[t]=n}return this},_refreshSize:function(){this._setSize(),this._addUiClass(),this._updateSize(),this._updateButtons(),this._updateAutohide(),this._trigger(e.jPlayer.event.resize)},_setSize:function(){this.options.fullWindow?(this.status.width=this.options.sizeFull.width,this.status.height=this.options.sizeFull.height,this.status.cssClass=this.options.sizeFull.cssClass):(this.status.width=this.options.size.width,this.status.height=this.options.size.height,this.status.cssClass=this.options.size.cssClass),this.element.css({width:this.status.width,height:this.status.height})},_addUiClass:function(){this.ancestorJq.length&&this.ancestorJq.addClass(this.status.cssClass)},_removeUiClass:function(){this.ancestorJq.length&&this.ancestorJq.removeClass(this.status.cssClass)},_updateSize:function(){this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),!this.status.waitForPlay&&this.html.active&&this.status.video||this.html.video.available&&this.html.used&&this.status.nativeVideoControls?this.internal.video.jq.css({width:this.status.width,height:this.status.height}):!this.status.waitForPlay&&this.flash.active&&this.status.video&&this.internal.flash.jq.css({width:this.status.width,height:this.status.height})},_updateAutohide:function(){var e=this,t="mousemove.jPlayer",n=".jPlayerAutohide",r=t+n,i=function(){e.css.jq.gui.fadeIn(e.options.autohide.fadeIn,function(){clearTimeout(e.internal.autohideId),e.internal.autohideId=setTimeout(function(){e.css.jq.gui.fadeOut(e.options.autohide.fadeOut)},e.options.autohide.hold)})};this.css.jq.gui.length&&(this.css.jq.gui.stop(!0,!0),clearTimeout(this.internal.autohideId),this.element.unbind(n),this.css.jq.gui.unbind(n),this.status.nativeVideoControls?this.css.jq.gui.hide():this.options.fullWindow&&this.options.autohide.full||!this.options.fullWindow&&this.options.autohide.restored?(this.element.bind(r,i),this.css.jq.gui.bind(r,i),this.css.jq.gui.hide()):this.css.jq.gui.show())},fullScreen:function(){this._setOption("fullScreen",!0)},restoreScreen:function(){this._setOption("fullScreen",!1)},_fullscreenAddEventListeners:function(){var t=this,n=e.jPlayer.nativeFeatures.fullscreen;n.api.fullscreenEnabled&&n.event.fullscreenchange&&(typeof this.internal.fullscreenchangeHandler!="function"&&(this.internal.fullscreenchangeHandler=function(){t._fullscreenchange()}),document.addEventListener(n.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1))},_fullscreenRemoveEventListeners:function(){var t=e.jPlayer.nativeFeatures.fullscreen;this.internal.fullscreenchangeHandler&&document.addEventListener(t.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1)},_fullscreenchange:function(){this.options.fullScreen&&!e.jPlayer.nativeFeatures.fullscreen.api.fullscreenElement()&&this._setOption("fullScreen",!1)},_requestFullscreen:function(){var t=this.ancestorJq.length?this.ancestorJq[0]:this.element[0],n=e.jPlayer.nativeFeatures.fullscreen;n.used.webkitVideo&&(t=this.htmlElement.video),n.api.fullscreenEnabled&&n.api.requestFullscreen(t)},_exitFullscreen:function(){var t=e.jPlayer.nativeFeatures.fullscreen,n;t.used.webkitVideo&&(n=this.htmlElement.video),t.api.fullscreenEnabled&&t.api.exitFullscreen(n)},_html_initMedia:function(t){var n=e(this.htmlElement.media).empty();e.each(t.track||[],function(e,t){var r=document.createElement("track");r.setAttribute("kind",t.kind?t.kind:""),r.setAttribute("src",t.src?t.src:""),r.setAttribute("srclang",t.srclang?t.srclang:""),r.setAttribute("label",t.label?t.label:""),t.def&&r.setAttribute("default",t.def),n.append(r)}),this.htmlElement.media.src=this.status.src,this.options.preload!=="none"&&this._html_load(),this._trigger(e.jPlayer.event.timeupdate)},_html_setFormat:function(t){var n=this;e.each(this.formats,function(e,r){if(n.html.support[r]&&t[r])return n.status.src=t[r],n.status.format[r]=!0,n.status.formatType=r,!1})},_html_setAudio:function(e){this._html_setFormat(e),this.htmlElement.media=this.htmlElement.audio,this._html_initMedia(e)},_html_setVideo:function(e){this._html_setFormat(e),this.status.nativeVideoControls&&(this.htmlElement.video.poster=this._validString(e.poster)?e.poster:""),this.htmlElement.media=this.htmlElement.video,this._html_initMedia(e)},_html_resetMedia:function(){this.htmlElement.media&&(this.htmlElement.media.id===this.internal.video.id&&!this.status.nativeVideoControls&&this.internal.video.jq.css({width:"0px",height:"0px"}),this.htmlElement.media.pause())},_html_clearMedia:function(){this.htmlElement.media&&(this.htmlElement.media.src="about:blank",this.htmlElement.media.load())},_html_load:function(){this.status.waitForLoad&&(this.status.waitForLoad=!1,this.htmlElement.media.load()),clearTimeout(this.internal.htmlDlyCmdId)},_html_play:function(e){var t=this,n=this.htmlElement.media;this._html_load();if(!isNaN(e)){this.internal.cmdsIgnored&&n.play();try{if(!(!n.seekable||typeof n.seekable=="object"&&n.seekable.length>0))throw 1;n.currentTime=e,n.play()}catch(r){this.internal.htmlDlyCmdId=setTimeout(function(){t.play(e)},250);return}}else n.play();this._html_checkWaitForPlay()},_html_pause:function(e){var t=this,n=this.htmlElement.media;e>0?this._html_load():clearTimeout(this.internal.htmlDlyCmdId),n.pause();if(!isNaN(e))try{if(!(!n.seekable||typeof n.seekable=="object"&&n.seekable.length>0))throw 1;n.currentTime=e}catch(r){this.internal.htmlDlyCmdId=setTimeout(function(){t.pause(e)},250);return}e>0&&this._html_checkWaitForPlay()},_html_playHead:function(e){var t=this,n=this.htmlElement.media;this._html_load();try{if(typeof n.seekable=="object"&&n.seekable.length>0)n.currentTime=e*n.seekable.end(n.seekable.length-1)/100;else{if(!(n.duration>0&&!isNaN(n.duration)))throw"e";n.currentTime=e*n.duration/100}}catch(r){this.internal.htmlDlyCmdId=setTimeout(function(){t.playHead(e)},250);return}this.status.waitForLoad||this._html_checkWaitForPlay()},_html_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})))},_html_volume:function(e){this.html.audio.available&&(this.htmlElement.audio.volume=e),this.html.video.available&&(this.htmlElement.video.volume=e)},_html_mute:function(e){this.html.audio.available&&(this.htmlElement.audio.muted=e),this.html.video.available&&(this.htmlElement.video.muted=e)},_flash_setAudio:function(t){var n=this;try{e.each(this.formats,function(e,r){if(n.flash.support[r]&&t[r]){switch(r){case"m4a":case"fla":n._getMovie().fl_setAudio_m4a(t[r]);break;case"mp3":n._getMovie().fl_setAudio_mp3(t[r]);break;case"rtmpa":n._getMovie().fl_setAudio_rtmp(t[r])}return n.status.src=t[r],n.status.format[r]=!0,n.status.formatType=r,!1}}),this.options.preload==="auto"&&(this._flash_load(),this.status.waitForLoad=!1)}catch(r){this._flashError(r)}},_flash_setVideo:function(t){var n=this;try{e.each(this.formats,function(e,r){if(n.flash.support[r]&&t[r]){switch(r){case"m4v":case"flv":n._getMovie().fl_setVideo_m4v(t[r]);break;case"rtmpv":n._getMovie().fl_setVideo_rtmp(t[r])}return n.status.src=t[r],n.status.format[r]=!0,n.status.formatType=r,!1}}),this.options.preload==="auto"&&(this._flash_load(),this.status.waitForLoad=!1)}catch(r){this._flashError(r)}},_flash_resetMedia:function(){this.internal.flash.jq.css({width:"0px",height:"0px"}),this._flash_pause(NaN)},_flash_clearMedia:function(){try{this._getMovie().fl_clearMedia()}catch(e){this._flashError(e)}},_flash_load:function(){try{this._getMovie().fl_load()}catch(e){this._flashError(e)}this.status.waitForLoad=!1},_flash_play:function(e){try{this._getMovie().fl_play(e)}catch(t){this._flashError(t)}this.status.waitForLoad=!1,this._flash_checkWaitForPlay()},_flash_pause:function(e){try{this._getMovie().fl_pause(e)}catch(t){this._flashError(t)}e>0&&(this.status.waitForLoad=!1,this._flash_checkWaitForPlay())},_flash_playHead:function(e){try{this._getMovie().fl_play_head(e)}catch(t){this._flashError(t)}this.status.waitForLoad||this._flash_checkWaitForPlay()},_flash_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.flash.jq.css({width:this.status.width,height:this.status.height})))},_flash_volume:function(e){try{this._getMovie().fl_volume(e)}catch(t){this._flashError(t)}},_flash_mute:function(e){try{this._getMovie().fl_mute(e)}catch(t){this._flashError(t)}},_getMovie:function(){return document[this.internal.flash.id]},_getFlashPluginVersion:function(){var e=0,t;if(window.ActiveXObject)try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(t){var n=t.GetVariable("$version");n&&(n=n.split(" ")[1].split(","),e=parseInt(n[0],10)+"."+parseInt(n[1],10))}}catch(r){}else navigator.plugins&&navigator.mimeTypes.length>0&&(t=navigator.plugins["Shockwave Flash"],t&&(e=navigator.plugins["Shockwave Flash"].description.replace(/.*\s(\d+\.\d+).*/,"$1")));return e*1},_checkForFlash:function(e){var t=!1;return this._getFlashPluginVersion()>=e&&(t=!0),t},_validString:function(e){return e&&typeof e=="string"},_limitValue:function(e,t,n){return e<t?t:e>n?n:e},_urlNotSetError:function(t){this._error({type:e.jPlayer.error.URL_NOT_SET,context:t,message:e.jPlayer.errorMsg.URL_NOT_SET,hint:e.jPlayer.errorHint.URL_NOT_SET})},_flashError:function(t){var n;this.internal.ready?n="FLASH_DISABLED":n="FLASH",this._error({type:e.jPlayer.error[n],context:this.internal.flash.swf,message:e.jPlayer.errorMsg[n]+t.message,hint:e.jPlayer.errorHint[n]}),this.internal.flash.jq.css({width:"1px",height:"1px"})},_error:function(t){this._trigger(e.jPlayer.event.error,t),this.options.errorAlerts&&this._alert("Error!"+(t.message?"\n\n"+t.message:"")+(t.hint?"\n\n"+t.hint:"")+"\n\nContext: "+t.context)},_warning:function(n){this._trigger(e.jPlayer.event.warning,t,n),this.options.warningAlerts&&this._alert("Warning!"+(n.message?"\n\n"+n.message:"")+(n.hint?"\n\n"+n.hint:"")+"\n\nContext: "+n.context)},_alert:function(e){alert("jPlayer "+this.version.script+" : id='"+this.internal.self.id+"' : "+e)},_emulateHtmlBridge:function(){var t=this;e.each(e.jPlayer.emulateMethods.split(/\s+/g),function(e,n){t.internal.domNode[n]=function(e){t[n](e)}}),e.each(e.jPlayer.event,function(n,r){var i=!0;e.each(e.jPlayer.reservedEvent.split(/\s+/g),function(e,t){if(t===n)return i=!1,!1}),i&&t.element.bind(r+".jPlayer.jPlayerHtml",function(){t._emulateHtmlUpdate();var e=document.createEvent("Event");e.initEvent(n,!1,!0),t.internal.domNode.dispatchEvent(e)})})},_emulateHtmlUpdate:function(){var t=this;e.each(e.jPlayer.emulateStatus.split(/\s+/g),function(e,n){t.internal.domNode[n]=t.status[n]}),e.each(e.jPlayer.emulateOptions.split(/\s+/g),function(e,n){t.internal.domNode[n]=t.options[n]})},_destroyHtmlBridge:function(){var t=this;this.element.unbind(".jPlayerHtml");var n=e.jPlayer.emulateMethods+" "+e.jPlayer.emulateStatus+" "+e.jPlayer.emulateOptions;e.each(n.split(/\s+/g),function(e,n){delete t.internal.domNode[n]})}},e.jPlayer.error={FLASH:"e_flash",FLASH_DISABLED:"e_flash_disabled",NO_SOLUTION:"e_no_solution",NO_SUPPORT:"e_no_support",URL:"e_url",URL_NOT_SET:"e_url_not_set",VERSION:"e_version"},e.jPlayer.errorMsg={FLASH:"jPlayer's Flash fallback is not configured correctly, or a command was issued before the jPlayer Ready event. Details: ",FLASH_DISABLED:"jPlayer's Flash fallback has been disabled by the browser due to the CSS rules you have used. Details: ",NO_SOLUTION:"No solution can be found by jPlayer in this browser. Neither HTML nor Flash can be used.",NO_SUPPORT:"It is not possible to play any media format provided in setMedia() on this browser using your current options.",URL:"Media URL could not be loaded.",URL_NOT_SET:"Attempt to issue media playback commands, while no media url is set.",VERSION:"jPlayer "+e.jPlayer.prototype.version.script+" needs Jplayer.swf version "+e.jPlayer.prototype.version.needFlash+" but found "},e.jPlayer.errorHint={FLASH:"Check your swfPath option and that Jplayer.swf is there.",FLASH_DISABLED:"Check that you have not display:none; the jPlayer entity or any ancestor.",NO_SOLUTION:"Review the jPlayer options: support and supplied.",NO_SUPPORT:"Video or audio formats defined in the supplied option are missing.",URL:"Check media URL is valid.",URL_NOT_SET:"Use setMedia() to set the media URL.",VERSION:"Update jPlayer files."},e.jPlayer.warning={CSS_SELECTOR_COUNT:"e_css_selector_count",CSS_SELECTOR_METHOD:"e_css_selector_method",CSS_SELECTOR_STRING:"e_css_selector_string",OPTION_KEY:"e_option_key"},e.jPlayer.warningMsg={CSS_SELECTOR_COUNT:"The number of css selectors found did not equal one: ",CSS_SELECTOR_METHOD:"The methodName given in jPlayer('cssSelector') is not a valid jPlayer method.",CSS_SELECTOR_STRING:"The methodCssSelector given in jPlayer('cssSelector') is not a String or is empty.",OPTION_KEY:"The option requested in jPlayer('option') is undefined."},e.jPlayer.warningHint={CSS_SELECTOR_COUNT:"Check your css selector and the ancestor.",CSS_SELECTOR_METHOD:"Check your method name.",CSS_SELECTOR_STRING:"Check your css selector is a string.",OPTION_KEY:"Check your option name."}}),define("com/external/jplayer/jquery.jplayer.min",function(){});var CirclePlayer=function(e,t,n,r){var i=this,s={supplied:"mp3, m4a",cssSelectorAncestor:"#cp_container_1",cssSelector:{play:".cp-play",pause:".cp-pause"}},o={bufferHolder:".cp-buffer-holder",buffer1:".cp-buffer-1",buffer2:".cp-buffer-2",progressHolder:".cp-progress-holder",progress1:".cp-progress-1",progress2:".cp-progress-2",circleControl:".cp-circle-control"};this.cssClass={gt50:"cp-gt50",fallback:"cp-fallback"},this.containerRef=e,this.spritePitch=104,this.spriteRatio=.24,this.player=$(i.containerRef).find(t),this.media=$.extend({},n),this.options=$.extend(!0,{},s,r),this.cssTransforms=Modernizr.csstransforms,this.audio={},this.dragging=!1,this.eventNamespace=".CirclePlayer",this.jq={},$.each(o,function(e,t){i.jq[e]=$(i.options.cssSelectorAncestor+" "+t,i.containerRef)}),this._initSolution(),this._initPlayer()};CirclePlayer.prototype={_createHtml:function(){},_initPlayer:function(){var e=this;this.player.jPlayer(this.options),this.player.bind($.jPlayer.event.ready+this.eventNamespace,function(t){t.jPlayer.html.used&&t.jPlayer.html.audio.available&&(e.audio=$(this).data("jPlayer").htmlElement.audio),$(this).jPlayer("setMedia",e.media),e._initCircleControl()}),this.player.bind($.jPlayer.event.play+this.eventNamespace,function(e){$(this).jPlayer("pauseOthers")}),this.player.bind($.jPlayer.event.timeupdate+this.eventNamespace,function(t){e.dragging||e._timeupdate(t.jPlayer.status.currentPercentAbsolute)}),this.player.bind($.jPlayer.event.progress+this.eventNamespace,function(t){var n=0;if(typeof e.audio.buffered=="object"&&e.audio.buffered.length>0){if(e.audio.duration>0){var r=0;for(var i=0;i<e.audio.buffered.length;i++)r+=e.audio.buffered.end(i)-e.audio.buffered.start(i);n=100*r/e.audio.duration}}else n=0;e._progress(n)}),this.player.bind($.jPlayer.event.ended+this.eventNamespace,function(t){e._resetSolution()})},_initSolution:function(){this.cssTransforms?(this.jq.progressHolder.show(),this.jq.bufferHolder.show()):(this.jq.progressHolder.addClass(this.cssClass.gt50).show(),this.jq.progress1.addClass(this.cssClass.fallback),this.jq.progress2.hide(),this.jq.bufferHolder.hide()),this._resetSolution()},_resetSolution:function(){this.cssTransforms?(this.jq.progressHolder.removeClass(this.cssClass.gt50),this.jq.progress1.css({transform:"rotate(0deg)"}),this.jq.progress2.css({transform:"rotate(0deg)"}).hide()):this.jq.progress1.css("background-position","0 "+this.spritePitch+"px")},_initCircleControl:function(){var e=this;this.jq.circleControl.grab({containerRef:e.containerRef,onstart:function(){e.dragging=!0},onmove:function(t){var n=e._getArcPercent(t.position.x,t.position.y);e.player.jPlayer("playHead",n).jPlayer("play"),e._timeupdate(n)},onfinish:function(t){e.dragging=!1;var n=e._getArcPercent(t.position.x,t.position.y);e.player.jPlayer("playHead",n).jPlayer("play")}})},_timeupdate:function(e){var t=e*3.6+"deg",n=(Math.floor(Math.round(e)*this.spriteRatio)-1)*-this.spritePitch;e<=50?this.cssTransforms?(this.jq.progressHolder.removeClass(this.cssClass.gt50),this.jq.progress1.css({transform:"rotate("+t+")"}),this.jq.progress2.hide()):this.jq.progress1.css("background-position","0 "+n+"px"):e<=100&&(this.cssTransforms?(this.jq.progressHolder.addClass(this.cssClass.gt50),this.jq.progress1.css({transform:"rotate(180deg)"}),this.jq.progress2.css({transform:"rotate("+t+")"}),this.jq.progress2.show()):this.jq.progress1.css("background-position","0 "+n+"px"))},_progress:function(e){var t=e*3.6+"deg";this.cssTransforms&&(e<=50?(this.jq.bufferHolder.removeClass(this.cssClass.gt50),this.jq.buffer1.css({transform:"rotate("+t+")"}),this.jq.buffer2.hide()):e<=100&&(this.jq.bufferHolder.addClass(this.cssClass.gt50),this.jq.buffer1.css({transform:"rotate(180deg)"}),this.jq.buffer2.show(),this.jq.buffer2.css({transform:"rotate("+t+")"})))},_getArcPercent:function(e,t){var n=this.jq.circleControl.offset(),r=e-n.left-this.jq.circleControl.width()/2,i=t-n.top-this.jq.circleControl.height()/2,s=Math.atan2(i,r);return s>-1*Math.PI&&s<-0.5*Math.PI&&(s=2*Math.PI+s),(s+Math.PI/2)/2*Math.PI*10},setMedia:function(e){this.media=$.extend({},e),this.player.jPlayer("setMedia",this.media)},play:function(e){this.player.jPlayer("play",e)},pause:function(e){this.player.jPlayer("pause",e)},destroy:function(){this.player.unbind(this.eventNamespace),this.player.jPlayer("destroy")}},define("com/external/jplayer/circle.player",function(){}),define("com/es/widgets/audio/AudioWidget",["com/es/widgets/WidgetUtils","com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/audioView/printViewTemplate.html","com/external/jplayer/jquery.transform2d","com/external/jplayer/jquery.grab","com/external/jplayer/jquery.jplayer.min","com/external/jplayer/circle.player"],function(e,t,n,r,s){var o=function(o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S={},x=WIDGET_CONSTANTS.AUDIO_MAX_WIDTH,T=WIDGET_CONSTANTS.AUDIO_MIN_WIDTH,N=WIDGET_CONSTANTS.AUDIO_MIN_HEIGHT,C=!1,k=!1,L,A,O=null,M=!1,D,P=[],H=function(){g=a.bookFrameContent,y=a.bookFrameContentRootEl;if(a.data_json){var e=a.data_json,t=f.split("/");t.pop(),t=t.join("/")+"/"+a.dataURL;var n=t.split("/");n.pop(),l=n.join("/")+"/",j(e)}else B()},B=function(){var e=f.split("/");e.pop(),e=e.join("/")+"/"+a.dataURL;var t=e.split("/");t.pop(),l=t.join("/")+"/",$.getJSON(e,{}).done(function(e){j(e)}).fail(function(e,t,n){u.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,n.message)})},j=function(t){h=t,h.formattedTitle&&(h.title=h.formattedTitle),h.duration=parseInt(h.duration)/1e3,a.view!==undefined?e.log("default view pre-injected",a.view):WIDGET_CONSTANTS.PRINT_MODE?F():C||J(),u.trigger(WIDGET_EVENTS.INITIALIZED,u)},F=function(){et(),S={id:"widget-"+c.id,width:$("#"+c.id,g).width()+"px",title:h.title,description:h.description},$("#"+S.id,g).remove();var e=_.template(s,S);a.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?y.QAappend(e):($("#"+c.id,g).empty().addClass("reflow-print").QAappend(e),$("#"+c.id,g).find(".icon").addClass("reflow-print")),u.trigger(WIDGET_EVENTS.RENDER_COMPLETE,u)},I=function(){if(WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&P[0].downloadStatus!=3&&WIDGET_CONSTANTS.NETWORK_AVAILABLE===!1){u.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE);return}v.paused===!0?(v.play(),$(".cp-play",p[0]).hide(),$(".cp-pause",p[0]).show()):(v.pause(),$(".cp-play",p[0]).show(),$(".cp-pause",p[0]).hide()),u.trigger(WIDGET_EVENTS.PLAY_CLICKED,u),v.paused||u.trigger(WIDGET_EVENTS.XAPI_EVENT,u)},q=function(){if(WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&P[0].downloadStatus!=3&&WIDGET_CONSTANTS.NETWORK_AVAILABLE===!1){u.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE);return}var e=$(".play-pause-btn",D);E.paused===!0?(E.play(),$(e).addClass("audio-play")):(E.pause(),$(e).removeClass("audio-play")),u.trigger(WIDGET_EVENTS.PLAY_CLICKED,u),E.paused||u.trigger(WIDGET_EVENTS.XAPI_EVENT,u)},R=function(){v!==undefined&&(v.pause(),U()),E&&(E.pause(),$(".play-pause-btn",D).removeClass("audio-play"))},U=function(){$(".cp-play",p[0]).show(),$(".cp-pause",p[0]).hide()},z=function(t){e.log(t.clientX,t.clientY)},W=function(e,t){$(e).attr({"data-fileSize":t.size,"data-downloadable":!0,"data-launchFile":"","data-downloadUrl":t.data[0].src})},X=function(){M&&(a.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(et(),Z()),a.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?V():Y())},V=function(){if(a.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t,n,r,i;t=e.getOffset($("#"+c.id,g)).left,n=e.getOffset($("#"+c.id,g)).top,r=$("#"+c.id,g).width(),i=$("#"+c.id,g).height();var s=$("#ui-"+c.id,a.bookFrameContent);$(s[0]).css("top",n),$(s[0]).css("left",t),$(s[0]).css("width",r+"px"),$(s[0]).css("height",i+"px"),$(s[0]).css("position","absolute")}},J=function(){var n=g,r="widget-"+c.id,i="ui-"+c.id;e.log("_resourceURL",l),n.find("#"+i).length>0&&n.find("#"+i).remove();var s='<div class="ui-audio-gal widget-ui ui-border invisible" id="'+i+'"></div>',o=$("#"+c.id,n).get(0).innerHTML;o=o.trim(),o.length==0?($("#"+c.id,n).get(0).innerHTML=s,y.append($("#"+i,n))):y.append(s),W($("#"+c.id,n),h);var a=ft(h.duration);et(),S={id:r,width:$("#"+c.id,g).width()+"px",resourceURL:l,title:h.title,data:h.data,duration:a},e.log("_frameCont",g),e.log("audio json",S);var f=WIDGET_CONSTANTS.ASSETS_URL+h.data[0].src;WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&P[0].downloadStatus==3?f=WIDGET_CONSTANTS.DOWNLOADED_ASSETS_URL+h.data[0].src:f=f+"?"+(new Date).getTime(),f=e.getCleanURL(f),S.src="";var d=_.template(t,{obj:S}),b=$("#"+i,n);$(b[0]).html(d);var E=new CirclePlayer(b[0],"#jquery_jplayer_1",{mp3:f,m4a:f},{cssSelectorAncestor:"#cp_container_1",volume:1});w=E,p=b;var x=$("#jquery_jplayer_1 audio",b[0])[0],T=$(".volume-bar",b[0]);v=x,m="#player-"+r,$(".cp-pp-ctrl",b[0]).bind(WIDGET_EVENTS.CLICK,function(e){I()}),$("#jquery_jplayer_1",b[0]).bind($.jPlayer.event.play,function(e){$(".cp-play",p[0]).hide(),$(".cp-pause, .ui-duration, .volume-div > .mute-btn",p[0]).show(),u.trigger(WIDGET_EVENTS.PLAY_CLICKED,u)}),$("#jquery_jplayer_1",b[0]).bind($.jPlayer.event.pause,function(e){$(".cp-pause, .volume-div > .mute-btn",p[0]).hide(),$(".cp-play",p[0]).show()}),$(".volume-div > .mute-btn",b[0]).hide(),$(v).bind(WIDGET_EVENTS.TIME_UPDATE,function(){ct()}),$(v).bind(WIDGET_EVENTS.ENDED,function(){ot()}),e.isTouchDevice()&&($(".volume-div",b[0]).hide(),$(".mute-btn",p[0])),e.isTouchDevice()?$(".volume-div",b[0]).hide():($(T).bind(WIDGET_EVENTS.CHANGE,function(e){ut(e,v)}),$(".volume-div",b[0]).hover(function(){$(".volume-up-down",b[0]).stop(!0,!0).slideDown(300)},function(){$(".volume-up-down",b[0]).stop(!0,!0).slideUp(300)}),$(".mute-btn",p[0]).bind(WIDGET_EVENTS.CLICK,function(e){ht(e.target,v)})),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&($("#ui-"+c.id,n).QAappend("<div class='download-widget-blue-corner' ><span class='download-widget-icon'></span></div>"),$("#ui-"+c.id+" .download-widget-icon",n).addClass("white-download-status-"+P[0].downloadStatus),$("#ui-"+c.id+" .download-widget-icon",n).unbind("click").bind("click",tt)),G()},K=function(){L=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")},Q=function(){if(navigator.plugins.length>=1)for(i=0;i<navigator.plugins.length;i++){if(navigator.plugins[i].name.indexOf("QuickTime")>=0){k=!0;return}k=!1}},G=function(){$("#"+c.id,g).removeClass("widget-loader"),$("#"+c.id,g).find(".move-icon").removeClass("move-icon-compact"),Z();if(a.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){Y();var e=$("#"+c.id,g).height();e<N&&($("#"+c.id,g).height(N),$("#ui-"+c.id,g).height(N));var t=$("#"+c.id,g).width();t<T&&($("#"+c.id,g).width(T),$("#ui-"+c.id,g).width(T));if(a.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){S.uiId="ui-"+c.id;var r=_.template(n,{id:S.uiId}),i=$("#"+c.id,g).get(0).innerHTML;i=i.trim(),i.length==0?($("#"+c.id,g).get(0).innerHTML=r,y.append($("#div-border-"+S.uiId,g))):y.append(r),$("#div-border-"+S.uiId,g).css({width:$(A).width()+"px",height:$(A).height()+"px",top:A.style.top,left:A.style.left,position:"absolute"}),$("#div-border-"+S.uiId,g).addClass("transparentWidget ui-hover-class"),$("#div-border-"+S.uiId,g).css({"pointer-events":"none"})}$(".inline-widget-footer",p.get(0)).remove(),$(".circleplayer",p.get(0)).remove(),$(p).html('<div class="ui-clickable-icon ui-audio-icon icon-font"></div>'),$(p).addClass("transparentWidget"),$(p).removeClass("ui-border"),$(p).css({width:$(".ui-clickable-icon",p).width()+"px",height:$(".ui-clickable-icon",p).height()+"px"}),$("#"+c.id,g).find(".move-icon").addClass("move-icon-compact"),$("#"+c.id+" .dummyWidget",g).show(),a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+c.id,g).css({width:$(".ui-clickable-icon",A).width()+"px",height:$(".ui-clickable-icon",A).height()+"px"}),$("#"+c.id+" .dummyWidget",g).hide()),$(".ui-audio-icon",p).click({},it)}else a.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?($(p).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize quiz-play-button'></div></div>"),$("audio",p).remove(),$(".ui-maximize",p).click({},it)):a.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&$(".ui-maximize",A).click({},it)}else $(".ui-maximize",p).click({},it);M=!0,u.trigger(WIDGET_EVENTS.RENDER_COMPLETE,u,x,T)},Y=function(){$("#"+c.id,g).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+c.id,g)).left,n=e.getOffset($("#"+c.id,g)).top,r=$("#"+c.id,g).width(),i=$("#"+c.id,g).height(),A=$("#ui-"+c.id,g).get(0),a.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(A).css({top:n+"px",left:t+"px",position:"absolute"}):$(A).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+S.uiId,g).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},Z=function(){if(a.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT&&a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE)var e=$("#"+c.id,g).height();else var e=$("#"+c.id,g).width();S.height=e,$("#"+c.id,a.bookFrameContent).css("height",S.height+"px")},et=function(){if(a.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+c.id,g).width();e<T&&$("#"+c.id,g).width(T),e>x&&$("#"+c.id,g).width(x)}},tt=function(e){var t=P[0].id,n=P[0].downloadStatus;switch(parseInt(n)){case 0:n=1;break;case 1:case 2:n=2;break;case 3:n=3;break;default:}u.trigger(WIDGET_EVENTS.DOWNLOAD_ACTION,c.id,t,n)},nt=function(e,t,n){P[0].downloadStatus=t,$("#ui-"+c.id+" .download-widget-icon",g).removeClass("white-download-status-0 white-download-status-1 white-download-status-2 white-download-status-3"),$("#ui-"+c.id+" .download-widget-icon",g).addClass("white-download-status-"+t);if(D){var r=D.find("#widget-"+c.id);r.length>0&&($("#widget-header .download-widget-icon",d).removeClass("download-status-0 download-status-1 download-status-2 download-status-3"),$("#widget-header .download-widget-icon",d).addClass("download-status-"+t))}},rt=function(){et(),Z(),V()},it=function(){R(),d.addClass("audio-popup"),u.trigger(WIDGET_EVENTS.LAUNCHED,u)},st=function(){D=$("#widgetContent",d);var t="";!C||P.length?t="widget-"+c.id:t="widget-"+(new Date).getTime();var n=ft(h.duration),i={id:t,width:a.width,resourceURL:l,src:WIDGET_CONSTANTS.ASSETS_URL+h.data[0].src,title:h.title,data:h.data,duration:n,description:h.description};WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&P[0].downloadStatus==3&&(i.src=WIDGET_CONSTANTS.DOWNLOADED_ASSETS_URL+h.data[0].src),i.src=e.getCleanURL(i.src);var s=_.template(r,{obj:i});$("#widgetContent",d).html(s),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&($("#widget-header",d).QAappend("<span class='download-widget-icon'></span>"),$("#widget-header .download-widget-icon",d).addClass("download-status-"+P[0].downloadStatus),$("#widget-header .download-widget-icon",d).unbind("click").bind("click",tt));var o=$(".popup-audio",D)[0];E=o;var f=$(".play-pause-btn",D),p=$(".stop-btn",D);_seekBar=$(".seek-bar",D),$(f).bind(WIDGET_EVENTS.CLICK,function(e){q()}),$(p).bind(WIDGET_EVENTS.CLICK,function(e){ot()}),$(_seekBar).bind(WIDGET_EVENTS.CHANGE,function(e){at()}),$(E).bind(WIDGET_EVENTS.TIME_UPDATE,function(e){ct()}),e.isTouchDevice()&&($(".ui-audio-circle",D).addClass("hide-device-volume"),$(".volume-div",D).hide(),$(".mute-btn",D).hide());if(!e.isTouchDevice()){var v=$(".volume-bar",D);$(v).bind(WIDGET_EVENTS.CHANGE,function(e){ut(e,E)}),$(".volume-div",D).hover(function(){$(".volume-up-down",D).stop(!0,!0).slideDown(300)},function(){$(".volume-up-down",D).stop(!0,!0).slideUp(300)}),$(".mute-btn",D).bind(WIDGET_EVENTS.CLICK,function(e){ht(e.target,E)})}else $(".volume-div",D).hide();$("#widgetPopup").removeClass("hide");try{$(".gal-title",d).html(unescape(h.title))}catch(m){}u.trigger(WIDGET_EVENTS.POPULATED,u);var g=".audio-info-description";u.trigger(WIDGET_EVENTS.POPULATE_MORE,h.description,g,D)},ot=function(){$("#widgetContent").html()===""?($(".ui-duration",p[0]).html(ft(h.duration)),$(".cp-play",p[0]).show(),$(".cp-pause",p[0]).hide()):(E.pause(),E.currentTime=0,$(".seek-bar",D).val(0),$(".current-time",D).html("00:00"),$(".play-pause-btn",D).removeClass("audio-play"))},ut=function(t,n){var r=t.target.value/10;n.volume=r,e.fillRange(t.target,r),n.muted&&(n.muted=!1,$(t.target.parentNode).siblings().removeClass("mute"))},at=function(){var e=!E.paused;e&&E.pause(),E.pause();var t=$(".seek-bar",D),n=h.duration*t.val()/100;E.currentTime=n,e&&parseInt(t.val())!=100&&E.play()},ft=function(e){e*=1e3;var t,n,r,i,s;return i=Math.floor(e/1e3),r=Math.floor(i/60),i%=60,n=Math.floor(r/60),r%=60,i===0?i="00":i<10&&(i="0"+i),r===0?r="00":r<10&&(r="0"+r),n===0?(n="00",s=r+":"+i):s=n+":"+r+":"+i,s},lt=function(){},ct=function(){if($("#widgetContent").html()===""){if(v.paused)return;var t=v.currentTime,n=ft(h.duration-t);n=parseFloat(n)<0?"00:00":n,$(".ui-duration",p[0]).html("-"+n)}else{var t=E.currentTime,r=100/h.duration*t;$(".seek-bar",D).val(r),e.fillRange($(".seek-bar",D),r/100),$(".current-time",D).html(ft(t)),E.ended&&$(".play-pause-btn",D).removeClass("audio-play")}},ht=function(e,t){t.muted==0?(t.muted=!0,$(e).addClass("mute")):(t.muted=!1,$(e).removeClass("mute"))},pt=function(){O!=null&&O.destroy()},dt=function(){$("#widget-header .download-widget-icon",d).unbind(),$(E).unbind(),$(".play-pause-btn",D).unbind(),$(".stop-btn",D).unbind(),$(".seek-bar",D).unbind(),$(".volume-bar",D).unbind(),$(".mute-btn",D).unbind(),$(".volume-div",D).unbind("mouseenter mouseleave").unbind(),$(".gal-title",d).html(""),D.empty(),d.removeClass("audio-popup"),u.trigger(WIDGET_EVENTS.DESTROYED,u)},vt=function(){return WIDGET_CONSTANTS.AUDIO_WIDGET},mt=function(){v!==undefined&&(k&&(v.pause(),$(".cp-play",p[0]).show(),$(".cp-pause",p[0]).hide()),v.paused!==!0&&I(),v.pause())},gt=function(){v&&(v.src="")},yt=function(){$(".cp-pp-ctrl",p[0]).unbind(),$("#jquery_jplayer_1",p[0]).unbind(),$(v).unbind(),$(".volume-bar",p[0]).unbind(),$(".mute-btn",p[0]).unbind(),$(".volume-div",p[0]).unbind("mouseenter mouseleave").unbind(),$("#ui-"+c.id+" .download-widget-icon",g).unbind(),$("#"+c.id,g).remove(),$("#ui-"+c.id,g).remove()},bt=Backbone.View.extend({initialize:function(t){e.log("On initialize of audio"),_.extend(this,Backbone.Events),t.directLaunch?(C=!0,t.widgetEnrichmentArr.length&&(c={},c.id=_.findWhere(t.widgetEnrichmentArr,{level:0}).widgetId)):c=t.obj,a=t.options,d=t.popupView,u=this,f=a.bookURL,P=t.widgetEnrichmentArr},initCurrWidget:H,destroy:dt,relayout:X,widgetResize:rt,pause:R,onCloseAllWidgets:mt,widgetType:vt,launch:it,onPopupShown:st,removeMedia:gt,updateDownloadStatus:nt,destroyView:yt});return new bt(o)};return o}),function($){function sc_setScroll(e,t,n){return n.transition=="transition"&&t=="swing"&&(t="ease"),{anims:[],duration:e,orgDuration:e,easing:t,startTime:getTime()}}function sc_startScroll(e,t){for(var n=0,r=e.anims.length;n<r;n++){var i=e.anims[n];if(!i)continue;i[0][t.transition](i[1],e.duration,e.easing,i[2])}}function sc_stopScroll(e,t){is_boolean(t)||(t=!0),is_object(e.pre)&&sc_stopScroll(e.pre,t);for(var n=0,r=e.anims.length;n<r;n++){var i=e.anims[n];i[0].stop(!0),t&&(i[0].css(i[1]),is_function(i[2])&&i[2]())}is_object(e.post)&&sc_stopScroll(e.post,t)}function sc_afterScroll(e,t,n){t&&t.remove();switch(n.fx){case"fade":case"crossfade":case"cover-fade":case"uncover-fade":e.css("opacity",1),e.css("filter","")}}function sc_fireCallbacks(e,t,n,r,i){t[n]&&t[n].call(e,r);if(i[n].length)for(var s=0,o=i[n].length;s<o;s++)i[n][s].call(e,r);return[]}function sc_fireQueue(e,t,n){return t.length&&(e.trigger(cf_e(t[0][0],n),t[0][1]),t.shift()),t}function sc_hideHiddenItems(e){e.each(function(){var e=$(this);e.data("_cfs_isHidden",e.is(":hidden")).hide()})}function sc_showHiddenItems(e){e&&e.each(function(){var e=$(this);e.data("_cfs_isHidden")||e.show()})}function sc_clearTimers(e){return e.auto&&clearTimeout(e.auto),e.progress&&clearInterval(e.progress),e}function sc_mapCallbackArguments(e,t,n,r,i,s,o){return{width:o.width,height:o.height,items:{old:e,skipped:t,visible:n},scroll:{items:r,direction:i,duration:s}}}function sc_getDuration(e,t,n,r){var i=e.duration;return e.fx=="none"?0:(i=="auto"?i=t.scroll.duration/t.scroll.items*n:i<10&&(i=r/i),i<1?0:(e.fx=="fade"&&(i/=2),Math.round(i)))}function nv_showNavi(e,t,n){var r=is_number(e.items.minimum)?e.items.minimum:e.items.visible+1;if(t=="show"||t=="hide")var i=t;else if(r>t){debug(n,"Not enough items ("+t+" total, "+r+" needed): Hiding navigation.");var i="hide"}else var i="show";var s=i=="show"?"removeClass":"addClass",o=cf_c("hidden",n);e.auto.button&&e.auto.button[i]()[s](o),e.prev.button&&e.prev.button[i]()[s](o),e.next.button&&e.next.button[i]()[s](o),e.pagination.container&&e.pagination.container[i]()[s](o)}function nv_enableNavi(e,t,n){if(e.circular||e.infinite)return;var r=t=="removeClass"||t=="addClass"?t:!1,i=cf_c("disabled",n);e.auto.button&&r&&e.auto.button[r](i);if(e.prev.button){var s=r||t==0?"addClass":"removeClass";e.prev.button[s](i)}if(e.next.button){var s=r||t==e.items.visible||t==e.visibleItemCount?"addClass":"removeClass";e.next.button[s](i)}}function go_getObject(e,t){return is_function(t)?t=t.call(e):is_undefined(t)&&(t={}),t}function go_getItemsObject(e,t){return t=go_getObject(e,t),is_number(t)?t={visible:t}:t=="variable"?t={visible:t,width:t,height:t}:is_object(t)||(t={}),t}function go_getScrollObject(e,t){return t=go_getObject(e,t),is_number(t)?t<=50?t={items:t}:t={duration:t}:is_string(t)?t={easing:t}:is_object(t)||(t={}),t}function go_getNaviObject(e,t){t=go_getObject(e,t);if(is_string(t)){var n=cf_getKeyCode(t);n==-1?t=$(t):t=n}return t}function go_getAutoObject(e,t){return t=go_getNaviObject(e,t),is_jquery(t)?t={button:t}:is_boolean(t)?t={play:t}:is_number(t)&&(t={timeoutDuration:t}),t.progress&&(is_string(t.progress)||is_jquery(t.progress))&&(t.progress={bar:t.progress}),t}function go_complementAutoObject(e,t){return is_function(t.button)&&(t.button=t.button.call(e)),is_string(t.button)&&(t.button=$(t.button)),is_boolean(t.play)||(t.play=!0),is_number(t.delay)||(t.delay=0),is_undefined(t.pauseOnEvent)&&(t.pauseOnEvent=!0),is_boolean(t.pauseOnResize)||(t.pauseOnResize=!0),is_number(t.timeoutDuration)||(t.timeoutDuration=t.duration<10?2500:t.duration*5),t.progress&&(is_function(t.progress.bar)&&(t.progress.bar=t.progress.bar.call(e)),is_string(t.progress.bar)&&(t.progress.bar=$(t.progress.bar)),t.progress.bar?(is_function(t.progress.updater)||(t.progress.updater=$.fn.carouFredSel.progressbarUpdater),is_number(t.progress.interval)||(t.progress.interval=50)):t.progress=!1),t}function go_getPrevNextObject(e,t){return t=go_getNaviObject(e,t),is_jquery(t)?t={button:t}:is_number(t)&&(t={key:t}),t}function go_complementPrevNextObject(e,t){return is_function(t.button)&&(t.button=t.button.call(e)),is_string(t.button)&&(t.button=$(t.button)),is_string(t.key)&&(t.key=cf_getKeyCode(t.key)),t}function go_getPaginationObject(e,t){return t=go_getNaviObject(e,t),is_jquery(t)?t={container:t}:is_boolean(t)&&(t={keys:t}),t}function go_complementPaginationObject(e,t){return is_function(t.container)&&(t.container=t.container.call(e)),is_string(t.container)&&(t.container=$(t.container)),is_number(t.items)||(t.items=!1),is_boolean(t.keys)||(t.keys=!1),!is_function(t.anchorBuilder)&&!is_false(t.anchorBuilder)&&(t.anchorBuilder=$.fn.carouFredSel.pageAnchorBuilder),is_number(t.deviation)||(t.deviation=0),t}function go_getSwipeObject(e,t){return is_function(t)&&(t=t.call(e)),is_undefined(t)&&(t={onTouch:!1}),is_true(t)?t={onTouch:t}:is_number(t)&&(t={items:t}),t}function go_complementSwipeObject(e,t){return is_boolean(t.onTouch)||(t.onTouch=!0),is_boolean(t.onMouse)||(t.onMouse=!1),is_object(t.options)||(t.options={}),is_boolean(t.options.triggerOnTouchEnd)||(t.options.triggerOnTouchEnd=!1),t}function go_getMousewheelObject(e,t){return is_function(t)&&(t=t.call(e)),is_true(t)?t={}:is_number(t)?t={items:t}:is_undefined(t)&&(t=!1),t}function go_complementMousewheelObject(e,t){return t}function gn_getItemIndex(e,t,n,r,i){is_string(e)&&(e=$(e,i)),is_object(e)&&(e=$(e,i)),is_jquery(e)?(e=i.children().index(e),is_boolean(n)||(n=!1)):is_boolean(n)||(n=!0),is_number(e)||(e=0),is_number(t)||(t=0),n&&(e+=r.first),e+=t;if(r.total>0){while(e>=r.total)e-=r.total;while(e<0)e+=r.total}return e}function gn_getVisibleItemsPrev(e,t,n){var r=0,i=0;for(var s=n;s>=0;s--){var o=e.eq(s);r+=o.is(":visible")?o[t.d.outerWidth](!0):0;if(r>t.maxDimension)return i;s==0&&(s=e.length),i++}}function gn_getVisibleItemsPrevFilter(e,t,n){return gn_getItemsPrevFilter(e,t.items.filter,t.items.visibleConf.org,n)}function gn_getScrollItemsPrevFilter(e,t,n,r){return gn_getItemsPrevFilter(e,t.items.filter,r,n)}function gn_getItemsPrevFilter(e,t,n,r){var i=0,s=0;for(var o=r,u=e.length;o>=0;o--){s++;if(s==u)return s;var a=e.eq(o);if(a.is(t)){i++;if(i==n)return s}o==0&&(o=u)}}function gn_getVisibleOrg(e,t){return t.items.visibleConf.org||e.children().slice(0,t.items.visible).filter(t.items.filter).length}function gn_getVisibleItemsNext(e,t,n){var r=0,i=0;for(var s=n,o=e.length-1;s<=o;s++){var u=e.eq(s);r+=u.is(":visible")?u[t.d.outerWidth](!0):0;if(r>t.maxDimension)return i;i++;if(i==o+1)return i;s==o&&(s=-1)}}function gn_getVisibleItemsNextTestCircular(e,t,n,r){var i=gn_getVisibleItemsNext(e,t,n);return t.circular||n+i>r&&(i=r-n),i}function gn_getVisibleItemsNextFilter(e,t,n){return gn_getItemsNextFilter(e,t.items.filter,t.items.visibleConf.org,n,t.circular)}function gn_getScrollItemsNextFilter(e,t,n,r){return gn_getItemsNextFilter(e,t.items.filter,r+1,n,t.circular)-1}function gn_getItemsNextFilter(e,t,n,r,i){var s=0,o=0;for(var u=r,a=e.length-1;u<=a;u++){o++;if(o>=a)return o;var f=e.eq(u);if(f.is(t)){s++;if(s==n)return o}u==a&&(u=-1)}}function gi_getCurrentItems(e,t){return e.slice(0,t.items.visible)}function gi_getOldItemsPrev(e,t,n){return e.slice(n,t.items.visibleConf.old+n)}function gi_getNewItemsPrev(e,t){return e.slice(0,t.items.visible)}function gi_getOldItemsNext(e,t){return e.slice(0,t.items.visibleConf.old)}function gi_getNewItemsNext(e,t,n){return e.slice(n,t.items.visible+n)}function sz_storeMargin(e,t,n){t.usePadding&&(is_string(n)||(n="_cfs_origCssMargin"),e.each(function(){var e=$(this),r=parseInt(e.css(t.d.marginRight),10);is_number(r)||(r=0),e.data(n,r)}))}function sz_resetMargin(e,t,n){if(t.usePadding){var r=is_boolean(n)?n:!1;is_number(n)||(n=0),sz_storeMargin(e,t,"_cfs_tempCssMargin"),e.each(function(){var e=$(this);e.css(t.d.marginRight,r?e.data("_cfs_tempCssMargin"):n+e.data("_cfs_origCssMargin"))})}}function sz_storeOrigCss(e){e.each(function(){var e=$(this);e.data("_cfs_origCss",e.attr("style")||"")})}function sz_restoreOrigCss(e){e.each(function(){var e=$(this);e.attr("style",e.data("_cfs_origCss")||"")})}function sz_setResponsiveSizes(e,t){var n=e.items.visible,r=e.items[e.d.width],i=e[e.d.height],s=is_percentage(i);t.each(function(){var t=$(this),n=r-ms_getPaddingBorderMargin(t,e,"Width");t[e.d.width](n),s&&t[e.d.height](ms_getPercentage(n,i))})}function sz_setSizes(e,t){var n=e.parent(),r=e.children(),i=gi_getCurrentItems(r,t),s=cf_mapWrapperSizes(ms_getSizes(i,t,!0),t,!1);n.css(s);if(t.usePadding){var o=t.padding,u=o[t.d[1]];t.align&&u<0&&(u=0);var a=i.last();a.css(t.d.marginRight,a.data("_cfs_origCssMargin")+u),e.css(t.d.top,o[t.d[0]]),e.css(t.d.left,o[t.d[3]])}return e.css(t.d.width,s[t.d.width]+ms_getTotalSize(r,t,"width")*2),e.css(t.d.height,ms_getLargestSize(r,t,"height")),s}function ms_getSizes(e,t,n){return[ms_getTotalSize(e,t,"width",n),ms_getLargestSize(e,t,"height",n)]}function ms_getLargestSize(e,t,n,r){return is_boolean(r)||(r=!1),is_number(t[t.d[n]])&&r?t[t.d[n]]:is_number(t.items[t.d[n]])?t.items[t.d[n]]:(n=n.toLowerCase().indexOf("width")>-1?"outerWidth":"outerHeight",ms_getTrueLargestSize(e,t,n))}function ms_getTrueLargestSize(e,t,n){var r=0;for(var i=0,s=e.length;i<s;i++){var o=e.eq(i),u=o.is(":visible")?o[t.d[n]](!0):0;r<u&&(r=u)}return r}function ms_getTotalSize(e,t,n,r){is_boolean(r)||(r=!1);if(is_number(t[t.d[n]])&&r)return t[t.d[n]];if(is_number(t.items[t.d[n]]))return t.items[t.d[n]]*e.length;var i=n.toLowerCase().indexOf("width")>-1?"outerWidth":"outerHeight",s=0;for(var o=0,u=e.length;o<u;o++){var a=e.eq(o);s+=a.is(":visible")?a[t.d[i]](!0):0}return s}function ms_getParentSize(e,t,n){var r=e.is(":visible");r&&e.hide();var i=e.parent()[t.d[n]]();return r&&e.show(),i}function ms_getMaxDimension(e,t){return is_number(e[e.d.width])?e[e.d.width]:t}function ms_hasVariableSizes(e,t,n){var r=!1,i=!1;for(var s=0,o=e.length;s<o;s++){var u=e.eq(s),a=u.is(":visible")?u[t.d[n]](!0):0;r===!1?r=a:r!=a&&(i=!0),r==0&&(i=!0)}return i}function ms_getPaddingBorderMargin(e,t,n){return e[t.d["outer"+n]](!0)-e[t.d[n.toLowerCase()]]()}function ms_getPercentage(e,t){if(is_percentage(t)){t=parseInt(t.slice(0,-1),10);if(!is_number(t))return e;e*=t/100}return e}function cf_e(e,t,n,r,i){return is_boolean(n)||(n=!0),is_boolean(r)||(r=!0),is_boolean(i)||(i=!1),n&&(e=t.events.prefix+e),r&&(e=e+"."+t.events.namespace),r&&i&&(e+=t.serialNumber),e}function cf_c(e,t){return is_string(t.classnames[e])?t.classnames[e]:e}function cf_mapWrapperSizes(e,t,n){is_boolean(n)||(n=!0);var r=t.usePadding&&n?t.padding:[0,0,0,0],i={};return i[t.d.width]=e[0]+r[1]+r[3],i[t.d.height]=e[1]+r[0]+r[2],i}function cf_sortParams(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)for(var s=0,o=t.length;s<o;s++)if(t[s].indexOf(typeof e[r])>-1&&is_undefined(n[s])){n[s]=e[r];break}return n}function cf_getPadding(e){if(is_undefined(e))return[0,0,0,0];if(is_number(e))return[e,e,e,e];is_string(e)&&(e=e.split("px").join("").split("em").join("").split(" "));if(!is_array(e))return[0,0,0,0];for(var t=0;t<4;t++)e[t]=parseInt(e[t],10);switch(e.length){case 0:return[0,0,0,0];case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];default:return[e[0],e[1],e[2],e[3]]}}function cf_getAlignPadding(e,t){var n=is_number(t[t.d.width])?Math.ceil(t[t.d.width]-ms_getTotalSize(e,t,"width")):0;switch(t.align){case"left":return[0,n];case"right":return[n,0];case"center":default:return[Math.ceil(n/2),Math.floor(n/2)]}}function cf_getDimensions(e){var t=[["width","innerWidth","outerWidth","height","innerHeight","outerHeight","left","top","marginRight",0,1,2,3],["height","innerHeight","outerHeight","width","innerWidth","outerWidth","top","left","marginBottom",3,2,1,0]],n=t[0].length,r=e.direction=="right"||e.direction=="left"?0:1,i={};for(var s=0;s<n;s++)i[t[0][s]]=t[r][s];return i}function cf_getAdjust(e,t,n,r){var i=e;if(is_function(n))i=n.call(r,i);else if(is_string(n)){var s=n.split("+"),o=n.split("-");if(o.length>s.length)var u=!0,a=o[0],f=o[1];else var u=!1,a=s[0],f=s[1];switch(a){case"even":i=e%2==1?e-1:e;break;case"odd":i=e%2==0?e-1:e;break;default:i=e}f=parseInt(f,10),is_number(f)&&(u&&(f=-f),i+=f)}if(!is_number(i)||i<1)i=1;return i}function cf_getItemsAdjust(e,t,n,r){return cf_getItemAdjustMinMax(cf_getAdjust(e,t,n,r),t.items.visibleConf)}function cf_getItemAdjustMinMax(e,t){return is_number(t.min)&&e<t.min&&(e=t.min),is_number(t.max)&&e>t.max&&(e=t.max),e<1&&(e=1),e}function cf_getSynchArr(e){is_array(e)||(e=[[e]]),is_array(e[0])||(e=[e]);for(var t=0,n=e.length;t<n;t++)is_string(e[t][0])&&(e[t][0]=$(e[t][0])),is_boolean(e[t][1])||(e[t][1]=!0),is_boolean(e[t][2])||(e[t][2]=!0),is_number(e[t][3])||(e[t][3]=0);return e}function cf_getKeyCode(e){return e=="right"?39:e=="left"?37:e=="up"?38:e=="down"?40:-1}function cf_setCookie(e,t,n){if(e){var r=t.triggerHandler(cf_e("currentPosition",n));$.fn.carouFredSel.cookie.set(e,r)}}function cf_getCookie(e){var t=$.fn.carouFredSel.cookie.get(e);return t==""?0:t}function in_mapCss(e,t){var n={};for(var r=0,i=t.length;r<i;r++)n[t[r]]=e.css(t[r]);return n}function in_complementItems(e,t,n,r){return is_object(e.visibleConf)||(e.visibleConf={}),is_object(e.sizesConf)||(e.sizesConf={}),e.start==0&&is_number(r)&&(e.start=r),is_object(e.visible)?(e.visibleConf.min=e.visible.min,e.visibleConf.max=e.visible.max,e.visible=!1):is_string(e.visible)?(e.visible=="variable"?e.visibleConf.variable=!0:e.visibleConf.adjust=e.visible,e.visible=!1):is_function(e.visible)&&(e.visibleConf.adjust=e.visible,e.visible=!1),is_string(e.filter)||(e.filter=n.filter(":hidden").length>0?":visible":"*"),e[t.d.width]||(t.responsive?(debug(!0,"Set a "+t.d.width+" for the items!"),e[t.d.width]=ms_getTrueLargestSize(n,t,"outerWidth")):e[t.d.width]=ms_hasVariableSizes(n,t,"outerWidth")?"variable":n[t.d.outerWidth](!0)),e[t.d.height]||(e[t.d.height]=ms_hasVariableSizes(n,t,"outerHeight")?"variable":n[t.d.outerHeight](!0)),e.sizesConf.width=e.width,e.sizesConf.height=e.height,e}function in_complementVisibleItems(e,t){e.items[e.d["width"]]=="variable"&&(e.items.visibleConf.variable=!0);if(!e.items.visibleConf.variable){is_number(e[e.d.width])?e.items.visible=Math.floor(e[e.d.width]/e.items[e.d.width]):(e.items.visible=Math.floor(t/e.items[e.d.width]),e[e.d.width]=e.items.visible*e.items[e.d.width],e.items.visibleConf.adjust||(e.align=!1));if(e.items.visible=="Infinity"||e.items.visible<1)debug(!0,'Not a valid number of visible items: Set to "variable".'),e.items.visibleConf.variable=!0}return e}function in_complementPrimarySize(e,t,n){return e=="auto"&&(e=ms_getTrueLargestSize(n,t,"outerWidth")),e}function in_complementSecondarySize(e,t,n){return e=="auto"&&(e=ms_getTrueLargestSize(n,t,"outerHeight")),e||(e=t.items[t.d.height]),e}function in_getAlignPadding(e,t){var n=cf_getAlignPadding(gi_getCurrentItems(t,e),e);return e.padding[e.d[1]]=n[1],e.padding[e.d[3]]=n[0],e}function in_getResponsiveValues(e,t,n){var r=cf_getItemAdjustMinMax(Math.ceil(e[e.d.width]/e.items[e.d.width]),e.items.visibleConf);r>t.length&&(r=t.length);var i=Math.floor(e[e.d.width]/r);return e.items.visible=r,e.items[e.d.width]=i,e[e.d.width]=r*i,e}function bt_pauseOnHoverConfig(e){if(is_string(e))var t=e.indexOf("immediate")>-1?!0:!1,n=e.indexOf("resume")>-1?!0:!1;else var t=n=!1;return[t,n]}function bt_mousesheelNumber(e){return is_number(e)?e:null}function is_null(e){return e===null}function is_undefined(e){return is_null(e)||typeof e=="undefined"||e===""||e==="undefined"}function is_array(e){return e instanceof Array}function is_jquery(e){return e instanceof jQuery}function is_object(e){return(e instanceof Object||typeof e=="object")&&!is_null(e)&&!is_jquery(e)&&!is_array(e)&&!is_function(e)}function is_number(e){return(e instanceof Number||typeof e=="number")&&!isNaN(e)}function is_string(e){return(e instanceof String||typeof e=="string")&&!is_undefined(e)&&!is_true(e)&&!is_false(e)}function is_function(e){return e instanceof Function||typeof e=="function"}function is_boolean(e){return e instanceof Boolean||typeof e=="boolean"||is_true(e)||is_false(e)}function is_true(e){return e===!0||e==="true"}function is_false(e){return e===!1||e==="false"}function is_percentage(e){return is_string(e)&&e.slice(-1)=="%"}function getTime(){return(new Date).getTime()}function deprecated(e,t){debug(!0,e+" is DEPRECATED, support for it will be removed. Use "+t+" instead.")}function debug(e,t){if(!is_undefined(window.console)&&!is_undefined(window.console.log)){if(is_object(e)){var n=" ("+e.selector+")";e=e.debug}else var n="";if(!e)return!1;is_string(t)?t="carouFredSel"+n+": "+t:t=["carouFredSel"+n+":",t],window.console.log(t)}return!1}if($.fn.carouFredSel)return;$.fn.caroufredsel=$.fn.carouFredSel=function(options,configs){if(this.length==0)return debug(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){$(this).carouFredSel(options,configs)});var $cfs=this,$tt0=this[0],starting_position=!1;$cfs.data("_cfs_isCarousel")&&(starting_position=$cfs.triggerHandler("_cfs_triggerEvent","currentPosition"),$cfs.trigger("_cfs_triggerEvent",["destroy",!0]));var FN={};FN._init=function(e,t,n){e=go_getObject($tt0,e),e.items=go_getItemsObject($tt0,e.items),e.scroll=go_getScrollObject($tt0,e.scroll),e.auto=go_getAutoObject($tt0,e.auto),e.prev=go_getPrevNextObject($tt0,e.prev),e.next=go_getPrevNextObject($tt0,e.next),e.pagination=go_getPaginationObject($tt0,e.pagination),e.swipe=go_getSwipeObject($tt0,e.swipe),e.mousewheel=go_getMousewheelObject($tt0,e.mousewheel),t&&(opts_orig=$.extend(!0,{},$.fn.carouFredSel.defaults,e)),opts=$.extend(!0,{},$.fn.carouFredSel.defaults,e),opts.d=cf_getDimensions(opts),crsl.direction=opts.direction=="up"||opts.direction=="left"?"next":"prev";var r=$cfs.children(),i=ms_getParentSize($wrp,opts,"width");is_true(opts.cookie)&&(opts.cookie="caroufredsel_cookie_"+conf.serialNumber),opts.maxDimension=ms_getMaxDimension(opts,i),opts.items=in_complementItems(opts.items,opts,r,n),opts[opts.d.width]=in_complementPrimarySize(opts[opts.d.width],opts,r),opts[opts.d.height]=in_complementSecondarySize(opts[opts.d.height],opts,r),opts.responsive&&(is_percentage(opts[opts.d.width])||(opts[opts.d.width]="100%")),is_percentage(opts[opts.d.width])&&(crsl.upDateOnWindowResize=!0,crsl.primarySizePercentage=opts[opts.d.width],opts[opts.d.width]=ms_getPercentage(i,crsl.primarySizePercentage),opts.items.visible||(opts.items.visibleConf.variable=!0)),opts.responsive?(opts.usePadding=!1,opts.padding=[0,0,0,0],opts.align=!1,opts.items.visibleConf.variable=!1):(opts.items.visible||(opts=in_complementVisibleItems(opts,i)),opts[opts.d.width]||(!opts.items.visibleConf.variable&&is_number(opts.items[opts.d.width])&&opts.items.filter=="*"?(opts[opts.d.width]=opts.items.visible*opts.items[opts.d.width],opts.align=!1):opts[opts.d.width]="variable"),is_undefined(opts.align)&&(opts.align=is_number(opts[opts.d.width])?"center":!1),opts.items.visibleConf.variable&&(opts.items.visible=gn_getVisibleItemsNext(r,opts,0))),opts.items.filter!="*"&&!opts.items.visibleConf.variable&&(opts.items.visibleConf.org=opts.items.visible,opts.items.visible=gn_getVisibleItemsNextFilter(r,opts,0)),opts.items.visible=cf_getItemsAdjust(opts.items.visible,opts,opts.items.visibleConf.adjust,$tt0),opts.items.visibleConf.old=opts.items.visible;if(opts.responsive)opts.items.visibleConf.min||(opts.items.visibleConf.min=opts.items.visible),opts.items.visibleConf.max||(opts.items.visibleConf.max=opts.items.visible),opts=in_getResponsiveValues(opts,r,i);else{opts.padding=cf_getPadding(opts.padding),opts.align=="top"?opts.align="left":opts.align=="bottom"&&(opts.align="right");switch(opts.align){case"center":case"left":case"right":opts[opts.d["width"]]!="variable"&&(opts=in_getAlignPadding(opts,r),opts.usePadding=!0);break;default:opts.align=!1,opts.usePadding=opts.padding[0]==0&&opts.padding[1]==0&&opts.padding[2]==0&&opts.padding[3]==0?!1:!0}}is_number(opts.scroll.duration)||(opts.scroll.duration=500),is_undefined(opts.scroll.items)&&(opts.scroll.items=opts.responsive||opts.items.visibleConf.variable||opts.items.filter!="*"?"visible":opts.items.visible),opts.auto=$.extend(!0,{},opts.scroll,opts.auto),opts.prev=$.extend(!0,{},opts.scroll,opts.prev),opts.next=$.extend(!0,{},opts.scroll,opts.next),opts.pagination=$.extend(!0,{},opts.scroll,opts.pagination),opts.auto=go_complementAutoObject($tt0,opts.auto),opts.prev=go_complementPrevNextObject($tt0,opts.prev),opts.next=go_complementPrevNextObject($tt0,opts.next),opts.pagination=go_complementPaginationObject($tt0,opts.pagination),opts.swipe=go_complementSwipeObject($tt0,opts.swipe),opts.mousewheel=go_complementMousewheelObject($tt0,opts.mousewheel),opts.synchronise&&(opts.synchronise=cf_getSynchArr(opts.synchronise)),opts.auto.onPauseStart&&(opts.auto.onTimeoutStart=opts.auto.onPauseStart,deprecated("auto.onPauseStart","auto.onTimeoutStart")),opts.auto.onPausePause&&(opts.auto.onTimeoutPause=opts.auto.onPausePause,deprecated("auto.onPausePause","auto.onTimeoutPause")),opts.auto.onPauseEnd&&(opts.auto.onTimeoutEnd=opts.auto.onPauseEnd,deprecated("auto.onPauseEnd","auto.onTimeoutEnd")),opts.auto.pauseDuration&&(opts.auto.timeoutDuration=opts.auto.pauseDuration,deprecated("auto.pauseDuration","auto.timeoutDuration"))},FN._build=function(){$cfs.data("_cfs_isCarousel",!0);var e=$cfs.children(),t=in_mapCss($cfs,["textAlign","float","position","top","right","bottom","left","zIndex","width","height","marginTop","marginRight","marginBottom","marginLeft"]),n="relative";switch(t.position){case"absolute":case"fixed":n=t.position}conf.wrapper=="parent"?sz_storeOrigCss($wrp):$wrp.css(t),$wrp.css({overflow:"hidden",position:n}),sz_storeOrigCss($cfs),$cfs.data("_cfs_origCssZindex",t.zIndex),$cfs.css({textAlign:"left","float":"none",position:"absolute",top:0,right:"auto",bottom:"auto",left:0,marginTop:0,marginRight:0,marginBottom:0,marginLeft:0}),sz_storeMargin(e,opts),sz_storeOrigCss(e),opts.responsive&&sz_setResponsiveSizes(opts,e)},FN._bind_events=function(){FN._unbind_events(),$cfs.bind(cf_e("stop",conf),function(e,t){return e.stopPropagation(),crsl.isStopped||opts.auto.button&&opts.auto.button.addClass(cf_c("stopped",conf)),crsl.isStopped=!0,opts.auto.play&&(opts.auto.play=!1,$cfs.trigger(cf_e("pause",conf),t)),!0}),$cfs.bind(cf_e("finish",conf),function(e){return e.stopPropagation(),crsl.isScrolling&&sc_stopScroll(scrl),!0}),$cfs.bind(cf_e("pause",conf),function(e,t,n){e.stopPropagation(),tmrs=sc_clearTimers(tmrs);if(t&&crsl.isScrolling){scrl.isStopped=!0;var r=getTime()-scrl.startTime;scrl.duration-=r,scrl.pre&&(scrl.pre.duration-=r),scrl.post&&(scrl.post.duration-=r),sc_stopScroll(scrl,!1)}!crsl.isPaused&&!crsl.isScrolling&&n&&(tmrs.timePassed+=getTime()-tmrs.startTime),crsl.isPaused||opts.auto.button&&opts.auto.button.addClass(cf_c("paused",conf)),crsl.isPaused=!0;if(opts.auto.onTimeoutPause){var i=opts.auto.timeoutDuration-tmrs.timePassed,s=100-Math.ceil(i*100/opts.auto.timeoutDuration);opts.auto.onTimeoutPause.call($tt0,s,i)}return!0}),$cfs.bind(cf_e("play",conf),function(e,t,n,r){e.stopPropagation(),tmrs=sc_clearTimers(tmrs);var i=[t,n,r],s=["string","number","boolean"],o=cf_sortParams(i,s);t=o[0],n=o[1],r=o[2],t!="prev"&&t!="next"&&(t=crsl.direction),is_number(n)||(n=0),is_boolean(r)||(r=!1),r&&(crsl.isStopped=!1,opts.auto.play=!0);if(!opts.auto.play)return e.stopImmediatePropagation(),debug(conf,"Carousel stopped: Not scrolling.");crsl.isPaused&&opts.auto.button&&(opts.auto.button.removeClass(cf_c("stopped",conf)),opts.auto.button.removeClass(cf_c("paused",conf))),crsl.isPaused=!1,tmrs.startTime=getTime();var u=opts.auto.timeoutDuration+n;return dur2=u-tmrs.timePassed,perc=100-Math.ceil(dur2*100/u),opts.auto.progress&&(tmrs.progress=setInterval(function(){var e=getTime()-tmrs.startTime+tmrs.timePassed,t=Math.ceil(e*100/u);opts.auto.progress.updater.call(opts.auto.progress.bar[0],t)},opts.auto.progress.interval)),tmrs.auto=setTimeout(function(){opts.auto.progress&&opts.auto.progress.updater.call(opts.auto.progress.bar[0],100),opts.auto.onTimeoutEnd&&opts.auto.onTimeoutEnd.call($tt0,perc,dur2),crsl.isScrolling?$cfs.trigger(cf_e("play",conf),t):$cfs.trigger(cf_e(t,conf),opts.auto)},dur2),opts.auto.onTimeoutStart&&opts.auto.onTimeoutStart.call($tt0,perc,dur2),!0}),$cfs.bind(cf_e("resume",conf),function(e){return e.stopPropagation(),scrl.isStopped?(scrl.isStopped=!1,crsl.isPaused=!1,crsl.isScrolling=!0,scrl.startTime=getTime(),sc_startScroll(scrl,conf)):$cfs.trigger(cf_e("play",conf)),!0}),$cfs.bind(cf_e("prev",conf)+" "+cf_e("next",conf),function(e,obj,num,clb,que){e.stopPropagation();if(crsl.isStopped||$cfs.is(":hidden"))return e.stopImmediatePropagation(),debug(conf,"Carousel stopped or hidden: Not scrolling.");var minimum=is_number(opts.items.minimum)?opts.items.minimum:opts.items.visible+1;if(minimum>itms.total)return e.stopImmediatePropagation(),debug(conf,"Not enough items ("+itms.total+" total, "+minimum+" needed): Not scrolling.");var v=[obj,num,clb,que],t=["object","number/string","function","boolean"],a=cf_sortParams(v,t);obj=a[0],num=a[1],clb=a[2],que=a[3];var eType=e.type.slice(conf.events.prefix.length);if($(eval("opts."+eType+".button.selector")).hasClass("disabled"))return;is_object(obj)||(obj={}),is_function(clb)&&(obj.onAfter=clb),is_boolean(que)&&(obj.queue=que),obj=$.extend(!0,{},opts[eType],obj);if(obj.conditions&&!obj.conditions.call($tt0,eType))return e.stopImmediatePropagation(),debug(conf,'Callback "conditions" returned false.');if(!is_number(num)){if(opts.items.filter!="*")num="visible";else{var arr=[num,obj.items,opts[eType].items];for(var a=0,l=arr.length;a<l;a++)if(is_number(arr[a])||arr[a]=="page"||arr[a]=="visible"){num=arr[a];break}}switch(num){case"page":return e.stopImmediatePropagation(),$cfs.triggerHandler(cf_e(eType+"Page",conf),[obj,clb]);case"visible":!opts.items.visibleConf.variable&&opts.items.filter=="*"&&(num=opts.items.visible)}}if(scrl.isStopped)return $cfs.trigger(cf_e("resume",conf)),$cfs.trigger(cf_e("queue",conf),[eType,[obj,num,clb]]),e.stopImmediatePropagation(),debug(conf,"Carousel resumed scrolling.");if(obj.duration>0&&crsl.isScrolling)return obj.queue&&(obj.queue=="last"&&(queu=[]),(obj.queue!="first"||queu.length==0)&&$cfs.trigger(cf_e("queue",conf),[eType,[obj,num,clb]])),e.stopImmediatePropagation(),debug(conf,"Carousel currently scrolling.");tmrs.timePassed=0,$cfs.trigger(cf_e("slide_"+eType,conf),[obj,num]);if(opts.synchronise){var s=opts.synchronise,c=[obj,num];for(var j=0,l=s.length;j<l;j++){var d=eType;s[j][2]||(d=d=="prev"?"next":"prev"),s[j][1]||(c[0]=s[j][0].triggerHandler("_cfs_triggerEvent",["configuration",d])),c[1]=num+s[j][3],s[j][0].trigger("_cfs_triggerEvent",["slide_"+d,c])}}return!0}),$cfs.bind(cf_e("slide_prev",conf),function(e,t,n){e.stopPropagation();var r=$cfs.children();if(!opts.circular&&itms.first==0)return opts.infinite&&$cfs.trigger(cf_e("next",conf),itms.total-1),e.stopImmediatePropagation();sz_resetMargin(r,opts);if(!is_number(n)){if(opts.items.visibleConf.variable)n=gn_getVisibleItemsPrev(r,opts,itms.total-1);else if(opts.items.filter!="*"){var i=is_number(t.items)?t.items:gn_getVisibleOrg($cfs,opts);n=gn_getScrollItemsPrevFilter(r,opts,itms.total-1,i)}else n=opts.items.visible;n=cf_getAdjust(n,opts,t.items,$tt0)}opts.circular||itms.total-n<itms.first&&(n=itms.total-itms.first),opts.items.visibleConf.old=opts.items.visible;if(opts.items.visibleConf.variable){var s=cf_getItemsAdjust(gn_getVisibleItemsNext(r,opts,itms.total-n),opts,opts.items.visibleConf.adjust,$tt0);opts.items.visible+n<=s&&n<itms.total&&(n++,s=cf_getItemsAdjust(gn_getVisibleItemsNext(r,opts,itms.total-n),opts,opts.items.visibleConf.adjust,$tt0)),opts.items.visible=s}else if(opts.items.filter!="*"){var s=gn_getVisibleItemsNextFilter(r,opts,itms.total-n);opts.items.visible=cf_getItemsAdjust(s,opts,opts.items.visibleConf.adjust,$tt0)}sz_resetMargin(r,opts,!0);if(n==0)return e.stopImmediatePropagation(),debug(conf,"0 items to scroll: Not scrolling.");debug(conf,"Scrolling "+n+" items backward."),itms.first+=n,itms.last-=n;while(itms.first>=itms.total)itms.first-=itms.total;opts.circular||(itms.first==0&&t.onEnd&&t.onEnd.call($tt0,"prev"),opts.infinite||nv_enableNavi(opts,itms.first,conf)),$cfs.children().slice(itms.total-n,itms.total).prependTo($cfs),itms.total<opts.items.visible+n&&$cfs.children().slice(0,opts.items.visible+n-itms.total).clone(!0).appendTo($cfs);var r=$cfs.children(),o=gi_getOldItemsPrev(r,opts,n),u=gi_getNewItemsPrev(r,opts),a=r.eq(n-1),f=o.last(),l=u.last();sz_resetMargin(r,opts);var c=0,h=0;if(opts.align){var p=cf_getAlignPadding(u,opts);c=p[0],h=p[1]}var d=c<0?opts.padding[opts.d[3]]:0,v=!1,m=$();if(opts.items.visible<n){m=r.slice(opts.items.visibleConf.old,n);if(t.fx=="directscroll"){var g=opts.items[opts.d.width];v=m,a=l,sc_hideHiddenItems(v),opts.items[opts.d.width]="variable"}}var y=!1,b=ms_getTotalSize(r.slice(0,n),opts,"width"),w=cf_mapWrapperSizes(ms_getSizes(u,opts,!0),opts,!opts.usePadding),E=0,S={},x={},T={},N={},C={},k={},L={},A=sc_getDuration(t,opts,n,b);switch(t.fx){case"cover":case"cover-fade":E=ms_getTotalSize(r.slice(0,opts.items.visible),opts,"width")}v&&(opts.items[opts.d.width]=g),sz_resetMargin(r,opts,!0),h>=0&&sz_resetMargin(f,opts,opts.padding[opts.d[1]]),c>=0&&sz_resetMargin(a,opts,opts.padding[opts.d[3]]),opts.align&&(opts.padding[opts.d[1]]=h,opts.padding[opts.d[3]]=c),k[opts.d.left]=-(b-d),L[opts.d.left]=-(E-d),x[opts.d.left]=w[opts.d.width];var O=function(){},M=function(){},_=function(){},D=function(){},P=function(){},H=function(){},B=function(){},j=function(){},F=function(){},I=function(){},q=function(){};switch(t.fx){case"crossfade":case"cover":case"cover-fade":case"uncover":case"uncover-fade":y=$cfs.clone(!0).appendTo($wrp)}switch(t.fx){case"crossfade":case"uncover":case"uncover-fade":y.children().slice(0,n).remove(),y.children().slice(opts.items.visibleConf.old).remove();break;case"cover":case"cover-fade":y.children().slice(opts.items.visible).remove(),y.css(L)}$cfs.css(k),scrl=sc_setScroll(A,t.easing,conf),S[opts.d.left]=opts.usePadding?opts.padding[opts.d[3]]:0;if(opts[opts.d["width"]]=="variable"||opts[opts.d["height"]]=="variable")O=function(){$wrp.css(w)},M=function(){scrl.anims.push([$wrp,w])};if(opts.usePadding){l.not(a).length&&(T[opts.d.marginRight]=a.data("_cfs_origCssMargin"),c<0?a.css(T):(B=function(){a.css(T)},j=function(){scrl.anims.push([a,T])}));switch(t.fx){case"cover":case"cover-fade":y.children().eq(n-1).css(T)}l.not(f).length&&(N[opts.d.marginRight]=f.data("_cfs_origCssMargin"),_=function(){f.css(N)},D=function(){scrl.anims.push([f,N])}),h>=0&&(C[opts.d.marginRight]=l.data("_cfs_origCssMargin")+opts.padding[opts.d[1]],P=function(){l.css(C)},H=function(){scrl.anims.push([l,C])})}q=function(){$cfs.css(S)};var R=opts.items.visible+n-itms.total;I=function(){R>0&&($cfs.children().slice(itms.total).remove(),o=$($cfs.children().slice(itms.total-(opts.items.visible-R)).get().concat($cfs.children().slice(0,R).get()))),sc_showHiddenItems(v);if(opts.usePadding){var e=$cfs.children().eq(opts.items.visible+n-1);e.css(opts.d.marginRight,e.data("_cfs_origCssMargin"))}};var U=sc_mapCallbackArguments(o,m,u,n,"prev",A,w);F=function(){sc_afterScroll($cfs,y,t),crsl.isScrolling=!1,clbk.onAfter=sc_fireCallbacks($tt0,t,"onAfter",U,clbk),queu=sc_fireQueue($cfs,queu,conf),crsl.isPaused||$cfs.trigger(cf_e("play",conf))},crsl.isScrolling=!0,tmrs=sc_clearTimers(tmrs),clbk.onBefore=sc_fireCallbacks($tt0,t,"onBefore",U,clbk);switch(t.fx){case"none":$cfs.css(S),O(),_(),P(),B(),q(),I(),F();break;case"fade":scrl.anims.push([$cfs,{opacity:0},function(){O(),_(),P(),B(),q(),I(),scrl=sc_setScroll(A,t.easing,conf),scrl.anims.push([$cfs,{opacity:1},F]),sc_startScroll(scrl,conf)}]);break;case"crossfade":$cfs.css({opacity:0}),scrl.anims.push([y,{opacity:0}]),scrl.anims.push([$cfs,{opacity:1},F]),M(),_(),P(),B(),q(),I();break;case"cover":scrl.anims.push([y,S,function(){_(),P(),B(),q(),I(),F()}]),M();break;case"cover-fade":scrl.anims.push([$cfs,{opacity:0}]),scrl.anims.push([y,S,function(){_(),P(),B(),q(),I(),F()}]),M();break;case"uncover":scrl.anims.push([y,x,F]),M(),_(),P(),B(),q(),I();break;case"uncover-fade":$cfs.css({opacity:0}),scrl.anims.push([$cfs,{opacity:1}]),scrl.anims.push([y,x,F]),M(),_(),P(),B(),q(),I();break;default:scrl.anims.push([$cfs,S,function(){I(),F()}]),M(),D(),H(),j()}return sc_startScroll(scrl,conf),cf_setCookie(opts.cookie,$cfs,conf),$cfs.trigger(cf_e("updatePageStatus",conf),[!1,w]),!0}),$cfs.bind(cf_e("slide_next",conf),function(e,t,n){e.stopPropagation();var r=$cfs.children();if(!opts.circular&&itms.first==opts.items.visible)return opts.infinite&&$cfs.trigger(cf_e("prev",conf),itms.total-1),e.stopImmediatePropagation();sz_resetMargin(r,opts);if(!is_number(n)){if(opts.items.filter!="*"){var i=is_number(t.items)?t.items:gn_getVisibleOrg($cfs,opts);n=gn_getScrollItemsNextFilter(r,opts,0,i)}else n=opts.items.visible;n=cf_getAdjust(n,opts,t.items,$tt0)}var s=itms.first==0?itms.total:itms.first;if(!opts.circular){if(opts.items.visibleConf.variable)var o=gn_getVisibleItemsNext(r,opts,n),i=gn_getVisibleItemsPrev(r,opts,s-1);else var o=opts.items.visible,i=opts.items.visible;n+o>s&&(n=s-i)}opts.items.visibleConf.old=opts.items.visible;if(opts.items.visibleConf.variable){var o=cf_getItemsAdjust(gn_getVisibleItemsNextTestCircular(r,opts,n,s),opts,opts.items.visibleConf.adjust,$tt0);while(opts.items.visible-n>=o&&n<itms.total)n++,o=cf_getItemsAdjust(gn_getVisibleItemsNextTestCircular(r,opts,n,s),opts,opts.items.visibleConf.adjust,$tt0);opts.items.visible=o}else if(opts.items.filter!="*"){var o=gn_getVisibleItemsNextFilter(r,opts,n);opts.items.visible=cf_getItemsAdjust(o,opts,opts.items.visibleConf.adjust,$tt0)}sz_resetMargin(r,opts,!0);if(n==0)return e.stopImmediatePropagation(),debug(conf,"0 items to scroll: Not scrolling.");debug(conf,"Scrolling "+n+" items forward."),itms.first-=n;while(itms.first<0)itms.first+=itms.total;opts.circular||(itms.first==opts.items.visible&&t.onEnd&&t.onEnd.call($tt0,"next"),opts.infinite||nv_enableNavi(opts,itms.first,conf)),itms.total<opts.items.visible+n&&$cfs.children().slice(0,opts.items.visible+n-itms.total).clone(!0).appendTo($cfs);var r=$cfs.children(),u=gi_getOldItemsNext(r,opts),a=gi_getNewItemsNext(r,opts,n),f=r.eq(n-1),l=u.last(),c=a.last();sz_resetMargin(r,opts);var h=0,p=0;if(opts.align){var d=cf_getAlignPadding(a,opts);h=d[0],p=d[1]}var v=!1,m=$();if(opts.items.visibleConf.old<n){m=r.slice(opts.items.visibleConf.old,n);if(t.fx=="directscroll"){var g=opts.items[opts.d.width];v=m,f=l,sc_hideHiddenItems(v),opts.items[opts.d.width]="variable"}}var y=!1,b=ms_getTotalSize(r.slice(0,n),opts,"width"),w=cf_mapWrapperSizes(ms_getSizes(a,opts,!0),opts,!opts.usePadding),E=0,S={},x={},T={},N={},C={},k=sc_getDuration(t,opts,n,b);switch(t.fx){case"uncover":case"uncover-fade":E=ms_getTotalSize(r.slice(0,opts.items.visibleConf.old),opts,"width")}v&&(opts.items[opts.d.width]=g),opts.align&&opts.padding[opts.d[1]]<0&&(opts.padding[opts.d[1]]=0),sz_resetMargin(r,opts,!0),sz_resetMargin(l,opts,opts.padding[opts.d[1]]),opts.align&&(opts.padding[opts.d[1]]=p,opts.padding[opts.d[3]]=h),C[opts.d.left]=opts.usePadding?opts.padding[opts.d[3]]:0;var L=function(){},A=function(){},O=function(){},M=function(){},_=function(){},D=function(){},P=function(){},H=function(){},B=function(){};switch(t.fx){case"crossfade":case"cover":case"cover-fade":case"uncover":case"uncover-fade":y=$cfs.clone(!0).appendTo($wrp),y.children().slice(opts.items.visibleConf.old).remove()}switch(t.fx){case"crossfade":case"cover":case"cover-fade":$cfs.css("zIndex",1),y.css("zIndex",0)}scrl=sc_setScroll(k,t.easing,conf),S[opts.d.left]=-b,x[opts.d.left]=-E,h<0&&(S[opts.d.left]+=h);if(opts[opts.d["width"]]=="variable"||opts[opts.d["height"]]=="variable")L=function(){$wrp.css(w)},A=function(){scrl.anims.push([$wrp,w])};if(opts.usePadding){var j=c.data("_cfs_origCssMargin");p>=0&&(j+=opts.padding[opts.d[1]]),c.css(opts.d.marginRight,j),f.not(l).length&&(N[opts.d.marginRight]=l.data("_cfs_origCssMargin")),O=function(){l.css(N)},M=function(){scrl.anims.push([l,N])};var F=f.data("_cfs_origCssMargin");h>0&&(F+=opts.padding[opts.d[3]]),T[opts.d.marginRight]=F,_=function(){f.css(T)},D=function(){scrl.anims.push([f,T])}}B=function(){$cfs.css(C)};var I=opts.items.visible+n-itms.total;H=function(){I>0&&$cfs.children().slice(itms.total).remove();var e=$cfs.children().slice(0,n).appendTo($cfs).last();I>0&&(a=gi_getCurrentItems(r,opts)),sc_showHiddenItems(v);if(opts.usePadding){if(itms.total<opts.items.visible+n){var t=$cfs.children().eq(opts.items.visible-1);t.css(opts.d.marginRight,t.data("_cfs_origCssMargin")+opts.padding[opts.d[1]])}e.css(opts.d.marginRight,e.data("_cfs_origCssMargin"))}};var q=sc_mapCallbackArguments(u,m,a,n,"next",k,w);P=function(){$cfs.css("zIndex",$cfs.data("_cfs_origCssZindex")),sc_afterScroll($cfs,y,t),crsl.isScrolling=!1,clbk.onAfter=sc_fireCallbacks($tt0,t,"onAfter",q,clbk),queu=sc_fireQueue($cfs,queu,conf),crsl.isPaused||$cfs.trigger(cf_e("play",conf))},crsl.isScrolling=!0,tmrs=sc_clearTimers(tmrs),clbk.onBefore=sc_fireCallbacks($tt0,t,"onBefore",q,clbk);switch(t.fx){case"none":$cfs.css(S),L(),O(),_(),B(),H(),P();break;case"fade":scrl.anims.push([$cfs,{opacity:0},function(){L(),O(),_(),B(),H(),scrl=sc_setScroll(k,t.easing,conf),scrl.anims.push([$cfs,{opacity:1},P]),sc_startScroll(scrl,conf)}]);break;case"crossfade":$cfs.css({opacity:0}),scrl.anims.push([y,{opacity:0}]),scrl.anims.push([$cfs,{opacity:1},P]),A(),O(),_(),B(),H();break;case"cover":$cfs.css(opts.d.left,$wrp[opts.d.width]()),scrl.anims.push([$cfs,C,P]),A(),O(),_(),H();break;case"cover-fade":$cfs.css(opts.d.left,$wrp[opts.d.width]()),scrl.anims.push([y,{opacity:0}]),scrl.anims.push([$cfs,C,P]),A(),O(),_(),H();break;case"uncover":scrl.anims.push([y,x,P]),A(),O(),_(),B(),H();break;case"uncover-fade":$cfs.css({opacity:0}),scrl.anims.push([$cfs,{opacity:1}]),scrl.anims.push([y,x,P]),A(),O(),_(),B(),H();break;default:scrl.anims.push([$cfs,S,function(){B(),H(),P()}]),A(),M(),D()}return sc_startScroll(scrl,conf),cf_setCookie(opts.cookie,$cfs,conf),$cfs.trigger(cf_e("updatePageStatus",conf),[!1,w]),!0}),$cfs.bind(cf_e("slideTo",conf),function(e,t,n,r,i,s,o){e.stopPropagation();var u=[t,n,r,i,s,o],a=["string/number/object","number","boolean","object","string","function"],f=cf_sortParams(u,a);return i=f[3],s=f[4],o=f[5],t=gn_getItemIndex(f[0],f[1],f[2],itms,$cfs),t==0?!1:(is_object(i)||(i=!1),s!="prev"&&s!="next"&&(opts.circular?s=t<=itms.total/2?"next":"prev":s=itms.first==0||itms.first>t?"next":"prev"),s=="prev"&&(t=itms.total-t),$cfs.trigger(cf_e(s,conf),[i,t,o]),!0)}),$cfs.bind(cf_e("prevPage",conf),function(e,t,n){e.stopPropagation();var r=$cfs.triggerHandler(cf_e("currentPage",conf));return $cfs.triggerHandler(cf_e("slideToPage",conf),[r-1,t,"prev",n])}),$cfs.bind(cf_e("nextPage",conf),function(e,t,n){e.stopPropagation();var r=$cfs.triggerHandler(cf_e("currentPage",conf));return $cfs.triggerHandler(cf_e("slideToPage",conf),[r+1,t,"next",n])}),$cfs.bind(cf_e("slideToPage",conf),function(e,t,n,r,i){e.stopPropagation(),is_number(t)||(t=$cfs.triggerHandler(cf_e("currentPage",conf)));var s=opts.pagination.items||opts.items.visible,o=Math.ceil(itms.total/s)-1;return t<0&&(t=o),t>o&&(t=0),$cfs.triggerHandler(cf_e("slideTo",conf),[t*s,0,!0,n,r,i])}),$cfs.bind(cf_e("jumpToStart",conf),function(e,t){e.stopPropagation(),t?t=gn_getItemIndex(t,0,!0,itms,$cfs):t=0,t+=itms.first;if(t!=0){if(itms.total>0)while(t>itms.total)t-=itms.total;$cfs.prepend($cfs.children().slice(t,itms.total))}return!0}),$cfs.bind(cf_e("synchronise",conf),function(e,t){e.stopPropagation();if(t)t=cf_getSynchArr(t);else{if(!opts.synchronise)return debug(conf,"No carousel to synchronise.");t=opts.synchronise}var n=$cfs.triggerHandler(cf_e("currentPosition",conf)),r=!0;for(var i=0,s=t.length;i<s;i++)t[i][0].triggerHandler(cf_e("slideTo",conf),[n,t[i][3],!0])||(r=!1);return r}),$cfs.bind(cf_e("queue",conf),function(e,t,n){return e.stopPropagation(),is_function(t)?t.call($tt0,queu):is_array(t)?queu=t:is_undefined(t)||queu.push([t,n]),queu}),$cfs.bind(cf_e("insertItem",conf),function(e,t,n,r,i){e.stopPropagation();var s=[t,n,r,i],o=["string/object","string/number/object","boolean","number"],u=cf_sortParams(s,o);t=u[0],n=u[1],r=u[2],i=u[3],is_object(t)&&!is_jquery(t)?t=$(t):is_string(t)&&(t=$(t));if(!is_jquery(t)||t.length==0)return debug(conf,"Not a valid object.");is_undefined(n)&&(n="end"),sz_storeMargin(t,opts),sz_storeOrigCss(t);var a=n,f="before";n=="end"?r?(itms.first==0?(n=itms.total-1,f="after"):(n=itms.first,itms.first+=t.length),n<0&&(n=0)):(n=itms.total-1,f="after"):n=gn_getItemIndex(n,i,r,itms,$cfs);var l=$cfs.children().eq(n);return l.length?l[f](t):(debug(conf,"Correct insert-position not found! Appending item to the end."),$cfs.append(t)),a!="end"&&!r&&n<itms.first&&(itms.first+=t.length),itms.total=$cfs.children().length,itms.first>=itms.total&&(itms.first-=itms.total),$cfs.trigger(cf_e("updateSizes",conf)),$cfs.trigger(cf_e("linkAnchors",conf)),!0}),$cfs.bind(cf_e("removeItem",conf),function(e,t,n,r){e.stopPropagation();var i=[t,n,r],s=["string/number/object","boolean","number"],o=cf_sortParams(i,s);t=o[0],n=o[1],r=o[2];var u=!1;if(t instanceof $&&t.length>1)return a=$(),t.each(function(e,t){var i=$cfs.trigger(cf_e("removeItem",conf),[$(this),n,r]);i&&(a=a.add(i))}),a;if(is_undefined(t)||t=="end")a=$cfs.children().last();else{t=gn_getItemIndex(t,r,n,itms,$cfs);var a=$cfs.children().eq(t);a.length&&t<itms.first&&(itms.first-=a.length)}return a&&a.length&&(a.detach(),itms.total=$cfs.children().length,$cfs.trigger(cf_e("updateSizes",conf))),a}),$cfs.bind(cf_e("onBefore",conf)+" "+cf_e("onAfter",conf),function(e,t){e.stopPropagation();var n=e.type.slice(conf.events.prefix.length);return is_array(t)&&(clbk[n]=t),is_function(t)&&clbk[n].push(t),clbk[n]}),$cfs.bind(cf_e("currentPosition",conf),function(e,t){e.stopPropagation();if(itms.first==0)var n=0;else var n=itms.total-itms.first;return is_function(t)&&t.call($tt0,n),n}),$cfs.bind(cf_e("currentPage",conf),function(e,t){e.stopPropagation();var n=opts.pagination.items||opts.items.visible,r=Math.ceil(itms.total/n-1),i;return itms.first==0?i=0:itms.first<itms.total%n?i=0:itms.first==n&&!opts.circular?i=r:i=Math.round((itms.total-itms.first)/n),i<0&&(i=0),i>r&&(i=r),is_function(t)&&t.call($tt0,i),i}),$cfs.bind(cf_e("currentVisible",conf),function(e,t){e.stopPropagation();var n=gi_getCurrentItems($cfs.children(),opts);return is_function(t)&&t.call($tt0,n),n}),$cfs.bind(cf_e("slice",conf),function(e,t,n,r){e.stopPropagation();if(itms.total==0)return!1;var i=[t,n,r],s=["number","number","function"],o=cf_sortParams(i,s);t=is_number(o[0])?o[0]:0,n=is_number(o[1])?o[1]:itms.total,r=o[2],t+=itms.first,n+=itms.first;if(items.total>0){while(t>itms.total)t-=itms.total;while(n>itms.total)n-=itms.total;while(t<0)t+=itms.total;while(n<0)n+=itms.total}var u=$cfs.children(),a;return n>t?a=u.slice(t,n):a=$(u.slice(t,itms.total).get().concat(u.slice(0,n).get())),is_function(r)&&r.call($tt0,a),a}),$cfs.bind(cf_e("isPaused",conf)+" "+cf_e("isStopped",conf)+" "+cf_e("isScrolling",conf),function(e,t){e.stopPropagation();var n=e.type.slice(conf.events.prefix.length),r=crsl[n];return is_function(t)&&t.call($tt0,r),r}),$cfs.bind(cf_e("configuration",conf),function(e,a,b,c){e.stopPropagation();var reInit=!1;if(is_function(a))a.call($tt0,opts);else if(is_object(a))opts_orig=$.extend(!0,{},opts_orig,a),b!==!1?reInit=!0:opts=$.extend(!0,{},opts,a);else if(!is_undefined(a))if(is_function(b)){var val=eval("opts."+a);is_undefined(val)&&(val=""),b.call($tt0,val)}else{if(!!is_undefined(b))return eval("opts."+a);typeof c!="boolean"&&(c=!0),eval("opts_orig."+a+" = b"),c!==!1?reInit=!0:eval("opts."+a+" = b")}if(reInit){sz_resetMargin($cfs.children(),opts),FN._init(opts_orig),FN._bind_buttons();var sz=sz_setSizes($cfs,opts);$cfs.trigger(cf_e("updatePageStatus",conf),[!0,sz])}return opts}),$cfs.bind(cf_e("linkAnchors",conf),function(e,t,n){return e.stopPropagation(),is_undefined(t)?t=$("body"):is_string(t)&&(t=$(t)),!is_jquery(t)||t.length==0?debug(conf,"Not a valid object."):(is_string(n)||(n="a.caroufredsel"),t.find(n).each(function(){var e=this.hash||"";e.length>0&&$cfs.children().index($(e))!=-1&&$(this).unbind("click").click(function(t){t.preventDefault(),$cfs.trigger(cf_e("slideTo",conf),e)})}),!0)}),$cfs.bind(cf_e("updatePageStatus",conf),function(e,t,n){e.stopPropagation();if(!opts.pagination.container)return;var r=opts.pagination.items||opts.items.visible,i=Math.ceil(itms.total/r);t&&(opts.pagination.anchorBuilder&&(opts.pagination.container.children().remove(),opts.pagination.container.each(function(){for(var e=0;e<i;e++){var t=$cfs.children().eq(gn_getItemIndex(e*r,0,!0,itms,$cfs));$(this).append(opts.pagination.anchorBuilder.call(t[0],e+1))}})),opts.pagination.container.each(function(){$(this).children().unbind(opts.pagination.event).each(function(e){$(this).bind(opts.pagination.event,function(t){t.preventDefault(),$cfs.trigger(cf_e("slideTo",conf),[e*r,-opts.pagination.deviation,!0,opts.pagination])})})}));var s=$cfs.triggerHandler(cf_e("currentPage",conf))+opts.pagination.deviation;return s>=i&&(s=0),s<0&&(s=i-1),opts.pagination.container.each(function(){$(this).children().removeClass(cf_c("selected",conf)).eq(s).addClass(cf_c("selected",conf))}),!0}),$cfs.bind(cf_e("updateSizes",conf),function(e){var t=opts.items.visible,n=$cfs.children(),r=ms_getParentSize($wrp,opts,"width");itms.total=n.length,crsl.primarySizePercentage?(opts.maxDimension=r,opts[opts.d.width]=ms_getPercentage(r,crsl.primarySizePercentage)):opts.maxDimension=ms_getMaxDimension(opts,r),opts.responsive?(opts.items.width=opts.items.sizesConf.width,opts.items.height=opts.items.sizesConf.height,opts=in_getResponsiveValues(opts,n,r),t=opts.items.visible,sz_setResponsiveSizes(opts,n)):opts.items.visibleConf.variable?t=gn_getVisibleItemsNext(n,opts,0):opts.items.filter!="*"&&(t=gn_getVisibleItemsNextFilter(n,opts,0));if(!opts.circular&&itms.first!=0&&t>itms.first){if(opts.items.visibleConf.variable)var i=gn_getVisibleItemsPrev(n,opts,itms.first)-itms.first;else if(opts.items.filter!="*")var i=gn_getVisibleItemsPrevFilter(n,opts,itms.first)-itms.first;else var i=opts.items.visible-itms.first;debug(conf,"Preventing non-circular: sliding "+i+" items backward."),$cfs.trigger(cf_e("prev",conf),i)}opts.items.visible=cf_getItemsAdjust(t,opts,opts.items.visibleConf.adjust,$tt0),opts.items.visibleConf.old=opts.items.visible,opts=in_getAlignPadding(opts,n);var s=sz_setSizes($cfs,opts);return $cfs.trigger(cf_e("updatePageStatus",conf),[!0,s]),nv_showNavi(opts,itms.total,conf),nv_enableNavi(opts,itms.first,conf),s}),$cfs.bind(cf_e("destroy",conf),function(e,t){return e.stopPropagation(),tmrs=sc_clearTimers(tmrs),$cfs.data("_cfs_isCarousel",!1),$cfs.trigger(cf_e("finish",conf)),t&&$cfs.trigger(cf_e("jumpToStart",conf)),sz_restoreOrigCss($cfs.children()),sz_restoreOrigCss($cfs),FN._unbind_events(),FN._unbind_buttons(),conf.wrapper=="parent"?sz_restoreOrigCss($wrp):$wrp.replaceWith($cfs),!0}),$cfs.bind(cf_e("debug",conf),function(e){return debug(conf,"Carousel width: "+opts.width),debug(conf,"Carousel height: "+opts.height),debug(conf,"Item widths: "+opts.items.width),debug(conf,"Item heights: "+opts.items.height),debug(conf,"Number of items visible: "+opts.items.visible),opts.auto.play&&debug(conf,"Number of items scrolled automatically: "+opts.auto.items),opts.prev.button&&debug(conf,"Number of items scrolled backward: "+opts.prev.items),opts.next.button&&debug(conf,"Number of items scrolled forward: "+opts.next.items),conf.debug}),$cfs.bind("_cfs_triggerEvent",function(e,t,n){return e.stopPropagation(),$cfs.triggerHandler(cf_e(t,conf),n)})},FN._unbind_events=function(){$cfs.unbind(cf_e("",conf)),$cfs.unbind(cf_e("",conf,!1)),$cfs.unbind("_cfs_triggerEvent")},FN._bind_buttons=function(){FN._unbind_buttons(),nv_showNavi(opts,itms.total,conf),nv_enableNavi(opts,itms.first,conf);if(opts.auto.pauseOnHover){var e=bt_pauseOnHoverConfig(opts.auto.pauseOnHover);$wrp.bind(cf_e("mouseenter",conf,!1),function(){$cfs.trigger(cf_e("pause",conf),e)}).bind(cf_e("mouseleave",conf,!1),function(){$cfs.trigger(cf_e("resume",conf))})}opts.auto.button&&opts.auto.button.bind(cf_e(opts.auto.event,conf,!1),function(e){e.preventDefault();var t=!1,n=null;crsl.isPaused?t="play":opts.auto.pauseOnEvent&&(t="pause",n=bt_pauseOnHoverConfig(opts.auto.pauseOnEvent)),t&&$cfs.trigger(cf_e(t,conf),n)});if(opts.prev.button){opts.prev.button.bind(cf_e(opts.prev.event,conf,!1),function(e){e.preventDefault(),$cfs.trigger(cf_e("prev",conf))});if(opts.prev.pauseOnHover){var e=bt_pauseOnHoverConfig(opts.prev.pauseOnHover);opts.prev.button.bind(cf_e("mouseenter",conf,!1),function(){$cfs.trigger(cf_e("pause",conf),e)}).bind(cf_e("mouseleave",conf,!1),function(){$cfs.trigger(cf_e("resume",conf))})}}if(opts.next.button){opts.next.button.bind(cf_e(opts.next.event,conf,!1),function(e){e.preventDefault(),$cfs.trigger(cf_e("next",conf))});if(opts.next.pauseOnHover){var e=bt_pauseOnHoverConfig(opts.next.pauseOnHover);opts.next.button.bind(cf_e("mouseenter",conf,!1),function(){$cfs.trigger(cf_e("pause",conf),e)}).bind(cf_e("mouseleave",conf,!1),function(){$cfs.trigger(cf_e("resume",conf))})}}if(opts.pagination.container&&opts.pagination.pauseOnHover){var e=bt_pauseOnHoverConfig(opts.pagination.pauseOnHover);opts.pagination.container.bind(cf_e("mouseenter",conf,!1),function(){$cfs.trigger(cf_e("pause",conf),e)}).bind(cf_e("mouseleave",conf,!1),function(){$cfs.trigger(cf_e("resume",conf))})}(opts.prev.key||opts.next.key)&&$(document).bind(cf_e("keyup",conf,!1,!0,!0),function(e){var t=e.keyCode;t==opts.next.key&&(e.preventDefault(),$cfs.trigger(cf_e("next",conf))),t==opts.prev.key&&(e.preventDefault(),$cfs.trigger(cf_e("prev",conf)))}),opts.pagination.keys&&$(document).bind(cf_e("keyup",conf,!1,!0,!0),function(e){var t=e.keyCode;t>=49&&t<58&&(t=(t-49)*opts.items.visible,t<=itms.total&&(e.preventDefault(),$cfs.trigger(cf_e("slideTo",conf),[t,0,!0,opts.pagination])))});if($.fn.swipe){var t="ontouchstart"in window;if(t&&opts.swipe.onTouch||!t&&opts.swipe.onMouse){var n=$.extend(!0,{},opts.prev,opts.swipe),r=$.extend(!0,{},opts.next,opts.swipe),i=function(){$cfs.trigger(cf_e("prev",conf),[n])},s=function(){$cfs.trigger(cf_e("next",conf),[r])};switch(opts.direction){case"up":case"down":opts.swipe.options.swipeUp=s,opts.swipe.options.swipeDown=i;break;default:opts.swipe.options.swipeLeft=s,opts.swipe.options.swipeRight=i}crsl.swipe&&$cfs.swipe("destroy"),$wrp.swipe(opts.swipe.options),$wrp.css("cursor","move"),crsl.swipe=!0}}if($.fn.mousewheel&&opts.mousewheel){var o=$.extend(!0,{},opts.prev,opts.mousewheel),u=$.extend(!0,{},opts.next,opts.mousewheel);crsl.mousewheel&&$wrp.unbind(cf_e("mousewheel",conf,!1)),$wrp.bind(cf_e("mousewheel",conf,!1),function(e,t){e.preventDefault(),t>0?$cfs.trigger(cf_e("prev",conf),[o]):$cfs.trigger(cf_e("next",conf),[u])}),crsl.mousewheel=!0}opts.auto.play&&$cfs.trigger(cf_e("play",conf),opts.auto.delay);if(crsl.upDateOnWindowResize){var a=function(e){$cfs.trigger(cf_e("finish",conf)),opts.auto.pauseOnResize&&!crsl.isPaused&&$cfs.trigger(cf_e("play",conf)),sz_resetMargin($cfs.children(),opts),$cfs.trigger(cf_e("updateSizes",conf))},f=$(window),l=null;if($.debounce&&conf.onWindowResize=="debounce")l=$.debounce(200,a);else if($.throttle&&conf.onWindowResize=="throttle")l=$.throttle(300,a);else{var c=0,h=0;l=function(){var e=f.width(),t=f.height();if(e!=c||t!=h)a(),c=e,h=t}}f.bind(cf_e("resize",conf,!1,!0,!0),l)}},FN._unbind_buttons=function(){var e=cf_e("",conf),t=cf_e("",conf,!1);ns3=cf_e("",conf,!1,!0,!0),$(document).unbind(ns3),$(window).unbind(ns3),$wrp.unbind(t),opts.auto.button&&opts.auto.button.unbind(t),opts.prev.button&&opts.prev.button.unbind(t),opts.next.button&&opts.next.button.unbind(t),opts.pagination.container&&(opts.pagination.container.unbind(t),opts.pagination.anchorBuilder&&opts.pagination.container.children().remove()),crsl.swipe&&($cfs.swipe("destroy"),$wrp.css("cursor","default"),crsl.swipe=!1),crsl.mousewheel&&(crsl.mousewheel=!1),nv_showNavi(opts,"hide",conf),nv_enableNavi(opts,"removeClass",conf)},is_boolean(configs)&&(configs={debug:configs});var crsl={direction:"next",isPaused:!0,isScrolling:!1,isStopped:!1,mousewheel:!1,swipe:!1},itms={total:$cfs.children().length,first:0,last:$cfs.children().length-1},tmrs={auto:null,progress:null,startTime:getTime(),timePassed:0},scrl={isStopped:!1,duration:0,startTime:0,easing:"",anims:[]},clbk={onBefore:[],onAfter:[]},queu=[],conf=$.extend(!0,{},$.fn.carouFredSel.configs,configs),opts={},opts_orig=$.extend(!0,{},options),$wrp=conf.wrapper=="parent"?$cfs.parent():$cfs.wrap("<"+conf.wrapper.element+' class="'+conf.wrapper.classname+'" />').parent();conf.selector=$cfs.selector,conf.serialNumber=$.fn.carouFredSel.serialNumber++,conf.transition=conf.transition&&$.fn.transition?"transition":"animate",FN._init(opts_orig,!0,starting_position),FN._build(),FN._bind_events(),FN._bind_buttons();if(is_array(opts.items.start))var start_arr=opts.items.start;else{var start_arr=[];opts.items.start!=0&&start_arr.push(opts.items.start)}opts.cookie&&start_arr.unshift(parseInt(cf_getCookie(opts.cookie),10));if(start_arr.length>0)for(var a=0,l=start_arr.length;a<l;a++){var s=start_arr[a];if(s==0)continue;if(s===!0){s=window.location.hash;if(s.length<1)continue}else s==="random"&&(s=Math.floor(Math.random()*itms.total));if($cfs.triggerHandler(cf_e("slideTo",conf),[s,0,!0,{fx:"none"}]))break}var siz=sz_setSizes($cfs,opts),itm=gi_getCurrentItems($cfs.children(),opts);return opts.onCreate&&opts.onCreate.call($tt0,{width:siz.width,height:siz.height,items:itm}),$cfs.trigger(cf_e("updatePageStatus",conf),[!0,siz]),$cfs.trigger(cf_e("linkAnchors",conf)),conf.debug&&$cfs.trigger(cf_e("debug",conf)),$cfs},$.fn.carouFredSel.serialNumber=1,$.fn.carouFredSel.defaults={synchronise:!1,infinite:!0,circular:!0,responsive:!1,direction:"left",visibleItemCount:0,items:{start:0},scroll:{easing:"swing",duration:500,pauseOnHover:!1,event:"click",queue:!1}},$.fn.carouFredSel.configs={debug:!1,transition:!1,onWindowResize:"throttle",events:{prefix:"",namespace:"cfs"},wrapper:{element:"div",classname:"caroufredsel_wrapper"},classnames:{}},$.fn.carouFredSel.pageAnchorBuilder=function(e){return'<a href="#"><span>'+e+"</span></a>"},$.fn.carouFredSel.progressbarUpdater=function(e){$(this).css("width",e+"%")},$.fn.carouFredSel.cookie={get:function(e){e+="=";var t=document.cookie.split(";");for(var n=0,r=t.length;n<r;n++){var i=t[n];while(i.charAt(0)==" ")i=i.slice(1);if(i.indexOf(e)==0)return i.slice(e.length)}return 0},set:function(e,t,n){var r="";if(n){var i=new Date;i.setTime(i.getTime()+n*24*60*60*1e3),r="; expires="+i.toGMTString()}document.cookie=e+"="+t+r+"; path=/"},remove:function(e){$.fn.carouFredSel.cookie.set(e,"",-1)}},$.extend($.easing,{quadratic:function(e){var t=e*e;return e*(-t*e+4*t-6*e+4)},cubic:function(e){return e*(4*e*e-9*e+6)},elastic:function(e){var t=e*e;return e*(33*t*t-106*t*e+126*t-67*e+15)}})}(jQuery),define("com/external/jquery.carouFredSel-6.2.1",function(){}),define("com/es/widgets/assessment/AssesmentLang",["com/es/widgets/WidgetUtils"],function(e){var t={langGlobalObj:"AssesmentLang",fileName:"assesmentStrings.json"};return e.setLangCode(t.langGlobalObj,t.fileName),!1}),define("com/es/widgets/assessment/AppConst",[],function(){var e={VERSION:"1.0.6.3",ANIMATE_FORWARD:"forward",ANIMATE_BACKWARD:"reverse",QUESTION_SCREEN:"QuestionScreen",QUESTION_PLAYER:"questionPlayer",QUESTION_TYPE_FIB:"FIB",QUESTION_TYPE_REORDERING:"REORDERING",QUESTION_TYPE_LABELLING:"LABELLING",QUESTION_TYPE_MCQ:"MCQ",QUESTION_TYPE_MATCHSORT:"MATCHSORT",QUESTION_TYPE_GROUPING:"GROUPING",QUESTION_TYPE_IMAGE:"IMAGE",QUESTION_TYPE_SPEAKING:"SPEAKING",QUESTION_TYPE_CROSSWORD:"CROSSWORD",QUESTION_TYPE_FIBTABLE:"FIBTABLE",QUESTION_TYPE_OPENTEXT:"OPENTEXT",RESPONSE_TYPE_PICKER:"PICKER",RESPONSE_INSTRUCTION_TEXT:"TEXT",RESPONSE_TYPE_BUTTON:"BUTTON",RESPONSE_TYPE_DRAG:"DRAGDROP",RESPONSE_TYPE_TEXT:"TEXT",RESPONSE_TYPE_BINARY:"BINARY",RESPONSE_TYPE_SET:"SET",RESPONSE_TYPE_TAPPLACE:"TAPPLACE",RESULT_SCREEN:"resultsScreen",RESOURCE_SCREEN:"resourceScreen",WELCOME_SCREEN:"splashScreen",LAYOUT_HORIZONTAL:"HORIZONTAL",ASSETS_PATH:"",DEF_PREFIX:"PRE_",POPQ:!0,ASSESSMENT_BTNS_DIV:"assessmentBtnsContainer",REVIEW_BTNS_DIV:"reviewBtnsContainer",QBTN_RESET:"resetQBtn",QBTN_ANSWERS:"answersBtn",QBTN_CLUES:"activityCluesBtn",QBTN_EVALUATE:"evaluateBtn",QBTN_CORRECT_ANS:"correctAnsBtn",QBTN_USER_ANS:"userAnsBtn",TOOLBAR_DEFAULT:"default",TOOLBAR_ACTIVE:"active",TOOLBAR_LOCKED:"locked",TOOLBAR_DISABLED:"disabled",TOOLBAR_RESET:"reset",TOOLBAR_REVIEW_CORRECT:"review_correct",TOOLBAR_REVIEW_USER:"review_user",QUESTION_VIEW_FIB:"FIB_",QUESTION_VIEW_FIB_TEXT:"FIB__text",QUESTION_VIEW_FIB_IMAGE:"FIB__image",QUESTION_VIEW_FIB_2COL:"FIB_2COL_image",QUESTION_VIEW_FIB_VERTICAL:"FIB__VERTICAL",QUESTION_VIEW_FIB_IMAGE_VERTICAL:"FIB__image_VERTICAL",QUESTION_VIEW_FIB_GAP:"FIB_GAP",QUESTION_VIEW_FIB_GAP_2COL:"FIB_2COL_text",QUESTION_VIEW_FIB_GAP_2COL_IMAGE:"FIB_2COL_image",QUESTION_VIEW_FIB_GAP_2COL_IMAGE_TEXT:"FIB_2COL_image_text",QUESTION_VIEW_FIB_GAP_2COL_AUDIO:"FIB_2COL_audio",QUESTION_VIEW_FIB_GAP_2COL_AUDIO_TEXT:"FIB_2COL_audio_text",QUESTION_VIEW_REORDERING:"REORDERING_HORIZONTAL",QUESTION_VIEW_REORDERING_VERTICAL:"REORDERING_",QUESTION_VIEW_LABELLING:"LABELLING_",QUESTION_VIEW_MCQ:"MCQ_",QUESTION_VIEW_MCQ_2COL:"MCQ_2COL",QUESTION_VIEW_MCQ_TEXT:"MCQ__text",QUESTION_VIEW_MCQ_IMAGE:"MCQ__image",QUESTION_VIEW_MCQ_SOUND:"MCQ__audio",QUESTION_VIEW_MATCHSORT_VERTICAL:"MATCHSORT_",QUESTION_VIEW_GROUPING:"GROUPING_",QUESTION_VIEW_IMAGE:"IMAGE_",QUESTION_VIEW_FIBDROPDOWN:"FIBDROPDOWN_",QUESTION_VIEW_BINARY:"MCQ__BINARY",QUESTION_VIEW_BINARY_TABLE:"FIBTABLE_",QUESTION_VIEW_OPENTEXT:"OPENTEXT_",QUESTION_VIEW_UK2:"UK_2",QUESTION_VIEW_UK3:"UK_3",QUESTION_INSTRUCTION_FIB:"instructions/gapfillbuttondefaultwttext.png",QUESTION_INSTRUCTION_FIB_TEXT:"instructions/gapfilldefaulttext.png",QUESTION_INSTRUCTION_FIB_IMAGE:"instructions/mcqbuttondefaultwtimage.png",QUESTION_INSTRUCTION_FIB_GAP_2COL_IMAGE_TEXT:"instructions/gapfilldefaulttext.png",QUESTION_INSTRUCTION_FIB_2COL:"instructions/gapfill2colwtimage.png",QUESTION_INSTRUCTION_FIB_VERTICAL:"instructions/gapfillpicker.png",QUESTION_INSTRUCTION_FIB_IMAGE_VERTICAL:"instructions/gapfillpickerimage.png",QUESTION_INSTRUCTION_FIB_GAP:"instructions/gapfilldefaulttext.png",QUESTION_INSTRUCTION_FIB_GAP_2COL:"instructions/gapfilldefaulttext.png",QUESTION_INSTRUCTION_FIB_GAP_2COL_IMAGE:"instructions/gapfilldefaulttext.png",QUESTION_INSTRUCTION_FIB_GAP_2COL_AUDIO:"instructions/gapfillbutton2columnwtaudio.png",QUESTION_INSTRUCTION_FIB_GAP_2COL_AUDIO_TEXT:"instructions/gapfill2colwt-audio.png",QUESTION_TYPE_FIB_DROPDOWN:"FIBDROPDOWN",QUESTION_INSTRUCTION_REORDERING:"instructions/reordering(horizontal).png",QUESTION_INSTRUCTION_REORDERING_VERTICAL:"instructions/re-ordering(vertical).png",QUESTION_INSTRUCTION_LABELLING:"instructions/textlabelling.png",QUESTION_INSTRUCTION_MCQ:"instructions/mcqbuttondefaultwtimage.png",QUESTION_INSTRUCTION_MCQ_2COL:"instructions/mcqbutton2colwtimage.png",QUESTION_INSTRUCTION_MCQ_TEXT:"instructions/mcqbuttondefaultwtimage.png",QUESTION_INSTRUCTION_MCQ_TEXT_PICKER:"instructions/mcqpicker.png",QUESTION_INSTRUCTION_MCQ_IMAGE:"instructions/mcqbuttondefaultwtimage.png",QUESTION_INSTRUCTION_MCQ_SOUND:"instructions/mcqbuttondefaultaudio.png",QUESTION_INSTRUCTION_MATCHSORT_VERTICAL:"instructions/matchingvertical.png",QUESTION_INSTRUCTION_GROUPING:"instructions/groupingquestion.png",QUESTION_INSTRUCTION_FIBDROPDOWN:"instructions/fibdropdown.png",QUESTION_INSTRUCTION_BINARY:"instructions/binary.png",QUESTION_INSTRUCTION_BINARY_TABLE:"instructions/fibtablebinary.png",QUESTION_INSTRUCTION_OPENTEXT:"instructions/opentext.png",TOOLBAR_SPEAKING:"speaking_locked",TOOLBAR_SPEAKING_ACTIVE:"speaking",CORRECT:"correct",INCORRECT:"incorrect",PARTIAL:"partial",LANDSCAPE:"90",PORTRAIT:"0",ORIENTATION_ALERT_TEXT:"This device does not support landscape orientation. Please use only portrait orientation.",MATCHING_RIGHTSIDE:"rightside",MATCHING_BOTH:"both",CROSSWORD_AUTO_POPULATE:!0,REORDERING_TAP_PLACE:"tapplace",REORDERING_DRAG_DROP:"dragdrop",DROPDOWN_SPINNINGWHEEL:"spinningwheel",DROPDOWN_NATIVE:"native",FIB_REMOVE_OPTIONS:"removeoptions",FIB_MAINTAIN_OPTIONS:"maintainoptions",DEFAULT_TOASTER_DURATION:1500,INCOMPLETE_TEST_REPORT_CLICK_MSG:"You have missed a question. You must complete all of the questions before proceeding.",URL_CHANGE_MSG:"Are you sure you want to leave this page?",MODE:"normal",USERID:"1",SAMSID:"9781444116526",UserToken:"{31180698-287f-4043-a076-ccc7efc30bed}",COMPLETE:"complete",NO_ATTEMPT:"noattempted"};return e}),define("com/es/widgets/assessment/assessEvent",[],function(){var e={SCREEN_READY:"screenReady",TEMPLATE_READY:"templateReady",ASSESSMENT_INITIATED:"assessmentInitiated",QUESTION_RENDERED:"onQuestionRenderd",QUESTION_EVALUATED:"onQuestionEvaluated",GET_QUESTIONDATA:"getQuestionData",REVIEW_QUESTION:"reviewAssessment",QUESTION_RESET:"onQuestionReset",HINT_SHOWED:"onHintShowed",ANSWER_SHOWED:"onAnswerShowed",ASSESSMENT_COMPLETED:"assessmentCompleted",RESPONSE_SAVED:"onResponseSaved",RESULT_SHOWED:"onResultShowed",CONFIG_SET:"onConfigSet",CONTROLS_DISABLED:"onControlsDisabled",CONTROLS_ENABLED:"onControlsEnabled",MARK_CORRECT:"markCorrect",MARK_INCORRECT:"markIncorrect",MARK_ANSWER:"markAnswer",SAVE_RESPONSE:"saveResponse",ANSWER_MARKED:"answerMarked",CONTINUE_ASSESSMENT:"continueAssessment",CLICK:String(document.documentElement.ontouchmove)!="undefined"?"touchstart":"click",UPDATE_RESPONSE:"updateResponse",CHANGETOOLBARMODE:"onChangeToolbarMode",MARK_EMPTY:"markEmpty",QUIT_RESULT:"quitResult",CHANGE:"change",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",REFRESH_SCROLL:"refreshScroll",Q_STATUS:"quesStatusChanged",START_TEST:"startTest",IMG_LOADED:"imageLoaded",CONTEXT_MENU:"contextmenu"};return e}),define("com/es/widgets/assessment/utilities",["com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent"],function(e,t){var n=new Object;n.resourcePath="",n.DEVICE_TYPE="";var r,i=+(new Date);return n.feedbackScroll=null,n.log=function(e){},n.screenTransition=function(e){n.log("screen moving start"),this.showPreloader(),e.persistent==undefined&&(e.persistent=!0),e.direction==undefined||e.direction==""||e.direction=="forward"?reverse=!1:reverse=!0,curElm=typeof e.curScreen=="string"?$("#"+e.curScreen):e.curScreen,showElm=typeof e.newScreen=="string"?$("#"+e.newScreen):e.newScreen;if(e.handler==undefined||e.handler==null)e.handler=function(){};reverse?(curElm.addClass("outback"),showElm.addClass("inback")):(showElm.addClass("infwd"),curElm.addClass("outfwd")),showElm.removeClass("disableTemplate").addClass("enableTemplate"),setTimeout(function(){n.animationComplete(curElm,showElm,e.persistent,e.handler)},600)},n.questionTransition=function(e){},n.animationComplete=function(e,t,r,i){e.removeClass("current"),this.removeAnimClasses([e,t]),t.addClass("current"),n.log(i),i(e),e.hasClass("quesWrapper")||this.hidePreloader()},n.removeAnimClasses=function(e){var t=["infwd","outfwd","inback","outback","current"];for(var n in t)for(var r in e)e[r].removeClass(t[n])},n.showPreloader=function(){$(".overlay").show(),$("#floatingCirclesG").show()},n.hidePreloader=function(){$(".overlay").hide(),$("#floatingCirclesG").hide()},n.showQuesPopup=function(t){if(!e.POPQ)return;var n=$(".questionPopup"),r='<img src="interface/correctAnswer.png">',i='<img src="interface/wrongAnswer.png">';n.bind(e.CLICK,this.hideQuesPopup);switch(t){case"correct":var s=r+"<br />"+"Correct.";n.find(".questionPopupBox").html(s),n.show();break;case"incorrect":var s=i+"<br />"+"Incorrect.";n.find(".questionPopupBox").html(s),n.show();break;default:}},n.hideQuesPopup=function(e){$(".questionPopup").hide(),$(".questionPopup").unbind()},n.showToasterMessage=function(r,i,s){if(i==undefined||i==null||i=="")i=e.DEFAULT_TOASTER_DURATION;$(".Overlay_toast").bind(t.CLICK,n.hideToasterMessage.bind(n,s)),$(".toast_message").text(r);var o=$("body").height()-100;o/=2,$(".toast_message").css("top",o),$(".Overlay_toast").css("opacity","1"),$(".toast_message").css("opacity","1"),$("#toast").show(),n.myTimer=setTimeout(n.hideToasterMessage.bind(n,s),i)},n.hideToasterMessage=function(e){clearTimeout(n.myTimer),$(".Overlay_toast").unbind(),$(".toast_message").text(""),$("#toast").hide(),e!=undefined&&e!=null&&e()},n.findResumePosition=function(e,t){n.log("findResumePosition quesIds",e),n.log("findResumePosition responseData",t);if(t)for(var r=0;r<e.length;r++){n.log("id>>>>",e[r]);var i=_.findWhere(t,{id:e[r]});if(i.userResponse==undefined)return n.log("k",r),r}return 0},n.renderNode=function s(t,r,i){var o="",u="PRE_";if(_.isArray(r))for(var a=0;a<r.length;a++)o+=s(t,r[a]);else if(typeof r=="object")switch(r.type){case"text":o+=r.data;break;case"optionText":var f="text-icon.png",l="132";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' width='"+l+"'  />";break;case"image":case"a":u.indexOf(e.DEF_PREFIX)<0?(n.log("image tag constuct"),o+="<img src='"+e.IOS_DOC_PATH+r.data+"'  class='image' id='"+i+"' />"):o+="<img src='"+t+r.data+"' class='image' id='"+i+"' />";break;case"optionImage":var f="image-icon.png",l="132";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' width='"+l+"'  />";break;case"word":var f="word-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"powerpoint":var f="powerpoint-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"pdf":var f="pdf-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"video":var f="video-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"html":var f="htmlView-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"excel":var f="excel-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"weblink":var f="weblink-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"activity":var f="activity-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"audio":var f="audio-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;case"personalTutor":var f="personalTutor-icon.png";o+="<img src='interface/"+f+"' data-url='"+t+r.data+"' class='icon' />";break;default:}return o},n.playAudio=function(){n.log("playAudio");var e=$(".audioBtn",this.screen).get(0);e.play(),e=null},n.showResetPopup=function(e){n.log("show reset popup"),$("#confirmload").removeClass("hide").addClass("resetPopup"),$(".resetOverlay").show();var r={};$("#confirmload #buttons input").bind(t.CLICK,function(t){if(t.target.id=="p_reset")var i=1;else if(t.target.id=="c_reset")var i=2;if($("#RemReset").is(":checked"))var s=!0;else var s=!1;$("#confirmload #buttons input").unbind(),$("#confirmload").addClass("hide"),$("#confirmload").removeClass("show"),$(".resetOverlay").hide(),n.log("obj",r),e(i,s)})},n.hideResetPopup=function(e){$(".resetPopup").hide(),$(".resetOverlay").hide(),$(".resetPopup").unbind()},n.showInfo=function(t,n,r,i){$(".overlay").show();var n=n,r=r;$("#infoTitle").html(n),$("#infoContent").html(r),$("#infoImage img").attr("src",i),$("#infoImage img").show(),Imfinity.Constants.ORIENTATION_TYPE==e.LANDSCAPE?$("#info").addClass("alert"):$("#info").removeClass("alert"),(i==""||i==undefined)&&$("#infoImage img").hide(),$("#info").show();var s=$("#info",this.screen)[0].clientHeight,o=$("#InfoHeader",this.screen)[0].clientHeight,u=s-o-5;$("#infoContentCover",this.screen).css("height",u+"px");return},n.hideInfo=function(){title=null,message=null,$("#info").hide(),$(".overlay").hide()},n.randomizeArray=function(e,t){var r=t.slice(),i=new Array;if(e.length!=t.length)return n.log("Can't randomize both array has different size"),null;for(var s=0;s<t.length;s++){var o=t[s],u=!1;r.indexOf(o)>-1&&(u=!0,r=n.removeIndexFromArray(r,r.indexOf(o)));var a=n.generateRandomNo(0,r.length-1);i[s]=r[a],r=n.removeIndexFromArray(r,a),u&&r.push(o)}return i},n.generateRandomNo=function(e,t){return Math.floor(Math.random()*t)+e},n.removeIndexFromArray=function(e,t){if(t>=0&&t<=e.length){var n=[],r=e.slice(0,t),i=e.slice(t+1,e.length);return n.push.apply(n,r),n.push.apply(n,i),n}return e},n.showFeedback=function(r,i){if($("#feedbackBtn").hasClass("disabled"))return;this.feedbackScroll=null,i==undefined&&(i=0);for(var s=0;s<r.length;s++)if(i>=r[s].minMarks&&i<=r[s].maxMarks){var o=r[s];break}var u="";o.feedbackText!=""&&(u+="<div id='feedbackText'>"+o.feedbackText+"</div>");if(o.resources.length>0){u+="<div id='feedbackResource'>",u+="<span class='resourceHeading'>Useful Resources</span>",u+="<div class='resourceContent'><ul>";for(var s=0;s<o.resources.length;s++)u+="<li id='"+o.resources[s].id+"' title='"+o.resources[s].resourceFileName+"' class='resource'><span id='resourceType' class='"+o.resources[s].icon+"'></span><span class='resource-txt'>"+o.resources[s].longText+"</span></li>";u+="</ul></div></div>"}$("#feedbackContent",this.obj).html(u),$("#feedbackOverlay",this.obj).show(),$("#contentWrapper").css("overflow","hidden"),$("#contentWrapper").css("position","relative"),$(".resource",this.obj).bind(e.CLICK,n.showResource),$("#closeFeedback",this.obj).bind(t.CLICK,n.hideFeedback);var a=$("#feedbackWrapper").height()-$("#feedbackText").height();$("#contentWrapper").height(a-20),this.feedbackScroll!=null&&this.feedbackScroll.destroy(),this.feedbackScroll=new IScroll($("#contentWrapper").get(0),{desktopCompatibility:!0,hScroll:!0}),ths=this,_.delay(function(){ths.feedbackScroll.refresh()},999)},n.hideFeedback=function(e){$("#feedbackContent",this.obj).html(""),$("#feedbackOverlay",this.obj).hide(),$("#closeFeedback",this.obj).unbind(),$(".resource",this.obj).unbind(),this.feedbackScroll=null},n.showResource=function(e){window.open(n.resourcePath+"Resources/"+e.target.title,"_blank")},n.create_unique_random_array=function(e,t,r){var i,s=new Array;for(var o=0;o<e;o++){while((i=n.number_found(n.random_number(t,r),s))==-1);s[o]=i}return s},n.random_number=function(e,t){return Math.round((t-e)*Math.random()+e)},n.number_found=function(e,t){for(var n=0;n<t.length;n++)if(e==t[n])return-1;return e},n.generateAlphaArr=function(e){var t=[];for(var n=0;n<e;n++)t.push(String.fromCharCode(65+n));return t},n.checkDevice=function(){screen.width<480?n.DEVICE_TYPE="phone":n.DEVICE_TYPE="desktop"},n.isPhone=function(){return window.innerWidth<768?!0:!1},n.isIOS=function(){var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;return e},n.iOSversion=function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return undefined},n.getHashValue=function(){var e="";return window.location.hash&&(e=window.location.hash.split("#")[1],e=e.split("-")[0]),n.log("value",e),e},n.getMode=function(){var e="";return window.location.hash&&(e=window.location.hash.split("-")[1]),n.log("value",e),e},n.hideAddressBar=function(){var t=document.getElementById("page"),r=navigator.userAgent,i=~r.indexOf("iPhone")||~r.indexOf("iPod"),s=~r.indexOf("iPad"),o=i||s,u=window.navigator.standalone,a=~r.indexOf("Android"),f=0,l,c=n.iOSversion();a?(window.onscroll=function(){t.style.height=window.innerHeight+"px"},window.onbeforeunload=function(){return e.URL_CHANGE_MSG}):window.onresize=function(){var e=t.offsetWidth;if(f==e)return;f=e,l()},(l=window.onload=function(){if(o){var e=document.documentElement.clientHeight;i&&!u&&c[0]<7&&(e+=60),t.style.height=e+"px"}else a&&(t.style.height=window.innerHeight+56+"px");setTimeout(scrollTo,0,0,1)})()},n.sortByKey=function(e,t){return e.sort(function(e,n){var r=e[t],i=n[t];return r<i?-1:r>i?1:0})},n.isDesktopBrowser=function(){return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i)?!1:!0},n.clone=function(e){if(Object.prototype.toString.call(e)==="[object Array]"){var t=[],n=0,r=e.length;for(;n<r;n++)t[n]=arguments.callee(e[n]);return t}if(typeof e=="object"){var t={},n;for(n in e)t[n]=arguments.callee(e[n]);return t}return e},n}),define("com/es/widgets/assessment/model/assessmentWidgetVO",[],function(){var e=Backbone.Model.extend({defaults:{myId:"questionPlayer",headerVisible:"none",leftBtnClass:"",leftVisible:"none",leftLabel:"",title:"Title",titleVisible:"none",rightLabel:"Action",rightBtnClass:"genericActionBtn",rightVisible:"none",timestamp:"00:00:00",colorCode:""}});return e}),define("com/es/widgets/assessment/model/mcqVO",[],function(){var e=Backbone.Model.extend({id:"",modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",heading:"",userResponse:"",partialAttempt:!0,feedback:[]});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/mcqView.html",[],function(){return"<div id='quesWrapper<%=id%>' class='disableTemplate'>\n    <div id='ques<%=id%>' class='quesContent'>\n		<div id='activityContent' style='display:block'>\n        	<div id='questionHeading' class='questionHeading'></div>\n            <div id='qCover' class=''>\n                <div id='questionMedia' class='left question-media'></div>\n                <div id='questionText' class='left questionImage'></div>\n                <div id='questionOptions'></div>\n            </div>\n        </div>\n    </div>\n</div>"}),define("com/es/widgets/assessment/view/mcqView",["com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/mcqView.html"],function(utils,AppConst,assessEvent,contentTpl){var mcqView=Backbone.View.extend({modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",assetsPath:"",reviewData:"",userResponse:[],qId:"",itemClicked:!1,correctAnswerVisible:null,inputNo:0,EvaluateFlag:!1,changeToolbar:{},nodes:[],maxpoints:0,partialAttempt:!0,scroll:null,initialize:function(){_.bindAll(this,"handleMcqBtnClick","resetClickFlag","handleEvaluate"),_.extend(this,Backbone.Events)},render:function(){this.element=this.el;var e=_.template(contentTpl,this.model.toJSON());$("#"+this.model.get("uiId")+" #content",this.$el).QAappend(e),this.screen=$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el),this.obj=this.screen,this.setQuestionData()},setQuestionData:function(){this.modelParagraph=this.model.get("modelParagraph"),this.type=this.model.get("type"),this.layout=this.model.get("questionLayout"),this.responseType=this.model.get("responseType"),this.clues=this.model.get("clues"),this.rubric=this.model.get("rubric"),this.questionText=JSON.stringify(this.model.get("questionBody")),this.questionMedia=this.model.get("questionMedia"),this.optionsMedia=this.model.get("optionsMedia"),this.leftCol=this.model.get("leftCol"),this.rightCol=this.model.get("rightCol"),this.opLayout=this.model.get("optionsLayout"),this.options=this.model.get("options"),this.answers=this.model.get("answers"),this.assetsPath=this.model.get("assetPath"),this.isTest=this.model.get("isTest"),this.isReview=this.model.get("isReview"),this.reviewData=this.model.get(""),this.qId=this.model.get("id"),this.maxpoints=parseFloat(this.model.get("maxpoints")),this.model.get("userResponse")&&(this.userResponse=this.model.get("userResponse").userResponse,this.isAnswered=!0),this.heading=this.model.get("heading"),this.partialAttempt=this.model.get("partialAttempt"),this.renderQues()},renderQues:function(){var qBody=eval(this.questionText.replace(/'+/g,"&apos;")),qOptions=eval(this.options);if(this.heading.length==0)$(".questionHeading",this.screen).hide();else{var headingStr="";for(var i=0;i<this.heading.length;i++)this.heading[i].type=="image"?headingStr+="<img src='"+this.assetsPath+this.heading[i].data+"' />":headingStr+="<div>"+this.heading[i].data+"</div>";$(".questionHeading",this.screen).html(headingStr)}if(this.questionMedia.length==0)$("#questionMedia",this.screen).hide();else{var qMediaStr="";for(var i=0;i<this.questionMedia.length;i++)qMediaStr+=utils.renderNode(this.assetsPath,this.questionMedia[i]);$("#questionMedia",this.screen).html(qMediaStr)}$("#questionMedia img",this.screen).bind(assessEvent.CLICK,function(){window.open($("#questionMedia img",this.screen).data("url"))});var qStr="",optionsStr="";optionHasImg=!1;if(optionHasImg&&this.responseType==AppConst.RESPONSE_TYPE_BUTTON){$("#qCover",this.screen).addClass("img2col");for(var i=0;i<qBody.length;i++)switch(qBody[i].type){case"text":qStr+=qBody[i].data;break;case"image":qStr+='<div class="col inlineImg"><img src=\''+this.assetsPath+qBody[i].data+"'  /></div>";break;default:}for(var i=0;i<qOptions.length;i++)switch(qOptions[i][0].type){case"text":optionsStr+='<div class="optionTxt"> <div id="text'+(i+1)+'" class="col">'+qOptions[i][0].data+'</div> <div id="opt'+(i+1)+"\" class='indicators modifier' "+"' data-op="+(i+1)+"> </div> </div>";break;case"image":optionsStr+='<li class="optionImg"> <img id="img'+(i+1)+"\" src='"+this.assetsPath+qOptions[i][0].data+"' /> <div id=\"opt"+(i+1)+"\" class='indicators modifier' "+"' data-op="+(i+1)+"> </div> </li>";break;default:}$("#questionText",this.obj).html(qStr),$("#questionText",this.obj).css("width","50%"),utils.log("QuestionTxt: "+$("#questionText",this.obj).html()),$("#questionOptions",this.obj).html(optionsStr),$("#activityContent",this.obj).addClass("mcqviewParent"),$("#questionText",this.obj).addClass("mcqQuestionText"),$("#questionOptions",this.obj).addClass("mcqOptions")}else{qStr+=utils.renderNode(this.assetsPath,qBody),this.layout=="2COL"&&this.leftCol!=""&&this.rightCol!=""&&(qStr+="<div class='leftcol'>",qStr+=utils.renderNode(this.assetsPath,eval(this.leftCol)),qStr+="</div>",qStr+="<div class='rightcol'>",qStr+=utils.renderNode(this.assetsPath,eval(this.rightCol)),qStr+="</div>");if(this.responseType==""||this.responseType==AppConst.RESPONSE_TYPE_BUTTON){this.inputNo=this.answers.length,this.opLayout=="2COL"?qOptions[0].type=="image"?optionsStr="<div class='mcq4'><ul class='newoptions '>":optionsStr="<div class='mcq4'><ul class='newoptions'>":qOptions[0].type=="image"?optionsStr="<div class='mcq2'><ul class='newoptions '>":optionsStr="<div class='mcq2'><ul class='newoptions'>";for(var i=0;i<qOptions.length;i++){var idcClasses=null;this.answers.length>1?idcClasses="indicators checkbox-btn-indicators":idcClasses="indicators radio-btn-indicators",optionsStr+="<li class='ui-ind-mcq' id='ui-mcq-"+(i+1)+"'><div class='"+idcClasses+"' id='opt"+(i+1)+"' data-op='"+(i+1)+"'></div>";for(var j=0;j<qOptions[i].length;j++)qOptions[i][j].type=="image"?optionsStr+="<img src='"+this.assetsPath+qOptions[i][j].data+"'></img>":optionsStr+="<div>"+qOptions[i][j].data+"</div>",this.optionsMedia.length!=0&&this.optionsMedia[i]!=undefined&&(this.optionsMedia[i].type=="image"?this.optionsMedia[i].type="optionImage":this.optionsMedia[i].type=="text"&&(this.optionsMedia[i].type="optionText"),optionsStr+="<div class='options-media'>"+utils.renderNode(this.assetsPath,this.optionsMedia[i])+"</div>");optionsStr+="<span class='checkBadge2'></span></li>"}optionsStr+="</ul></div>",$("#questionOptions",this.obj).html(optionsStr),$("#questionText",this.obj).html(qStr);if(qOptions[0].type=="image"){var l=$("#questionText",this.obj).find(".leftcol"),r=$("#questionText",this.obj).find(".rightcol");l.before(r),l.removeClass("leftcol"),r.removeClass("rightcol")}}}var root=$(".mcq2",this.obj),options=$("input",root),len=options.length,minFontSize=14;for(var i=0;i<len;i++){var node=options[i],fsize=this.resizeText(node,minFontSize);minFontSize=fsize<minFontSize?fsize:minFontSize}for(var i=0;i<len;i++){var node=options[i];node.style.fontSize=minFontSize+"px"}this.enableInteraction();var loadedImageCount=0,imgArray=$("#activityContent img",this.obj),imgCount=imgArray.length,that=this;imgCount==0&&this.trigger(assessEvent.TEMPLATE_READY),_.each(imgArray,function(e){$(e).on("load",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.trigger(assessEvent.IMG_LOADED),that.trigger(assessEvent.TEMPLATE_READY))}),$(e).on("error",function(){loadedImageCount++,imgCount===loadedImageCount&&that.trigger(assessEvent.TEMPLATE_READY)})})},resizeText:function(e,t){var n=t;while(e.offsetWidth<e.scrollWidth)e.style.fontSize=--n+"px";return n},enableInteraction:function(){$("#questionOptions",this.obj).find("input").unbind(),$("#questionOptions",this.obj).find("li").unbind(),$("#questionOptions",this.obj).find("input").removeClass("disableOption").removeClass("disabled"),$("#questionOptions",this.obj).find("li").removeClass("disableOption").removeClass("disabled"),$("#questionOptions",this.obj).find("li").removeClass("disableOption").removeClass("disabled"),$("#questionOptions",this.obj).find("img").removeClass("disableOption").removeClass("disabled"),$("#questionOptions",this.obj).find("div").removeClass("disableOption").removeClass("disabled"),$("#questionText",this.obj).removeClass("disabled");var qOptions=eval(this.options);$("#questionOptions",this.obj).find(".optionImg").bind(assessEvent.CLICK,this.handleMcqBtnClick),$("#questionOptions",this.obj).find("li").bind(assessEvent.CLICK,this.handleMcqBtnClick),$("#questionOptions",this.obj).find("input").bind(assessEvent.CLICK,this.handleMcqBtnClick),$(".options-media img",this.obj).unbind().bind(assessEvent.CLICK,function(){window.open($(".options-media img",this.screen).data("url"))})},disableInteraction:function(){var e=$("#activityContent img",this.obj);$("#questionOptions",this.obj).find("input").addClass("disableOption"),$("#questionOptions",this.obj).find("li").addClass("disableOption"),$("#questionOptions",this.obj).find("img").addClass("disableOption"),$("#questionOptions",this.obj).find("input").unbind(),$("#questionOptions",this.obj).find("li").unbind(),$("#questionOptions",this.obj).find("img").unbind(),$("#questionOptions",this.obj).find(".qr-correct").unbind(),$("#questionOptions",this.obj).find(".qr-incorrect").unbind(),$("#questionOptions",this.obj).find(".optionImg").unbind(),$("#questionText",this.screen).addClass("disabled"),$(".options-media img",this.obj).unbind(),$(e).off()},handleMcqBtnClick:function(e){if(e.target.parentNode.classList&&e.target.parentNode.classList.contains("options-media"))return;if(this.itemClicked==1)return;this.itemClicked=!0;var t=e.target;this.answers.length==1?($("#questionOptions",this.obj).find(".selected").removeClass("selected"),utils.log(t),t.nodeName.toLowerCase()!="li"?(t.nodeName.toLowerCase()=="img"&&($(t).addClass("selected"),$(t.parentNode).find(".modifier").addClass("selected")),$(t).hasClass("modifier")&&$(t).addClass("selected"),$(t.parentNode).find(".modifier").length>0?$(t).find(".modifier").addClass("selected"):(t=$(t).closest(".ui-ind-mcq"),$(t).addClass("selected"),$(t).find(".indicators").addClass("selected"),$(t).find(".optionsText").addClass("selected"))):($(t).addClass("selected"),$(t).find(".indicators").addClass("selected"),$(t).find(".optionsText").addClass("selected"))):(t.nodeName.toLowerCase()!="li"&&(t=$(t).closest(".ui-ind-mcq")),$(t).find(".indicators").hasClass("selected")?($(t).removeClass("selected"),$(t).find(".indicators").removeClass("selected"),$(t).find(".optionsText").removeClass("selected")):$("ul.newoptions,div.mcqOptions",this.obj).find(".indicators.selected").length<this.answers.length&&($(t).addClass("selected"),$(t).find(".indicators").addClass("selected"),$(t).find(".optionsText").addClass("selected")));var n=$("#questionOptions",this.obj).find(".indicators.selected");this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,n.length==this.answers.length?this.trigger(assessEvent.Q_STATUS,AppConst.COMPLETE):n.length>0?this.trigger(assessEvent.Q_STATUS,AppConst.PARTIAL):this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT),this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),_.delay(this.resetClickFlag,500)},resetClickFlag:function(){this.itemClicked=!1},handleEvaluate:function(e){if(e!=undefined&&$(e.target).hasClass("disabled"))return;this.userResponse=[],blankObjsBadges=$("#questionOptions",this.obj).find("li.ui-ind-mcq").find(".checkBadge2");if(this.answers.length==1){var t=$("#questionOptions",this.obj).find(".indicators.selected").attr("data-op"),n=this.maxpoints,r=0;this.userResponse.push(t);var i=$("#questionOptions",this.obj).find(".indicators.selected").length;this.partialAttempt==1||i>0?t==this.answers[0]?($("#questionOptions",this.obj).find("#ui-mcq-"+t).find(".checkBadge2").addClass("markRight2"),$("#questionOptions",this.obj).find("#ui-mcq-"+t).addClass("focus-markright"),r+=n,this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.CORRECT,maxScore:this.maxpoints,optLength:this.options.length,type:this.type,responseType:this.responseType})):($("#questionOptions",this.obj).find("#ui-mcq-"+t).find(".checkBadge2").addClass("markWrong2"),$("#questionOptions",this.obj).find("#ui-mcq-"+t).addClass("focus-markwrong"),this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.INCORRECT,maxScore:this.maxpoints,optLength:this.options.length,type:this.type,responseType:this.responseType})):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,type:this.type,optLength:this.options.length,responseType:this.responseType})}else if(this.answers.length>1){var s=$("#questionOptions",this.obj).find(".indicators.selected");$("#questionOptions",this.obj).removeClass("selected"),blankObjsBadges=$("#questionOptions",this.obj).find("li.ui-ind-mcq").find(".checkBadge2");var o=0,u=0;u=this.answers.length;var n=parseFloat(this.maxpoints/u),r=0;for(var a=0;a<this.answers.length;a++){var t=$(s.get(a)).attr("data-op");this.userResponse.push(""+t)}for(var f=0;f<s.length;f++){var l=parseInt(this.userResponse[f]),t=parseInt($(s.get(f)).attr("data-op"));this.answers.indexOf(l)>=0?($("#questionOptions",this.obj).find("#ui-mcq-"+t).find(".checkBadge2").addClass("markRight2"),$("#questionOptions",this.obj).find("#ui-mcq-"+t).addClass("focus-markright"),r+=n,o++):($("#questionOptions",this.obj).find("#ui-mcq-"+t).find(".checkBadge2").addClass("markWrong2"),$("#questionOptions",this.obj).find("#ui-mcq-"+t).addClass("focus-markwrong"))}this.partialAttempt==1||s.length==u?o==this.answers.length?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.CORRECT,maxScore:this.maxpoints,type:this.type,optLength:this.options.length,responseType:this.responseType}):o>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.PARTIAL,maxScore:this.maxpoints,type:this.type,optLength:this.options.length,responseType:this.responseType}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.INCORRECT,maxScore:this.maxpoints,type:this.type,optLength:this.options.length,responseType:this.responseType}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,type:this.type,optLength:this.options.length,responseType:this.responseType})}this.partialAttempt||(blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markright"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markwrong")),$("#questionOptions",this.obj).find("li").removeClass("selected"),this.EvaluateFlag=!0,this.lockQuestion()},lockQuestion:function(){this.correctAnswerVisible=!1,this.changeToolbar.mode=AppConst.TOOLBAR_LOCKED,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.disableInteraction()},populateAnswers:function(e,t){e.length>0&&(this.EvaluateFlag=!0),blankObjsBadges=$("#questionOptions",this.obj).find("li.ui-ind-mcq").find(".checkBadge2"),$("#questionOptions",this.obj).find("input").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("input").removeClass("selected"),$("#questionOptions",this.obj).find("img").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("img").removeClass("selected"),blankObjsBadges.removeClass("markWrong2"),blankObjsBadges.removeClass("markRight2"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markright"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markwrong"),$("#questionOptions",this.obj).find(".indicators").removeClass("selected"),$("#questionOptions",this.obj).find("div.optionsText").removeClass("Selected"),$("#questionOptions",this.obj).find(".qr-incorrect").removeClass("selected"),$("#questionOptions",this.obj).find(".qr-correct").removeClass("selected"),t==0&&(this.responseType==AppConst.RESPONSE_TYPE_PICKER?($("#MCQpick",this.obj).removeClass("markWrong2"),$("#MCQpick",this.obj).removeClass("markRight2")):(blankObjsBadges.removeClass("markWrong2"),blankObjsBadges.removeClass("markRight2")));if(this.responseType==AppConst.RESPONSE_TYPE_PICKER)e.length>0?(ans=this.options[e[0]-1].data,$("#questionOptions",this.obj).find("input").val(ans)):$("#questionOptions",this.obj).find("input").val(" ");else if(this.responseType==AppConst.RESPONSE_TYPE_BINARY){if(e.length>0)for(var n=0;n<e.length;n++)e[n]==0?$("#li"+(n+1),this.obj).find(".qr-correct").addClass("selected"):e[n]==1&&$("#li"+(n+1),this.obj).find(".qr-incorrect").addClass("selected")}else{e.length>0?($("#questionOptions",this.obj).find("li").attr("disabled","disabled"),$("#questionOptions",this.obj).find("li").addClass("disabled")):($("#questionOptions",this.obj).find("li").removeAttr("disabled"),$("#questionOptions",this.obj).find("li").removeClass("disabled"),$("#questionOptions",this.obj).find(".selected").removeClass("selected"));for(var r=0;r<e.length;r++)$("#opt"+e[r],this.obj).addClass("selected"),$("#text"+e[r],this.obj).addClass("selected")}if(t==1){for(var r=0;r<this.userResponse.length;r++)for(var i=0;i<this.answers.length;i++){var s=parseInt(this.userResponse[i]);this.answers.indexOf(s)>=0?($("#questionOptions",this.obj).find("#ui-mcq-"+s).find(".checkBadge2").addClass("markRight2"),$("#questionOptions",this.obj).find("#ui-mcq-"+s).addClass("focus-markright"),$("#li"+s,this.obj).find(".indicators").addClass("selected"),$("#li"+s,this.obj).find(".optionsText").addClass("selected"),$("#opt"+s,this.obj).find("img")?$("#opt"+s,this.obj).find("img").addClass("selected"):($("#questionOptions",this.obj).find(".checkBadge2").addClass("markWrong2"),$("#questionOptions",this.obj).addClass("focus-markwrong"),$("#li"+s,this.obj).find(".optionsText").addClass("selected"),$("#opt"+s,this.obj).addClass("selected"))):($("#questionOptions",this.obj).find("#ui-mcq-"+s).find(".checkBadge2").addClass("markWrong2"),$("#questionOptions",this.obj).find("#ui-mcq-"+s).addClass("focus-markwrong"),$("#opt"+s,this.obj).find("img").length>0?$("#opt"+s,this.obj).find("img").addClass("selected"):($("#opt"+s,this.obj).addClass("selected"),$("#opt"+s,this.obj).find(".indicators").addClass("selected"),$("#opt"+s,this.obj).find(".optionsText").addClass("selected")))}(this.isTest||this.partialAttempt==0)&&!this.isReview&&(blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markright"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markwrong"))}},resetQuestion:function(e){$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("markRight2"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("markWrong2"),blankObjsBadges=$("#questionOptions",this.obj).find("li.ui-ind-mcq").find(".checkBadge2"),blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markright"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markwrong");if(this.responseType==""||this.responseType==AppConst.RESPONSE_TYPE_BINARY){$("#questionOptions",this.obj).find(".selected").removeClass("selected"),$("#questionOptions",this.obj).find("input").removeClass("optionHighlight");var t=$("#questionOptions",this.obj).find("li");t.removeAttr("disabled"),t.removeClass("disabled"),blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2"),t.removeClass("optionHighlight")}else if(this.responseType==""||this.responseType==AppConst.RESPONSE_TYPE_BUTTON){$("#questionOptions",this.obj).find(".selected").removeClass("selected"),$("#questionOptions",this.obj).find("input").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("img").removeClass("optionHighlight");var t=$("#questionOptions",this.obj).find("li");t.removeAttr("disabled"),t.removeClass("disabled"),blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2"),t.removeClass("optionHighlight")}else this.responseType==AppConst.RESPONSE_TYPE_PICKER&&($("#MCQpick",this.obj).val(""),$("#MCQpick",this.obj).removeClass("markRight2"),$("#MCQpick",this.obj).removeClass("markWrong2"),$("#MCQpick",this.obj).removeClass("disabled"),$("#MCQpick",this.obj).removeClass("selected"));this.userResponse=[],this.EvaluateFlag=!1,this.enableInteraction(),this.trigger(assessEvent.MARK_EMPTY,this.qId),this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)},resetQuestionPartial:function(e){var t=!0;blankObjsBadges=$("#questionOptions",this.obj).find("li.ui-ind-mcq").find(".checkBadge2"),blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markright"),$("#questionOptions",this.obj).find(".ui-ind-mcq").removeClass("focus-markwrong"),$("#questionOptions",this.obj).find("li").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("img").removeClass("optionHighlight"),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);if(this.responseType==""||this.responseType==AppConst.RESPONSE_TYPE_BUTTON){$("#questionOptions",this.obj).find(".selected").removeClass("selected"),$("#questionOptions",this.obj).find("li").removeAttr("disabled"),$("#questionOptions",this.obj).find("li").removeClass("disabled");if(this.userResponse.length>0)for(var n=0;n<this.userResponse.length;n++)this.answers.indexOf(this.userResponse[n])>-1?($("#opt"+this.userResponse[n],this.obj).find("img").length!=0?($("#opt"+this.userResponse[n],this.obj).find("img").addClass("selected"),$("#opt"+this.userResponse[n],this.obj).addClass("selected")):$("#opt"+this.userResponse[n],this.obj).addClass("selected"),this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),t=!1):this.userResponse[n]=""}this.EvaluateFlag=!1,this.correctAnswerVisible=!1,this.enableInteraction(),t==0?this.trigger(assessEvent.UPDATE_RESPONSE,this.qId,{userResponse:this.userResponse}):this.trigger(assessEvent.MARK_EMPTY,this.qId),this.disableButton(AppConst.QBTN_RESET)},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},handleScreenExit:function(){},orientationchange:function(e){},randomize:function(){if(this.responseType==""||this.responseType==AppConst.RESPONSE_TYPE_BINARY){var e="";this.opLayout=="2COL"?e="<div class='mcq4'><ul>":e="<div class='mcq2 trueFalse'><ul>";for(var t=0;t<this.nodes.length;t++)e+=this.nodes[t];e+="</ul></div>",$("#questionOptions",this.screen).html(e)}},destroy:function(){this.unbind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.unbind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.unbind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.unbind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.unbind(assessEvent.MARK_EMPTY,this.markEmpty),this.unbind(assessEvent.UPDATE_RESPONSE,this.updateResponse),$("#questionOptions",this.obj).find("li").unbind(),$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el).remove(),this.disableInteraction()}});return mcqView}),define("com/es/widgets/assessment/model/matchSortVO",[],function(){var e=Backbone.Model.extend({id:"",modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",heading:[],attemptMethod:"",partialAttempt:!0,feedback:[]});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/matchSortView.html",[],function(){return"<div id='quesWrapper<%=id%>' class='none-bg disableTemplate'>\n    <div id='ques<%=id%>'  class='quesContent'>\n		<div id='activityContent'>\n            <div id='questionHeading' class='questionHeading'></div>\n            <div id='questionMedia' class='left question-media'></div>\n            <div id='questionText' class='center clearfix'></div>\n            <div id='questionOptions'></div>\n            <div id='labelanswers'></div>\n        </div>\n	</div>\n</div>"}),define("com/es/widgets/assessment/view/matchSortView",["com/es/widgets/assessment/AssesmentLang","com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/matchSortView.html"],function(AssesmentLang,utils,AppConst,assessEvent,contentTpl){var matchSortView=Backbone.View.extend({modelParagraph:"",qId:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:[],answers:"",isTest:"",isReview:"",reviewData:"",userResponse:[],itemClicked:!1,correctAnswerVisible:null,inputNo:0,EvaluateFlag:!1,templateOptionItem:"<div class='dropelement' id='drag<%=index+1%>'><span><%=option.data%></span></div>",resetClicked:!1,firstItem:null,secondItem:null,numSelected:0,changeToolbar:{},quesType:"",maxItemHeight:0,maxpoints:0,assetsPath:"",marksQbtained:0,rightMaxWidth:0,leftMaxWidth:0,heading:"",attemptMethod:AppConst.MATCHING_RIGHTSIDE,partialAttempt:!0,sortItemAttr:"",refItemAttr:"",title:"",defaultOptions:[],scroll:null,initialize:function(){_.bindAll(this,"handleEvaluate","resetClickFlag","handleLook","handleMatchSortItemClick","handleMatchLeftItemClick","handleMatchRightItemClick"),_.extend(this,Backbone.Events)},render:function(){this.element=this.el;var e=_.template(contentTpl,this.model.toJSON());$("#"+this.model.get("uiId")+" #content",this.$el).QAappend(e),this.screen=$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el),this.setQuestionData()},setQuestionData:function(){this.modelParagraph=this.model.get("modelParagraph"),this.type=this.model.get("type"),this.layout=this.model.get("questionLayout"),this.responseType=this.model.get("responseType"),this.clues=this.model.get("clues"),this.rubric=this.model.get("rubric"),this.questionText=JSON.stringify(this.model.get("questionBody")),this.questionMedia=this.model.get("questionMedia"),this.optionsMedia=this.model.get("optionsMedia"),this.leftCol=this.model.get("leftCol"),this.rightCol=this.model.get("rightCol"),this.opLayout=this.model.get("optionsLayout"),this.answers=this.model.get("answers"),this.assetsPath=this.model.get("assetPath"),this.options=this.model.get("options"),this.isTest=this.model.get("isTest"),this.isReview=this.model.get("isReview"),this.reviewData=this.model.get(""),this.inputNo=this.options.length,this.qId=this.model.get("id"),this.heading=this.model.get("heading"),this.maxpoints=parseFloat(this.model.get("maxpoints")),this.partialAttempt=this.model.get("partialAttempt"),this.title=this.model.get("title"),this.model.get("userResponse").userResponse&&(this.userResponse=this.model.get("userResponse").userResponse),this.attemptMethod=this.model.get("attemptMethod"),this.renderQues()},renderQues:function(){this.userResponse&&this.userResponse.length>0&&(this.EvaluateFlag=!0),this.obj=this.screen;var leftOptions=eval(this.questionText);this.answers=eval(_.clone(this.options));var rightOptions=eval(_.clone(this.options));if(!leftOptions.length||!rightOptions.length)return;var leftSort="<div class='leftsort'>";leftSort+=this.generateList(leftOptions,"sortL","matching addsort textsort","refItem"),leftSort+="</div>";var rightSort="<div class='rightsort'>";rightOptions=utils.randomizeArray(leftOptions,rightOptions),rightSort+=this.generateList(rightOptions,"sort","matching addsort textsort","sortItem","addBadge"),rightSort+="</div>",$("#questionText",this.obj).html(leftSort+rightSort),$("#sortL",this.obj).find("img").length==0?(this.refItemAttr="p",$("#sortL",this.obj).removeClass("addsort")):(this.refItemAttr="img",$("#sortL",this.obj).removeClass("textsort")),$("#sort",this.obj).find("img").length==0?(this.sortItemAttr="p",$("#sort",this.obj).removeClass("addsort")):(this.sortItemAttr="img",$("#sort",this.obj).removeClass("textsort"),this.quesType="image");if(this.heading.length==0)$(".questionHeading",this.screen).hide();else{var headingStr="";for(var i=0;i<this.heading.length;i++)this.heading[i].type=="image"?headingStr+="<img src='"+this.assetsPath+this.heading[i].data+"' />":headingStr+="<div>"+this.heading[i].data+"</div>";$(".questionHeading",this.screen).html(headingStr)}if(this.questionMedia.length==0)$("#questionMedia",this.screen).hide();else{var qMediaStr="";for(var i=0;i<this.questionMedia.length;i++)qMediaStr+=utils.renderNode(this.assetsPath,this.questionMedia[i]);$("#questionMedia",this.screen).html(qMediaStr)}$("#questionMedia img",this.screen).bind(assessEvent.CLICK,function(){window.open($("#questionMedia img").data("url"))});var fontSize=1;$("#sort > li",this.obj).css("font-size",fontSize+"em"),this.enableInteraction();var loadedImageCount=0,imgArray=$("#activityContent img",this.obj),imgCount=imgArray.length,that=this;_.delay(function(){imgCount==0&&(that.handleLook(),that.trigger(assessEvent.TEMPLATE_READY))},200),_.each(imgArray,function(e){$(e).on("load",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.handleLook(),that.trigger(assessEvent.IMG_LOADED),that.trigger(assessEvent.TEMPLATE_READY))}),$(e).on("error",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.handleLook(),that.trigger(assessEvent.TEMPLATE_READY))})})},checkMaxHeight:function(e,t){var n=e.length,r=0;for(var i=0;i<n;i++){var s=$("#"+t+(i+1),this.screen).get(0).scrollHeight,o=parseInt($("#"+t+(i+1)+" p",this.screen).css("padding"));o&&(s+=o*2),s>r&&(r=s)}return r},handleLook:function(){var leftOptions=eval(this.questionText),rightOptions=eval(_.clone(this.options)),l=this.checkMaxHeight(leftOptions,"refItem"),r=this.checkMaxHeight(rightOptions,"sortItem");if(utils.isPhone()){var maxWidthNode=$(".matching",this.obj),fontSize=this.resizeText(maxWidthNode,.8);$(".matching  > li",this.obj).css("font-size",fontSize+"em")}this.maxItemHeight=l>r?l:r,this.maxItemHeight<60&&(this.maxItemHeight=60),utils.log("left maxHeight: "+l+" | r mHieght: "+r),$("li",this.screen).css("height",this.maxItemHeight+"px"),$("li",this.screen).css("position","relative");var pHeight=this.maxItemHeight/2;if($("#sort",this.screen).find("p").length==$("#sortL",this.screen).find("p").length){var pList=$("#sort, #sortL",this.screen).find("p");for(var idx=0;idx<pList.length;idx++)$(pList[idx]).height()<this.maxItemHeight-5}var paddingHeight=parseInt($("li",this.screen).css("padding-bottom"));paddingHeight+=parseInt($("li",this.screen).css("padding-top")),$("#sort, #sortL",this.screen).find("p").css("height",this.maxItemHeight-paddingHeight+"px"),$("#sort",this.screen).find("p").length>0&&$("#sort",this.screen).find("img").length==0&&$("#sortL",this.screen).find("p").length>0&&$("#sortL",this.screen).find("img").length==0&&($("#sort",this.screen).addClass("matchTextSpacer"),$("#sortL",this.screen).addClass("matchTextSpacer")),this.quesType=="image"},checkMaxOffWidth:function(e,t){var n=e.length,r=0,i;for(var s=0;s<n;s++){var o=$("#"+t+(s+1),this.screen).find("p");if(o.length>0)o=o.get(0).offsetWidth;else var o=$("#"+t+(s+1),this.screen).find("img").get(0).offsetWidth;o>r&&(r=o,i=$("#"+t+(s+1),this.screen))}return i},resetFontSize:function(e,t,n){return fSize=n,e.offsetWidth-6<t.offsetWidth&&(fSize=t.innerHTML.length*.625),fSize},resizeText:function(e,t){var n=t;for(var r=0;r<e.length;r++)e[r].offsetWidth<e[r].scrollWidth&&(n-=.1);return n},enableInteraction:function(){$("li",this.obj).removeClass("disableOption"),$("p",this.obj).removeClass("disableOption"),$("img",this.obj).removeClass("disableOption"),$("#questionText",this.obj).removeClass("disabled");var e=$(".rightsort li",this.obj).find("img"),t=$(".leftsort li",this.obj).find("img");this.attemptMethod!=AppConst.MATCHING_RIGHTSIDE?(e.get(0)?$(".rightsort",this.obj).find("li").unbind().bind(assessEvent.CLICK,this.handleMatchRightItemClick):$(".rightsort",this.obj).find("li").unbind().bind(assessEvent.CLICK,this.handleMatchRightItemClick),t.get(0)?$(".leftsort",this.obj).find("li").unbind().bind(assessEvent.CLICK,this.handleMatchLeftItemClick):$(".leftsort",this.obj).find("li").unbind().bind(assessEvent.CLICK,this.handleMatchLeftItemClick)):e.get(0)?$(".rightsort",this.obj).find("li").unbind().bind(assessEvent.CLICK,this.handleMatchSortItemClick):$(".rightsort",this.obj).find("li").unbind().bind(assessEvent.CLICK,this.handleMatchSortItemClick)},disableInteraction:function(){var e=$("#activityContent img",this.obj);$("li",this.obj).unbind(),$("img",this.obj).unbind(),$("p",this.obj).unbind(),$("#questionText",this.obj).addClass("disabled"),$("#questionMedia img",this.screen).unbind(),$(".rightsort",this.obj).find("li").unbind(),$(".leftsort",this.obj).find("li").unbind(),e.off()},handleTouchStart:function(e){$("#sort>li",this.obj).attr("class","options")},handleMatchSortItemClick:function(e){if(this.itemClicked==1)return;$(".rightsort li",this.obj).find("img").removeClass("selected"),$(".rightsort li",this.obj).removeClass("selected"),this.itemClicked=!0;var t=e.target,n=t.id;if(t.nodeName=="IMG")t=t.parentNode.parentNode;else if(t.nodeName=="figure"||t.nodeName=="P")t=t.parentNode;$(".rightsort li",this.obj).find("img").attr("class","options");var r=$(t);r.get(0)?r.addClass("selected"):$(t).addClass("selected"),this.numSelected==0?(this.firstItem={value:$(t).html(),ele:t.id},this.numSelected++):this.numSelected==1&&(this.secondItem={value:$(t).html(),ele:t.id},this.swap(this.firstItem,this.secondItem),$(".rightsort li",this.obj).removeClass(),this.numSelected=0,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)),_.delay(this.resetClickFlag,100)},handleMatchRightItemClick:function(e){if(this.itemClicked==1)return;$(".rightsort li",this.obj).removeClass("selected"),$(".rightsort p",this.obj).removeClass("selected"),$(".rightsort img",this.obj).removeClass("selected"),this.itemClicked=!0;var t=e.target,n=t,r=t.id;t.nodeName.toLowerCase()=="img"?(t=t.parentNode,n=t):t.nodeName.toLowerCase()=="figure"?(t=t.parentNode,n=t):t.nodeName.toLowerCase()=="p"&&(n=t,t=t.parentNode);if($(t).hasClass("attempted")){$(t).removeClass("attempted");var i=t.id.split("sortItem")[1];$("#refItem"+i,this.obj).removeClass("attempted"),$("#sortL",this.obj).find(".attempted").length==this.options.length?this.trigger(assessEvent.Q_STATUS,AppConst.COMPLETE):$("#sortL",this.obj).find(".attempted").length>0?this.trigger(assessEvent.Q_STATUS,AppConst.PARTIAL):this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT)}var s=$(t);s.get(0)?s.addClass("selected"):$(n).addClass("selected"),this.firstItem={value:$(t).html(),ele:t.id},this.firstItem!=null&&this.secondItem!=null&&(this.swap(this.firstItem,this.secondItem),this.firstItem=null,this.secondItem=null,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)),_.delay(this.resetClickFlag,100)},resetClickFlag:function(){this.itemClicked=!1},handleMatchLeftItemClick:function(e){if(this.itemClicked==1)return;$(".leftsort li",this.obj).removeClass("selected"),$(".leftsort p",this.obj).removeClass("selected"),$(".leftsort img",this.obj).removeClass("selected"),this.itemClicked=!0;var t=e.target,n=t,r=t.id;t.nodeName=="IMG"||t.nodeName=="figure"?(t=t.parentNode,n=t):t.nodeName=="P"&&(n=t,t=t.parentNode);if($(t).hasClass("attempted")){$(t).removeClass("attempted");var i=t.id.split("refItem")[1];$("#sortItem"+i,this.obj).removeClass("attempted"),$("#sortL",this.obj).find(".attempted").length==this.answers.length?this.trigger(assessEvent.Q_STATUS,AppConst.COMPLETE):$("#sortL",this.obj).find(".attempted").length>0?this.trigger(assessEvent.Q_STATUS,AppConst.PARTIAL):this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT)}var s=$(t);s.get(0)?s.addClass("selected"):$(n).addClass("selected");var i=t.id.match(/\d+$/),o="sortItem"+i,u=$("#sortItem"+i,this.screen).html();this.secondItem={value:u,ele:o},this.firstItem!=null&&this.secondItem!=null&&(this.swap(this.firstItem,this.secondItem),this.firstItem=null,this.secondItem=null,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)),_.delay(this.resetClickFlag,100)},generateList:function(e,t,n,r,i){var s=0;if(r==undefined||r=="")r="sortItem";var o="<ul id='"+t+"' class='"+n+"'>";for(var u=0;u<e.length;u++)e[u].type=="image"?e[u].data==undefined?i?o+="<li id='"+r+(u+1)+"'><img src ='"+this.assetsPath+e[u][0].data+"' /><div class='checkBadge2 icon'></div></li>":o+="<li id='"+r+(u+1)+"'><span class='addImage'><img  id ='imgques"+(u+1)+"' src ='"+this.assetsPath+e[u][0].data+"' /></span></li>":i?o+="<li id='"+r+(u+1)+"'><img src ='"+this.assetsPath+e[u].data+"' /><div class='checkBadge2 icon'></div></li>":o+="<li id='"+r+(u+1)+"'><span class='addImage'><img  id ='imgques"+(u+1)+"' src ='"+this.assetsPath+e[u].data+"'/></span></li>":e[u].data==undefined?(i?o+="<li id='"+r+(u+1)+"'><p>"+e[u][0].data+"</p><div class='checkBadge2 icon'></div></li>":o+="<li id='"+r+(u+1)+"'><p>"+e[u][0].data+"</p></li>",e[u][0].data.length>s&&(s=e[u].data.length)):(i?o+="<li id='"+r+(u+1)+"'><p>"+e[u].data+"</p><div class='checkBadge2 icon'></div></li>":o+="<li id='"+r+(u+1)+"'><p>"+e[u].data+"</p></li>",e[u].data.length>s&&(s=e[u].data.length));return o+="</ul>",t=="sortL"?this.leftMaxWidth=s:t=="sort"&&(this.rightMaxWidth=s),o},swap:function(e,t){utils.log("SWAP: ");var n=$("#"+e.ele,this.obj).position(),r=$("#"+t.ele,this.obj).position();if(n&&r){var i=n.top,s=r.top;utils.log(i+" - "+s),utils.log("A id: "+$("#"+e.ele,this.obj).attr("id")),utils.log("B id: "+$("#"+t.ele,this.obj).attr("id"));var o=0,u=0;u=$("#"+t.ele,this.obj).css("top"),utils.log("bNewTop:"+u+(u!="auto")),u!="auto"&&u!=0?(utils.log(u),u=u.replace("px",""),u*=1):u=0,o=$("#"+e.ele,this.obj).css("top"),utils.log("aNewTop: "+o),o!="auto"&&o!=0?(utils.log(o),o=o.replace("px",""),o*=1):o=0,utils.log(o+" - "+u);var a=500,f=e.ele.replace("sortItem","")*1,l=t.ele.replace("sortItem","")*1,c=l-f,h=this;isNaN(c)?a=600:c>=2&&(a+=c*50),utils.log("animDuration "+a+" - "+c),$("#"+t.ele,this.obj).animate({top:i-s+u},a),$("#"+e.ele,this.obj).animate({top:s-i+o},a,function(){$(".rightsort li",h.obj).removeClass("selected"),$(".rightsort p",h.obj).removeClass("selected"),$(".leftsort li",h.obj).removeClass("selected"),$(".leftsort p",h.obj).removeClass("selected"),$(".rightsort img",h.obj).removeClass("selected"),$(".leftsort img",h.obj).removeClass("selected")})}temp=e.value;var p=$("#"+e.ele,this.obj),d=$("#"+t.ele,this.obj);p.attr("id",t.ele),d.attr("id",e.ele);var v=parseInt(t.ele.split("sortItem")[1]);$("#refItem"+v,this.obj).addClass("attempted"),$("#"+t.ele,this.obj).addClass("attempted");var m=parseInt(e.ele.split("sortItem")[1]);$("#refItem"+m,this.obj).hasClass("attempted")?$("#"+e.ele,this.obj).addClass("attempted"):$("#"+e.ele,this.obj).removeClass("attempted"),$("#sortL").find(".attempted").length==this.answers.length?this.trigger(assessEvent.Q_STATUS,AppConst.COMPLETE):$("#sortL").find(".attempted").length>0?this.trigger(assessEvent.Q_STATUS,AppConst.PARTIAL):this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT)},isSolved:function(ob){this.userResponse=[];var qOptions=eval(_.clone(ob.options)),items=$(".rightsort li",ob.obj).sort(function(e,t){var n=e.id.replace("sortItem","")*1,r=t.id.replace("sortItem","")*1;return n>r?1:-1}),selector="div.checkBadge2",blankObjsBadges=$(".rightsort li",this.screen).find("div.checkBadge2");$(".rightsort li",this.screen).find("div.checkBadge2").siblings("p").length>0&&(blankObjsBadges=$(".rightsort li",this.screen).find("div.checkBadge2").siblings("p"),selector="p"),blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2"),utils.log(blankObjsBadges);var max=items.size(),totalCorrect=0,markPerQ=parseFloat(this.maxpoints/max);for(var i=0;i<max;i++){var obj=new Object;$(items.get(i)).hasClass("attempted")?obj.attempted=!0:obj.attempted=!1;var item1=$(items.get(i)).find("img");if(item1.length>0){var itemTexts=$(items.get(i)).find("img").attr("src").split("/"),itemText=itemTexts[itemTexts.length-1];obj.type="image",obj.data=item1.attr("src").split(this.assetsPath)[1];var correctAnsArray=qOptions[i].data.split("/"),correctAns=correctAnsArray[correctAnsArray.length-1]}else{var itemText=$(items.get(i)).find("p").html();obj.type="text",obj.data=itemText;var correctAns=qOptions[i].data}for(var j=0;j<this.options.length;j++)if(this.options[j].data==itemText){obj.index=j+1;break}this.userResponse.push(obj),utils.log("matching-- ",$(items.get(i)),qOptions[i].data),correctAns==itemText?(totalCorrect++,this.marksQbtained=this.marksQbtained+markPerQ,$(items.get(i)).find(".checkBadge2").addClass("markRight2")):$(items.get(i)).find(".checkBadge2").addClass("markWrong2")}return this.partialAttempt||(blankObjsBadges.removeClass("markRight2"),blankObjsBadges.removeClass("markWrong2")),totalCorrect==max?AppConst.CORRECT:totalCorrect>0?AppConst.PARTIAL:AppConst.INCORRECT},handleEvaluate:function(e){if(e!=undefined&&$(e.target).hasClass("disabled"))return;$(".rightsort li",this.obj).removeClass("selected"),$(".rightsort li",this.obj).find("img").removeClass("selected"),$(".leftsort li",this.obj).removeClass("selected"),$(".leftsort li",this.obj).find("img").removeClass("selected"),this.EvaluateFlag=!0;var t=this.isSolved(this),n=$("#sortL").find(".attempted").length;this.partialAttempt==1||n==this.answers.length?t==AppConst.CORRECT?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:this.marksQbtained,status:AppConst.CORRECT,maxScore:this.maxpoints,title:this.title,type:this.type,responseType:this.responseType}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:this.marksQbtained,status:t,maxScore:this.maxpoints,title:this.title,type:this.type,responseType:this.responseType}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,title:this.title,type:this.type,responseType:this.responseType}),this.lockQuestion()},lockQuestion:function(){this.correctAnswerVisible=!1,this.changeToolbar.mode=AppConst.TOOLBAR_LOCKED,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.disableInteraction()},populateAnswers:function(answers,correctAnswerVisible){$("#questionText",this.obj).find("li").unbind(assessEvent.CLICK),_.delay(this.handleLook,200),answers.length>0&&(this.EvaluateFlag=!0);var qOptions=[];answers.length==0?qOptions=eval(_.clone(this.options)):qOptions=eval(_.clone(answers));var leftOptions=eval(this.questionText),leftSort="<div class='leftsort'>";leftSort+=this.generateList(leftOptions,"sortL","matching addsort textsort","refItem"),leftSort+="</div>";var rightSort="<div class='rightsort'>";answers.length==0||correctAnswerVisible==0?(qOptions=eval(_.clone(this.options)),answers.length==0?rightSort+=this.generateList(qOptions,"sort","matching textsort addsort","sortItem","addBadge"):rightSort+=this.generateList(qOptions,"sort","matching textsort addsort","sortItem","addBadge")):(qOptions=eval(_.clone(answers)),rightSort+=this.generateList(qOptions,"sort","matching textsort addsort","sortItem","addBadge")),rightSort+="</div>",$("#questionText",this.obj).html(leftSort+rightSort);for(var i=0;i<answers.length;i++)answers[i].attempted&&($("#refItem"+(i+1),this.obj).addClass("attempted"),$("#sortItem"+(i+1),this.obj).addClass("attempted"));$("#sortL",this.obj).find("img").length==0&&$("#sortL",this.obj).removeClass("addsort"),$("#sort",this.obj).find("img").length==0?$("#sort",this.obj).removeClass("addsort"):this.quesType="image";var blankObjsBadges=$(".rightsort li",this.screen).find("div.checkBadge2"),blankObjs=$(".rightsort li",this.screen);utils.log(blankObjsBadges),blankObjsBadges.removeClass("markWrong2"),blankObjsBadges.removeClass("markRight2");if(correctAnswerVisible==1)for(var i=0;i<answers.length;i++)answers[i].data==this.answers[i].data?blankObjsBadges[i].className+=" markRight2":blankObjsBadges[i].className+=" markWrong2";var l=this.checkMaxOffWidth(leftOptions,"refItem"),r=this.checkMaxOffWidth(qOptions,"sortItem"),fontSize=1;$("#sort > li").css("font-size",fontSize+"em"),$(".rightsort > ul",this.obj).hide(),(this.isTest||this.partialAttempt==0)&&!this.isReview&&(blankObjsBadges.removeClass("markWrong2"),blankObjsBadges.removeClass("markRight2"),$(".rightsort li",this.screen).removeClass("disableOption")),$(".leftsort > ul",this.obj).show(),$(".rightsort > ul",this.obj).show()},resetQuestion:function(e){$(".rightsort li",this.obj).removeClass("selected"),$(".rightsort p",this.obj).removeClass("selected"),$(".leftsort p",this.obj).removeClass("selected"),$(".rightsort img",this.obj).removeClass("selected"),$(".leftsort img",this.obj).removeClass("selected"),this.firstItem=null,this.secondItem=null,$("#questionText",this.obj).html(""),this.resetClicked=!0,this.numSelected=0,this.userResponse=[],this.renderQues(),this.enableInteraction(),this.trigger(assessEvent.MARK_EMPTY,this.qId),this.EvaluateFlag=!1,this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)},resetQuestionPartial:function(e){$(".rightsort li",this.obj).removeClass("selected"),$(".rightsort p",this.obj).removeClass("selected"),$(".leftsort p",this.obj).removeClass("selected"),$(".rightsort img",this.obj).removeClass("selected"),$(".leftsort img",this.obj).removeClass("selected"),this.firstItem=null,this.secondItem=null;var t=$("#questionText",this.obj).find("div.checkBadge2");$(".rightsort li",this.screen).find("div.checkBadge2").siblings("p").length>0&&(t=$(".rightsort li",this.screen).find("div.checkBadge2").siblings("p")),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);var n=!0,r=$("#sort>li",this.obj);t.removeClass("markRight2"),t.removeClass("markWrong2"),$(".rightsort li",this.obj).removeClass("disableOption");var i=[],s=[];for(var o=0;o<this.userResponse.length;o++){var u=this.userResponse[o].data;this.options[o].data!=u?(s.push(o+1),i.push(this.options[o])):(n=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar))}i=utils.randomizeArray(i,i);for(var o=0;o<s.length;o++)i[o].data.indexOf(".jpg")>0?$("#sortItem"+s[o],this.obj).html("<img src ='"+this.assetsPath+i[o].data+"' /><div class='checkBadge2'></div>"):$("#sortItem"+s[o],this.obj).html("<p>"+i[o].data+"</p><div class='checkBadge2'></div>");_.delay(this.handleLook,200),this.numSelected=0,this.EvaluateFlag=!1,this.resetFlag=!0,this.enableInteraction(),n==0?this.trigger(assessEvent.UPDATE_RESPONSE,this.qId,{userResponse:this.userResponse}):this.trigger(assessEvent.MARK_EMPTY,this.qId),this.disableButton(AppConst.QBTN_RESET),this.EvaluateFlag=!1,this.userResponse=[]},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},handleScreenExit:function(){},orientationchange:function(e){this.handleLook()},destroy:function(){this.unbind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.unbind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.unbind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.unbind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.unbind(assessEvent.MARK_EMPTY,this.markEmpty),this.unbind(assessEvent.UPDATE_RESPONSE,this.updateResponse),$("#questionOptions",this.obj).find("li").unbind(),$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el).remove(),this.disableInteraction()}});return matchSortView}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/fibView.html",[],function(){return"<div id='quesWrapper<%=id%>' class='disableTemplate'>\n    <div id='ques<%=id%>' class='quesContent'>\n		<div id='activityContent'>\n			<div id='questionHeading' class='questionHeading'></div>\n			<div id='questionText' class='left'></div>\n			<div id='questionOptions'></div>\n			<div id='labelanswers'></div>\n		</div>\n	</div>\n</div>"}),define("com/es/widgets/assessment/view/fibView",["com/es/widgets/assessment/AssesmentLang","com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/fibView.html"],function(AssesmentLang,utils,AppConst,assessEvent,contentTpl){var fibView=Backbone.View.extend({modelParagraph:"",qId:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",itemClicked:!1,correctAnswerVisible:null,inputNo:0,EvaluateFlag:!1,changeToolbar:{},maxpoints:0,partialAttempt:!0,assetsPath:"",initialize:function(){_.bindAll(this,"handleScreenExit","handleFibBtnClick","handleEvaluate","handleBlankChange"),_.bindAll(this,"enableInteraction","destroyScroll","resetClickFlag"),_.extend(this,Backbone.Events)},render:function(){this.element=this.el;var e=_.template(contentTpl,this.model.toJSON());$("#"+this.model.get("uiId")+" #content",this.$el).QAappend(e),this.screen=$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el),this.setQuestionData()},setQuestionData:function(){this.modelParagraph=this.model.get("modelParagraph"),this.type=this.model.get("type"),this.layout=this.model.get("questionLayout"),this.responseType=this.model.get("responseType"),this.clues=this.model.get("clues"),this.rubric=this.model.get("rubric"),this.questionText=JSON.stringify(this.model.get("questionBody")),this.leftCol=this.model.get("leftCol"),this.rightCol=this.model.get("rightCol"),this.opLayout=this.model.get("optionsLayout"),this.options=this.model.get("options"),this.answers=this.model.get("answers"),this.isTest=this.model.get("isTest"),this.isReview=this.model.get("isReview"),this.reviewData=this.model.get(""),this.qId=this.model.get("id"),this.assetsPath=this.model.get("assetPath"),this.maxpoints=parseFloat(this.model.get("maxpoints")),this.model.get("userResponse").userResponse&&(this.userResponse=this.model.get("userResponse").userResponse),this.heading=this.model.get("heading"),this.partialAttempt=this.model.get("partialAttempt"),this.renderQues()},renderQues:function(){this.answers.length>0,this.obj=this.screen;var qBody=eval(this.questionText),qOptions=eval(this.options),qStr="",optionsStr="",gapNo=0,gapLength=0,headingStr="";for(var i=0;i<this.heading.length;i++)this.heading[i].type=="image"?headingStr+="<img src='"+this.assetsPath+this.heading[i].data+"'/>":headingStr+="<div>"+this.heading[i].data+"</div>";$(".questionHeading",this.screen).html(headingStr);if(this.responseType==AppConst.RESPONSE_TYPE_TEXT){if(this.layout==""||this.layout==undefined){var startNewLineUl=!0,flagGap=!1;for(var i=0;i<qBody.length;i++){startNewLineUl&&(qStr+='<ul class="fibLine">',startNewLineUl=!1);if(qBody[i]=="GAP"){gapNo++;var gspSize=0;for(var k=0;k<this.answers[gapNo-1].length;k++)gspSize<this.answers[gapNo-1][k].length&&(gspSize=this.answers[gapNo-1][k].length,gspSize+=4);gspSize=Math.min(gspSize,document.body.clientWidth/15),gspSize=Math.max(gspSize,4),i==0?qStr+="<li class='fibLineGap'><div class='badgeWrapper'><input type='text' autocorrect='off' style='text-transform:capitalize' id='ans"+gapNo+"' size='"+gspSize+"' class='FIBblank'/><div id='badge"+gapNo+"' class='checkBadge icon '></div></div></li>":qStr+="<li class='fibLineGap'><div class='badgeWrapper'><input type='text' autocorrect='off' autocapitalize='off' id='ans"+gapNo+"' size='"+gspSize+"' class='FIBblank'/><div id='badge"+gapNo+"' class='checkBadge icon '></div></div></li>",flagGap=!0}else{if(typeof qBody[i]=="object"){var liClass="finLine"+qBody[i].type;qBody[i].type=="text"?qBody[i].data.trim().indexOf(" ")==-1&&flagGap?qStr=qStr.replace(new RegExp("</li>$"),utils.renderNode(this.assetsPath,qBody[i])+"</li>"):qStr+=utils.renderNode(this.assetsPath,qBody[i]):qStr+='<li class="'+liClass+'">'+utils.renderNode(this.assetsPath,qBody[i])+"</li><br />"}flagGap=!1}}qStr+="</ul>",this.inputNo=gapNo}else if(this.layout=="2COL"){qStr+="<div class='leftcol'>";var lcol=eval(this.leftCol);for(var i=0;i<lcol.length;i++)if(lcol[i]=="GAP"){gapNo++;var gspSize=0;for(var k=0;k<this.answers[gapNo-1].length;k++)gspSize<this.answers[gapNo-1][k].length&&(gspSize=this.answers[gapNo-1][k].length,gspSize+=4);gspSize=Math.min(gspSize,document.body.clientWidth/15),gspSize=Math.max(gspSize,4),i==0?qStr+="<div class='badgeWrapper'><input type='text' autocorrect='off' autocapitalize='on' style='text-transform:capitalize' id='ans"+gapNo+"' size='"+gspSize+"' class='FIBblank'/><div id='badge"+gapNo+"' class='checkBadge icon'></div></div>":qStr+="<div class='badgeWrapper'><input type='text' autocorrect='off' autocapitalize='off' id='ans"+gapNo+"' size='"+gspSize+"' class='FIBblank'/><div id='badge"+gapNo+"' class='checkBadge icon'></div></div>",this.inputNo=gapNo,utils.log("input no 2COL : "+this.inputNo)}else typeof lcol[i]=="object"&&(qStr+=utils.renderNode(this.assetsPath,lcol[i]));qStr+="</div>",qStr+="<div class='rightcol'>";var rcol=eval(this.rightCol);for(var i=0;i<rcol.length;i++)if(rcol[i]=="GAP"){gapNo++;var gspSize=0;for(var k=0;k<this.answers[gapNo-1].length;k++)gspSize<this.answers[gapNo-1][k].length&&(gspSize=this.answers[gapNo-1][k].length,gspSize=gspSize);style="",i==0?qStr+="<div class='badgeWrapper'><input type='text' autocorrect='off' autocapitalize='on' style='text-transform:capitalize' "+style+" id='mcqFIBans"+gapNo+"' size='"+(gspSize+4)+"'  class='FIBblank'/><div id='badge"+gapNo+"' class='checkBadge'></div></div>":qStr+="<div class='badgeWrapper'><input type='text' autocorrect='off' autocapitalize='off' "+style+" id='mcqFIBans"+gapNo+"' size='"+(gspSize+4)+"'  class='FIBblank'/><div id='badge"+gapNo+"' class='checkBadge'></div></div>",this.inputNo=gapNo,utils.log("input no rightcol : "+this.inputNo)}else typeof rcol[i]=="object"&&(qStr+=utils.renderNode(this.assetsPath,rcol[i]));qStr+="</div>"}}else if(this.responseType==AppConst.RESPONSE_TYPE_PICKER){for(var j=0;j<this.options.length;j++)gapLength<this.options[j].data.length&&(gapLength=this.options[j].data.length);this.inputNo=gapLength;for(var i=0;i<qBody.length;i++)qBody[i]=="GAP"?qStr+="<input type='text' id='FIBpick"+(i+1)+"' size='"+gapLength+"' class='FIBblank dropdown' data-ddid='"+(i+1)+"' readonly />":typeof qBody[i]=="object"&&(qStr+=utils.renderNode(this.assetsPath,qBody[i]))}else if(this.responseType==AppConst.RESPONSE_TYPE_BUTTON){for(var j=0;j<this.options.length;j++)gapLength<this.options[j].data.length&&(gapLength=this.options[j].data.length);if(this.layout==""||this.layout==undefined)for(var i=0;i<qBody.length;i++)utils.log(qBody[i]),utils.log("qBody length::"+qBody.length),qBody[i]=="GAP"?qStr+="<div class='badgeWrapper'><input type='text' id='mcqFIBans"+(i+1)+"' size='"+(gapLength+4)+"' class='FIBblank' readonly='true' disabled style='background:#fff; opacity:1' /><div class='checkBadge'></div></div>":typeof qBody[i]=="object"&&(qStr+=utils.renderNode(this.assetsPath,qBody[i]));else if(this.layout=="2COL"){qStr+="<div class='leftcol'>";var lcol=eval(this.leftCol);for(var i=0;i<lcol.length;i++)utils.log(lcol[i]),utils.log("lcol length::"+lcol.length),lcol[i]=="GAP"?qStr+="<div class='badgeWrapper'><input type='text' id='mcqFIBans"+(i+1)+"' size='"+(gapLength+4)+"' class='FIBblank' readonly='true' disabled style='background:#fff; opacity:1' /><div class='checkBadge'></div></div>":typeof lcol[i]=="object"&&(qStr+=utils.renderNode(this.assetsPath,lcol[i]));qStr+="</div>",qStr+="<div class='rightcol'>";var rcol=eval(this.rightCol);for(var i=0;i<rcol.length;i++)utils.log(rcol[i]),utils.log("rcol length::"+rcol.length),rcol[i]=="GAP"?qStr+="<div class='badgeWrapper'><input type='text' id='mcqFIBans"+(i+1)+"' size='"+(gapLength+4)+"' class='FIBblank' readonly='true' disabled style='background:#fff; opacity:1' /><div class='checkBadge'></div></div>":typeof rcol[i]=="object"&&(qStr+=utils.renderNode(this.assetsPath,rcol[i]));qStr+="</div>"}this.opLayout=="2COL"?optionsStr="<div class='mcq4'><ul>":this.opLayout==""&&(optionsStr="<div class='mcq2'><ul class='newoptions'>");for(var i=0;i<qOptions.length;i++)optionsStr+="<li id='li"+(i+1)+"' class=''><div class='indicators' id='opt"+(i+1)+"'></div><div class='optionsText' id='text"+(i+1)+"'>"+qOptions[i].data+"</div></li>";optionsStr+="</ul></div>"}$("#questionText",this.obj).html(qStr),this.fixWrappedLi(),$("#questionOptions",this.obj).html(optionsStr),this.responseType==AppConst.RESPONSE_TYPE_TEXT&&($("#questionText",this.obj).removeClass("center"),$("#questionText",this.obj).addClass("left")),this.enableInteraction();var loadedImageCount=0,imgCount=$("#activityContent img",this.obj).length,imgArray=$("#activityContent img",this.obj),that=this;imgCount==0&&this.trigger(assessEvent.TEMPLATE_READY),_.each(imgArray,function(e){$(e).on("load",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.trigger(assessEvent.IMG_LOADED),that.trigger(assessEvent.TEMPLATE_READY))}),$(e).on("error",function(){loadedImageCount++,imgCount===loadedImageCount&&that.trigger(assessEvent.TEMPLATE_READY)})}),this.responseType==AppConst.RESPONSE_TYPE_TEXT&&_.delay(this.destroyScroll,1e3)},fixWrappedLi:function(){var e=$("#questionText",this.obj).find("ul"),t=$(e[0]).height();for(var n=0;n<e.length;n++){var r=$(e[n]).height();r<t&&(t=r)}for(var n=0;n<e.length;n++){var r=$(e[n]).height();if(r>t*2-5){var i=$(e[n]).find("li");for(var s=0;s<i.length;s++){if($(i[s]).find("*").length>0)continue;var o=$(i[s]).text(),u=o.split(" "),a="";for(var f=0;f<u.length;f++)a+='<li class="fibLinetext"> '+u[f]+"</li>";$(i[s]).replaceWith(a)}}}},destroyScroll:function(){this.spinnerOpen=!1,this.iScroll!=null&&this.iScroll.destroy()},enableInteraction:function(){$("#questionOptions",this.obj).find("li").bind(assessEvent.CLICK,this.handleFibBtnClick);var e=this;if(this.responseType==AppConst.RESPONSE_TYPE_TEXT){$("#questionText",this.obj).find("input").unbind(assessEvent.KEYUP).bind(assessEvent.KEYUP,this.handleBlankChange),$("#questionText",this.obj).find("input").unbind(assessEvent.CONTEXT_MENU).bind(assessEvent.CONTEXT_MENU,function(e){e.preventDefault()});var e=this;$("#questionText",this.obj).find("input").bind(assessEvent.CLICK,function(e){utils.isIOS()||(e.stopPropagation(),$(e.target).focus())})}var t=$("#questionText",this.obj).find("input"),n=$("#questionOptions",this.obj).find("li");t.removeClass("disableOption"),n.removeClass("disableOption"),t.removeAttr("readonly")},disableInteraction:function(){var e=$("#questionText",this.obj).find("input"),t=$("#questionOptions",this.obj).find("li"),n=$("#activityContent img",this.obj);e.addClass("disableOption"),t.addClass("disableOption"),e.unbind(),t.unbind(),n.off(),e.attr("readonly","true"),$("#questionText",this.obj).find("input").unbind("contextmenu")},handleBlankChange:function(e){this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT;var t=$("#questionText",this.obj).find("input"),n=0;for(var r=0;r<t.length;r++)t[r].value!=""&&(n++,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE);this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),n==t.length?this.trigger(assessEvent.Q_STATUS,1):this.trigger(assessEvent.Q_STATUS,0)},handleFibBtnClick:function(e){if(this.itemClicked==1)return;this.itemClicked=!0,utils.log("check0 ",$("#"+e.target.id)),node=e.target,e.target.nodeName.toLowerCase()!="li"&&(node=node.parentNode);var t=$(node).find(".optionsText").text();$("#questionText",this.obj).find(".FIBblank").val(t),this.trigger(assessEvent.Q_STATUS,1);if(this.answers.length==1)$("#questionOptions",this.obj).find(".selected").removeClass("selected");else if($(node).find(".indicators").hasClass("selected")){$(node).find(".indicators").removeClass("selected"),$(node).find(".optionsText").removeClass("selected");return}$(node).find(".indicators").addClass("selected"),$(node).find(".optionsText").addClass("selected"),this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),_.delay(this.resetClickFlag,500)},resetClickFlag:function(){this.itemClicked=!1},populateAnswers:function(answers,correctAnswerVisible){if(this.isReset&&this.isTest&&!this.isReview&&answers==undefined)return;var blanks=$("#questionText",this.obj).find("input"),buttons=$("#questionOptions",this.obj).find("li"),blankObjsBadges=$("#questionText",this.obj).find("div.checkBadge");$("#questionOptions",this.obj).find(".indicators").removeClass("markRight"),$("#questionOptions",this.obj).find(".indicators").removeClass("markWrong"),$("#questionOptions",this.obj).find(".indicators").removeClass("selected"),$("#questionOptions",this.obj).find(".optionsText").removeClass("selected"),blanks.removeClass("focus-markright"),blanks.removeClass("focus-markwrong"),buttons.removeClass("optionHighlight"),buttons.removeClass("selected"),correctAnswerVisible==0?(blankObjsBadges.removeClass("markWrong"),blankObjsBadges.removeClass("markRight"),blankObjsBadges.removeClass("selected"),$("#questionOptions",this.obj).find("div.optionsText").removeClass("Selected")):(utils.log(answers),answers.length>0&&(this.EvaluateFlag=!0));var qOptions=eval(this.options),max=blanks.length;answers.length>0?buttons.attr("disabled","disabled"):buttons.removeAttr("disabled");if(max==0&&this.layout==""&&this.opLayout==""){var optionButton=$(".mcq2",this.obj).find("li");max=optionButton.size(),answers=_.flatten(answers),optionBadges=optionButton.find(".checkBadge2"),optionBadges.removeClass("markRight"),optionBadges.removeClass("markWrong"),buttonIndex=0;if(typeof answers[0]=="number")buttonIndex=answers[0]-1;else for(var i=0;i<max;i++)optionValue=$(optionButton.get(i)).html().substr(0,$(optionButton.get(i)).html().search("<div")),optionValue.toLowerCase()==answers[0]&&(buttonIndex=i);this.answers=_.flatten(this.answers),$(optionButton.get(buttonIndex)).addClass("optionHighlight"),correctAnswerVisible==1&&(qOptions[this.answers[0]-1].data.toLowerCase()==qOptions[buttonIndex].data.toLowerCase()?($(optionBadges.get(buttonIndex)).addClass("markRight"),blanks.get(buttonIndex).className+=" focus-markright"):($(optionBadges.get(buttonIndex)).addClass("markWrong"),blanks.get(buttonIndex).className+=" focus-markwrong"),this.isTest&&(optionBadges.removeClass("markRight"),optionBadges.removeClass("markWrong"),blanks.removeClass("focus-markright"),blanks.removeClass("focus-markwrong")))}else for(var i=0;i<max;i++){var ans="";switch(typeof answers[i]){case"string":ans=answers[i];break;case"number":ans=qOptions[answers[i]-1].data;break;case"object":if(_.isArray(answers[i]))if(this.responseType==AppConst.RESPONSE_TYPE_BUTTON){var firstCorrect=answers[i][0];ans=qOptions[firstCorrect-1].data.toLowerCase()}else ans=answers[i][0];else ans=answers[i].data;break;default:}ans=ans.trim();var myBlank=$(blanks.get(i));myBlank.val(""+ans);if(this.responseType==AppConst.RESPONSE_TYPE_BUTTON){var btnIndex=0;if(answers[i]!=undefined)for(var k=0;k<qOptions.length;k++)if(qOptions[k].data.toLowerCase()==ans.toLowerCase()){btnIndex=k;break}correctAnswerVisible==1&&answers[i]!=undefined&&(ans.toLowerCase()==this.options[this.answers[0][i]-1].data.toLowerCase()?(blankObjsBadges.addClass("markRight"),blanks.addClass("focus-markright")):(blankObjsBadges.addClass("markWrong"),blanks.addClass("focus-markwrong"))),answers[i]!=undefined&&(myButton=$(buttons.get(btnIndex)),myButton.find(".indicators").addClass("selected"),myButton.find(".optionsText").addClass("selected"),$(myButton).find(".optionsText").text()==this.options[this.answers[0][i]-1].data.toLowerCase())}else if(this.responseType==AppConst.RESPONSE_TYPE_TEXT){if(correctAnswerVisible==1)if(this.answers[i].length>1)answers[i]!=undefined&&(_.indexOf(this.answers[i],ans)>=0?($(blankObjsBadges.get(i)).addClass("markRight"),blanks.get(i).className+=" focus-markright"):($(blankObjsBadges.get(i)).addClass("markWrong"),blanks.get(i).className+=" focus-markwrong"));else{var editanswer=this.answers[i][0].replace(/[.,?]/g,"");editanswer=editanswer.toLowerCase(),editanswer=editanswer.trim();var userAnswer=ans.replace(/[.,?]/g,"");userAnswer=userAnswer.toLowerCase(),userAnswer=userAnswer.trim(),answers[i]!=undefined&&(editanswer==userAnswer?($(blankObjsBadges.get(i)).addClass("markRight"),blanks.get(i).className+=" focus-markright"):($(blankObjsBadges.get(i)).addClass("markWrong"),blanks.get(i).className+=" focus-markwrong"))}}else this.responseType==AppConst.RESPONSE_TYPE_PICKER&&answers.length>0&&$(".dropdown",this.obj).removeClass("dropdown");(this.isTest||this.partialAttempt==0)&&!this.isReview&&(blankObjsBadges.removeClass("markRight"),blankObjsBadges.removeClass("markWrong"),blanks.removeClass("focus-markright"),blanks.removeClass("focus-markwrong"))}},itemClicked:!1,handleEvaluate:function(e){if(e!=undefined&&$(e.target).hasClass("disabled"))return;if(this.itemClicked==1)return;this.userResponse=[],this.itemClicked=!0,this.EvaluateFlag=!0,this.isReset=!1;var totalInputs=0,attrToCheck=null,blankObjs=null,totalCorrect=0,qOptions=eval(this.options),attemtedInputs=0,buttons=$("#questionOptions",this.obj).find("li");if(this.responseType==AppConst.RESPONSE_TYPE_TEXT){blankObjs=$("#questionText",this.obj).find("input"),attrToCheck="value",totalInputs=blankObjs.size();var markPerQ=parseFloat(this.maxpoints/totalInputs),marksQbtained=0;$("#questionOptions",this.obj).find(".selected").removeClass("selected"),correctTrimedAnswerArray=[];for(var i=0;i<totalInputs;i++)for(var k=0;k<this.answers[i].length;k++){var correctTrimedAnswer=this.answers[i][k].replace(/[.,?]/g,"");correctTrimedAnswer=correctTrimedAnswer.toLowerCase(),correctTrimedAnswerArray.push(correctTrimedAnswer)}for(var i=0;i<totalInputs;i++){if(blankObjs.get(i)[attrToCheck]==undefined)break;blankObjs.get(i)[attrToCheck]!=""&&attemtedInputs++;var myanswer=""+blankObjs.get(i)[attrToCheck];this.userResponse.push(myanswer),myanswer=myanswer.toLowerCase();var myTrimedAnswer=myanswer.replace(/[.,?]/g,"");myTrimedAnswer=myTrimedAnswer.trim(),$("#badge"+(i+1),this.obj).removeClass("markRight"),$("#badge"+(i+1),this.obj).removeClass("markWrong");if(totalInputs>1)if(this.answers[i].length>1){var index=_.indexOf(this.answers[i],myTrimedAnswer);index>=0?($("#badge"+(i+1),this.obj).addClass("markRight"),blankObjs.get(i).className+=" focus-markright",marksQbtained+=markPerQ,totalCorrect++):($("#badge"+(i+1),this.obj).addClass("markWrong"),blankObjs.get(i).className+=" focus-markwrong")}else for(var k=0;k<this.answers[i].length;k++){var correctTrimedAnswer=this.answers[i][k].replace(/[.,?]/g,"");correctTrimedAnswer=correctTrimedAnswer.toLowerCase(),utils.log(correctTrimedAnswer+", "+myTrimedAnswer),myTrimedAnswer==correctTrimedAnswer?($("#badge"+(i+1),this.obj).addClass("markRight"),blankObjs.get(i).className+=" focus-markright",marksQbtained+=markPerQ,totalCorrect++):($("#badge"+(i+1),this.obj).addClass("markWrong"),blankObjs.get(i).className+=" focus-markwrong")}else{utils.log("single response");var index=_.indexOf(correctTrimedAnswerArray,myTrimedAnswer);index>=0?($("#badge"+(i+1),this.obj).addClass("markRight"),$("#opt"+(i+1),this.obj).addClass("markRight"),blankObjs.get(i).className+=" focus-markright",marksQbtained+=markPerQ,totalCorrect++):($("#badge"+(i+1),this.obj).addClass("markWrong"),$("#opt"+(i+1),this.obj).addClass("markWrong"),blankObjs.get(i).className+=" focus-markwrong")}}this.partialAttempt==1||attemtedInputs==totalInputs?totalCorrect>=totalInputs?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,maxScore:this.maxpoints,status:AppConst.CORRECT,type:this.type,title:this.title}):totalCorrect>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,maxScore:this.maxpoints,status:AppConst.PARTIAL,type:this.type,title:this.title}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,maxScore:this.maxpoints,status:AppConst.INCORRECT,type:this.type,title:this.title}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,score:marksQbtained,type:this.type,title:this.title})}else if(this.responseType==AppConst.RESPONSE_TYPE_BUTTON||this.responseType==AppConst.RESPONSE_TYPE_PICKER){blankObjs=$("#questionText",this.obj).find("input"),blankObjsBadges=$("#questionText",this.obj).find("div.checkBadge"),attrToCheck="value",totalInputs=blankObjs.size();var markPerQ=parseFloat(this.maxpoints/totalInputs),marksQbtained=0,attemtedInputs=0;if(totalInputs==0&&this.layout==""&&this.opLayout==""){optionButtons=$(".mcq2",this.obj).find("li.selected"),optionButtonBadges=$("li.selected",this.obj).find(".checkBadge2"),totalCorrect=0,correctAnswers=_.flatten(this.options),correctAnswerIndex=_.flatten(this.answers),$("#questionOptions",this.obj).find(".selected").removeClass("selected");for(var i=0;i<optionButtons.size();i++)option=$(optionButtons.get(i)),optionBadge=option.find(".checkBadge2"),optionValue=option.html().substr(0,option.html().search("<div")),optionValue!=""&&attemtedInputs++,this.userResponse.push(optionValue),correct=0,correctAnswers[correctAnswerIndex[0]-1].data.toLowerCase()==optionValue.toLowerCase()&&correct++,option.addClass("optionHighlight"),correct>0&&(marksQbtained+=markPerQ,totalCorrect++);this.partialAttempt==1||attemtedInputs==totalInputs?totalCorrect>=correctAnswerIndex.length?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.CORRECT}):totalCorrect>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.PARTIAL}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.INCORRECT}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints})}else{for(var i=0;i<totalInputs;i++){blankObjs.val()!=""&&attemtedInputs++;var myanswer=""+blankObjs.val();this.userResponse.push(myanswer),myanswer=myanswer.toLowerCase();if(this.responseType==AppConst.RESPONSE_TYPE_BUTTON)for(var k=0;k<this.answers[i].length;k++){var correctAnswer=this.options[this.answers[i][k]-1].data.toLowerCase();myanswer==correctAnswer?(marksQbtained+=markPerQ,blankObjsBadges.addClass("markRight"),blankObjsBadges.addClass("focus-markright"),totalCorrect++):(blankObjsBadges.addClass("markWrong"),blankObjsBadges.addClass("focus-markwrong"));for(var j=0;j<qOptions.length;j++)if(qOptions[j].data.toLowerCase()==myanswer){var myButton=buttons.get(j);$(myButton).find(".indicators").addClass("selected"),$(myButton).find(".optionsText").addClass("selected")}}else{var correctAnswer=this.options[this.answers[i]-1].data.toLowerCase();myanswer==correctAnswer?(marksQbtained+=markPerQ,blankObjsBadges.addClass("markRight"),blankObjsBadges.addClass("focus-markright"),totalCorrect++):(blankObjsBadges.addClass("markWrong"),blankObjsBadges.addClass("focus-markwrong"))}}this.partialAttempt==1||attemtedInputs==totalInputs?totalCorrect>=totalInputs?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.CORRECT}):totalCorrect>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.PARTIAL}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.INCORRECT}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints})}}this.lockQuestion(),_.delay(this.resetClickFlag,500)},resetClickFlag:function(){this.itemClicked=!1},lockQuestion:function(){this.correctAnswerVisible=!1,this.changeToolbar.mode=AppConst.TOOLBAR_LOCKED,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.disableInteraction()},resetQuestion:function(e){this.isReset=!0;var t=$("#questionText",this.obj).find("input"),n=$("#questionText",this.obj).find("div.checkBadge"),r=$("#questionOptions",this.obj).find(".selected");n.removeClass("markRight"),n.removeClass("markWrong"),r.removeClass("markRight"),r.removeClass("markWrong"),r.removeClass("selected"),t.removeClass("focus-markright"),t.removeClass("focus-markwrong");var i=$(".mcq2",this.obj).find(".checkBadge2");i.size()>0&&(i.removeClass("markRight"),i.removeClass("markWrong")),$("#questionText input",this.obj).val(""),this.responseType==AppConst.RESPONSE_TYPE_TEXT&&$("#questionText input",this.obj).removeAttr("readonly"),$("#questionOptions",this.obj).find(".selected").removeClass("selected"),$("#questionOptions",this.obj).find("li").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("li").removeAttr("disabled"),this.userResponse=[],this.enableInteraction(),this.trigger(assessEvent.MARK_EMPTY,this.qId),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.trigger(assessEvent.Q_STATUS,0),this.EvaluateFlag=!1},resetQuestionPartial:function(e){this.optionSelected="",this.targetSelected="";var t=!0;$("#questionOptions",this.obj).find(".selected").removeClass("selected"),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);var n=$("#questionText",this.obj).find("input"),r=$("#questionText",this.obj).find("div.checkBadge"),i=$("#questionOptions",this.obj).find("li");r.removeClass("markWrong"),r.removeClass("markRight"),blanks.removeClass("focus-markright"),blanks.removeClass("focus-markwrong");if(this.userResponse.length>0)if(this.responseType==AppConst.RESPONSE_TYPE_TEXT)for(var s=0;s<n.length;s++)if(this.answers[s].length>1)if(_.indexOf(this.answers[s],this.userResponse[s].trim())<0){var o=$(n.get(s));o.val(""),this.userResponse[s]=""}else t=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);else if(this.userResponse[s].trim()!=this.answers[s][0].replace(/[.,?]/g,"").toLowerCase()){var o=$(n.get(s));o.val(""),this.userResponse[s]=""}else t=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);else{for(var s=0;s<n.length;s++)if(this.userResponse[s]!=this.options[this.answers[s][0]-1].data.toLowerCase()){var o=$(n.get(s));o.val(""),this.userResponse[s]=""}else t=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);var u=this.userResponse[0];for(var s=0;s<this.options.length;s++)if(this.options[s].data.toLowerCase()==u){var a=i.get(s);$(a).find(".indicators").addClass("selected"),$(a).find(".optionsText").addClass("selected")}}n.removeClass("disableOption"),i.removeClass("disableOption"),i.removeClass("optionHighlight"),this.EvaluateFlag=!1,this.correctAnswerVisible=!1,this.enableInteraction(),t==0?this.trigger(assessEvent.UPDATE_RESPONSE,this.qId,{userResponse:this.userResponse}):this.trigger(assessEvent.MARK_EMPTY,this.qId),this.disableButton(AppConst.QBTN_RESET)},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},handleScreenExit:function(){},orientationchange:function(e){},destroy:function(){this.unbind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.unbind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.unbind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.unbind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.unbind(assessEvent.MARK_EMPTY,this.markEmpty),this.unbind(assessEvent.UPDATE_RESPONSE,this.updateResponse),this.unbind(assessEvent.MARK_ANSWER,this.handleMarkAnswer),$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el).remove(),this.disableInteraction()}});return fibView}),define("com/es/widgets/assessment/model/fibVO",[],function(){var e=Backbone.Model.extend({id:"",modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",heading:"",partialAttempt:!0,feedback:[]});return e});var SpinningWheel={cellHeight:44,friction:.003,slotData:[],handleEvent:function(e){e.type=="touchstart"?(this.lockScreen(e),e.currentTarget.id=="sw-cancel"||e.currentTarget.id=="sw-done"?(e.currentTarget.className="sw-pressed",this.tapUp(e)):e.currentTarget.id=="sw-frame"&&this.scrollStart(e)):e.type=="touchmove"?(this.lockScreen(e),e.currentTarget.id=="sw-cancel"||e.currentTarget.id=="sw-done"?this.tapCancel(e):e.currentTarget.id=="sw-frame"&&this.scrollMove(e)):e.type=="touchend"?e.currentTarget.id=="sw-cancel"||e.currentTarget.id=="sw-done"?this.tapUp(e):e.currentTarget.id=="sw-frame"&&this.scrollEnd(e):e.type=="webkitTransitionEnd"?e.target.id=="sw-wrapper"?this.destroy():this.backWithinBoundaries(e):e.type=="orientationchange"?this.onOrientationChange(e):e.type=="scroll"&&this.onScroll(e)},onOrientationChange:function(e){window.scrollTo(0,0),this.swWrapper.style.top=window.innerHeight+window.pageYOffset+"px",this.calculateSlotsWidth()},onScroll:function(e){this.swWrapper.style.top=window.innerHeight+window.pageYOffset+"px"},lockScreen:function(e){e.preventDefault(),e.stopPropagation()},reset:function(){this.slotEl=[],this.activeSlot=null,this.swWrapper=undefined,this.swSlotWrapper=undefined,this.swSlots=undefined,this.swFrame=undefined},calculateSlotsWidth:function(){var e=this.swSlots.getElementsByTagName("div");for(var t=0;t<e.length;t+=1)this.slotEl[t].slotWidth=e[t].offsetWidth},create:function(){var e,t,n,r,i;this.reset(),i=document.createElement("div"),i.id="sw-wrapper",i.style.top=window.innerHeight+window.pageYOffset+"px",i.style.webkitTransitionProperty="-webkit-transform",i.innerHTML='<div id="sw-header"><div id="sw-cancel">Cancel</div><div id="sw-done">Done</div></div><div id="sw-slots-wrapper"><div id="sw-slots"></div></div><div id="sw-frame"></div>',document.body.appendChild(i),this.swWrapper=i,this.swSlotWrapper=document.getElementById("sw-slots-wrapper"),this.swSlots=document.getElementById("sw-slots"),this.swFrame=document.getElementById("sw-frame");for(t=0;t<this.slotData.length;t+=1){r=document.createElement("ul"),n="";for(e in this.slotData[t].values)n+="<li>"+this.slotData[t].values[e]+"<"+"/li>";r.innerHTML=n,i=document.createElement("div"),i.className=this.slotData[t].style,i.appendChild(r),this.swSlots.appendChild(i),r.slotPosition=t,r.slotYPosition=0,r.slotWidth=0,r.slotMaxScroll=this.swSlotWrapper.clientHeight-r.clientHeight-86,r.style.webkitTransitionTimingFunction="cubic-bezier(0, 0, 0.2, 1)",this.slotEl.push(r),this.slotData[t].defaultValue&&this.scrollToValue(t,this.slotData[t].defaultValue)}this.calculateSlotsWidth(),document.addEventListener("touchstart",this,!1),document.addEventListener("touchmove",this,!1),window.addEventListener("orientationchange",this,!0),window.addEventListener("scroll",this,!0),document.getElementById("sw-cancel").addEventListener("touchstart",this,!1),document.getElementById("sw-done").addEventListener("touchstart",this,!1),this.swFrame.addEventListener("touchstart",this,!1)},open:function(){this.create(),this.swWrapper.style.webkitTransitionTimingFunction="ease-out",this.swWrapper.style.webkitTransitionDuration="400ms",this.swWrapper.style.webkitTransform="translate3d(0, -260px, 0)"},destroy:function(){this.swWrapper.removeEventListener("webkitTransitionEnd",this,!1),this.swFrame.removeEventListener("touchstart",this,!1),document.getElementById("sw-cancel").removeEventListener("touchstart",this,!1),document.getElementById("sw-done").removeEventListener("touchstart",this,!1),document.removeEventListener("touchstart",this,!1),document.removeEventListener("touchmove",this,!1),window.removeEventListener("orientationchange",this,!0),window.removeEventListener("scroll",this,!0),this.slotData=[],this.cancelAction=function(){return!1},this.cancelDone=function(){return!0},this.reset(),document.body.removeChild(document.getElementById("sw-wrapper"))},close:function(e){this.swWrapper.style.webkitTransitionTimingFunction="ease-in",this.swWrapper.style.webkitTransitionDuration="400ms",this.swWrapper.style.webkitTransform="translate3d(0, 0, 0)",this.swWrapper.addEventListener("webkitTransitionEnd",this,!1)},addSlot:function(e,t,n){t||(t=""),t=t.split(" ");for(var r=0;r<t.length;r+=1)t[r]="sw-"+t[r];t=t.join(" ");var i={values:e,style:t,defaultValue:n};this.slotData.push(i)},getSelectedValues:function(){var e,t,n,r,i=[],s=[];for(n in this.slotEl){this.slotEl[n].removeEventListener("webkitTransitionEnd",this,!1),this.slotEl[n].style.webkitTransitionDuration="0",this.slotEl[n].slotYPosition>0?this.setPosition(n,0):this.slotEl[n].slotYPosition<this.slotEl[n].slotMaxScroll&&this.setPosition(n,this.slotEl[n].slotMaxScroll),e=-Math.round(this.slotEl[n].slotYPosition/this.cellHeight),t=0;for(r in this.slotData[n].values){if(t==e){i.push(r),s.push(this.slotData[n].values[r]);break}t+=1}}return{keys:i,values:s}},setPosition:function(e,t){this.slotEl[e].slotYPosition=t,this.slotEl[e].style.webkitTransform="translate3d(0, "+t+"px, 0)"},scrollStart:function(e){var t=e.targetTouches[0].clientX-this.swSlots.offsetLeft,n=0;for(var r=0;r<this.slotEl.length;r+=1){n+=this.slotEl[r].slotWidth;if(t<n){this.activeSlot=r;break}}if(this.slotData[this.activeSlot].style.match("readonly"))return this.swFrame.removeEventListener("touchmove",this,!1),this.swFrame.removeEventListener("touchend",this,!1),!1;this.slotEl[this.activeSlot].removeEventListener("webkitTransitionEnd",this,!1),this.slotEl[this.activeSlot].style.webkitTransitionDuration="0";var i=window.getComputedStyle(this.slotEl[this.activeSlot]).webkitTransform;return i=(new WebKitCSSMatrix(i)).m42,i!=this.slotEl[this.activeSlot].slotYPosition&&this.setPosition(this.activeSlot,i),this.startY=e.targetTouches[0].clientY,this.scrollStartY=this.slotEl[this.activeSlot].slotYPosition,this.scrollStartTime=e.timeStamp,this.swFrame.addEventListener("touchmove",this,!1),this.swFrame.addEventListener("touchend",this,!1),!0},scrollMove:function(e){var t=e.targetTouches[0].clientY-this.startY;if(this.slotEl[this.activeSlot].slotYPosition>0||this.slotEl[this.activeSlot].slotYPosition<this.slotEl[this.activeSlot].slotMaxScroll)t/=2;this.setPosition(this.activeSlot,this.slotEl[this.activeSlot].slotYPosition+t),this.startY=e.targetTouches[0].clientY,e.timeStamp-this.scrollStartTime>80&&(this.scrollStartY=this.slotEl[this.activeSlot].slotYPosition,this.scrollStartTime=e.timeStamp)},scrollEnd:function(e){this.swFrame.removeEventListener("touchmove",this,!1),this.swFrame.removeEventListener("touchend",this,!1);if(this.slotEl[this.activeSlot].slotYPosition>0||this.slotEl[this.activeSlot].slotYPosition<this.slotEl[this.activeSlot].slotMaxScroll)return this.scrollTo(this.activeSlot,this.slotEl[this.activeSlot].slotYPosition>0?0:this.slotEl[this.activeSlot].slotMaxScroll),!1;var t=this.slotEl[this.activeSlot].slotYPosition-this.scrollStartY;if(t<this.cellHeight/1.5&&t>-this.cellHeight/1.5)return this.slotEl[this.activeSlot].slotYPosition%this.cellHeight&&this.scrollTo(this.activeSlot,Math.round(this.slotEl[this.activeSlot].slotYPosition/this.cellHeight)*this.cellHeight,"100ms"),!1;var n=e.timeStamp-this.scrollStartTime,r=2*t/n/this.friction,i=this.friction/2*r*r;r<0&&(r=-r,i=-i);var s=this.slotEl[this.activeSlot].slotYPosition+i;return s>0?(s/=2,r/=3,s>this.swSlotWrapper.clientHeight/4&&(s=this.swSlotWrapper.clientHeight/4)):s<this.slotEl[this.activeSlot].slotMaxScroll?(s=(s-this.slotEl[this.activeSlot].slotMaxScroll)/2+this.slotEl[this.activeSlot].slotMaxScroll,r/=3,s<this.slotEl[this.activeSlot].slotMaxScroll-this.swSlotWrapper.clientHeight/4&&(s=this.slotEl[this.activeSlot].slotMaxScroll-this.swSlotWrapper.clientHeight/4)):s=Math.round(s/this.cellHeight)*this.cellHeight,this.scrollTo(this.activeSlot,Math.round(s),Math.round(r)+"ms"),!0},scrollTo:function(e,t,n){this.slotEl[e].style.webkitTransitionDuration=n?n:"100ms",this.setPosition(e,t?t:0),(this.slotEl[e].slotYPosition>0||this.slotEl[e].slotYPosition<this.slotEl[e].slotMaxScroll)&&this.slotEl[e].addEventListener("webkitTransitionEnd",this,!1)},scrollToValue:function(e,t){var n,r,i;this.slotEl[e].removeEventListener("webkitTransitionEnd",this,!1),this.slotEl[e].style.webkitTransitionDuration="0",r=0;for(i in this.slotData[e].values){if(i==t){n=r*this.cellHeight,this.setPosition(e,n);break}r-=1}},backWithinBoundaries:function(e){return e.target.removeEventListener("webkitTransitionEnd",this,!1),this.scrollTo(e.target.slotPosition,e.target.slotYPosition>0?0:e.target.slotMaxScroll,"150ms"),!1},tapDown:function(e){e.currentTarget.addEventListener("touchmove",this,!1),e.currentTarget.addEventListener("touchend",this,!1),e.currentTarget.className="sw-pressed"},tapCancel:function(e){e.currentTarget.removeEventListener("touchmove",this,!1),e.currentTarget.removeEventListener("touchend",this,!1),e.currentTarget.className=""},tapUp:function(e){this.tapCancel(e),e.currentTarget.id=="sw-cancel"?this.cancelAction(e):this.doneAction(e),this.close(e)},setCancelAction:function(e){this.cancelAction=e},setDoneAction:function(e){this.doneAction=e},cancelAction:function(){return!1},cancelDone:function(){return!0}};define("com/external/spinningwheel-min",function(){}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/fibDropDown.html",[],function(){return"<div class='disableTemplate' id='quesWrapper<%=id%>'>\n    <div id='ques<%=id%>' class='quesContent'>\n        <div id='activityContent'>\n            <div id='questionHeading' class='questionHeading'></div>\n            <div id='questionMedia' class='left question-media'></div>\n            <div id='questionText' class='left'></div>\n            <div id='questionOptions'></div>\n            <div id='labelanswers'></div>\n        </div>\n    </div>\n</div>"}),define("com/es/widgets/assessment/view/fibDropDown",["com/es/widgets/assessment/AssesmentLang","com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/external/spinningwheel-min","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/fibDropDown.html"],function(AssesmentLang,utils,AppConst,assessEvent,spinningwheel,contentTpl){var fibDropDown=Backbone.View.extend({modelParagraph:"",qId:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",itemClicked:!1,correctAnswerVisible:null,inputNo:0,EvaluateFlag:!1,changeToolbar:{},spinnerOpen:!1,maxpoints:0,attemptMethod:AppConst.DROPDOWN_SPINNINGWHEEL,partialAttempt:!0,title:"",assetsPath:"",initialize:function(){_.bindAll(this,"handleScreenExit","handleEvaluate","handleFibBtnClick"),_.bindAll(this,"enableInteraction","destroyScroll","resetClickFlag","showDropDown","spinningWheelCancelClick","spinningWheelDoneClick"),_.extend(this,Backbone.Events)},render:function(){this.element=this.el;var e=_.template(contentTpl,this.model.toJSON());$("#"+this.model.get("uiId")+" #content",this.$el).QAappend(e),this.screen=$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el),this.setQuestionData()},setQuestionData:function(){this.modelParagraph=this.model.get("modelParagraph"),this.type=this.model.get("type"),this.layout=this.model.get("questionLayout"),this.responseType=this.model.get("responseType"),this.clues=this.model.get("clues"),this.rubric=this.model.get("rubric"),this.questionText=JSON.stringify(this.model.get("questionBody")),this.questionMedia=this.model.get("questionMedia"),this.optionsMedia=this.model.get("optionsMedia"),this.leftCol=this.model.get("leftCol"),this.rightCol=this.model.get("rightCol"),this.opLayout=this.model.get("optionsLayout"),this.options=this.model.get("options"),this.answers=this.model.get("answers"),this.isTest=this.model.get("isTest"),this.isReview=this.model.get("isReview"),this.reviewData=this.model.get(""),this.qId=this.model.get("id"),this.maxpoints=parseFloat(this.model.get("maxpoints")),this.model.get("userResponse").userResponse&&(this.userResponse=this.model.get("userResponse").userResponse),this.heading=this.model.get("heading"),utils.isDesktopBrowser()?this.attemptMethod=AppConst.DROPDOWN_NATIVE:this.attemptMethod=AppConst.DROPDOWN_SPINNINGWHEEL,this.partialAttempt=this.model.get("partialAttempt"),this.title=this.model.get("title"),this.assetsPath=this.model.get("assetPath"),this.renderQues()},renderQues:function(){this.answers.length>0;for(var i=0;i<this.options.length;i++)for(var j=0;j<this.options[i].length;j++)this.options[i][j].data=this.options[i][j].data.replace(/(<([^>]+)>)/ig,"");this.drags=[],this.drops=[],this.dropObjs=[],this.obj=this.screen;var qBody=eval(this.questionText),qOptions=eval(this.options),qStr="",optionsStr="",gapNo=0,gapLength=0,imgcnt=0;if(this.type==AppConst.QUESTION_TYPE_FIBTABLE){var Body=[],options=[];for(var i=0;i<qBody.length;i++){options[i]=[],Body.push(qBody[i]),Body.push("GAP"),Body.push({data:" <br/>",type:"text"});for(var j=0;j<qOptions.length;j++)options[i].push(qOptions[j])}qBody=Body,qOptions=options,this.options=qOptions,this.questionText=qBody}if(this.heading.length==0)$(".questionHeading",this.screen).hide();else{var headingStr="";for(var i=0;i<this.heading.length;i++)this.heading[i].type=="image"?headingStr+="<img src='"+this.assetsPath+this.heading[i].data+"'></img>":headingStr+="<div>"+this.heading[i].data+"</div>";$(".questionHeading",this.screen).html(headingStr)}if(this.questionMedia.length==0)$("#questionMedia",this.screen).hide();else{var qMediaStr="";for(var i=0;i<this.questionMedia.length;i++){imgcnt+=1;var id="fibdd-img-"+imgcnt;qMediaStr+=utils.renderNode(this.assetsPath,this.questionMedia[i],id)}$("#questionMedia",this.screen).html(qMediaStr)}$("#questionMedia img",this.screen).bind(assessEvent.CLICK,function(){window.open($("#questionMedia img").data("url"))});var startNewLineUl=!0,flagGap=!1;for(var i=0;i<qBody.length;i++){startNewLineUl&&(qStr+="<ul class='fibLine'>",startNewLineUl=!1);if(qBody[i]=="GAP"){var index=0;if(this.attemptMethod==AppConst.DROPDOWN_NATIVE){qStr+="<li class='fibLineGap'><div class='inputDrop'><div class='badgeWrapper' id='group_drop"+gapNo+"'><select id='drop"+gapNo+"' class='dropdown' readonly='readonly'  data-ddid='"+(i+1)+"' ><option value='-1'></option>";for(var j=0;j<this.options[gapNo].length;j++)qStr+="<option value='"+index+"'>"+this.options[gapNo][j].data+"</option>",index++;qStr+="</select><div class='' id='arrow_drop"+gapNo+"'></div><div id='badge"+gapNo+"' class='checkBadge5 icon'></div></div></div></li>"}else{gapLength=4;for(var j=0;j<this.options[gapNo].length;j++)gapLength<this.options[gapNo][j].data.length&&(gapLength=this.options[gapNo][j].data.length);gapLength+=2,qStr+="<li class='fibLineGap'><div class='inputDrop'><div class='badgeWrapper' id='group_drop"+gapNo+"'><input type='text' id='drop"+gapNo+"' size='"+parseInt(parseInt(gapLength))+"' class='dropdown' data-ddid='"+(i+1)+"' /><span class='icon icon-input-arrow'></span>",qStr+="<div class='' id='arrow_drop"+gapNo+"'></div><div id='badge"+gapNo+"' class='checkBadge5 icon'></div></div></div></li>"}gapNo++,this.drops.push("drop"+gapNo),flagGap=!0}else{if(typeof qBody[i]=="object"){var liClass="fibLine"+qBody[i].type;if(qBody[i].type=="text")if(qBody[i].data.match(/<[bB][rR]\s*[/]?>/)){var arr=qBody[i].data.split(/<[bB][rR]\s*[/]?>/),txt=arr[0];txt.trim()!=""&&(txt.trim().indexOf(" ")==-1&&flagGap?qStr=qStr.replace(new RegExp("</li>$"),utils.renderNode(this.assetsPath,{type:"text",data:txt})+"</li>"):qStr+=utils.renderNode(this.assetsPath,{type:"text",data:txt})),qStr+="</ul><ul class='fibLine'>";for(var j=1;j<arr.length;j++){var txt=arr[j];txt.trim()!=""?qStr+=utils.renderNode(this.assetsPath,{type:"text",data:txt}):j!=1&&(qStr+="<br/>")}}else qStr+=utils.renderNode(this.assetsPath,qBody[i]);else{imgcnt+=1;var id="fibdd-img-"+imgcnt;qStr+='<li class="'+liClass+'">'+utils.renderNode(this.assetsPath,qBody[i],id)+"</li>"}}flagGap=!1}}qStr+="</ul>",utils.log("FIBDD",qStr),this.inputNo=gapNo,$("#questionText",this.obj).html(qStr),this.fixWrappedLi(),$(".dropdown",this.obj).css("max-width",$("#questionText",this.obj).width()-10),$("#questionOptions",this.obj).html(optionsStr),$("#questionText",this.obj).removeClass("center"),$("#questionText",this.obj).addClass("left"),this.enableInteraction();var that=this,ref=this.element,loadedImageCount=0,imgArray=$("#activityContent img",this.obj),imgCount=imgArray.length;imgCount==0&&this.trigger(assessEvent.TEMPLATE_READY),_.each(imgArray,function(e){$(e).on("load",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.trigger(assessEvent.IMG_LOADED),that.trigger(assessEvent.TEMPLATE_READY))}),$(e).on("error",function(){loadedImageCount++,imgCount===loadedImageCount&&that.trigger(assessEvent.TEMPLATE_READY)})}),this.responseType==AppConst.RESPONSE_TYPE_TEXT&&_.delay(this.destroyScroll,1e3)},fixWrappedLi:function(){var e=$("#questionText",this.obj).find("ul"),t=$(e[0]).height();for(var n=0;n<e.length;n++){var r=$(e[n]).height();r<t&&(t=r)}for(var n=0;n<e.length;n++){var r=$(e[n]).height();if(r>t*2-5){var i=$(e[n]).find("li");for(var s=0;s<i.length;s++){if($(i[s]).find("*").length>0)continue;var o=$(i[s]).text(),u=o.split(" "),a="";for(var f=0;f<u.length;f++)a+='<li class="fibLinetext"> '+u[f]+"</li>";$(i[s]).replaceWith(a)}}}},destroyScroll:function(){this.spinnerOpen=!1,this.iScroll!=null&&this.iScroll.destroy()},enableInteraction:function(){var e=this,t=$(".dropdown",this.obj);t.removeClass("disableOption"),t.removeAttr("disabled"),$(".checkBadge5",this.obj).css("z-index",-1),$("#questionText",this.obj).removeClass("disabled"),this.attemptMethod==AppConst.DROPDOWN_NATIVE?$(".dropdown",this.obj).unbind().bind(assessEvent.CHANGE,function(t){_.delay(e.handleFibBtnClick,500,t)}):$(".badgeWrapper",this.obj).unbind().bind(assessEvent.CLICK,e.showDropDown)},showDropDown:function(e){if(this.spinnerOpen==0){var t={};t.e=e,t.align="bottom",t.position=50,this.disableInteraction(),utils.log(e.target.id),$(e.target).hasClass("icon-input-arrow")?this.currentDropDown=$(e.target).prev().attr("id"):this.currentDropDown=e.target.id;var n=this.currentDropDown.split("drop")[1];this.gapIndex=n;var r=new Object;for(var i=0;i<this.options[n].length;i++)r[i+1]=this.options[n][i].data;return SpinningWheel.addSlot(r,"",this.key||1),SpinningWheel.setCancelAction(this.spinningWheelCancelClick),SpinningWheel.setDoneAction(this.spinningWheelDoneClick),SpinningWheel.open(t),this.spinnerOpen=!0,!1}},spinningWheelCancelClick:function(){this.spinnerOpen=!1,this.enableInteraction()},spinningWheelDoneClick:function(){this.spinnerOpen=!1,this.enableInteraction();var e=this.gapIndex,t=SpinningWheel.getSelectedValues();$("#drop"+e,this.screen).val(t.values),this.key=t.keys,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)},disableInteraction:function(){var e=$(".dropdown",this.obj),t=$("#activityContent img",this.obj);e.addClass("disableOption"),e.attr("disabled","disabled"),e.unbind(assessEvent.CLICK),$("#questionText",this.obj).addClass("disabled"),$(".checkBadge5",this.obj).css("z-index",0),$(".badgeWrapper",this.obj).unbind(),$("#questionMedia img",this.screen).unbind(),$(".dropdown",this.obj).unbind(),$(t).off()},handleFibBtnClick:function(e){this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT;var t=$("#questionText",this.obj).find(".dropdown"),n=0;for(var r=0;r<t.length;r++){var i=t[r];i.options[i.selectedIndex].value!=-1&&(n++,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE)}this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),n==t.length?this.trigger(assessEvent.Q_STATUS,AppConst.COMPLETE):n>0?this.trigger(assessEvent.Q_STATUS,AppConst.PARTIAL):this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT)},resetClickFlag:function(){this.itemClicked=!1},populateAnswers:function(e,t){if(this.isReset&&this.isTest&&!this.isReview&&e==undefined)return;var n=$("#questionText",this.obj).find("input"),r=$("#questionText",this.obj).find("div.checkBadge5");$("#questionText",this.obj).find(".dropdown").removeClass("focus-markright"),$("#questionText",this.obj).find(".dropdown").removeClass("focus-markwrong"),t==0?(r.removeClass("markWrong"),r.removeClass("markRight")):e.length>0&&(this.EvaluateFlag=!0);if(e.length>0)if(t!=0)for(var i=0;i<this.options.length;i++)e[i]>=0?(e[i]==this.answers[i]?($("#badge"+i,this.obj).addClass("markRight"),$("#questionText",this.obj).find(".dropdown").get(i).className+=" focus-markright"):($("#badge"+i,this.obj).addClass("markWrong"),$("#questionText",this.obj).find(".dropdown").get(i).className+=" focus-markwrong"),this.attemptMethod==AppConst.DROPDOWN_NATIVE?$("#drop"+[i],this.screen).val(parseInt(e[i])):$("#drop"+[i],this.screen).val(this.options[i][e[i]].data)):($("#badge"+i,this.obj).addClass("markWrong"),$("#questionText",this.obj).find(".dropdown").get(i).className+=" focus-markwrong",this.attemptMethod==AppConst.DROPDOWN_NATIVE?$("#drop"+i,this.screen).val(-1):$("#drop"+i,this.screen).val(""));else{for(var i=0;i<this.options.length;i++)this.attemptMethod==AppConst.DROPDOWN_NATIVE?$("#drop"+[i],this.screen).val(e[i]):e[i]>=0?$("#drop"+[i],this.screen).val(this.options[i][e[i]].data):$("#drop"+[i],this.screen).val(""),$("#badge"+[i],this.screen).removeClass("markWrong"),$("#badge"+[i],this.screen).removeClass("markRight");$("#questionText",this.obj).find(".dropdown").removeClass("focus-markright"),$("#questionText",this.obj).find(".dropdown").removeClass("focus-markwrong")}e.length>0&&(this.EvaluateFlag=!0),(this.isTest||this.partialAttempt==0)&&!this.isReview&&(r.removeClass("markRight"),r.removeClass("markWrong"),$("#questionText",this.obj).find(".dropdown").removeClass("focus-markright"),$("#questionText",this.obj).find(".dropdown").removeClass("focus-markwrong"))},itemClicked:!1,handleEvaluate:function(e){if(e!=undefined&&$(e.target).hasClass("disabled"))return;if(this.itemClicked==1)return;this.userResponse=[],this.itemClicked=!0,this.EvaluateFlag=!0,this.isReset=!1;var attemtedInputs=0,totalInputs=0,attrToCheck=null,blankObjs=null,totalCorrect=0,qOptions=eval(this.options);utils.log("qOptions",qOptions);var markPerQ=parseFloat(this.maxpoints/this.options.length),marksQbtained=0,buttons=$("#questionOptions",this.obj).find("li");blankObjs=$("#questionText",this.obj).find(".dropdown"),blankObjsBadges=$("#questionText",this.obj).find("div.checkBadge5"),attrToCheck="value",totalInputs=blankObjs.size(),$("#questionOptions",this.obj).find(".selected").removeClass("selected");var dropList=$("#questionText",this.obj).find(".dropdown");for(var i=0;i<dropList.length;i++){var el=dropList[i],myanswer=-1;if(this.attemptMethod==AppConst.DROPDOWN_NATIVE)myanswer=parseInt(el.options[el.selectedIndex].value);else{var ans=$(el).val();for(var j=0;j<this.options[i].length;j++)if(ans==this.options[i][j].data){myanswer=j;break}}myanswer>=0&&attemtedInputs++,this.userResponse.push(myanswer),myanswer==this.answers[i]?($("#badge"+[i],this.obj).addClass("markRight"),blankObjs.get(i).className+=" focus-markright",totalCorrect++,marksQbtained+=markPerQ):($("#badge"+[i],this.obj).addClass("markWrong"),$("#badge"+[i],this.obj).addClass("markWrong"),blankObjs.get(i).className+=" focus-markwrong")}this.partialAttempt||(blankObjsBadges.removeClass("markRight"),blankObjsBadges.removeClass("markWrong"),blankObjs.removeClass("focus-markright"),blankObjs.removeClass("focus-markwrong")),this.partialAttempt==1||attemtedInputs==totalInputs?totalCorrect>=totalInputs?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,status:AppConst.CORRECT,score:marksQbtained,maxScore:this.maxpoints,type:this.type,title:this.title,responseType:this.responseType}):totalCorrect>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.PARTIAL,maxScore:this.maxpoints,type:this.type,title:this.title,responseType:this.responseType}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.PARTIAL,maxScore:this.maxpoints,type:this.type,title:this.title,responseType:this.responseType}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,type:this.type,responseType:this.responseType}),this.lockQuestion(),_.delay(this.resetClickFlag,500)},resetClickFlag:function(){this.itemClicked=!1},lockQuestion:function(){this.correctAnswerVisible=!1,this.changeToolbar.mode=AppConst.TOOLBAR_LOCKED,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.disableInteraction()},resetQuestion:function(e){this.isReset=!0;var t=$("#questionText",this.obj).find("div.checkBadge5");t.removeClass("markRight"),t.removeClass("markWrong"),$("#questionText",this.obj).find(".dropdown").removeClass("focus-markright"),$("#questionText",this.obj).find(".dropdown").removeClass("focus-markwrong");var n=$("#questionText",this.obj).find(".dropdown").length;if(this.attemptMethod==AppConst.DROPDOWN_NATIVE)for(var r=0;r<n;r++)$("#questionText",this.obj).find(".dropdown")[r].selectedIndex=0;else $("#questionText",this.obj).find(".dropdown").val("");this.userResponse=[],this.enableInteraction(),this.trigger(assessEvent.MARK_EMPTY,this.qId),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT),this.EvaluateFlag=!1},resetQuestionPartial:function(e){this.targetSelected="";var t=!0,n=$("#questionText",this.obj).find("input"),r=$("#questionText",this.obj).find("div.checkBadge5");r.removeClass("markWrong"),r.removeClass("markRight");var i=$("#questionText",this.obj).find(".dropdown");i.removeClass("focus-markright"),i.removeClass("focus-markwrong");var s=0;for(var o=0;o<i.length;o++)if(this.userResponse[o]!=this.answers[o]){if(this.attemptMethod==AppConst.DROPDOWN_NATIVE)var u=$("#drop"+[o],this.screen).val(-1);else var u=$("#drop"+[o],this.screen).val("");this.userResponse[o]=""}else s++;s>0?(t=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)):(this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)),n.removeClass("disableOption"),this.EvaluateFlag=!1,this.correctAnswerVisible=!1,this.enableInteraction(),t==0?this.trigger(assessEvent.UPDATE_RESPONSE,this.qId,{userResponse:this.userResponse}):this.trigger(assessEvent.MARK_EMPTY,this.qId),this.disableButton(AppConst.QBTN_RESET)},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},handleScreenExit:function(){},orientationchange:function(e){},destroy:function(){this.spinnerOpen&&(SpinningWheel.close(),this.spinnerOpen=!1),this.unbind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.unbind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.unbind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.unbind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.unbind(assessEvent.MARK_EMPTY,this.markEmpty),this.unbind(assessEvent.UPDATE_RESPONSE,this.updateResponse),this.unbind(assessEvent.MARK_ANSWER,this.handleMarkAnswer),$("#questionOptions",this.obj).find("li").unbind(),this.disableInteraction(),$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el).remove()}});return fibDropDown}),define("com/es/widgets/assessment/model/fibDropDownVO",[],function(){var e=Backbone.Model.extend({id:"",modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",attemptMethod:"",heading:[],partialAttempt:!0,feedback:[]});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/fibTapPlace.html",[],function(){return"<div id='quesWrapper<%=id%>' class='disableTemplate'>\n    <div id='ques<%=id%>' class='quesContent'>\n		<div id='activityContent'>\n			<div id='questionHeading' class='questionHeading'></div>\n			<div id='questionMedia' class='left question-media'></div>\n			<div id='questionOptions' class='trayParent'></div>\n			<div id='questionTextCover'>\n				<div id='questionText' class='left'></div>\n			</div>\n			<div id='labelanswers'></div>\n		</div>\n	</div>\n</div>"}),define("com/es/widgets/assessment/view/fibTapPlace",["com/es/widgets/assessment/AssesmentLang","com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/fibTapPlace.html"],function(AssesmentLang,utils,AppConst,assessEvent,contentTpl){var fibTapPlace=Backbone.View.extend({modelParagraph:"",qId:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",itemClicked:!1,correctAnswerVisible:null,inputNo:0,EvaluateFlag:!1,changeToolbar:{},drags:[],drops:[],dragObjs:[],targetSelected:"",optionSelected:"",optionNode:"",maxpoints:0,resetClicked:!1,maintainOptions:AppConst.FIB_REMOVE_OPTIONS,partialAttempt:!0,optionHasImg:!1,textScroll:null,title:"",assetsPath:"",initialize:function(){_.bindAll(this,"handleScreenExit","handleEvaluate","onOptionSelected","onTargetSelected","resetFontSize","disableButton","resetClickFlag","onDeleteBtnClick","initScroll"),_.extend(this,Backbone.Events)},render:function(){this.element=this.el;var e=_.template(contentTpl,this.model.toJSON());$("#"+this.model.get("uiId")+" #content",this.$el).QAappend(e),this.screen=$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el),this.setQuestionData()},setQuestionData:function(){this.modelParagraph=this.model.get("modelParagraph"),this.type=this.model.get("type"),this.layout=this.model.get("questionLayout"),this.responseType=this.model.get("responseType"),this.clues=this.model.get("clues"),this.rubric=this.model.get("rubric"),this.questionText=JSON.stringify(this.model.get("questionBody")),this.questionMedia=this.model.get("questionMedia"),this.optionsMedia=this.model.get("optionsMedia"),this.leftCol=this.model.get("leftCol"),this.rightCol=this.model.get("rightCol"),this.opLayout=this.model.get("optionsLayout"),this.options=this.model.get("options"),this.answers=this.model.get("answers"),this.isTest=this.model.get("isTest"),this.isReview=this.model.get("isReview"),this.reviewData=this.model.get(""),this.qId=this.model.get("id"),this.maxpoints=parseFloat(this.model.get("maxpoints")),this.partialAttempt=this.model.get("partialAttempt"),this.title=this.model.get("title"),this.assetsPath=this.model.get("assetPath"),this.model.get("userResponse").userResponse&&(this.userResponse=this.model.get("userResponse").userResponse),this.heading=this.model.get("heading"),this.maintainOptions=this.model.get("maintainOptions"),this.renderQues()},renderQues:function(){this.drags=[],this.drops=[],this.dropObjs=[],this.obj=this.screen;var qBody=eval(this.questionText),qOptions=eval(this.options),qStr="",optionsStr="",gapNo=0,gapLength=0;this.inputNo=this.answers.length;if(this.heading.length==0)$(".questionHeading",this.screen).hide();else{var headingStr="";for(var i=0;i<this.heading.length;i++)this.heading[i].type=="image"?headingStr+="<img src='"+this.assetsPath+this.heading[i].data+"' />":headingStr+="<div>"+this.heading[i].data+"</div>";$(".questionHeading",this.screen).html(headingStr)}if(this.questionMedia.length==0)$("#questionMedia",this.screen).hide();else{var qMediaStr="";for(var i=0;i<this.questionMedia.length;i++)qMediaStr+=utils.renderNode(this.assetsPath,this.questionMedia[i]);$("#questionMedia",this.screen).html(qMediaStr)}$("#questionMedia img",this.screen).bind(assessEvent.CLICK,function(){window.open($("#questionMedia img").data("url"))});if(this.responseType==AppConst.RESPONSE_TYPE_DRAG){utils.log("render Ques 2");for(var j=0;j<this.options.length;j++)gapLength<this.options[j].data.length&&(gapLength=this.options[j].data.length);gapLength=Math.max(gapLength,6),utils.log("gap length : "+gapLength);var startNewLineUl=!0,flagGap=!1;for(var i=0;i<qBody.length;i++){startNewLineUl&&(qStr+='<ul class="fibLine">',startNewLineUl=!1);if(qBody[i]=="GAP")gapNo++,qStr+="<li class='fibLineGap'><div class='badgeWrapper'><span type='text' id='drop"+gapNo+"' size='"+parseInt(parseInt(gapLength)+3)+"' class='blank' readonly='readonly' ></span><div class='deleteBtn' style='display:none;'></div><div class='checkBadge icon'></div> </div></li>",this.drops.push("drop"+gapNo),flagGap=!0;else{if(typeof qBody[i]=="object"){var liClass="fibLine"+qBody[i].type;qBody[i].type=="text"?qBody[i].data.trim().indexOf(" ")==-1&&flagGap?qStr=qStr.replace(new RegExp("</li>$"),utils.renderNode(this.assetsPath,qBody[i])+"</li>"):qStr+=utils.renderNode(this.assetsPath,qBody[i]):qStr+='<li class="'+liClass+'">'+utils.renderNode(this.assetsPath,qBody[i])+"</li><br />"}flagGap=!1}}qStr+="</ul>",this.layout=this.layout.toUpperCase(),this.layout.toUpperCase()==AppConst.LAYOUT_HORIZONTAL||this.layout==""?optionsStr="<div class='mcq4'>":this.layout==AppConst.LAYOUT_VERTICAL&&(optionsStr="<div class='mcq2' style='padding-top:30px;'>");var optionsStr2="";for(var i=0;i<qOptions.length;i++)qOptions[i].type=="image"?optionsStr2+="<div class='dropelement trayOptions imageOpt' id='drag"+(i+1)+"'><span>"+utils.renderNode(this.assetsPath,qOptions[i])+"</span></div>":optionsStr2+="<div class='dropelement trayOptions' id='drag"+(i+1)+"'><span>"+utils.renderNode(this.assetsPath,qOptions[i])+"</span></div>";var optionsStr3="</div>"}$("#questionText",this.obj).html(qStr),this.fixWrappedLi(),$("#questionOptions",this.obj).html(optionsStr+optionsStr2+optionsStr3);for(var i=0;i<qOptions.length;i++)this.drags.push("drag"+(i+1));var minFontSize=16;for(var i=0;i<qOptions.length;i++){utils.log("calculating font size : "+i),fSize=16,cardTextNode=$("#drag"+(i+1),this.obj).get(0);var node=$("span",cardTextNode).get(0);fCard=node.parentNode;var size=this.resetFontSize(cardTextNode,node,fSize,"px");minFontSize=size<minFontSize?size:minFontSize,cardTextNode.style["font-size"]=minFontSize+"px !important"}$(".dropelement",this.obj).css("font-size",minFontSize+"px !important");for(var i=0;i<qOptions.length;i++)if(qOptions[i].type=="image"){this.optionHasImg=!0;break}this.enableInteraction();if(this.optionHasImg){var that=this;_.delay(that.initScroll,500)}else this.initScroll();var loadedImageCount=0,imgArray=$("#activityContent img",this.obj),imgCount=imgArray.length,that=this;imgCount==0&&this.trigger(assessEvent.TEMPLATE_READY),_.each(imgArray,function(e){$(e).on("load",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.trigger(assessEvent.IMG_LOADED),that.trigger(assessEvent.TEMPLATE_READY))}),$(e).on("error",function(){loadedImageCount++,imgCount===loadedImageCount&&that.trigger(assessEvent.TEMPLATE_READY)})})},fixWrappedLi:function(){var e=$("#questionText",this.obj).find("ul"),t=$(e[0]).height();for(var n=0;n<e.length;n++){var r=$(e[n]).height();r<t&&(t=r)}for(var n=0;n<e.length;n++){var r=$(e[n]).height();if(r>t*2-5){var i=$(e[n]).find("li");for(var s=0;s<i.length;s++){if($(i[s]).find("*").length>0)continue;var o=$(i[s]).text(),u=o.split(" "),a="";for(var f=0;f<u.length;f++)a+='<li class="fibLinetext"> '+u[f]+"</li>";$(i[s]).replaceWith(a)}}}},resetFontSize:function(e,t,n){return fSize=n,e.offsetWidth-6<t.offsetWidth&&(fSize=n*.625),fSize},enableInteraction:function(){$(".blank",this.obj).unbind().bind(assessEvent.CLICK,this.onTargetSelected),$(".dropelement",this.obj).unbind().bind(assessEvent.CLICK,this.onOptionSelected),$(".blank",this.obj).removeClass("disableTarget"),$("#questionText").removeClass("disabled"),$(".dropelement",this.obj).removeClass("disableOption")},disableInteraction:function(){var e=$("#activityContent img",this.obj);$(".blank",this.obj).unbind(),$(".dropelement",this.obj).unbind(),$("div.deleteBtn",this.obj).unbind(),$("#questionMedia img",this.screen).unbind(),$(e).off(),$(".blank",this.obj).addClass("disableTarget"),$(".dropelement",this.obj).addClass("disableOption"),$("#questionText").addClass("disabled");var t=$("#questionOptions").find(".dropelement");t.removeClass("selected")},onDeleteBtnClick:function(e){this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,$("#questionText",this.obj).find("div.deleteBtn").hide();var t=e.target,n=$(t).siblings(".badgeWrapper").find(".blank");n.html(""),n.removeAttr("style"),n.removeClass("selected"),$("#"+$(t).attr("optionId"),this.obj).css("visibility","visible"),this.optionHasImg&&this.initScroll(),$(t).hide(),$(t).attr("optionId",""),this.optionSelected=this.targetSelected=this.optionNode="";var r=$(".blank",this.screen);for(var i=0;i<r.length;i++)if($(r[i]).html()!=""){this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE;break}this.trigger(assessEvent.Q_STATUS,0),this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.itemClicked=!1},onOptionSelected:function(e){if(this.itemClicked==1)return;$("#questionOptions",this.screen).find(".dropelement").removeClass("optionSelected"),$("#questionOptions",this.screen).find("img").removeClass("optionSelected"),node=e.target;var t=null;node.nodeName.toLowerCase()=="img"?(node=node.parentNode,t=node.parentNode):node.nodeName.toLowerCase()=="span"?t=node.parentNode:node.nodeName.toLowerCase()=="div"&&(t=node,node=$(node).find("span")),this.itemClicked=!0,this.optionNode=$(node),this.optionSelected=$(node).html(),$(t).addClass("optionSelected");var n=this.checkAndFillValue();$("#questionText",this.obj).find("div.deleteBtn").hide(),_.delay(this.resetClickFlag,100)},onTargetSelected:function(e){if(this.itemClicked==1)return;$("#questionText",this.obj).find(".selected").removeClass("selected"),$("#questionText",this.obj).find(".deleteBtn").hide(),node=e.target,this.itemClicked=!0,node.nodeName.toLowerCase()=="img"&&(node=node.parentNode),utils.log(node.id),this.targetSelected=node.id,$("#"+this.targetSelected,this.obj).addClass("selected");var t=this.checkAndFillValue();!t&&$(node).html()!="",_.delay(this.resetClickFlag,100)},initScroll:function(){utils.log("in init scroll",$("#content",this.obj))},resetClickFlag:function(){this.itemClicked=!1},checkAndFillValue:function(){if(this.optionSelected!=""&&this.targetSelected!=""){$("#"+this.targetSelected,this.obj).get(0).innerHTML=this.optionSelected;var e=$("#"+this.targetSelected,this.obj).find("img").height();$("#"+this.targetSelected,this.obj).height(e),$("#"+this.targetSelected,this.obj).removeClass("selected"),$(".optionSelected",this.obj).removeClass("optionSelected");if(this.maintainOptions==AppConst.FIB_REMOVE_OPTIONS){this.optionNode.css("visibility","hidden");var t=$("#"+this.targetSelected,this.obj).parent().siblings("div.deleteBtn");t.attr("optionId")&&$("#"+t.attr("optionId"),this.obj).css("visibility","visible"),t.attr("optionId",this.optionNode.attr("id"))}var n=$(".blank",this.screen),r=0;for(var i=0;i<n.length;i++)$(n[i]).html()!=""&&r++;return r==n.length?this.trigger(assessEvent.Q_STATUS,1):this.trigger(assessEvent.Q_STATUS,0),this.optionSelected=this.targetSelected=this.optionNode="",this.optionHasImg&&this.initScroll(),this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),!0}},populateAnswers:function(e,t){if(this.resetClicked&&this.isTest)return;utils.log(e);var n=$("#questionText",this.obj).find(".blank");n.removeClass("focus-markright"),n.removeClass("focus-markwrong");var r=$("#questionText",this.obj).find("div.checkBadge"),i=$("#questionOptions",this.obj).find(".dropelement");i.removeClass("selected"),i.removeClass("optionHighlight"),i.removeClass("optionSelected"),$("#questionText",this.obj).find("div.deleteBtn").hide(),$("#questionText",this.obj).find(".selected").removeClass("selected"),t==0&&(utils.log("in correct ans false"),r.removeClass("markWrong"),r.removeClass("markRight"));var s=n.size();utils.log("max "+s),e.length>0?i.addClass("disableOption"):i.css("opacity",1);for(var o=0;o<s;o++){var u=e[o];myBlank=n.get(o),myBlank.innerHTML="";if(e.length>0){if(u!=""){if(this.options[u-1].type=="image"){u=this.options[u-1].data;var a=utils.renderNode(this.assetsPath,{type:"image",data:u});myBlank.innerHTML=a;var f=$(myBlank).find("img").height();$(myBlank).height(f)}else u=this.options[u-1].data,myBlank.innerHTML=u;var l=$("#"+myBlank.id,this.obj).parent().siblings("div.deleteBtn");l.attr("optionid","drag"+e[o]),utils.log("answer1 "+u)}else myBlank.innerHTML=u;if(t==1){this.answers.length>0&&(this.EvaluateFlag=!0);var c=this.options[this.answers[o]-1].data.toLowerCase();userAns=u==undefined?u:u.toLowerCase(),userAns==c?(r.get(o).className+=" markRight",n.get(o).className+=" focus-markright"):(r.get(o).className+=" markWrong",n.get(o).className+=" focus-markwrong")}var h=$("#questionOptions",this.obj).find("span");for(var p=0;p<h.length;p++){var d="";if($(h[p]).find("img").length>0){var v=$(h[p]).find("img").attr("src").split(this.assetsPath);d=v[v.length-1]}else d=h[p].innerHTML;d==u&&i[p].className.search("optionHighlight")<0&&(i[p].className+=" optionHighlight")}}}e.length>0&&(this.EvaluateFlag=!0),(this.isTest||this.partialAttempt==0)&&!this.isReview&&(r.removeClass("markWrong"),r.removeClass("markRight"),i.removeClass("selected"),i.removeClass("optionHighlight"),i.removeClass("optionSelected"),i.removeClass("disableOption"),n.removeClass("focus-markright"),n.removeClass("focus-markwrong")),!this.isReview&&e.length<=0&&this.enableInteraction()},handleEvaluate:function(e){if(e!=undefined&&$(e.target).hasClass("disabled"))return;this.EvaluateFlag=!0,this.resetClicked=!1;var t=$("#questionText",this.obj).find(".blank"),n=$("#questionText",this.obj).find("div.checkBadge"),r=$("#questionOptions",this.obj).find(".dropelement");n.removeClass("markRight"),n.removeClass("markWrong"),t.removeClass("selected"),r.removeClass("optionSelected"),$("#questionText",this.obj).find("div.deleteBtn").hide(),$("#questionText",this.obj).find(".selected").removeClass("selected");var i=0,s=null,o=null,u=0,a=0;this.userResponse=[];var f=0,l=0;o=$("#questionText",this.obj).find(".blank"),s="value",i=o.length;var c=parseFloat(this.maxpoints/i);for(var h=0;h<i;h++){if($(o.get(h)).find("img").length>0)var p=$(o.get(h)).find("img").attr("src").split(this.assetsPath),d=p[p.length-1];else var d=$(o.get(h)).html();d=d.toLowerCase(),utils.log(d),d==""&&this.userResponse.push(d);var v=[];if(this.answers[h].length&&this.answers[h].length>1)for(var m=0;m<this.answers[h].length;m++)v.push(this.options[this.answers[h][m]-1].data.toLowerCase());else v.push(this.options[this.answers[h]-1].data.toLowerCase());for(var g=0;g<this.options.length;g++)if(d==this.options[g].data.toLowerCase()){a=g+1,f++,this.userResponse.push(a);break}utils.log(d+", correct answer : "+v+" total inputs: "+i),v.indexOf(d)!=-1?(n.get(h).className+=" markRight",t.get(h).className+=" focus-markright",l+=c,u++):(n.get(h).className+=" markWrong",t.get(h).className+=" focus-markwrong");for(var y=0;y<this.options.length;y++)if(this.options[y].data==d){utils.log("drops[o]",r[y]),$("#drag"+(y+1),this.obj).addClass("optionHighlight");break}}this.partialAttempt||(n.removeClass("markRight"),n.removeClass("markWrong")),this.partialAttempt==1||f==i?u>=i?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,status:AppConst.CORRECT,score:l,maxScore:this.maxpoints,title:this.title,type:this.type,responseType:this.responseType}):u>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:l,status:AppConst.PARTIAL,maxScore:this.maxpoints,title:this.title,type:this.type,responseType:this.responseType}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:l,status:AppConst.INCORRECT,maxScore:this.maxpoints,title:this.title,type:this.type,responseType:this.responseType}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,title:this.title,type:this.type,responseType:this.responseType}),this.lockQuestion()},lockQuestion:function(){this.correctAnswerVisible=!1,this.changeToolbar.mode=AppConst.TOOLBAR_LOCKED,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.disableInteraction()},resetQuestion:function(e){this.resetClicked=!0,this.optionSelected="",this.targetSelected="",$("#questionText",this.obj).html(""),$("#questionOptions",this.obj).html(""),this.userResponse=[],this.EvaluateFlag=!1,this.renderQues(),this.correctAnswerVisible=!1,this.enableInteraction(),this.trigger(assessEvent.MARK_EMPTY,this.qId),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.Q_STATUS,0),this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)},resetQuestionPartial:function(e){this.optionSelected="",this.targetSelected="";var t=!0;this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);var n=$("#questionText",this.obj).find("div.checkBadge"),r=$("#questionText",this.obj).find(".blank"),i=$("#questionOptions",this.obj).find(".dropelement");$("#questionText",this.obj).find("div.deleteBtn").hide(),$("#questionText",this.obj).find(".selected").removeClass("selected"),n.removeClass("markWrong"),n.removeClass("markRight"),i.removeClass("optionHighlight");if(this.userResponse.length>0)for(var s=0;s<this.userResponse.length;s++)this.answers[s].indexOf(this.userResponse[s])==-1?($("#drag"+this.userResponse[s],this.obj).removeClass("optionHighlight"),$("#drag"+this.userResponse[s],this.obj).css("visibility","visible"),$("div.deleteBtn[optionid=drag"+this.userResponse[s]+"]",this.obj).attr("optionid",""),this.userResponse[s]="",$("#drop"+(s+1)).html("")):(this.maintainOptions==AppConst.FIB_REMOVE_OPTIONS&&$("#drag"+this.userResponse[s],this.obj).css("visibility","hidden"),t=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar));this.EvaluateFlag=!1,this.correctAnswerVisible=!1,this.enableInteraction(),t==0?this.trigger(assessEvent.UPDATE_RESPONSE,this.qId,{userResponse:this.userResponse}):this.trigger(assessEvent.MARK_EMPTY,this.qId),this.disableButton(AppConst.QBTN_RESET)},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},handleScreenExit:function(){try{for(var e=0;e<this.dragObjs.length;e++)this.dragObjs[e].lastCurX=null,this.dragObjs[e].lastCurY=null,this.dragObjs[e].destroy();webkit_drop.remove()}catch(t){console.log(t)}this.textScroll!=null&&this.textScroll.destroy()},orientationchange:function(e){},destroy:function(){this.unbind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.unbind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.unbind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.unbind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.unbind(assessEvent.MARK_EMPTY,this.markEmpty),this.unbind(assessEvent.UPDATE_RESPONSE,this.updateResponse),this.disableInteraction(),$("#questionOptions",this.obj).find("li").unbind(),$("#ques"+this.model.get("id")).remove()}});return fibTapPlace}),define("com/es/widgets/assessment/model/fibTapPlaceVO",[],function(){var e=Backbone.Model.extend({id:"",modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",heading:[],maintainOptions:"",partialAttempt:!0,feedback:[]});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/mcqBinary.html",[],function(){return"<div id='quesWrapper<%=id%>' class='disableTemplate'>\n    <div id='ques<%=id%>' class='quesContent'>\n		<div id='activityContent'>\n        	<div id='questionHeading' class='questionHeading'></div>\n			<div id='questionMedia' class='left question-media'></div>\n			<div id='questionText' class='left'></div>\n			<div id='questionOptions'></div>\n			<div id='labelanswers'></div>\n		</div>\n	</div>\n</div>"}),define("com/es/widgets/assessment/view/mcqBinary",["com/es/widgets/assessment/AssesmentLang","com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/mcqBinary.html"],function(AssesmentLang,utils,AppConst,assessEvent,contentTpl){var mcqBinaryView=Backbone.View.extend({modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:[],qId:"",itemClicked:!1,correctAnswerVisible:null,inputNo:0,EvaluateFlag:!1,changeToolbar:{},nodes:[],maxpoints:0,partialAttempt:!0,scroll:null,assetsPath:"",numberstyle:"1",initialize:function(){_.bindAll(this,"handleMcqBtnClick","resetClickFlag","randomize"),_.extend(this,Backbone.Events)},render:function(){utils.log(this.model.get("id")),this.element=this.el;var e=_.template(contentTpl,this.model.toJSON());$("#"+this.model.get("uiId")+" #content",this.$el).QAappend(e),this.screen=$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el),this.setQuestionData()},setQuestionData:function(){this.modelParagraph=this.model.get("modelParagraph"),this.type=this.model.get("type"),this.layout=this.model.get("questionLayout"),this.responseType=this.model.get("responseType"),this.clues=this.model.get("clues"),this.rubric=this.model.get("rubric"),this.questionText=JSON.stringify(this.model.get("questionBody")),this.questionMedia=this.model.get("questionMedia"),this.optionsMedia=this.model.get("optionsMedia"),this.leftCol=this.model.get("leftCol"),this.rightCol=this.model.get("rightCol"),this.opLayout=this.model.get("optionsLayout"),this.options=this.model.get("options"),this.answers=this.model.get("answers"),this.isTest=this.model.get("isTest"),this.assetsPath=this.model.get("assetPath"),this.isReview=this.model.get("isReview"),this.reviewData=this.model.get(""),this.qId=this.model.get("id"),this.maxpoints=parseFloat(this.model.get("maxpoints")),this.model.get("userResponse").userResponse&&(this.userResponse=this.model.get("userResponse").userResponse,this.isAnswered=!0),this.heading=this.model.get("heading"),this.partialAttempt=this.model.get("partialAttempt"),this.labelFalse=this.model.get("labelFalse"),this.labelTrue=this.model.get("labelTrue"),this.labelFalse="False",this.numberstyle=this.model.get("numberstyle"),this.renderQues()},renderQues:function(){this.nodes=[],this.obj=this.screen;var qBody=eval(this.questionText.replace(/'+/g,"&apos;")),qOptions=eval(this.options),initialNumber=49,isRoman=!1;this.numberstyle=="1"?initialNumber=49:this.numberstyle=="a"?initialNumber=97:this.numberstyle=="i"&&(isRoman=!0);if(this.heading.length==0)$(".questionHeading",this.screen).hide();else{var headingStr="";for(var i=0;i<this.heading.length;i++)this.heading[i].type=="image"?headingStr+="<img src='"+this.assetsPath+this.heading[i].data+"' />":headingStr+="<div>"+this.heading[i].data+"</div>";$(".questionHeading",this.screen).html(headingStr)}if(this.questionMedia.length==0)$("#questionMedia",this.screen).hide();else{var qMediaStr="";for(var i=0;i<this.questionMedia.length;i++)qMediaStr+=utils.renderNode(this.assetsPath,this.questionMedia[i]);$("#questionMedia",this.screen).html(qMediaStr)}$("#questionMedia img",this.screen).bind(assessEvent.CLICK,function(){window.open($("#questionMedia img").data("url"))});var qStr="",optionsStr="";qStr+=utils.renderNode(this.assetsPath,qBody),this.layout=="2COL"&&this.leftCol!=""&&this.rightCol!=""&&(qStr+="<div class='leftcol'>",qStr+=utils.renderNode(this.assetsPath,eval(this.leftCol)),qStr+="</div>",qStr+="<div class='rightcol'>",qStr+=utils.renderNode(this.assetsPath,eval(this.rightCol)),qStr+="</div>"),this.inputNo=this.answers.length;var node="",startLi=!0,idCounter=1;for(var i=0;i<qOptions.length;i++){var curNumbering="";isRoman?curNumbering=utils.romanize(idCounter):curNumbering=String.fromCharCode(initialNumber+idCounter-1),startLi&&(node="<li id='li"+idCounter+"' class=''><!--span class='numbering'>"+curNumbering+" )</span--> <div class='tf-question binaryQues'>",startLi=!1);var tempData=qOptions[i].data.replace(/\s/g,"").toLowerCase();tempData=="<br>"||tempData=="<br/>"?(node+="</div><div class='qr-answer binaryAns'><span id='qr-correct-"+idCounter+"' class='qr-correct' data-op = '0' >"+this.labelTrue+" <span class='checkBadge4 icon'></span> </span><span id='qr-incorrect-"+idCounter+"' class='qr-incorrect' data-op = '1'>"+this.labelFalse+" <span class='checkBadge4 icon'></span> </span> </div><div style='clear:both;'></div></li>",this.nodes.push(node),idCounter++,startLi=!0,node=""):qOptions[i].type=="image"?node+='<img src="'+this.assetsPath+qOptions[i].data+'" />':node+=utils.renderNode(this.assetsPath,qOptions[i])}node.trim()!=""&&(node+="</div><div class='qr-answer binaryAns'><span id='qr-correct-"+idCounter+"' class='qr-correct' data-op = '0' >"+this.labelTrue+"<span class='checkBadge4 icon'></span></span><span id='qr-incorrect-"+idCounter+"' class='qr-incorrect' data-op = '1'>"+this.labelFalse+"<span class='checkBadge4 icon'></span> </span> </div><div style='clear:both;'></div></li>",this.nodes.push(node)),this.randomize(),$("#questionText",this.obj).html(qStr),qBody.length==0&&$("#questionText",this.obj).hide();var root=$(".mcq2",this.obj),options=$("input",root),len=options.length,minFontSize=14;for(var i=0;i<len;i++){var node=options[i],fsize=this.resizeText(node,minFontSize);minFontSize=fsize<minFontSize?fsize:minFontSize}for(var i=0;i<len;i++){var node=options[i];node.style.fontSize=minFontSize+"px"}this.enableInteraction();var loadedImageCount=0,imgArray=$("#activityContent img",this.obj),imgCount=imgArray.length,that=this;imgCount==0&&this.trigger(assessEvent.TEMPLATE_READY),_.each(imgArray,function(e){$(e).on("load",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.trigger(assessEvent.IMG_LOADED),that.trigger(assessEvent.TEMPLATE_READY))}),$(e).on("error",function(){loadedImageCount++,imgCount===loadedImageCount&&that.trigger(assessEvent.TEMPLATE_READY)})})},resizeText:function(e,t){var n=t;while(e.offsetWidth<e.scrollWidth)e.style.fontSize=--n+"px";return n},enableInteraction:function(){$("#questionOptions",this.obj).find("input").unbind(),$("#questionOptions",this.obj).find("li").unbind(),$("#questionOptions",this.obj).find("input").removeClass("disableOption"),$("#questionOptions",this.obj).find("li").removeClass("disableOption"),$(".dropdown",this.obj).unbind(),$("#questionOptions",this.obj).find("span").bind(assessEvent.CLICK,this.handleMcqBtnClick),$("#questionOptions",this.obj).find("input").bind(assessEvent.CLICK,this.handleMcqBtnClick),$("#questionOptions",this.obj).find(".qr-correct").removeAttr("disabled"),$("#questionOptions",this.obj).find(".qr-incorrect").removeAttr("disabled"),$("#questionText",this.obj).removeClass("disabled")},disableInteraction:function(){var e=$("#activityContent img",this.obj);$("#questionOptions",this.obj).find("input").addClass("disableOption"),$("#questionMedia img",this.screen).unbind(),$("#questionOptions",this.obj).find("li").addClass("disableOption"),$("#questionOptions",this.obj).find("input").unbind(),$("#questionOptions",this.obj).find("span").unbind(),$("#questionOptions",this.obj).find("li").unbind(),$("#questionOptions",this.obj).find(".qr-correct").unbind(),$("#questionOptions",this.obj).find(".qr-incorrect").unbind(),$(".dropdown",this.obj).unbind(),$("#questionText",this.obj).addClass("disabled"),$(e).off()},randomize:function(){if(this.responseType==""||this.responseType==AppConst.RESPONSE_TYPE_BINARY){var e="";this.opLayout=="2COL"?e="<div class='mcq4'><ul>":e="<div class='mcq2 trueFalse'><ul>";for(var t=0;t<this.nodes.length;t++)e+=this.nodes[t];e+="</ul></div>",$("#questionOptions",this.obj).html(e);var n=$("#questionOptions",this.obj).find("li").width();$("#questionOptions",this.obj).find(".tf-question").css("width",n-190+"px"),$("#questionOptions",this.obj).find(".tf-question img").css("vertical-align","middle"),$("#questionOptions",this.obj).find(".tf-question").css("vertical-align","middle"),$("#questionOptions",this.obj).find(".tf-question img").css("padding","3px"),$("#questionOptions",this.obj).find(".tf-question, .binaryAns").css("display","inline-block"),$("#questionOptions",this.obj).find(".binaryAns").css("position","relative")}},handleMcqBtnClick:function(e){if(this.itemClicked==1)return;this.itemClicked=!0,utils.log($(e.target),$(e.target.parentNode));if(this.answers)$(e.target.parentNode).find(".selected").removeClass("selected"),$(e.target).addClass("selected"),this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE;else{$(e.target).hasClass("selected")?$(e.target).removeClass("selected"):$(e.target).addClass("selected");var t=$("#questionOptions",this.obj).find(".selected")}var n=$("#questionOptions").find(".selected").length;this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),n==this.answers.length?this.trigger(assessEvent.Q_STATUS,AppConst.COMPLETE):n>0?this.trigger(assessEvent.Q_STATUS,AppConst.PARTIAL):this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT),_.delay(this.resetClickFlag,500)},resetClickFlag:function(){this.itemClicked=!1},handleEvaluate:function(e){if(e!=undefined&&$(e.target).hasClass("disabled"))return;this.userResponse=[];var t=this.answers.length,n=parseFloat(this.maxpoints/t),r=0;for(i=0;i<this.answers.length;i++){var s=$("#li"+(i+1),this.obj).find(".selected").attr("data-op");this.userResponse.push(""+s)}var o=0;for(var u=0;u<this.userResponse.length;u++)this.userResponse[u]==this.answers[u]?($("#li"+(u+1),this.screen).find(".selected").find(".checkBadge4").addClass("markRight"),$("#li"+(u+1),this.screen).find(".selected").addClass("focus-markright"),r+=n,o++):($("#li"+(u+1),this.screen).find(".selected").find(".checkBadge4").addClass("markWrong"),$("#li"+(u+1),this.screen).find(".selected").addClass("focus-markwrong"));this.partialAttempt||($("#questionOptions",this.obj).find(".checkBadge4").removeClass("markRight"),$("#questionOptions",this.obj).find(".checkBadge4").removeClass("markWrong")),this.partialAttempt==1||this.userResponse.length==t?o==this.answers.length?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.CORRECT,maxScore:this.maxpoints,type:this.type,responseType:this.responseType}):o>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.PARTIAL,maxScore:this.maxpoints,type:this.type,responseType:this.responseType}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:r,status:AppConst.INCORRECT,maxScore:this.maxpoints,type:this.type,responseType:this.responseType}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,type:this.type,responseType:this.responseType}),$("#questionOptions",this.obj).find("li").removeClass("selected"),this.EvaluateFlag=!0,this.lockQuestion()},lockQuestion:function(){this.correctAnswerVisible=!1,this.changeToolbar.mode=AppConst.TOOLBAR_LOCKED,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.disableInteraction()},populateAnswers:function(e,t){e.length>0&&(this.EvaluateFlag=!0);var n=$("#questionOptions",this.obj).find(".checkBadge4");$("#questionOptions",this.obj).find("input").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("input").removeClass("selected"),$("#questionOptions",this.obj).find("li").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("li").removeClass("selected"),$("#questionOptions",this.obj).find("span").removeClass("optionHighlight"),$("#questionOptions",this.obj).find("span").removeClass("selected"),$("#questionOptions",this.obj).find("span").removeClass("focus-markwrong"),$("#questionOptions",this.obj).find("span").removeClass("focus-markright"),t==0&&(n.removeClass("markWrong"),n.removeClass("markRight"));for(var r=0;r<e.length;r++)parseInt(e[r])==0?$("#qr-correct-"+(r+1),this.screen).addClass("selected"):parseInt(e[r])==1&&$("#qr-incorrect-"+(r+1),this.screen).addClass("selected"),e[r]==this.answers[r]?($("#li"+(r+1),this.screen).find(".selected").find(".checkBadge4").addClass("markRight"),$("#li"+(r+1),this.screen).find(".selected").addClass("focus-markright")):($("#li"+(r+1),this.screen).find(".selected").find(".checkBadge4").addClass("markWrong"),$("#li"+(r+1),this.screen).find(".selected").addClass("focus-markwrong"));if(t==0||this.isTest)$("#questionOptions",this.obj).find(".checkBadge4").removeClass("markRight"),$("#questionOptions",this.obj).find(".checkBadge4").removeClass("markWrong"),$("#questionOptions",this.obj).find("span").removeClass("focus-markwrong"),$("#questionOptions",this.obj).find("span").removeClass("focus-markright")},resetQuestion:function(e){var t=$("#questionOptions",this.obj).find(".checkBadge4");$("#questionOptions",this.obj).find(".selected").removeClass("selected"),$("#questionOptions",this.obj).find("input").removeClass("optionHighlight");var n=$("#questionOptions",this.obj).find("li");n.removeAttr("disabled"),n.css("opacity",1),t.removeClass("markRight"),t.removeClass("markWrong"),n.removeClass("optionHighlight"),this.randomize(),this.userResponse=[],this.EvaluateFlag=!1,this.enableInteraction(),this.trigger(assessEvent.MARK_EMPTY,this.qId),this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)},resetQuestionPartial:function(e){$("#questionOptions",this.obj).find(".checkBadge4").removeClass("markWrong"),$("#questionOptions",this.obj).find(".checkBadge4").removeClass("markRight"),$("#questionOptions",this.obj).find("li").removeClass("optionHighlight"),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);var t=!0;$("#questionOptions",this.obj).find(".selected").removeClass("selected"),$("#questionOptions",this.obj).find("li").removeAttr("disabled"),$("#questionOptions",this.obj).find("li").css("opacity",1);if(this.userResponse.length>0)for(var n=0;n<this.userResponse.length;n++)this.userResponse[n]==this.answers[n]?(this.userResponse[n]==0?$("#li"+(n+1),this.obj).find(".qr-correct").addClass("selected"):$("#li"+(n+1),this.obj).find(".qr-incorrect").addClass("selected"),t=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)):this.userResponse[n]=undefined;this.userResponse=[],this.EvaluateFlag=!1,this.correctAnswerVisible=!1,this.enableInteraction(),t==0?this.trigger(assessEvent.UPDATE_RESPONSE,this.qId,{userResponse:this.userResponse}):this.trigger(assessEvent.MARK_EMPTY,this.qId),this.disableButton(AppConst.QBTN_RESET)},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},handleScreenExit:function(){},orientationchange:function(e){},destroy:function(){this.unbind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.unbind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.unbind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.unbind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.unbind(assessEvent.MARK_EMPTY,this.markEmpty),this.unbind(assessEvent.UPDATE_RESPONSE,this.updateResponse),$("#questionOptions",this.obj).find("li").unbind(),$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.obj).remove(),this.disableInteraction()}});return mcqBinaryView}),define("com/es/widgets/assessment/model/mcqBinaryVO",[],function(){var e=Backbone.Model.extend({id:"",modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",maxpoints:null,heading:"",partialAttempt:!0,feedback:[],labelTrue:"",labelFalse:"",numberstyle:""});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/groupingTapPlace.html",[],function(){return"<div class='disableTemplate' id='quesWrapper<%=id%>'>\n    <div id='ques<%=id%>'  class='quesContent'>\n		<div id='activityContent'>\n        	<div id='questionHeading' class='questionHeading'></div>\n			<div id='questionMedia' class='left question-media'></div>\n			<div id='questionText' class='groupingText'></div>\n			<div id='questionOptionsCover'>\n            	<div id='questionOptions'></div>\n            </div>\n			<div id='labelanswers'></div>\n		</div>\n	</div>\n</div>"}),define("com/es/widgets/assessment/view/groupingTapPlace",["com/es/widgets/assessment/AssesmentLang","com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quesTypeTemplates/groupingTapPlace.html"],function(AssesmentLang,utils,AppConst,assessEvent,contentTpl){var groupingTapPlace=Backbone.View.extend({modelParagraph:"",type:"",qId:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",userResponse:"",itemClicked:!1,correctAnswerVisible:null,inputNo:0,EvaluateFlag:!1,changeToolbar:{},drags:[],drops:[],dragObjs:[],targetSelected:"",optionSelected:"",optionNode:"",templateOptionItem:"<div class='dropelement' id='drag<%=index+1%>'><span><%=option.data%></span></div>",resetClicked:!1,alphabets:[],colors:[],optionColor:"",optionBorderColor:"",maxpoints:0,partialAttempt:!0,optionScroll:null,quesScroll:null,title:"",assetsPath:"",blanksCount:"",groupsCount:"",initialize:function(){_.bindAll(this,"handleScreenExit","handleEvaluate","initScroll","onOptionSelected","onTargetSelected","resetClickFlag","addHoverClass"),_.extend(this,Backbone.Events)},render:function(){this.element=this.el;var e=_.template(contentTpl,this.model.toJSON());$("#"+this.model.get("uiId")+" #content",this.$el).QAappend(e),this.widgetId=$("#"+this.model.get("uiId"),this.$el),this.screen=$("#"+this.model.get("uiId")+" #ques"+this.model.get("id"),this.$el),this.setQuestionData()},setQuestionData:function(){this.modelParagraph=this.model.get("modelParagraph"),this.type=this.model.get("type"),this.layout=this.model.get("questionLayout"),this.responseType=this.model.get("responseType"),this.clues=this.model.get("clues"),this.rubric=this.model.get("rubric"),this.questionText=JSON.stringify(this.model.get("questionBody")),this.questionMedia=this.model.get("questionMedia"),this.optionsMedia=this.model.get("optionsMedia"),this.leftCol=this.model.get("leftCol"),this.rightCol=this.model.get("rightCol"),this.opLayout=this.model.get("optionsLayout"),this.options=this.model.get("options"),this.answers=this.model.get("answers"),this.isTest=this.model.get("isTest"),this.assetsPath=this.model.get("assetPath"),this.isReview=this.model.get("isReview"),this.reviewData=this.model.get(""),this.qId=this.model.get("id"),this.maxpoints=parseFloat(this.model.get("maxpoints")),this.model.get("userResponse").userResponse&&(this.userResponse=this.model.get("userResponse").userResponse),this.heading=this.model.get("heading"),this.inputNo=this.answers.length,this.partialAttempt=this.model.get("partialAttempt"),this.title=this.model.get("title"),this.alphabets=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],this.colors=["#f69a51","#46b6ed","#f57dc1","#a9c656","#e24c4c","#49b444","#a9e6f7"],this.bgColors=["#fef0e5","#e6f6fd","#ffecf7","#edf6e8","#fae8e8","#edf6e8","#f9ffe7"],this.blanksCount=this.model.get("blanksCount"),this.groupsCount=this.model.get("groupsCount"),this.renderQues()},initScroll:function(e){var t=($("#footer",this.widgetId).get(0).offsetTop-$("#content",this.widgetId).get(0).offsetTop)/2,n=$("#footer",this.widgetId).get(0).offsetTop-$("#content",this.widgetId).get(0).offsetTop-parseInt($("#questionText",this.obj).css("height"))-parseInt($("#questionMedia",this.obj).css("height"))-65;$("#questionOptionsCover",this.obj).css("position","relative"),$("#questionOptionsCover",this.obj).css("height",n+"px"),this.optionScroll!=null&&this.optionScroll.destroy(),this.optionScroll=new IScroll($("#questionOptionsCover",this.obj).get(0),{desktopCompatibility:!0,hScroll:!1,keyBindings:!0});var r=this;_.delay(function(){r.optionScroll.refresh()},999)},renderQues:function(){this.userResponse&&this.userResponse.length>0&&(this.EvaluateFlag=!0),this.drags=[],this.drops=[],this.dropObjs=[],this.dropSequence=[],this.droppedCount=0,this.layout=this.layout.toUpperCase();if(this.heading.length==0)$(".questionHeading",this.screen).hide();else{var headingStr="";for(var i=0;i<this.heading.length;i++)this.heading[i].type=="image"?headingStr+="<img src='"+this.assetsPath+this.heading[i].data+"'></img>":headingStr+="<div>"+this.heading[i].data+"</div>";$(".questionHeading",this.screen).html(headingStr)}if(this.questionMedia.length==0)$("#questionMedia",this.screen).hide();else{var qMediaStr="";for(var i=0;i<this.questionMedia.length;i++)qMediaStr+=utils.renderNode(this.assetsPath,this.questionMedia[i]);$("#questionMedia",this.screen).html(qMediaStr)}$("#questionMedia img",this.screen).bind(assessEvent.CLICK,function(){window.open($("#questionMedia img").data("url"))}),this.obj=this.screen;var qBody=eval(this.questionText),qOptions=eval(_.clone(this.options)),layoutClass="col-grouping-three";qOptions.length<=2&&(layoutClass="col-grouping-two");var qStr="<ul class='topsort'>",liCount=0,totalLength=Math.ceil(qBody.length/4)*4;for(var i=0;i<totalLength;i++){liCount++;if(qBody[i]!=undefined){qStr+="<li id='opt"+(i+1)+"' class='matchdrag ' >";for(var j=0;j<qBody[i].length;j++)qBody[i][j].type=="image"?qStr+="<div class='grouping-img'><img id='img"+(i+1)+"' class='' src='"+this.assetsPath+qBody[i][j].data+"'></img></div>":(qStr+="<span id='text"+(i+1)+"' class='optionsText'>"+qBody[i][j].data,qStr+="</span>");this.drags.push(""+(i+1)),qStr+="<span class='dragBand hide'></span></li>"}}qStr+="</ul>";var optionsStr="<div class='bottomsort'>";for(var i=0;i<qOptions.length;i++)optionsStr+="<div id='drop"+(i+1)+"' class='matchdrop' style='border:1px solid "+this.colors[i]+";background:"+this.bgColors[i]+";' ><span>"+qOptions[i].data+"</span>",optionsStr+="<span class='dropBand' style='display:none;border:1px solid "+this.colors[i]+";background-color:"+this.bgColors[i]+"' >"+this.alphabets[i]+"</span>",optionsStr+="</div>",this.drops.push("drop"+(i+1));optionsStr+="</div>",$("#questionText",this.obj).html(optionsStr),$("#questionText",this.obj).removeClass("left"),$("#questionOptions",this.obj).html(qStr);var ulList=$(".topsort",this.obj),liArr=ulList.find("li"),randomArr=_.shuffle(liArr);ulList.html(randomArr);var drops=$(".matchdrop",this.obj),len=drops.length,minFontSize=16;for(var i=0;i<len;i++){var node=drops[i];node.style.fontSize=minFontSize+"px"}var drags=$(".matchdrag",this.obj),len=drags.length,minFontSize=16;for(var i=0;i<len;i++){var node=drags[i];node.style.fontSize=minFontSize+"px"}var fontSize=this.resizeText(drops,.8);drops.find("span").css("font-size",fontSize+"em"),this.enableInteraction();var loadedImageCount=0,imgArray=$("#activityContent img",this.obj),imgCount=imgArray.length,that=this;imgCount==0&&this.trigger(assessEvent.TEMPLATE_READY),_.each(imgArray,function(e){$(e).on("load",function(){loadedImageCount++,imgCount===loadedImageCount&&(that.trigger(assessEvent.IMG_LOADED),that.trigger(assessEvent.TEMPLATE_READY))}),$(e).on("error",function(){loadedImageCount++,imgCount===loadedImageCount&&that.trigger(assessEvent.TEMPLATE_READY)})}),that.maxItemHeight&&(that.maxItemHeight=that.checkMaxHeight(qOptions,"drop"),$(".matchdrop",that.screen).css("height",that.maxItemHeight+"px"))},checkMaxHeight:function(e,t){var n=e.length,r=0;for(var i=0;i<n;i++){var s=$("#"+t+(i+1),this.screen).css("height");s=s.substr(0,s.length-2),s>r&&(r=s)}return r},resizeText:function(e,t){var n=t;for(var r=0;r<e.length;r++)e[r].offsetWidth<e[r].scrollWidth&&(n-=.1);return n},enableInteraction:function(){$(".matchdrag",this.obj).bind(assessEvent.CLICK,this.onTargetSelected),$(".matchdrop",this.obj).bind(assessEvent.CLICK,this.onOptionSelected),$(".matchdrag",this.obj).removeClass("disableTarget"),$(".matchdrop",this.obj).removeClass("disableOption"),$("#questionText",this.obj).removeClass("disabled")},disableInteraction:function(){var e=$("#activityContent img",this.obj);$(".matchdrag",this.obj).unbind(),$(".matchdrop",this.obj).unbind(),$(".matchdrag",this.obj).addClass("disableTarget"),$(".matchdrop",this.obj).addClass("disableOption"),$("#questionText",this.obj).addClass("disabled"),$("#questionMedia img",this.screen).unbind(),e.off()},onOptionSelected:function(e){if(this.itemClicked==1)return;$("#questionText",this.obj).find(".optionSelected").css("color","#000"),$("#questionText",this.obj).find(".optionSelected").removeClass("optionSelected"),node=e.target,node.nodeName.toLowerCase()=="span"&&(node=node.parentNode),node.nodeName.toLowerCase()=="p"&&(node=node.parentNode.parentNode),this.itemClicked=!0,this.optionNode=node.id;var t=parseInt(node.id.split("drop")[1]);this.optionSelected=this.alphabets[t-1],this.optionColor=$(node).find(".dropBand").css("background-color"),this.optionBorderColor=$(node).find(".dropBand").get(0).style.border;var n=this;$("#"+this.optionNode,this.obj).addClass("optionSelected"),$("#"+this.optionNode,this.obj).css("background-color",this.optionColor),_.delay(function(){n.addHoverClass(n.optionNode)},300),_.delay(n.resetClickFlag,500)},onTargetSelected:function(e){if(this.itemClicked==1)return;$("#questionOptions",this.obj).find(".optionSelected").removeClass("optionSelected"),node=e.target;if(node.nodeName.toLowerCase()=="div"||node.nodeName.toLowerCase()=="span"||node.nodeName.toLowerCase()=="img")node=node.parentNode;this.itemClicked=!0,this.targetSelected=node.id;var t=this;this.optionSelected||$("#"+this.targetSelected,this.obj).addClass("optionSelected"),$("#"+this.targetSelected,this.obj).find(".optionsText").addClass("optionSelected"),_.delay(function(){t.addHoverClass(t.targetSelected)},300),_.delay(this.resetClickFlag,500)},addHoverClass:function(e){this.checkAndFillValue()},resetClickFlag:function(){this.itemClicked=!1},checkAndFillValue:function(){if(this.optionSelected!=""&&this.targetSelected!=""){$("#"+this.targetSelected,this.obj).get(0).setAttribute("data-group",this.optionSelected),$("#"+this.targetSelected,this.obj).css({"background-color":this.optionColor,border:this.optionBorderColor}),badge=$("#"+this.targetSelected,this.obj).find(".dragBand"),badge.html(this.optionSelected),$(".matchdrop",this.obj).removeClass("optionSelected"),$("#"+this.targetSelected,this.obj).removeClass("optionHighlight"),$("#"+this.targetSelected,this.obj).find(".optionsText").removeClass("optionSelected"),this.optionSelected=this.targetSelected=this.optionNode="",this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);var e=0;for(var t=0;t<this.drags.length;t++)dragLabel=$("#opt"+this.drags[t],this.obj).find(".dragBand").html(),dragLabel!=""&&e++;e==this.drags.length?this.trigger(assessEvent.Q_STATUS,AppConst.COMPLETE):e>0?this.trigger(assessEvent.Q_STATUS,AppConst.PARTIAL):this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT)}},handleEvaluate:function(e){if(e!=undefined&&$(e.target).hasClass("disabled"))return;this.EvaluateFlag=!0;var correctAnswerLabels=[],binLabels=[];this.userResponse=[];var myanswerIndex=0,totalCorrect=0;this.answers=_.flatten(this.answers),utils.log("answers",this.answers),$("#questionText",this.obj).find(".optionSelected").css("background-color","#fff"),$("#questionText",this.obj).find(".optionSelected").css("color","#000"),$(".indicators",this.obj).removeClass("optionSelected"),$(".optionText",this.obj).removeClass("optionSelected"),$(".matchdrag",this.obj).removeClass("markRight2"),$(".matchdrag",this.obj).removeClass("markWrong2");var qOptions=eval(_.clone(this.options));utils.log("qOptions",qOptions);var markPerQ=parseFloat(this.maxpoints/this.drags.length),marksQbtained=0;for(var i=0;i<qOptions.length;i++)binLabels.push(this.alphabets[i]);for(var i=0;i<this.drags.length;i++)utils.log("#opt"+this.drags[i]),dragLabel=$("#opt"+this.drags[i],this.obj).find(".dragBand").html(),dragLabelIndex=binLabels.indexOf(dragLabel)+1,utils.log("dragLabelIndex",dragLabelIndex),this.userResponse.push(dragLabelIndex),dragLabelIndex==this.answers[i]?($("#opt"+(i+1),this.obj).addClass("markRight2"),marksQbtained+=markPerQ,totalCorrect++):$("#opt"+(i+1),this.obj).addClass("markWrong2");this.partialAttempt||($(".matchDrag",this.obj).removeClass("markRight2"),$(".matchDrag",this.obj).removeClass("markWrong2"));var attemtedInputs=_.without(this.userResponse,0).length;this.partialAttempt==1||attemtedInputs==this.drags.length?totalCorrect==this.drags.length?this.trigger(assessEvent.MARK_CORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.CORRECT,maxScore:this.maxpoints,title:this.title,type:this.type,blanksCount:this.blanksCount,groupsCount:this.groupsCount,responseType:this.responseType}):totalCorrect>0?this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.PARTIAL,maxScore:this.maxpoints,title:this.title,type:this.type,blanksCount:this.blanksCount,groupsCount:this.groupsCount,responseType:this.responseType}):this.trigger(assessEvent.MARK_INCORRECT,this.qId,{userResponse:this.userResponse,score:marksQbtained,status:AppConst.INCORRECT,maxScore:this.maxpoints,title:this.title,type:this.type,blanksCount:this.blanksCount,groupsCount:this.groupsCount,responseType:this.responseType}):this.trigger(assessEvent.MARK_ANSWER,this.qId,{userResponse:this.userResponse,maxScore:this.maxpoints,title:this.title,type:this.type,blanksCount:this.blanksCount,groupsCount:this.groupsCount,responseType:this.responseType}),this.isReset=!1,this.lockQuestion()},lockQuestion:function(){this.correctAnswerVisible=!1,this.changeToolbar.mode=AppConst.TOOLBAR_LOCKED,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.disableInteraction()},populateAnswers:function(answers,correctAnswerVisible){if(this.isReset&&this.isTest&&!this.isReview)return;try{answers.length>0&&(this.EvaluateFlag=!0),$(".matchdrag",this.obj).unbind();var qBody=eval(this.questionText);$("#questionOptions",this.obj).find(".dragBand").html(""),this.answers=_.flatten(this.answers);if(answers.length>0)for(var i=0;i<answers.length;i++){if(answers[i]!=0){var dragDataGroup=$("#drop"+answers[i],this.obj).find("span").html();utils.log("dragDataGroup : "+dragDataGroup),$("#opt"+this.drags[i],this.obj).get(0).setAttribute("data-group",dragDataGroup),$("#opt"+this.drags[i],this.obj).find(".dragBand").html(this.alphabets[answers[i]-1]),$("#opt"+this.drags[i],this.obj).css({"background-color":this.bgColors[answers[i]-1],border:"1px solid "+this.colors[answers[i]-1]})}else $("#opt"+this.drags[i],this.obj).get(0).setAttribute("data-group",""),$("#opt"+this.drags[i],this.obj).find(".dragBand").html(""),$("#opt"+this.drags[i],this.obj).css("background-color","white"),$("#opt"+this.drags[i],this.obj).find(".optionsText").css("color","#8A8A8A");this.resetFlag!=1&&correctAnswerVisible!=0?answers[i]==this.answers[i]?$("#opt"+(i+1),this.obj).addClass("markRight2"):$("#opt"+(i+1),this.obj).addClass("markWrong2"):(utils.log("else case"),$("#opt"+(i+1),this.obj).removeClass("markRight2"),$("#opt"+(i+1),this.obj).removeClass("markWrong2"))}else $(".dragBand",this.obj).find(".dragBand").html(""),$(".matchDrag",this.obj).css("background-color","white"),$(".optionsText",this.obj).css("color","#8A8A8A");(this.isTest||this.partialAttempt==0)&&!this.isReview&&($(".matchdrag",this.obj).removeClass("markRight2"),$(".matchdrag",this.obj).removeClass("markWrong2")),this.resetFlag=!1,!this.isReview&&answers.length<=0&&this.enableInteraction()}catch(error){console.log(error)}},resetQuestion:function(e){this.isReset=!0,this.resetClicked=!0,$("#questionText",this.obj).html(""),$("#questionOptions",this.obj).html(""),this.userResponse=[],this.renderQues(),this.enableInteraction(),this.trigger(assessEvent.MARK_EMPTY,this.qId),this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar),this.EvaluateFlag=!1,this.optionSelected="",this.targetSelected="",$(".matchdrag",this.obj).removeClass("optionSelected"),this.trigger(assessEvent.Q_STATUS,AppConst.NO_ATTEMPT)},resetQuestionPartial:function(e){this.changeToolbar.mode=AppConst.TOOLBAR_DEFAULT,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar);var t=!0;if(this.userResponse.length>0)for(var n=0;n<this.userResponse.length;n++)this.userResponse[n]==this.answers[n]?(t=!1,this.changeToolbar.mode=AppConst.TOOLBAR_ACTIVE,this.trigger(assessEvent.ANSWER_MARKED,this.changeToolbar)):(this.userResponse[n]=0,$("#opt"+this.drags[n],this.obj).removeAttr("background-color"),$("#opt"+this.drags[n],this.obj).find(".optionsText").removeAttr("color"),$("#opt"+this.drags[n],this.obj).get(0).setAttribute("data-group",""),$("#opt"+this.drags[n],this.obj).get(0).setAttribute("data-group",""),$("#opt"+this.drags[n],this.obj).find(".dragBand").html(""));this.EvaluateFlag=!1,this.resetFlag=!0,this.optionSelected="",this.targetSelected="",this.populateAnswers(this.userResponse,!0),this.enableInteraction(),t==0?this.trigger(assessEvent.UPDATE_RESPONSE,this.qId,{userResponse:this.userResponse}):this.trigger(assessEvent.MARK_EMPTY,this.qId),this.disableButton(AppConst.QBTN_RESET)},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},handleScreenExit:function(){this.iScroll!=null&&this.iScroll.destroy(),this.optionScroll!=null&&this.optionScroll.destroy(),this.quesScroll!=null&&this.quesScroll.destroy()},orientationchange:function(e){},destroy:function(){this.unbind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.unbind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.unbind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.unbind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.unbind(assessEvent.MARK_EMPTY,this.markEmpty),this.unbind(assessEvent.UPDATE_RESPONSE,this.updateResponse),$("#questionOptions",this.obj).find("li").unbind(),$("#ques"+this.model.get("id")).remove(),this.disableInteraction()}});return groupingTapPlace}),define("com/es/widgets/assessment/model/groupingTapPlaceVO",[],function(){var e=Backbone.Model.extend({id:"",modelParagraph:"",type:"",layout:"",responseType:"",clues:"",rubric:"",questionText:"",questionMedia:"",optionsMedia:"",leftCol:"",rightCol:"",opLayout:"",options:"",answers:"",isTest:"",isReview:"",reviewData:"",heading:"",userResponse:"",partialAttempt:!0,feedback:[]});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/resultScreenView/templateContent.html",[],function(){return"<div id='resultsScreen' class='screen'>\n    <div id='header' class='result-grid-head'>\n        <!--LEFT BTN-->\n        <div id='header-left' style='display: <%=leftVisible%>' class='header-left-btn'>\n            <div class='<%=leftBtnClass%>'>\n                <span id='backBtn' class='btn'><%=AssesmentLang.BACK_BUTTON_LABEL%></span>\n                <span><%=AssesmentLang.QUIT_RESULTS_LABEL%></span>\n            </div>\n        </div>\n        <!--TITLE-->\n        <!--h1 style='display: <%=titleVisible%>'><%=title%></h1-->\n        <!--RIGHT BTN-->\n        <div class='header-right-btn resourceBtn'>\n            <div class='<%=rightBtnClass%>'>\n                <div>\n                    <span></span>\n                </div>\n                <p><%=rightLabel%></p>\n            </div>\n        </div>\n    </div>\n    <div id='resultsContentCover'>\n        <div id='resultsContent'></div>\n    </div>\n    <!--div class='footerbar'>\n		<span id='backBtn'>Back</span>\n		<span id='resourceBtn'>Useful Resources</span>\n	</div-->\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/resultScreenView/resultsTemplate.html",[],function(){return'<div class="qinfo">\n    <span id="usernameSpan"><%=AssesmentLang.QUIT_RESULTS_LABEL%></span>\n</div>\n<div class="progressdiv">\n    <span  id="testScore" class="score">\n        <span class="type"><%=AssesmentLang.QUIT_RESULTS_LABEL%></span>\n        <span class="title"><%=AssesmentLang.RESULT_TYPE_LABEL%></span>\n        <span class="taken"><%=AssesmentLang.RESULT_TAKEN_LABEL%></span>\n        <span class="attempt"><%=AssesmentLang.RESULT_ATTEMPT_LABEL%></span>\n        <span class="score"><%=AssesmentLang.RESULT_SCORE_LABEL%></span>\n        <span class="actions"><%=AssesmentLang.RESULT_ACTION_LABEL%></span>\n    </span>\n</div>\n<div id= "detailedProgressCover">\n    <div id= "detailedProgress" class="resques"></div>\n</div>'}),define("com/es/widgets/assessment/view/resultScreen",["com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/resultScreenView/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/resultScreenView/resultsTemplate.html"],function(e,t,n,r,i){var s=Backbone.View.extend({curObj:this,screen:null,headerClass:"homehead",screenClass:"",leftBtnClass:"",resultData:[],iScroll:null,selectedFeedback:null,resourceButton:null,initialize:function(){_.bindAll(this,"handleReviewClick","handleBackClick","destroy")},render:function(){this.generateResults()},generateResults:function(){this.resultData=this.model.get("resultData");var n=this.model.get("testFeedbackData"),s=this.model.get("testMarkScheme");this.$el.QAappend(_.template(r,this.model.toJSON())),e.log("el === ",this.$el),this.screen=this.el,e.log("result screen ",$(this.screen));var o=_.template(i,this.model.toJSON());$("#resultsContent",this.screen).html(o),$("#header",this.screen).hide(),t.username!=""&&t.username!=undefined&&$("#usernameSpan",this.screen).html(WidgetLang.TEST_RESULTS_FOR_LABEL+t.username);var u=0,a=0,f="<ul>";for(var l=0;l<this.resultData.length;l++){var c=this.resultData[l].score;c==undefined?c=0:c=parseFloat(parseFloat(c).toFixed(1));var h=parseFloat(parseFloat(this.resultData[l].maxScore).toFixed(1)),p=this.resultData[l].questionData,d=this.resultData[l].title!=undefined?this.resultData[l].title:"Default title";f+='<li class="progress-text">',f+='<span class="type">Quiz</span>',f+='<span class="title">'+d+"</span>",f+='<span class="taken">27.03.14</span>',f+='<span class="attempt">1st</span>',f+='<span class="score">'+c+"/"+h+"</span>",f+='<span class="actions">Try Again</span>',f+="</li>"}f+="<br/><br/><br/>",f+="</ul>",$("#detailedProgress",this.screen).html(f)},getQuestionTitle:function(n){return n.type==t.QUESTION_TYPE_MCQ&&n.responseType=="BUTTON"?n.questionBody[0].type!="image"?(title=n.questionBody[0].data!=""?n.questionBody[0].data:n.rubric[0].data,title=title!=""?title:n.title):title=n.rubric[0].data!=""?n.rubric[0].data:n.title:n.type==t.QUESTION_TYPE_MCQ&&n.responseType==t.RESPONSE_TYPE_BINARY?n.options[0].type!="image"?(title=n.options[0].data!=""?n.options[0].data:n.rubric[0].data,title=title!=""?title:n.title):title=n.rubric[0].data!=""?n.rubric[0].data:n.title:title=n.rubric[0].data!=""?n.rubric[0].data:n.title,e.handleEscapeSequence(title)},initScroll:function(){var e=$("#resultsScreen").get(0).clientHeight-$("#header").get(0).clientHeight-$(".qinfo").get(0).clientHeight-$(".progressdiv").get(0).clientHeight;$("#testFeedbackContainer").css("height",e+"px"),$("#testFeedbackContainer").css("overflow","hidden"),$("#testFeedbackContainer").css("position","relative"),this.iScroll!=null&&this.iScroll.destroy(),this.iScroll=new IScroll($("#testFeedbackContainer").get(0),{desktopCompatibility:!0,hScroll:!0,keyBindings:!0}),ths=this,_.delay(function(){ths.iScroll.refresh()},999)},handleBackClick:function(e){this.trigger("reviewTest")},handleReviewClick:function(e){if(this.iScroll.moved)return;var t=e.target;t.className!="review-outer"&&(t=t.parentNode);var r=t.id.split("review")[1];this.iScroll!=null&&this.iScroll.destroy(),Backbone.Events.trigger(n.REVIEW_QUESTION,r.toString())},destroy:function(){this.iScroll!=null&&this.iScroll.destroy(),$(".feedback-outer",this.screen).unbind(),$(".review-outer",this.screen).unbind(),this.resourceButton.unbind(),$(".header-right-btn",this.screen).unbind(),$(".header-left-btn",this.screen).unbind(),$("#"+t.RESULT_SCREEN,this.screen).unbind(),$("#"+t.RESULT_SCREEN,this.screen).remove(),this.screen.remove(),this.screen=null,this.off()}});return s}),define("com/es/widgets/assessment/model/resultScreenVO",[],function(e,t){var n=Backbone.Model.extend({initialize:function(){this.set({myId:"",leftLabel:"",title:"",rightLabel:"",leftBtnClass:"",rightBtnClass:"",content:"",headerVisible:"block",leftVisible:"block",titleVisible:"block",rightVisible:"block",questionIds:[],resultData:[],testFeedbackData:[],colorCode:"",testMarkScheme:[]})},toString:function(){return e.RESULT_SCREEN}});return n}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/welcomeScreenView/templateContent.html",[],function(){return'<div id="splashScreen" class="clearfix splashScreen">\n    <div id="container-div"  style="overflow: auto;">\n        <div class="l-column">\n            <div class="splash-title">\n                <%=testTitle%>\n            </div>\n            <h5><%=AssesmentLang.ATTEMPTS_LABEL%></h5>\n            <ul id="prevAttemptContainer" style="list-style: none;">\n                \n            </ul>\n        </div>\n        <div class="r-column">\n            <div class="quiz-instruction"><%=AssesmentLang.WELCOME_SCREEN_INSTRUCTION_TITLE%></div>\n           <%=AssesmentLang.WELCOME_SCREEN_INSTRUCTION_MESSAGE%>\n            <span id="startTest"  class="btn splashScreen-btn"><%=AssesmentLang.WELCOME_SCREEN_START_BUTTON%></span>\n        </div>\n    </div>\n</div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/welcomeScreenView/prevAttemptTemplate.html",[],function(){return'<% _.each(objArr, function(obj, index) { %>\n    <li>\n        <div class="quiz-box-pattern">\n            <%\n                var countStr = "Last "+ (objArr.length - index);\n            %>\n            <div class="quiz-attempt">\n                <span class="quiz-attempt-score"> <%=countStr%> <%=parseFloat(parseFloat(obj.score).toFixed(1))%>/<%=parseFloat(parseFloat(obj.maxScore).toFixed(1))%> </span>\n                <%\n                        var per = parseFloat((obj.score/obj.maxScore)*100), grade;\n                        if(per < 33.33){\n                            grade = "R";\n                        }else if(per < 66.66){\n                            grade = "A";\n                        }else{\n                            grade = "G";\n                        }\n                %>\n                <span class="<%=grade%>-pattern"><%=grade%></span>\n            </div>\n            <div class="result-progress">\n                <span class="result-arrow" style="left: <%=per%>%;"></span>\n                <span class="progress-thumb"></span>\n            </div>\n        </div>\n    </li>\n<% }); %>'}),define("com/es/widgets/assessment/view/welcomeScreenView",["com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/welcomeScreenView/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/welcomeScreenView/prevAttemptTemplate.html"],function(e,t,n,r,i){var s=Backbone.View.extend({iScroll:null,_widget:null,_prevAttemptsArr:[],initialize:function(){_.bindAll(this,"handleStartTest","updatePreviousResponse","initScroll")},render:function(e){var t=_.template(r);this.screen=this.el;var i=this;_widget=$("#"+this.model.get("uiId")+" #assessment-container",this.$el),$(_widget).html(t(this.model.toJSON()));var s={testId:this.model.get("testId"),maxAttempts:3,callbkFn:this.updatePreviousResponse};this.trigger(WIDGET_EVENTS.FETCH_PREVIUOUS_ATTEMPTS,s),$("#startTest",this.screen).bind(n.CLICK,this.handleStartTest),_.delay(function(){i.initScroll(),i.trigger(n.TEMPLATE_READY)},999)},initScroll:function(){var e=this;this.iScroll!=null&&this.iScroll.destroy(),this.iScroll=new IScroll($("#splashScreen").get(0),{desktopCompatibility:!0,vScroll:!0,keyBindings:!0}),_.delay(function(){e.iScroll.refresh()},999)},handleStartTest:function(){this.iScroll!=null&&this.iScroll.destroy(),this.trigger(WIDGET_EVENTS.START_TEST_CLICK,this.el,this._prevAttemptsArr,this.destroy)},updatePreviousResponse:function(e){this._prevAttemptsArr=e.result;if(this._prevAttemptsArr.length>0){var t=_.template(i,{objArr:e.result});$("#prevAttemptContainer",this.screen).html(t)}else $("#prevAttemptContainer",this.screen).html(WidgetLang.NO_PREVIOUS_ATTEMPT)},destroy:function(){this._prevAttemptsArr=[],$("#splashScreen").remove(),$("#splashScreen").unbind(),$("#startTest",this.screen).unbind()}});return s}),define("com/es/widgets/assessment/model/welcomeScreenVO",[],function(){var e=Backbone.Model.extend({defaults:function(){return{testId:"",testTitle:""}}});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizFinishScreenView/templateContent.html",[],function(){return'<div id="quizFinishScreen" class="clearfix splashScreen">\n	<div id="container" class="quizFinishContainer">\n        <h5><%=AssesmentLang.QUIT_RESULTS_LABEL%></h5>\n        <h2><%=title%></h2>\n        <h5><%=AssesmentLang.ATTEMPTS_LABEL%></h5>\n        <ul id="prevAttemptContainer" style="list-style: none;width:50%;">\n            \n        </ul>\n        <span id="tryAgainBtn"  class="btn splashScreen-btn"> <%=AssesmentLang.TRY_AGAIN_LABEL%> </span>\n        <span id="finishedTest"  class="btn splashScreen-btn"> <%=AssesmentLang.FINISH_LABEL%> </span>\n	</div>\n</div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizFinishScreenView/prevAttemptTemplate.html",[],function(){return'<% _.each(objArr, function(obj, index) { %>\n    <li>\n        <div class="quiz-box-pattern">\n            <%\n                var countStr = "Last "+ (objArr.length - index);\n            %>\n            <div class="quiz-attempt">\n                <span class="quiz-attempt-score"> <%=countStr%> <%=parseFloat(parseFloat(obj.score).toFixed(1))%>/<%=parseFloat(parseFloat(obj.maxScore).toFixed(1))%> </span>\n                <%\n                        var per = parseFloat((obj.score/obj.maxScore)*100), grade;\n                        if(per < 33.33){\n                            grade = "R";\n                        }else if(per < 66.66){\n                            grade = "A";\n                        }else{\n                            grade = "G";\n                        }\n                %>\n                <span class="<%=grade%>-pattern"><%=grade%></span>\n            </div>\n            <div class="result-progress">\n                <span class="result-arrow" style="left: <%=per%>%;"></span>\n                <span class="progress-thumb"></span>\n            </div>\n        </div>\n    </li>\n<% }); %>'}),define("com/es/widgets/assessment/view/quizFinishScreen",["com/es/widgets/assessment/utilities","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizFinishScreenView/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizFinishScreenView/prevAttemptTemplate.html"],function(e,t,n,r,i){var s=Backbone.View.extend({iScroll:null,initialize:function(){_.bindAll(this,"handleFinishedTest","handleTryAgain","initScroll")},render:function(e){this.screen=this.el;var t=this,s=_.template(r);$(this.el).html(s(this.model.toJSON()));var o=_.template(i,{objArr:this.model.get("attemptsArr")});$("#prevAttemptContainer",this.screen).html(o),$("#finishedTest",this.screen).bind(n.CLICK,this.handleFinishedTest),$("#tryAgainBtn",this.screen).bind(n.CLICK,this.handleTryAgain),_.delay(function(){t.initScroll(),t.trigger(n.TEMPLATE_READY)},999)},initScroll:function(){var e=this;this.iScroll!=null&&this.iScroll.destroy(),this.iScroll=new IScroll($("#quizFinishScreen").get(0),{desktopCompatibility:!0,vScroll:!0,keyBindings:!0}),_.delay(function(){e.iScroll.refresh()},999)},handleFinishedTest:function(){this.trigger(WIDGET_EVENTS.TEST_FINISH_CLICK)},handleTryAgain:function(){this.trigger(WIDGET_EVENTS.TEST_TRY_AGAIN_CLICK)},destroy:function(){$("#quizFinishScreen").unbind(),$("#finishedTest",this.screen).unbind(),$("#tryAgainBtn",this.screen).unbind(),$("#quizFinishScreen").remove()}});return s}),define("com/es/widgets/assessment/model/quizFinishScreenVO",[],function(){var e=Backbone.Model.extend({defaults:function(){return{title:"",attemptsArr:""}}});return e}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/inlineViewTemplate.html",[],function(){return"<div class='ui-assessment-widget widget-ui ui-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div id='assessment-container'> </div>\r\n	<div class='inline-widget-footer'>\r\n		<div class='ui-assessment-icon icon icon-ic-assessment'></div>\r\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n		<!--<div class='ui-maximize ui-right-div'></div>-->\r\n        <div class=\"ui-maximize ui-right-div-control icon icon-ic-fullscreen\"></div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/popupViewTemplate.html",[],function(){return"<div class='ui-assessment-widget' id='<%=uiId%>'>\n	<div id='assessment-container'> </div>\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='print-widget-header'>\r\n		<div class='ui-assessment-icon icon icon-ic-assessment'></div>\r\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n	</div>\r\n	<div id='assessment-container'>\r\n		<div id='content' class='content'></div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/questionPlayer/templateHeader.html",[],function(){return"<div id='<%=myId%>' class='screen question-player'>\n	<!--header-->\n	<div id='header' class='head' style='display: <%=headerVisible%>;background-color: <%=colorCode%>'>\n		<!--LEFT BTN-->\n	 	<div id='header-left' style='display: <%=leftVisible%>' class='header-left-btn <%=leftBtnClass%>'>\n            <span><%=leftLabel%></span>\n		</div>\n		<!--TITLE-->\n		<h1 style='display: <%=titleVisible%>'><%=title%></h1>\n		<!--RIGHT BTN-->\n		<div class='header-right-btn' style='display: <%=rightVisible%>'>\n			<div class='<%=rightBtnClass%>'>\n				<div>\n					<span></span>\n				</div>\n                <p><%=rightLabel%></p>\n			</div>\n		</div>\n	</div>\n	<div class='qinfo phone' id='info' style='background-color: <%=colorCode%>'>\n		<span class='qposition'></span>\n		<div class='infoButton'></div>\n		<span class='qtime'></span>\n		<div class='qMapWrapper'><div class='qMap'></div></div>\n	</div>\n	<div class='qinstructions' id='inst'>\n        <span class='instructionTitle instruction-title closed'><%=AssesmentLang.QUESTION_INSTRUCTION%></span>\n        <span class='instructionContent instruction-content'></span>\n        <div id='instructionsWrapper'><img/></div>\n    </div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/questionPlayer/templateContent.html",[],function(){return"<div id='content' class='content'></div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/questionPlayer/templateFooter.html",[],function(){return"	<div id='footer' style='background-color: <%=colorCode%>' class='footer-assessment-widget'>\r\n		<div id='assessmentBtnsContainer' class=\"footer-assesment-btn-widget\">\r\n        	<div class=\"assessment-btns\">\r\n                <div id='resetQBtn' class='footer_ico reset-btn-icon'  style='display:inline-block;'>\r\n\r\n                   <!-- <%=AssesmentLang.RESET_BTN_LABEL%>-->\r\n                </div>\r\n                <div id='answersBtn' class='footer_ico myAnswers'  style='display:inline-block;margin: 0 5px;  left: 5px'>\r\n                    <!--%=AssesmentLang.ANSWER_BTN_LABEL%-->\r\n                </div>\r\n                <div id='evaluateBtn' class='footer_ico evaluate-btn-icon'  style='left:5px;display:inline-block;margin: 0 5px;  left: 5px'>\r\n                    <!--<%=AssesmentLang.EVALUATE_BTN_LABEL%>-->\r\n                </div>\r\n                <div class='action-buttons-outer'>\r\n                    <span id='ReportBtn' class='reportButton report-btn'><label><%=AssesmentLang.SUBMIT_LABEL%></label></span>\r\n                </div>\r\n            </div>\r\n        	<div class=\"prev-next-wid-pagination\">\r\n                <span id='prevQBtn' class='footer_ico'></span>\r\n                <span id='qMapDesktop' class='footer_ico arrow-wid-pagination'></span>\r\n                <span id='nextQBtn' class='footer_ico'></span>\r\n                <div class='qinfo desktop pagination-info' id='info' style='background-color: <%=colorCode%>'>\r\n                    <div class='infoButton'></div>\r\n                    <span class='qposition'></span>\r\n            	</div>\r\n            </div>\r\n            <div class=\"assessment-submit-btn\" style='display:none;'>\r\n            	<button type=\"submit\" class=\"blue-submit-btn\">Submit</button>\r\n            </div>\r\n		</div>\r\n		\r\n\r\n		<div id='reviewBtnsContainer' style='display:none;'>\r\n			<span id='prevQBtn' class='footer_ico'><%=AssesmentLang.PREVIOUS_LABEL%></span>\r\n			<span id='qMapDesktop' class='footer_ico'></span>\r\n			<span id='correctAnsBtn' class='review_ico'><%=AssesmentLang.CORRECT_ANSWER_BTN_LABEL%></span>\r\n			<span id='userAnsBtn' class='review_ico'><%=AssesmentLang.USER_ANSWER_BTN_LABEL%></span>\r\n			<span id='feedbackBtn' class='footer_ico'><%=AssesmentLang.FEEDBACK%></span>\r\n			<span id='nextQBtn' class='footer_ico'><%=AssesmentLang.NEXT_LABEL%></span>\r\n			<span id='ReportBtn' class='reportButton report-btn'><label><%=AssesmentLang.SUBMIT_LABEL%></label></span>\r\n		</div>\r\n	</div>\r\n	<!--<div class='inline-widget-footer'> \r\n		<div class='ui-assessment-icon'></div>\r\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n		<div class='ui-maximize ui-right-div'></div>\r\n	</div>-->\r\n	<!--div class='questionPopup'>\r\n		<div class='questionPopupBox arrowEvaluate'>\r\n			<img src='interface/wrongAnswer.png' /><img src='interface/correctAnswer.png' />\r\n			<br />Oh, answer?\r\n		</div>\r\n		<div class='questionPopupArrow'></div>\r\n	</div>\r\n	<div class='instructionPopup'>\r\n		<div class='instructionPopupBox'>\r\n			<img src='<%=AssesmentLang.QUESTION_INSTRUCTION_IMAGE%>' />\r\n		</div>\r\n	</div-->\r\n	<div id='instructionsWrapper'></div>\r\n	<div class='resetOverlay'>\r\n		<div id='confirmload' class='hide resetPopup'>\r\n			<div id='confirm'>\r\n				<div id='title'></div>\r\n				<div id='message'></div>\r\n				<div id= 'buttons' class = 'button'>\r\n					<input id='p_reset' type='button'  value= '<%=AssesmentLang.RESET_ONLY_INCORRECT_ANSWERS%>' /><br />\r\n					<input id='c_reset' type='button'  value= '<%=AssesmentLang.RESET_THE_WHOLE_QUESTION%>' /><br />\r\n				</div>\r\n				<input type='checkbox' id='RemReset' value='0' /> <%=AssesmentLang.REMEMBER_MY_PREFERENCE%><br /><br />\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div id='navigatorOverlay'>\r\n		<div id='navigatorWrapper'>\r\n			<div class='navigator hidden'>\r\n				<span id='closeQMap' class='closeBtn'></span>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>"}),define("com/es/widgets/assessment/view/assesmentWidget",["com/external/jquery.carouFredSel-6.2.1","com/es/widgets/assessment/AssesmentLang","com/es/widgets/assessment/utilities","com/es/widgets/WidgetUtils","com/es/widgets/assessment/AppConst","com/es/widgets/assessment/assessEvent","com/es/widgets/assessment/model/assessmentWidgetVO","com/es/widgets/assessment/model/mcqVO","com/es/widgets/assessment/view/mcqView","com/es/widgets/assessment/model/matchSortVO","com/es/widgets/assessment/view/matchSortView","com/es/widgets/assessment/view/fibView","com/es/widgets/assessment/model/fibVO","com/es/widgets/assessment/view/fibDropDown","com/es/widgets/assessment/model/fibDropDownVO","com/es/widgets/assessment/view/fibTapPlace","com/es/widgets/assessment/model/fibTapPlaceVO","com/es/widgets/assessment/view/mcqBinary","com/es/widgets/assessment/model/mcqBinaryVO","com/es/widgets/assessment/view/groupingTapPlace","com/es/widgets/assessment/model/groupingTapPlaceVO","com/es/widgets/assessment/view/resultScreen","com/es/widgets/assessment/model/resultScreenVO","com/es/widgets/assessment/view/welcomeScreenView","com/es/widgets/assessment/model/welcomeScreenVO","com/es/widgets/assessment/view/quizFinishScreen","com/es/widgets/assessment/model/quizFinishScreenVO","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/quizView/printViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/questionPlayer/templateHeader.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/questionPlayer/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/assessmentView/questionPlayer/templateFooter.html"],function(carousel,AssesmentLang,utils,widgetUtils,AppConst,assessEvent,assessmentVO,mcqVO,mcqView,matchSortVO,matchSortView,fibView,fibVO,fibDropDown,fibDropDownVO,fibTapPlace,fibTapPlaceVO,mcqBinaryView,mcqBinaryVO,groupingTapPlace,groupingTapPlaceVO,resultScreen,resultScreenVO,welcomeScreenView,welcomeScreenVO,quizFinishScreenView,quizFinishScreenVO,_defaultViewTpl,_borderDivTpl,_popupViewTpl,_printViewTpl,_templateHeader,_templateContent,_templateFooter){var assessmentWidget=function(data){var _instance,_options,_bookURL,_resourceURL,_widgetObj,_popupView,_data,_frameContent,_frameContentRootEl,_cfg,_uicfg,_templateCfg,_resData,_QuestionId,_responseData=[],_questionIds=[],_quesView,_inlineQuesView,_quesVO,_refScreen,_jsonObject={},_appenderSelector,_isPopupView=!1,_widgetObjData,_directLaunch=!1,_view,_widgetContent,_maxWidth,_minWidth=WIDGET_CONSTANTS.ASSESSMENT_MIN_WIDTH,_minHeight=WIDGET_CONSTANTS.ASSESSMENT_MIN_HEIGHT,_resetBtnClick=!1,_visibleElement=0,_prevAttemptsArr=[],_quizTestID="",_isRendered=!1,_isTrackable=!0,_isPersistable=require.s.contexts._.config.assessmentConfig.is_persistable,_config={},_isEditPreview=!1,_isQuizPreview=!1,_isListPreview=!1,_reqConfig=require.s.contexts._.config.theme,_initialize=function(){_config=require.s.contexts._.config.assessmentConfig,_frameContent=_options.bookFrameContent,_frameContentRootEl=_options.bookFrameContentRootEl;if(_options.data_json){var e=_options.data_json,t=_bookURL.split("/");t.pop(),t=t.join("/")+"/"+_options.dataURL;var n=t.split("/");n.pop(),_resourceURL=n.join("/")+"/",_onDataLoaded(e)}else _loadData()},_loadData=function(){if(_isEditPreview)var e=_options.dataURL+"data.json";else if(_isListPreview)var e=_options.dataURL;else{var e=_bookURL.split("/");e.pop(),e=e.join("/")+"/"+_options.dataURL}var t=e.split("/");t.pop(),_resourceURL=t.join("/")+"/",utils.log("url",e),$.getJSON(e,{}).done(function(e){_onDataLoaded(e)}).fail(function(e,t,n){_instance.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,n.message)})},_onDataLoaded=function(e){e.formattedTitle&&(e.title=e.formattedTitle),_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(_minWidth=_frameContentRootEl.width()*.7),_options.bookFrameContent&&(_maxWidth=_frameContentRootEl.width()),e.testid&&(_quizTestID=e.testid.trim()),$("#"+_widgetObj.id,_options.bookFrameContent).attr("data-testid",_quizTestID),_widgetObjData=e,_data=_widgetObjData.questionsData;for(var t=0;t<_data.length;t++){_data[t].id||(_data[t].id=_data[t].qId),_data[t].id=_widgetObj.id+"_"+_data[t].id;var n=_data[t].id;_questionIds.push(n),_.findWhere(_responseData,{id:n})==undefined&&_responseData.push({id:n,maxScore:parseFloat(_data[t].maxpoints[0]),title:_data[t].title})}_checkWidth(),_jsonObject={uiId:"ui-"+_widgetObj.id,widgetId:"widget-"+_widgetObj.id,title:_widgetObjData.title,width:$("#"+_widgetObj.id,_options.bookFrameContent).width()+"px"},_widgetObjData.poster&&(_jsonObject.posterUrl=_resourceURL+_widgetObjData.poster),_cfg={ContainerEL:_options.bookFrameContent,QuestionIds:_questionIds,Mode:"Practise",Partial_attempt:!0,partial_test_submission:!1,InstantFeedback:!1,TimerLimit:1,Reset:"Complete",Error_Prefix:"Imf_Error",LogPrefix:"Imf_Log",OrientationSupport:!1},_templateCfg={dropDown:{attemptMethod:AppConst.DROPDOWN_NATIVE},fibTapPlace:{maintainOptions:AppConst.FIB_MAINTAIN_OPTIONS},fibTapPlaceTable:{maintainOptions:AppConst.FIB_MAINTAIN_OPTIONS},matchSort:{attemptMethod:AppConst.BOTH},reordering:{attemptMethod:AppConst.REORDERING_TAP_PLACE},crossword:{autoPopulate:!0}},_uicfg={Header:{left:{visible:!1,text:""},right:{visible:!1,text:""},title:{visible:!1,text:""},colorCode:"",visible:!1},Controls:[],Timer:!1,InstructionsImage:""},_isPersistable&&(_options.checkAnswer||(_cfg.Mode="Test")),WIDGET_CONSTANTS.PRINT_MODE?_addPrintView():_directLaunch||_addDefaultView(),_instance.trigger(WIDGET_EVENTS.INITIALIZED,_instance)},_addPrintView=function(){var e=_.template(_printViewTpl,_jsonObject);utils.log("str",e),$("#"+_jsonObject.uiId,_frameContent).remove(),_options.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?_frameContentRootEl.QAappend(e):($("#"+_widgetObj.id,_frameContent).empty().addClass("reflow-print").QAappend(e),$("#"+_widgetObj.id,_frameContent).find(".icon").addClass("reflow-print")),_appenderSelector=$("#ui-"+_widgetObj.id,_frameContent);for(var t=0;t<_data.length;t++)_printQuesView(_data[t],t+1);_instance.trigger(WIDGET_EVENTS.RENDER_COMPLETE,_instance)},_printQuesView=function(e,t){var n=[],r=!1,i=!1,s=_cfg.Partial_attempt,o=_options.bookFrameContent,u="ui-"+_widgetObj.id,a,f;switch(e.type){case AppConst.QUESTION_TYPE_MCQ:e.responseType==AppConst.RESPONSE_TYPE_BINARY?(utils.log("label true/false",e),a=new mcqBinaryVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s,labelTrue:"True"}),f=new mcqBinaryView({model:a,el:o})):e.responseType==AppConst.RESPONSE_TYPE_SET?(a=new mcqSetVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r}),f=new mcqSetView({model:a,el:o})):(a=new mcqVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s}),f=new mcqView({model:a,el:o}));break;case AppConst.QUESTION_TYPE_IMAGE:a=new imageVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r}),f=new imageTapPlace({model:a,el:o});break;case AppConst.QUESTION_TYPE_FIB:e.responseType==AppConst.RESPONSE_TYPE_DRAG?(a=new fibTapPlaceVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s,maintainOptions:_templateCfg.fibTapPlace.maintainOptions}),f=new fibTapPlace({model:a,el:o})):(a=new fibVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s}),f=new fibView({model:a,el:o}));break;case AppConst.QUESTION_TYPE_GROUPING:a=new groupingTapPlaceVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s,widgetId:_widgetObj.id}),f=new groupingTapPlace({model:a,el:o});break;case AppConst.QUESTION_TYPE_MATCHSORT:a=new matchSortVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s,attemptMethod:_templateCfg.matchSort.attemptMethod}),f=new matchSortView({model:a,el:o});break;case AppConst.QUESTION_TYPE_LABELLING:a=new textLabellingVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r}),f=new textLabellingView({model:a,el:o});break;case AppConst.QUESTION_TYPE_REORDERING:a=new reorderingShiftViewVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,attemptMethod:_templateCfg.reordering.attemptMethod}),e.questionLayout.toUpperCase()==AppConst.LAYOUT_HORIZONTAL?(_templateCfg["reordering"]["attemptMethod"]==AppConst.REORDERING_DRAG_DROP&&(this.disableIScroll=!0),f=new reorderingShiftViewHorizontal({model:a,el:o})):f=new reorderingShift({model:a,el:o});break;case AppConst.QUESTION_TYPE_SPEAKING:a=new speakingVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r}),f=new speakingView({model:a,el:o});break;case AppConst.QUESTION_TYPE_FIB_DROPDOWN:a=new fibDropDownVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s,attemptMethod:_templateCfg.dropDown.attemptMethod}),f=new fibDropDown({model:a,el:o});break;case AppConst.QUESTION_TYPE_CROSSWORD:a=new crosswordVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r}),_templateCfg["crossword"]["autoPopulate"]==1?f=new crossword_auto({model:a,el:o}):f=new crossword_cord({model:a,el:o});break;case AppConst.QUESTION_TYPE_FIBTABLE:e.responseType==AppConst.RESPONSE_TYPE_BINARY?utils.isPhone()?(a=new fibDropDownVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,uiId:u,partialAttempt:s,attemptMethod:_templateCfg.dropDown.attemptMethod}),f=new fibDropDown({model:a,el:o})):(a=new fibBinaryTableVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r,maintainOptions:_templateCfg.fibTapPlaceTable.maintainOptions}),f=new fibBinaryTable({model:a,el:o})):(a=new fibTextTableVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r}),f=new fibTextTable({model:a,el:o}));break;case AppConst.QUESTION_TYPE_OPENTEXT:a=new openTextVO(e),a.set({userResponse:n,isReview:i,assetPath:_resourceURL,isTest:r}),f=new openText({model:a,el:o})}f.unbind(),f.render();var l=$("#quesWrapper"+e.id,_appenderSelector);l.QAprepend("<div class='qinstructions' id='inst'>"+t+". <span class='instructionContent instruction-content'></span><div id='instructionsWrapper'><img/></div></div>");var c=$(".qinstructions",l);if(e.rubric==""||e.rubric==undefined||!e.rubric.length||!e.rubric[0].data.trim().length)c.hide(),$(".qinstructions span.instruction-content",l).html("");else{c.show();var h=utils.renderNode(_resourceURL,e.rubric[0]),p=$(".qinstructions span.instruction-title",l),d=$(".qinstructions span.instruction-content",l);p.hide(),c.unbind(),d.html(h)}l.removeClass("disableTemplate").addClass("enableTemplate")},_refreshScroll=function(){_quesView.refreshScroll()},_checkHeight=function(){var e=$("#ui-"+_widgetObj.id+" #assessment-container",_options.bookFrameContent).height();e+=$("#ui-"+_widgetObj.id+" .inline-widget-footer",_options.bookFrameContent).height(),$("#"+_widgetObj.id,_frameContent).height()<=e&&$("#"+_widgetObj.id,_frameContent).height(e),$("#"+_widgetObj.id,_options.bookFrameContent).html()!=""&&_setMinHeight()},_setMinHeight=function(){if(_options.dataMode!==WIDGET_CONSTANTS.DATA_MODE_COMPACT&&!_isPopupView){var e=$("#"+_widgetObj.id,_frameContent).height();e<_minHeight&&($("#"+_widgetObj.id,_frameContent).height(_minHeight),$("#ui-"+_widgetObj.id,_frameContent).height(_minHeight))}},_relayout=function(){if(_isRendered){if(_options.dataMode==WIDGET_CONSTANTS.DATA_MODE_INLINE||_options.dataMode==WIDGET_CONSTANTS.DATA_MODE_POSTER&&_options.align!="fitToWidth")_checkWidth(),_setHeight();_options.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?_updatePosition():_setDimension()}},_updatePosition=function(){if(_options.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var e=_options.bookFrameContent,t,n,r,i;t=widgetUtils.getOffset($("#"+_widgetObj.id,e)).left,n=widgetUtils.getOffset($("#"+_widgetObj.id,e)).top,r=$("#"+_widgetObj.id,e).width(),i=$("#"+_widgetObj.id,e).height(),$("#"+_widgetObj.id,_frameContent).data("height")==undefined&&_options.align=="fitToWidth"&&(i=i>_minHeight?i:_minHeight,$("#"+_widgetObj.id,_frameContent).css("height",i+"px")),_view=$("#ui-"+_widgetObj.id,e).get(0),$(_view).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"})}_options.align=="fitToWidth"&&_options.dataMode=="poster"?($("#"+_widgetObj.id,e).attr("data-height",i+"px"),$("#ui-"+_widgetObj.id+" img",e).css({height:i+"px",width:"auto"})):_options.align!="fitToWidth"&&_options.dataMode=="inline"&&$("#"+_widgetObj.id,e).attr("data-width",r+"px")},_widgetType=function(){return WIDGET_CONSTANTS.ASSESSMENT_WIDGET},_setOptions=function(){},_widgetResize=function(){_checkWidth(),_setHeight(),_updatePosition(),_quesView&&(_quesView.refreshScroll(),_widgetContent&&(_quesView.hideQMap(),_quesView.createCrousal(),_.delay(function(){$("#nav"+_quesView.curIndex,_quesView.screen).addClass("selected"),_quesView._visibleElement=_quesView._visibleElement==0?1:_quesView._visibleElement,_quesView._visibleElement<_quesView.questionids.length&&$(".next",_quesView.obj).removeClass("disabled"),_quesView.curIndex>=_quesView._visibleElement&&$(".prev",_quesView.obj).removeClass("disabled"),_quesView.handleQmap()},300)))},_onCloseAllWidgets=function(e){_quesView&&!e&&e!=undefined&&_quesView.destroy(),_widgetContent&&_quesView.el==_widgetContent.get(0)&&_destroy()},_addDefaultView=function(){var e=_.template(_defaultViewTpl,_jsonObject);utils.log("str",e),_options.align!="fitToWidth"&&$("#"+_widgetObj.id,_frameContent).css("width",$("#"+_widgetObj.id,_frameContent).data("width"));var t=$("#"+_widgetObj.id,_frameContent).get(0).innerHTML;t=t.trim(),t.length==0?($("#"+_widgetObj.id,_frameContent).get(0).innerHTML=e,_frameContentRootEl.append($("#"+_jsonObject.uiId,_frameContent))):_frameContentRootEl.append(e),_appenderSelector=$("#ui-"+_widgetObj.id,_frameContent),_renderAssessmentQuestion(_options.bookFrameContent)},_renderAssessmentWidget=function(e){var t=[];_.each(_responseData,function(e){t.push({id:e.id,maxScore:e.maxScore,title:e.title})}),_responseData=t;if(_config.is_trackable&&(_config.single_ques_quiz||_data.length>1)){var n={uiId:"ui-"+_widgetObj.id,testId:_quizTestID,testTitle:_jsonObject.title},r=new welcomeScreenVO;r.set(n);var i=new welcomeScreenView({model:r,el:e});i._prevAttemptsArr=[],i.on(WIDGET_EVENTS.FETCH_PREVIUOUS_ATTEMPTS,function(e){_instance.trigger(WIDGET_EVENTS.FETCH_PREVIUOUS_ATTEMPTS,e)}),i.on(WIDGET_EVENTS.START_TEST_CLICK,_renderAssessmentQuestion),i.on(assessEvent.TEMPLATE_READY,_onContentLoaded),i.render()}else _quesVO=new assessmentVO(_data[0]),utils.log("_quesVO :",_quesVO),_quesVO.set({uiId:"ui-"+_widgetObj.id,width:_options.width,height:_options.height,colorCode:"transparent"}),_quesView=new questionPlayer({model:_quesVO,el:e}),_isPersistable&&_options.checkAnswer==0?_instance.trigger(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA,_quizTestID,function(e){_responseData=e?e:_responseData,_quesView.render(_cfg,_uicfg,_templateCfg,_responseData,_questionIds[0])}):_quesView.render(_cfg,_uicfg,_templateCfg,_responseData,_questionIds[0])},_renderAssessmentQuestion=function(e,t,n){_prevAttemptsArr=t,_quesVO=new assessmentVO(_data[0]),utils.log("_quesVO :",_quesVO),_quesVO.set({uiId:"ui-"+_widgetObj.id,width:_options.width,height:_options.height,colorCode:"transparent"}),_quesView=new questionPlayer({model:_quesVO,el:e}),_isPersistable&&_options.checkAnswer==0?_instance.trigger(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA,_quizTestID,function(e){_responseData=e?e:_responseData,_quesView.render(_cfg,_uicfg,_templateCfg,_responseData,_questionIds[0])}):_quesView.render(_cfg,_uicfg,_templateCfg,_responseData,_questionIds[0]),n&&n()},_onContentLoaded=function(){_view=$("#ui-"+_widgetObj.id,_options.bookFrameContent).get(0),$("#"+_widgetObj.id,_options.bookFrameContent).removeClass("widget-loader"),$("#"+_widgetObj.id,_options.bookFrameContent).find(".move-icon").removeClass("move-icon-compact"),_setHeight();if(_options.layout===WIDGET_CONSTANTS.DATA_LAYOUT_REFLOW)_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER&&_isPopupView===!1?(_jsonObject.posterUrl?($(_view).QAprepend("<div style='width: 100%; height: 100%;'><img class='quizPoster'/><div class='ui-maximize quiz-package-widget-icon icon icon-ic-quiz-widget'></div></div>"),$(_view).find("img").attr("src",_jsonObject.posterUrl),_options.align==="fitToWidth"&&($("#ui-"+_widgetObj.id,_options.bookFrameContent).addClass("widget-fitToWidth"),$("#ui-"+_widgetObj.id+" img",_options.bookFrameContent).parent().css({width:"auto",height:"auto"}),$("#ui-"+_widgetObj.id+" img",_options.bookFrameContent).width($("#"+_widgetObj.id,_frameContent).data("width")))):$(_view).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize quiz-play-button icon icon-ic-quiz-widget'></div></div>"),$("#assessment-container",_view).remove(),_minHeight=_minWidth):_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE;else if(_options.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED&&_isPopupView===!1){_setDimension(),_setMinHeight();if(_options.dataMode!==WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+_widgetObj.id,_options.bookFrameContent).width();e<_minWidth&&($("#"+_widgetObj.id,_options.bookFrameContent).width(_minWidth),$("#ui-"+_widgetObj.id,_options.bookFrameContent).width(_minWidth))}if(_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER&&_isPopupView===!1)_jsonObject.posterUrl?($(_view).QAprepend("<div style='width: 100%; height: 100%;'><img class='quizPoster'/><div class='ui-maximize quiz-package-widget-icon icon icon-ic-quiz-widget'></div></div>"),$(_view).find("img").attr("src",_jsonObject.posterUrl)):$(_view).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize quiz-play-button icon icon-ic-quiz-widget'></div></div>"),$("#assessment-container",_view).remove();else if(_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(_options.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){var t=_.template(_borderDivTpl,{id:_jsonObject.uiId}),n=$("#"+_widgetObj.id,_options.bookFrameContent).get(0).innerHTML;n=n.trim(),n.length==0?($("#"+_widgetObj.id,_options.bookFrameContent).get(0).innerHTML=t,_frameContentRootEl.append($("#div-border-"+_jsonObject.uiId,_options.bookFrameContent))):_frameContentRootEl.append(t),$("#div-border-"+_jsonObject.uiId,_options.bookFrameContent).css({width:$(_view).width()+"px",height:$(_view).height()+"px",top:_view.style.top,left:_view.style.left,position:"absolute"}),$("#div-border-"+_jsonObject.uiId,_options.bookFrameContent).addClass("transparentWidget ui-hover-class"),$("#div-border-"+_jsonObject.uiId,_options.bookFrameContent).css({"pointer-events":"none"})}$("#assessment-container",_view).remove(),$(".inline-widget-footer",_view).remove(),$(_view).html('<div class="ui-clickable-icon ui-assessment-icon icon-font"></div>'),$(_view).addClass("transparentWidget"),$(_view).removeClass("ui-border"),$(_view).css({width:$(".ui-clickable-icon",_view).width()+"px",height:$(".ui-clickable-icon",_view).height()+"px"}),$("#"+_widgetObj.id,_options.bookFrameContent).find(".move-icon").addClass("move-icon-compact"),$("#"+_widgetObj.id+" .dummyWidget",_options.bookFrameContent).show(),_options.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+_widgetObj.id,_options.bookFrameContent).css({"min-width":"0px",width:$(".ui-clickable-icon",_view).width()+"px",height:$(".ui-clickable-icon",_view).height()+"px"}),$("#"+_widgetObj.id+" .dummyWidget",_options.bookFrameContent).hide()),$(".ui-assessment-icon",_view).click({},_launchAssessmentPopup)}}$(".ui-maximize",_view).unbind().bind("click",_launchAssessmentPopup),_minWidth=WIDGET_CONSTANTS.ASSESSMENT_MIN_WIDTH,!_isPopupView&&!_resetBtnClick&&(_isRendered=!0,_instance.trigger(WIDGET_EVENTS.RENDER_COMPLETE,_instance,_maxWidth,_minWidth,_minHeight))},_setDimension=function(){$("#"+_widgetObj.id,_frameContent).css({position:"absolute"});var e,t,n,r;e=widgetUtils.getOffset($("#"+_widgetObj.id,_frameContent)).left,t=widgetUtils.getOffset($("#"+_widgetObj.id,_frameContent)).top,n=$("#"+_widgetObj.id,_frameContent).width(),r=$("#"+_widgetObj.id,_frameContent).height(),_view=$("#ui-"+_widgetObj.id,_frameContent).get(0),_options.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(_view).css({top:t+"px",left:e+"px",position:"absolute"}):$(_view).css({top:t+"px",left:e+"px",width:n+"px",height:r+"px",position:"absolute"}),_options.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+_jsonObject.uiId,_frameContent).css({top:t+"px",left:e+"px",width:n+"px",height:r+"px",position:"absolute","z-index":1e4})},_setHeight=function(){if(_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER)_options.align=="fitToWidth"?_jsonObject.height=$("#"+_widgetObj.id,_options.bookFrameContent).data("height"):_jsonObject.height=$("#"+_widgetObj.id,_options.bookFrameContent).width();else if(_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT&&_options.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE)_jsonObject.height=$("#"+_widgetObj.id,_options.bookFrameContent).height();else{var e=$("#ui-"+_widgetObj.id+" #assessment-container",_options.bookFrameContent).height();e+=$("#ui-"+_widgetObj.id+" .inline-widget-footer",_options.bookFrameContent).height(),_jsonObject.height=e}!_isPopupView&&!_resetBtnClick&&$("#"+_widgetObj.id,_options.bookFrameContent).css("height",_jsonObject.height+"px"),$("#"+_widgetObj.id,_options.bookFrameContent).html()!=""&&_setMinHeight()},_checkWidth=function(){if(_options.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+_widgetObj.id,_options.bookFrameContent).width();e<_minWidth&&$("#"+_widgetObj.id,_options.bookFrameContent).css({"min-width":_minWidth}),e>_maxWidth&&$("#"+_widgetObj.id,_options.bookFrameContent).css({"max-width":"100%"})}},_launchAssessmentPopup=function(){if(_isEditPreview){_onPopupShown();return}_inlineQuesView=_quesView,_popupView.addClass("assessment-popup");var e={type:"quiz"};_instance.trigger(WIDGET_EVENTS.LAUNCHED,_instance),_instance.trigger(WIDGET_EVENTS.XAPI_EVENT,_instance,e),$("#widgetPopup").removeClass("hide")},_onPopupShown=function(){if(_isEditPreview){_isPopupView=!0,_data.length>1&&(_isQuizPreview=!0,_isEditPreview=!1);var e=_.template(_popupViewTpl,_jsonObject);_popupView.html(e),_renderAssessmentWidget(_popupView);return}_widgetContent=$("#widgetContent",_popupView),_isPopupView=!0;var e=_.template(_popupViewTpl,_jsonObject);utils.log("str",e),$("#widgetContent").html(e),_renderAssessmentWidget(_widgetContent),$(".gal-title",_popupView).html(unescape(_jsonObject.title)),$("#widgetPopup").unbind(assessEvent.KEYDOWN).bind(assessEvent.KEYDOWN,function(e){e.keyCode==37?(_quesView.prevBtnClick(),$("#widgetPopup").focus()):e.keyCode==39&&(_quesView.nextBtnClick(),$("#widgetPopup").focus())}),_instance.trigger(WIDGET_EVENTS.POPULATED,_instance)},_populateInlineView=function(e){_options.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(e[0].userResponse?(_inlineQuesView.quesView.resetClicked=!1,_inlineQuesView.quesView.populateAnswers(e[0].userResponse,!1),_inlineQuesView.quesView.lockQuestion()):_inlineQuesView.quesView.resetQuestion(),_inlineQuesView.reportButton.addClass("disabled"))},_destroy=function(){_quesView&&_quesView.destroy(),_isPopupView=!1,_prevAttemptsArr=[],!_isQuizPreview&&!_isEditPreview&&($("#widgetPopup").unbind(),$(".gal-title",_popupView).html(""),_widgetContent.empty(),_popupView.removeClass("assessment-popup"),_instance.trigger(WIDGET_EVENTS.DESTROYED,_instance)),_quesView=_inlineQuesView},_destroyView=function(){$(".ui-maximize",_view).unbind(),$("#"+_widgetObj.id,_frameContent).remove(),$("#ui-"+_widgetObj.id,_frameContent).remove()},questionPlayer=Backbone.View.extend({animconfig:{},screenId:"",curScreen:"",screen:null,prevBtnEnabled:!0,nextBtnEnabled:!0,quesView:null,mode:"",isTest:!1,isReview:!1,correctAnswerVisible:null,userResponse:{},isAnswered:!1,externalCall:!1,prevQobj:null,stopwatch:0,questionids:[],responseData:[],currentView:"",curIndex:-1,readOnly:!1,CurrentResponse:null,isBypass:!1,isRemember:!1,resetType:2,launchId:null,disableIScroll:!1,OrientationSupport:!1,direction:"",templateConfig:{},partialAttempt:!0,feedbackScroll:null,mapScroll:null,QAttemptStatus:[],partial_test_submission:!0,reportButton:null,uicfg:{},iScroll:null,navigatorsDisabled:!1,isNavigatorVisible:!1,initialize:function(e){utils.log("questionplayer rendering",this.model),_.extend(this,Backbone.Events),_.bindAll(this,"onTemplateReady","handleMarkCorrect","handleMarkIncorrect","handleMarkAnswer","onAnswerMarked","resetBtnClick","handleTemplateEvents","onQuestionReset","handleEvaluateClick","toggleVisibleResponse","nextBtnClick","createCrousal","prevBtnClick","handleAnimationComplete","handleQuestionAnimationComplete","destroyPrev","updateTime","handleDoneClick","resetAnswer","handleShowAnswer","handleBackClick","showQueInfo","hideQueInfo","destroy","orientationchange","initScroll","handleEvaluateBtnClick","refreshScroll","showFeedback","sendQuizResponseData","handleDoneStatus","handleMapItemClick","hideQMap","toggleInstructions","showQuesMap","getQuestionData","saveResponse","handleMaximizeClicked","onImageLoaded")},render:function(e,t,n,r,i){var s=this;this.screen=this.$el,this.obj=this.screen,_refScreen=this.obj,this.responseData=r,this.launchId=i,s.setConfig(e,t,n,s),this.onScreenReady()},setConfig:function(e,t,n,r){this.templateConfig=n,this.mode=e.Mode,this.uicfg=t,this.partialAttempt=e.Partial_attempt,this.partial_test_submission=e.partial_test_submission,this.OrientationSupport=e.OrientationSupport,this.questionids=e.QuestionIds,this.mode=="Test"?(this.isTest=!0,this.isReview=!1):this.mode=="Review"&&(this.isTest=!0,this.isReview=!0);var i={};t.Header.visible&&(i.headerVisible="block",t.Header.left.visible&&(i.leftLabel=t.Header.left.text,i.leftVisible="none"),t.Header.right.visible&&(i.rightLabel=t.Header.right.text,i.rightVisible="block"),t.Header.title.visible&&(i.title=t.Header.title.text,i.titleVisible="block")),r.model.set(i);var s=r.model.toJSON(),o=_.template(_templateHeader+_templateContent+_templateFooter,s);$("#"+this.model.get("uiId")+" #assessment-container",this.$el).QAappend(o)},onScreenReady:function(e){this.screen=$("#"+this.model.get("uiId")+" .question-player",this.$el),this.obj=this.screen;if(this.launchId==null||this.launchId==undefined)this.mode=="Review"?this.curIndex=-1:this.curIndex=utils.findResumePosition(this.questionids,this.responseData)-1;else{this.curIndex=_.indexOf(this.questionids,this.launchId)-1;if(this.curIndex==-2){_instance.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_SUCH_QUESTION_PRESENT_LABEL);return}}$(".qMapWrapper",this.screen).hide(),$(".qinfo.phone",this.screen).hide(),$(".qinfo.desktop",this.screen).hide(),this.isReview?$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).find("#qMapDesktop").show():$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).find("#qMapDesktop").show(),$(".qinfo",this.screen).removeClass("phone"),$("#footer",this.screen).removeClass("phone"),this.reportButton=$(".report-btn",this.obj),this.questionids.length>1?($(".qinfo.desktop",this.screen).show(),this.isReview?$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).find("#qMapDesktop").show():$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).find("#qMapDesktop").show(),this.createQuesMap(this.questionids,this.responseData)):this.isReview?$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).find("#qMapDesktop").hide():$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).find("#qMapDesktop").hide(),$("#header",this.screen).hide(),!this.partial_test_submission&&!this.isReview,this.isReview?($("#"+AppConst.QBTN_CORRECT_ANS,this.screen).bind(assessEvent.CLICK,this.handleShowAnswer),$("#"+AppConst.QBTN_USER_ANS,this.screen).bind(assessEvent.CLICK,this.handleShowAnswer)):($("#resetQBtn",this.screen).bind(assessEvent.CLICK,this.resetBtnClick),$("#"+AppConst.QBTN_ANSWERS,this.screen).bind(assessEvent.CLICK,this.handleShowAnswer),$("#"+AppConst.QBTN_EVALUATE,this.screen).bind(assessEvent.CLICK,this.handleEvaluateBtnClick)),$(".ui-maximize",this.obj).bind(assessEvent.CLICK,this.handleMaximizeClicked),this.screen.find(".header-left-btn").bind(assessEvent.CLICK,this.handleBackClick),_config.single_ques_quiz||_data.length>1?$("#footer",this.screen).removeClass("footer-singleQue"):(this.reportButton.hide(),$("#footer",this.screen).addClass("footer-singleQue")),_config.is_trackable?this.reportButton.bind(assessEvent.CLICK,this.handleDoneClick):this.reportButton.hide(),_isPersistable&&(_options.checkAnswer?this.reportButton.hide():(this.reportButton.addClass("disabled"),this.reportButton.show(),this.reportButton.bind(assessEvent.CLICK,this.handleDoneClick))),this.animconfig={hide:"",show:AppConst.QUESTION_PLAYER,direction:AppConst.ANIMATE_FORWARD,destroy:!0},$("#"+this.model.get("uiId")+" #"+AppConst.QUESTION_PLAYER,this.$el).addClass("current"),this.curScreen=AppConst.QUESTION_PLAYER,this.questionids.length<=1&&($("#prevQBtn",this.obj).hide(),$("#nextQBtn",this.obj).hide()),this.onNextQuestion()},handleMaximizeClicked:function(){_instance.trigger(WIDGET_EVENTS.LAUNCHED,_instance),_widgetContent=$("#widgetContent",_popupView)},onNextQuestion:function(){this.questionids.length>=1&&(this.curIndex!=this.questionids.length-1&&this.curIndex++,this.direction="forward",this.handlePreviousandNextClick(),this.getQuestionData(this.questionids[this.curIndex]))},onPreviousQuestion:function(){this.questionids.length>=1&&(this.curIndex>0&&this.curIndex--,this.direction="reverse",this.handlePreviousandNextClick(),this.getQuestionData(this.questionids[this.curIndex]))},handlePreviousandNextClick:function(){this.disableIScroll=!1,$(".qposition",this.screen).text(WidgetLang.QUESTION_WITH_COLON_LABEL+(this.curIndex+1)+" of "+this.questionids.length),this.curIndex==0?this.prevBtnEnabled=!1:this.prevBtnEnabled=!0,this.curIndex==this.questionids.length-1?this.nextBtnEnabled=!1:this.nextBtnEnabled=!0,this.handleQmap()},getQuestionData:function(e){utils.log("C: question data done ",e);var t="",n={};for(var r in _data)_data[r].id==e.toString()&&(t=_data[r],utils.log("----questiondata-----",JSON.stringify(t)));_responseData!=null&&(utils.log("Passing response: ",_responseData[e.toString()]),n=_.findWhere(_responseData,{id:e.toString()})),this.initializeActivity(t,n)},saveResponse:function(e,t){utils.log("C: question Evaluated done -- ",e,t);if(t!=undefined&&_.size(t)!=0){for(var n=0;n<_responseData.length;n++)if(_responseData[n].id==e){_responseData[n]=t;break}this.handleQMapClass(e,t.status);var r={questionId:_instance.identifier+"_"+(this.curIndex+1),raw:_responseData[n].score,maxScore:_responseData[n].maxScore,scaled:parseFloat((_responseData[n].score/_responseData[n].maxScore).toFixed(2)),type:"question"};_quizTestID&&(r.refTestId=_quizTestID),_instance.trigger(WIDGET_EVENTS.XAPI_EVENT,_instance,r,"answered")}else{for(var n=0;n<_responseData.length;n++)if(_responseData[n].id==e){_responseData[n]={id:e,maxScore:parseFloat(_data[n].maxpoints[0]),title:_data[n].title};break}this.handleQMapClass(e,"notattempted")}utils.log("responsedate: ",_responseData)},handleQMapClass:function(e,t){var n=$("[data-id = "+e+"]",this.screen);t==AppConst.CORRECT?(n.addClass("correct"),n.removeClass("incorrect")):t==AppConst.PARTIAL||t==AppConst.INCORRECT?(n.addClass("incorrect"),n.removeClass("correct")):(n.removeClass("incorrect"),n.removeClass("correct"))},handleQmap:function(){if($("#mapDiv",this.screen).find("li").length>this._visibleElement){var e=$("#mapDiv",this.screen).find("li").get(this._visibleElement-1),t=parseInt(e.id.split("nav")[1]),n=t-this._visibleElement+1;if(!(this.curIndex>=n&&this.curIndex<=t)){var r=Math.floor(t/this._visibleElement),i=Math.floor(this.curIndex/this._visibleElement),s=r-i+1,o=parseInt($(".pagination",this.screen).find(".selected").find("span").html()),u=$(".pagination",this.screen).find("a").get(o-s);$(u).trigger("click")}}},handleTemplateEvents:function(){if(!this.quesView.resetClicked){this.isReview?(this.toggleVisibleResponse(),this.quesView.lockQuestion(),utils.log(">>>>>inside test and review"),this.changeToolbarMode({mode:AppConst.TOOLBAR_REVIEW_USER}),$("#feedbackBtn",this.screen).unbind(),this.curQData.feedback&&this.curQData.feedback!=""?($("#feedbackBtn",this.screen).removeClass("disabled"),$("#feedbackBtn",this.screen).bind(assessEvent.CLICK,this.showFeedback)):$("#feedbackBtn",this.screen).addClass("disabled")):this.isTest?this.readOnly?(utils.log("test mode and read only :",this.readOnly),this.correctAnswerVisible=!0,this.toggleVisibleResponse(),this.quesView.lockQuestion(),this.changeToolbarMode({mode:AppConst.TOOLBAR_LOCKED})):this.changeToolbarMode({mode:AppConst.TOOLBAR_DEFAULT}):this.readOnly?(this.correctAnswerVisible=!0,this.toggleVisibleResponse(),this.quesView.lockQuestion(),this.changeToolbarMode({mode:AppConst.TOOLBAR_LOCKED})):(this.correctAnswerVisible=!1,this.changeToolbarMode({mode:AppConst.TOOLBAR_DEFAULT})),this.partialAttempt==0&&!this.isReview&&this.quesView.enableInteraction();var e=this;this.prevQobj!=undefined?utils.screenTransition({curScreen:$("#ques"+this.prevQobj.model.get("id"),this.obj).parent(),newScreen:$("#ques"+this.curQobj.model.get("id"),this.obj).parent(),direction:this.direction,persistent:!0,handler:function(){e.destroyPrev(),e.initScroll(),e.quesView.scroll=e.iScroll}}):(_.delay(e.initScroll,50),this.quesView.scroll=this.iScroll)}},handleDoneClick:function(){var e=this;if(_isPersistable&&this.reportButton.hasClass("disabled"))return;if(this.isAnswered&&this.quesView.EvaluateFlag==0||this.partialAttempt==0&&this.isAnswered)this.isBypass=!1,this.handleEvaluateClick();this.isTest,utils.hideQuesPopup();var t=0,n=0,r=this,i=[];_.each(_responseData,function(e,r){var s=isNaN(parseFloat(e.score))?0:parseFloat(e.score),o=isNaN(parseFloat(e.maxScore))?0:parseFloat(e.maxScore);t+=o,n+=s,i.push({qid:_questionIds[r],score:{raw:s,max:o,scaled:parseFloat((s/o*100).toFixed(2)),attempted:e.score==undefined?!1:!0}})}),attemptObj={date:new Date,score:n,maxScore:t};if(_reqConfig=="cup"){_prevAttemptsArr=[],_prevAttemptsArr.length>2&&_prevAttemptsArr.shift(),_prevAttemptsArr.push(attemptObj),this.sendQuizResponseData(attemptObj);var s=new quizFinishScreenVO({title:_jsonObject.title,attemptsArr:_prevAttemptsArr}),o=$("#ui-"+_widgetObj.id+" #assessment-container"),u=new quizFinishScreenView({model:s,el:o});u.render(),u.on(WIDGET_EVENTS.TEST_FINISH_CLICK,function(){_popupView.modal("hide")}),u.on(WIDGET_EVENTS.TEST_TRY_AGAIN_CLICK,function(){u.destroy();var e=[];_.each(_responseData,function(t){e.push({id:t.id,maxScore:t.maxScore,title:t.title})}),_responseData=e,_renderAssessmentQuestion($("#widgetContent",_popupView),_prevAttemptsArr)}),utils.screenTransition({curScreen:$("#"+AppConst.QUESTION_PLAYER),newScreen:$("#quizFinishScreen"),direction:"forward",persistent:!1,handler:function(){_quesView.destroy()}})}else _isPersistable&&(this.reportButton.addClass("disabled"),_instance.trigger(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA,_quizTestID,_responseData),_instance.trigger(WIDGET_EVENTS.ON_DONE,_responseData));var a={raw:attemptObj.score,maxScore:attemptObj.maxScore,scaled:parseFloat((attemptObj.score/attemptObj.maxScore).toFixed(2)),questionCount:_responseData.length,questionWiseScores:i,completion:"true",type:"quiz"};_quizTestID&&(a.refTestId=_quizTestID),$("#ReportBtn").css("display")!=="none"&&_instance.trigger(WIDGET_EVENTS.XAPI_EVENT,_instance,a,"completed")},sendQuizResponseData:function(e){var t,n=utils.clone(_responseData),r=_widgetObj.id+"_";_.each(n,function(e){e.id=e.id.substring(r.length),e.qId=e.id}),t={testId:_quizTestID,testTitle:_jsonObject.title,resultsData:{date:e.date,score:e.score,maxScore:e.maxScore,responseData:n}},_instance.trigger(WIDGET_EVENTS.SEND_RESPONSE_DATA,t)},showFeedback:function(){if($("#feedbackBtn",this.screen).hasClass("disabled"))return;var e=_.findWhere(this.responseData,{id:this.questionids[this.curIndex]}),t=e.score;t==undefined&&(t=0),utils.showFeedback(this.curQData.feedback,t)},handleDoneStatus:function(e){var t=this.QAttemptStatus[this.questionids[this.curIndex]],n=-1;if(t!=e){e==AppConst.COMPLETE?($("#nav"+this.curIndex,this.screen).addClass("attempted"),$("#nav"+this.curIndex,this.screen).removeClass("notattempted"),$("#nav"+this.curIndex,this.screen).removeClass("partial"),n=2):e==AppConst.PARTIAL?($("#nav"+this.curIndex,this.screen).addClass("partial"),$("#nav"+this.curIndex,this.screen).removeClass("notattempted"),$("#nav"+this.curIndex,this.screen).removeClass("attempted"),n=1):($("#nav"+this.curIndex,this.screen).addClass("notattempted"),$("#nav"+this.curIndex,this.screen).removeClass("attempted"),$("#nav"+this.curIndex,this.screen).removeClass("partial"),n=0),this.QAttemptStatus[this.questionids[this.curIndex]]=n;var r=_.without(this.QAttemptStatus,0,1).length;this.partial_test_submission==0&&(r==this.questionids.length?(this.reportButton.show(),this.reportButton.removeClass("disabled")):(this.reportButton.hide(),this.reportButton.addClass("disabled")))}},onSubmitAssessment:function(e,t){this.destroy(),utils.log("onSubmitAssessment>>>>>>>>",this.questionids,e);var n=this.questionids.length-_.size(e),r=0;for(k in e)e[k].status==1&&r++;var i=new resultScreenVO;i.set({questionData:this.questionids,resData:e,score:r,numSkipped:n,timeTaken:this.model.get("timestamp"),isTest:this.isTest});var s=new resultsScreen({model:i,el:this.screen});this.curScreen=AppConst.RESULT_SCREEN,s.render(t),this.currentView=s,s.isTest=this.isTest,this.showScreen()},onImageLoaded:function(){_isPopupView||_instance.trigger(WIDGET_EVENTS.HEIGHT_UPDATED,_instance)},handleBackClick:function(){this.isTest&&this.stopwatch.stop();var e={interrupt:!0,timeTaken:this.model.get("timestamp")};Backbone.Events.trigger("assessmentCompleted",e)},resetBtnClick:function(e){utils.log($("#resetQBtn"),this.screen);if($("#resetQBtn",this.screen).hasClass("disabled"))return;_isPersistable&&this.reportButton.removeClass("disabled"),_resetBtnClick=!0,this.resetAnswer()},resetAnswer:function(e,t){e&&(this.resetType=e),t&&(this.isRemember=t),this.resetType==1?this.quesView.resetQuestionPartial?this.quesView.resetQuestionPartial():this.quesView.resetQuestion():this.quesView.resetQuestion()},nextBtnClick:function(e){if($("#nextQBtn",this.obj).hasClass("disabled"))return;if(this.navigatorsDisabled)return;this.navigatorsDisabled=!0,$(".overlay",this.obj).show(),(this.isBypass!=1&&this.isAnswered==1&&this.quesView.EvaluateFlag==0||this.partialAttempt==0&&this.isAnswered==1)&&this.handleEvaluateClick(),this.onNextQuestion()},prevBtnClick:function(){if($("#prevQBtn",this.obj).hasClass("disabled"))return;if(this.navigatorsDisabled)return;this.navigatorsDisabled=!0,$(".overlay",this.obj).show(),(this.isBypass!=1&&this.isAnswered==1&&this.quesView.EvaluateFlag==0||this.partialAttempt==0&&this.isAnswered==1)&&this.handleEvaluateClick(),this.onPreviousQuestion(),Backbone.Events.trigger("onPrevClicked")},nextConfirmation:function(e){e=e==2?!0:!1,e?this.showNextQuestion():this.handleEvaluate()},handleEvaluateBtnClick:function(e){var t=$("#"+AppConst.QBTN_EVALUATE,this.obj);if(t.hasClass("disabled"))return;this.handleEvaluateClick()},handleEvaluateClick:function(e){var t=$("#"+AppConst.QBTN_EVALUATE,this.obj);utils.log("handle Evaluate",t);if(this.isBypass&&this.isTest)return;e?(AppConst.POPQ=!0,e.preventDefault()):AppConst.POPQ=!1,this.quesView.handleEvaluate(t)},handleShowAnswer:function(e){if(this.itemClicked==1)return;utils.hideQuesPopup();if(e){var t=$(e.currentTarget);t.get(0).tagName=="LABEL"&&(t=t.parents("span"));if(t.hasClass("disabled"))return;e.preventDefault()}this.itemClicked=!0,$("#labelanswers",this.screen).css("visibility","hidden");if(this.isTest)this.toggleVisibleResponse();else if(!this.correctAnswerVisible){var n=!1;n?this.showAnswerConfirmation(2):($("#"+AppConst.QBTN_ANSWERS,this.screen).addClass("toggle"),this.toggleVisibleResponse())}else $("#"+AppConst.QBTN_ANSWERS,this.screen).removeClass("toggle"),this.toggleVisibleResponse();this.itemClicked=!1},toggleVisibleResponse:function(){if(!this.correctAnswerVisible&&this.correctAnswerVisible!=null)this.isTest||this.isReview?($("#labelanswers",this.obj).css("visibility","visible"),this.changeToolbarMode({mode:AppConst.TOOLBAR_REVIEW_CORRECT})):this.changeToolbarMode({mode:AppConst.TOOLBAR_RESET}),$("#answersBtn",this.obj).html(WidgetLang.YOUR_ANSWER_LABEL),this.quesView.populateAnswers(this.curQData.answers,this.correctAnswerVisible),this.correctAnswerVisible=!0;else{var e=[];this.CurrentResponse?e=this.CurrentResponse.userResponse:this.userResponse&&this.userResponse.userResponse&&(e=this.userResponse.userResponse,this.isTest||(this.readOnly=!1)),this.isTest||this.isReview?(this.changeToolbarMode({mode:AppConst.TOOLBAR_REVIEW_USER}),this.readOnly=!1):this.userResponse.length>0?this.changeToolbarMode({mode:AppConst.TOOLBAR_LOCKED}):this.changeToolbarMode({mode:AppConst.TOOLBAR_LOCKED}),$("#answersBtn",this.obj).html(WidgetLang.ANSWER_LABEL),this.quesView.populateAnswers(e,this.correctAnswerVisible),this.correctAnswerVisible=!1}},onQuestionReset:function(){this.quesView.enableInteraction(),this.changeToolbarMode({mode:AppConst.TOOLBAR_DEFAULT})},initializeActivity:function(questionData,userResponse){this.correctAnswerVisible=!0,utils.showPreloader(),this.quesView!=null,this.userResponse="",userResponse==null||userResponse==undefined||userResponse==""?this.readOnly=!1:userResponse.userResponse&&(this.readOnly=!0),this.curQData=questionData,this.userResponse=userResponse,questionData.instructions==""||questionData.instructions==undefined;var ins=$(".qinstructions",this.screen);if(questionData.rubric==""||questionData.rubric==undefined||!questionData.rubric.length||!questionData.rubric[0].data.trim().length)ins.hide(),$(".qinstructions span.instruction-content",this.screen).html("");else{ins.show();var rubric=utils.renderNode(_resourceURL,questionData.rubric[0]),insTitle=$(".qinstructions span.instruction-title",this.screen),insCont=$(".qinstructions span.instruction-content",this.screen);insTitle.hide(),insCont.removeClass("up-arrow"),insCont.removeClass("closed"),insCont.removeClass("open"),ins.unbind(),insCont.html(rubric),questionData.rubric[0].type=="text"&&insCont.get(0).offsetWidth>=$("#inst",this.obj).get(0).offsetWidth-30&&(insCont.addClass("up-arrow"),insCont.addClass("open"),ins.bind(assessEvent.CLICK,this.toggleInstructions))}switch(questionData.type){case AppConst.QUESTION_TYPE_MCQ:if(questionData.responseType==AppConst.RESPONSE_TYPE_BINARY){utils.log("label true/false",questionData);var quesVO=new mcqBinaryVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest,uiId:this.model.get("uiId"),partialAttempt:this.partialAttempt,labelTrue:"True"}),this.quesView=new mcqBinaryView({model:quesVO,el:this.el})}else if(questionData.responseType==AppConst.RESPONSE_TYPE_SET){var quesVO=new mcqSetVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest}),this.quesView=new mcqSetView({model:quesVO,el:this.el})}else{var quesVO=new mcqVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest,uiId:this.model.get("uiId"),partialAttempt:this.partialAttempt}),this.quesView=new mcqView({model:quesVO,el:this.el})}break;case AppConst.QUESTION_TYPE_IMAGE:var quesVO=new imageVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest}),this.quesView=new imageTapPlace({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_FIB:if(questionData.responseType==AppConst.RESPONSE_TYPE_DRAG){var quesVO=new fibTapPlaceVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,isTest:this.isTest,uiId:this.model.get("uiId"),assetPath:_resourceURL,maintainOptions:this.templateConfig.fibTapPlace.maintainOptions,partialAttempt:this.partialAttempt}),this.quesView=new fibTapPlace({model:quesVO,el:this.el})}else{var quesVO=new fibVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,isTest:this.isTest,assetPath:_resourceURL,uiId:this.model.get("uiId"),partialAttempt:this.partialAttempt}),this.quesView=new fibView({model:quesVO,el:this.el})}break;case AppConst.QUESTION_TYPE_GROUPING:var quesVO=new groupingTapPlaceVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,isTest:this.isTest,assetPath:_resourceURL,widgetId:_widgetObj.id,uiId:this.model.get("uiId"),partialAttempt:this.partialAttempt}),this.quesView=new groupingTapPlace({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_MATCHSORT:var quesVO=new matchSortVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest,attemptMethod:this.templateConfig.matchSort.attemptMethod,partialAttempt:this.partialAttempt,uiId:this.model.get("uiId")}),this.quesView=new matchSortView({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_LABELLING:var quesVO=new textLabellingVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest}),this.quesView=new textLabellingView({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_REORDERING:var quesVO=new reorderingShiftViewVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest,attemptMethod:this.templateConfig.reordering.attemptMethod}),questionData.questionLayout.toUpperCase()==AppConst.LAYOUT_HORIZONTAL?(this.templateConfig["reordering"]["attemptMethod"]==AppConst.REORDERING_DRAG_DROP&&(this.disableIScroll=!0),this.quesView=new reorderingShiftViewHorizontal({model:quesVO,el:this.el})):this.quesView=new reorderingShift({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_SPEAKING:var quesVO=new speakingVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest}),this.quesView=new speakingView({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_FIB_DROPDOWN:var quesVO=new fibDropDownVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest,uiId:this.model.get("uiId"),partialAttempt:this.partialAttempt,attemptMethod:this.templateConfig.dropDown.attemptMethod}),this.quesView=new fibDropDown({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_CROSSWORD:var quesVO=new crosswordVO(questionData);quesVO.set({userResponse:this.userResponse,assetPath:_resourceURL,isReview:this.isReview,isTest:this.isTest}),this.templateConfig["crossword"]["autoPopulate"]==1?this.quesView=new crossword_auto({model:quesVO,el:this.el}):this.quesView=new crossword_cord({model:quesVO,el:this.el});break;case AppConst.QUESTION_TYPE_FIBTABLE:if(questionData.responseType==AppConst.RESPONSE_TYPE_BINARY)if(utils.isPhone()){var quesVO=new fibDropDownVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest,attemptMethod:this.templateConfig.dropDown.attemptMethod,partialAttempt:this.partialAttempt}),this.quesView=new fibDropDown({model:quesVO,el:this.el})}else{var quesVO=new fibBinaryTableVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest,maintainOptions:this.templateConfig.fibTapPlaceTable.maintainOptions}),this.quesView=new fibBinaryTable({model:quesVO,el:this.el})}else{var quesVO=new fibTextTableVO(questionData);quesVO.set({userResponse:this.userResponse,assetPath:_resourceURL,isReview:this.isReview,isTest:this.isTest}),this.quesView=new fibTextTable({model:quesVO,el:this.el})}break;case AppConst.QUESTION_TYPE_OPENTEXT:var quesVO=new openTextVO(questionData);quesVO.set({userResponse:this.userResponse,isReview:this.isReview,assetPath:_resourceURL,isTest:this.isTest}),this.quesView=new openText({model:quesVO,el:this.el})}this.quesView.unbind(),this.quesView.bind(assessEvent.TEMPLATE_READY,this.onTemplateReady),this.quesView.bind(assessEvent.ANSWER_MARKED,this.onAnswerMarked),this.quesView.bind(assessEvent.MARK_CORRECT,this.handleMarkCorrect),this.quesView.bind(assessEvent.MARK_INCORRECT,this.handleMarkIncorrect),this.quesView.bind(assessEvent.MARK_ANSWER,this.handleMarkAnswer),this.quesView.bind(assessEvent.QUESTION_RESET,this.onQuestionReset),this.quesView.bind(assessEvent.CHANGETOOLBARMODE,this.changeToolbarMode),this.quesView.bind(assessEvent.UPDATE_RESPONSE,this.updateResponse),this.quesView.bind(assessEvent.MARK_EMPTY,this.markEmpty),this.quesView.bind(assessEvent.REFRESH_SCROLL,this.refreshScroll),this.quesView.bind(assessEvent.IMG_LOADED,this.onImageLoaded),rel=questionData.type+"_"+questionData.questionLayout,questionData.type==AppConst.QUESTION_TYPE_FIBTABLE&&utils.isPhone()&&(rel="FIBDROPDOWN_");if(questionData.type==AppConst.QUESTION_TYPE_MCQ)if(questionData.responseType=="BINARY")rel+="_BINARY";else{try{QuestionText=eval(questionData.questionBody)}catch(e){}QuestionText.length>0&&(rel+="_"+QuestionText[0].type)}if(questionData.type==AppConst.QUESTION_TYPE_FIB){try{QuestionText=eval(questionData.leftCol)}catch(e){}QuestionText.length>0&&(rel+="_"+QuestionText[0].type);try{QuestionText=eval(questionData.questionBody)}catch(e){}QuestionText.length>0&&QuestionText[0].type=="image"&&(rel+="_"+QuestionText[0].type),questionData.responseType=="TEXT"?rel+="_text":questionData.responseType=="DRAGDROP"&&(rel+="_VERTICAL")}questionData.type==AppConst.QUESTION_TYPE_FIB&&questionData.responseType=="BINARY"&&(rel+="_BINARY"),this.prevQobj=_.clone(this.curQobj),this.curQobj=this.quesView,$(".infoButton",this.screen).attr("rel",rel);var ref=this;utils.hidePreloader(),$(".infoButton",this.screen).unbind().bind(assessEvent.CLICK,function(){}),$("#instructionsWrapper",this.screen).unbind().bind(assessEvent.CLICK,ref.hideQueInfo),$(".qno",this.screen).removeClass("selected"),$("#nav"+this.curIndex,this.screen).addClass("selected"),this.quesView.render(),this.prevQobj||$("#quesWrapper"+this.curQData.id,this.obj).removeClass("disableTemplate").addClass("enableTemplate")},toggleInstructions:function(){$(".instruction-content",this.obj).hasClass("open")?($(".instruction-content",this.obj).removeClass("open"),$(".instruction-content",this.obj).removeClass("up-arrow"),$(".instruction-content",this.obj).addClass("closed")):($(".instruction-content",this.obj).removeClass("closed"),$(".instruction-content",this.obj).addClass("open"),$(".instruction-content",this.obj).addClass("up-arrow")),this.refreshScroll()},evaluateQuestion:function(e){this.isBypass=!0,this.handleEvaluateClick()},showNextQuestion:function(e){this.initializeActivity(e)},refreshScroll:function(){this.initScroll()},showPreviousQuestion:function(e){this.initializeActivity(e)},updateResponse:function(e,t){t==[]&&delete this.responseData[e],this.saveResponse(e,t)},markEmpty:function(e){_quesView.saveResponse(e,[])},showQueInfo:function(e){qView=$(".infoButton",this.screen).attr("rel"),popupImage="";switch(qView){case AppConst.QUESTION_VIEW_FIB:popupImage=AppConst.QUESTION_INSTRUCTION_FIB;break;case AppConst.QUESTION_VIEW_FIB_VERTICAL:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_VERTICAL;break;case AppConst.QUESTION_VIEW_FIB_IMAGE_VERTICAL:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_IMAGE_VERTICAL;break;case AppConst.QUESTION_VIEW_FIB_IMAGE:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_IMAGE;break;case AppConst.QUESTION_VIEW_FIB_2COL:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_2COL;break;case AppConst.QUESTION_VIEW_FIB_TEXT:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_TEXT;break;case AppConst.QUESTION_VIEW_FIB_GAP_2COL_IMAGE_TEXT:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_GAP_2COL_IMAGE_TEXT;break;case AppConst.QUESTION_VIEW_FIB_GAP_2COL_AUDIO_TEXT:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_GAP_2COL_AUDIO_TEXT;break;case AppConst.QUESTION_VIEW_FIB_GAP:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_GAP;break;case AppConst.QUESTION_VIEW_FIB_GAP_2COL:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_GAP_2COL;break;case AppConst.QUESTION_VIEW_FIB_GAP_2COL_IMAGE:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_GAP_2COL_IMAGE;break;case AppConst.QUESTION_VIEW_FIB_GAP_2COL_AUDIO:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_GAP_2COL_AUDIO;break;case AppConst.QUESTION_VIEW_REORDERING:popupImage=AppConst.QUESTION_INSTRUCTION_REORDERING;break;case AppConst.QUESTION_VIEW_REORDERING_VERTICAL:popupImage=AppConst.QUESTION_INSTRUCTION_REORDERING_VERTICAL;break;case AppConst.QUESTION_VIEW_LABELLING:popupImage=AppConst.QUESTION_INSTRUCTION_LABELLING;break;case AppConst.QUESTION_VIEW_MCQ:popupImage=AppConst.QUESTION_INSTRUCTION_MCQ;break;case AppConst.QUESTION_VIEW_MCQ_2COL:popupImage=AppConst.QUESTION_INSTRUCTION_MCQ_2COL;break;case AppConst.QUESTION_VIEW_MCQ_TEXT:popupImage=AppConst.QUESTION_INSTRUCTION_MCQ_TEXT,e=="PICKER"&&(popupImage=AppConst.QUESTION_INSTRUCTION_MCQ_TEXT_PICKER);break;case AppConst.QUESTION_VIEW_MCQ_IMAGE:popupImage=AppConst.QUESTION_INSTRUCTION_MCQ_IMAGE;break;case AppConst.QUESTION_VIEW_MCQ_SOUND:popupImage=AppConst.QUESTION_INSTRUCTION_MCQ_SOUND;break;case AppConst.QUESTION_VIEW_MATCHSORT_VERTICAL:popupImage=AppConst.QUESTION_INSTRUCTION_MATCHSORT_VERTICAL;break;case AppConst.QUESTION_INSTRUCTION_GROUPING:popupImage=AppConst.QUESTION_INSTRUCTION_GROUPING;break;case AppConst.QUESTION_VIEW_IMAGE:popupImage=AppConst.QUESTION_INSTRUCTION_IMAGE;break;case AppConst.QUESTION_VIEW_GROUPING:popupImage=AppConst.QUESTION_INSTRUCTION_GROUPING;break;case AppConst.QUESTION_VIEW_FIB_AUDIO_2COL:popupImage=AppConst.QUESTION_INSTRUCTION_FIB_AUDIO_2COL;break;case AppConst.QUESTION_VIEW_FIBDROPDOWN:popupImage=AppConst.QUESTION_INSTRUCTION_FIBDROPDOWN;break;case AppConst.QUESTION_VIEW_BINARY:popupImage=AppConst.QUESTION_INSTRUCTION_BINARY;break;case AppConst.QUESTION_VIEW_BINARY_TABLE:popupImage=AppConst.QUESTION_INSTRUCTION_BINARY_TABLE;break;case AppConst.QUESTION_VIEW_OPENTEXT:popupImage=AppConst.QUESTION_INSTRUCTION_OPENTEXT;break;default:}$("#instructionsWrapper img",this.screen).attr("src",popupImage),$("#instructionsWrapper",this.screen).show()},hideQueInfo:function(){$("#instructionsWrapper",this.screen).hide()},showScreen:function(){var e=this;utils.screenTransition({curScreen:$("#"+this.model.get("uiId")+" #"+AppConst.QUESTION_PLAYER,this.$el),newScreen:$("#"+this.model.get("uiId")+" #"+AppConst.RESULT_SCREEN,this.$el),direction:this.direction,persistent:!1,handler:function(){e.destroy()}})},onTemplateReady:function(){var e=this;_isPersistable&&_options.checkAnswer==0&&$("#"+this.model.get("uiId")+" #"+AppConst.QUESTION_PLAYER,this.$el).addClass("no-badge");if(_isPopupView&&!_isEditPreview){var t=$("#ques"+this.curQData.id,this.screen),n=$("#content",this.screen).height();$("#ques"+this.curQData.id,this.screen).height(n)}this.handleTemplateEvents(),utils.hidePreloader(),_onContentLoaded(),_resetBtnClick=!1,$("#splashScreen",_widgetContent).length>0&&utils.screenTransition({curScreen:$("#splashScreen",_widgetContent),newScreen:$("#"+AppConst.QUESTION_PLAYER,_widgetContent),direction:"forward",persistent:!1,handler:function(){$("#splashScreen",_widgetContent).remove(),$("#splashScreen",_widgetContent).unbind()}})},updateTime:function(e){this.model&&this.model.set({timestamp:e})},onAnswerMarked:function(e){this.changeToolbarMode(e)},changeToolbarMode:function(e){this.isAnswered=!1,$(".footer_ico",this.obj).addClass("disabled"),$(".review_ico",this.obj).addClass("disabled"),this.prevBtnEnabled&&$("#prevQBtn",this.obj).removeClass("disabled"),this.nextBtnEnabled&&$("#nextQBtn",this.obj).removeClass("disabled");switch(e.mode){case AppConst.TOOLBAR_DEFAULT:$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).show(),$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).hide(),$("#"+AppConst.QBTN_ANSWERS,this.obj).removeClass("toggle"),$("#"+AppConst.QBTN_ANSWERS,this.obj).hide(),$("#"+AppConst.QBTN_EVALUATE,this.obj).show();break;case AppConst.TOOLBAR_ACTIVE:this.isAnswered=!0,$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).show(),$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).hide(),this.isTest||$("#"+AppConst.QBTN_EVALUATE,this.obj).removeClass("disabled"),$("#"+AppConst.QBTN_RESET,this.obj).removeClass("disabled"),_isPersistable&&this.reportButton.removeClass("disabled"),this.enableCluesIfAvailable();break;case AppConst.TOOLBAR_LOCKED:this.isAnswered=!0,$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).show(),$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).hide(),$("#"+AppConst.QBTN_ANSWERS,this.obj).show(),$("#"+AppConst.QBTN_RESET,this.obj).show(),$("#"+AppConst.QBTN_EVALUATE,this.obj).hide(),this.isTest?$("#"+AppConst.QBTN_RESET,this.obj).removeClass("disabled"):($("#"+AppConst.QBTN_ANSWERS,this.obj).removeClass("disabled toggle"),$("#"+AppConst.QBTN_RESET,this.obj).removeClass("disabled"));break;case AppConst.TOOLBAR_DISABLED:$("#"+AppConst.QBTN_ANSWERS,this.obj).removeClass("disabled");break;case AppConst.TOOLBAR_RESET:$("#"+AppConst.QBTN_ANSWERS,this.obj).removeClass("disabled");break;case AppConst.TOOLBAR_REVIEW_CORRECT:$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).hide(),$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).show(),$("#"+AppConst.QBTN_USER_ANS,this.obj).removeClass("disabled"),$("#"+AppConst.QBTN_CORRECT_ANS,this.obj).addClass("selected"),$("#"+AppConst.QBTN_USER_ANS,this.obj).removeClass("selected");break;case AppConst.TOOLBAR_REVIEW_USER:$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).hide(),$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).show(),$("#"+AppConst.QBTN_CORRECT_ANS,this.obj).removeClass("disabled"),$("#"+AppConst.QBTN_USER_ANS,this.obj).addClass("selected"),$("#"+AppConst.QBTN_CORRECT_ANS,this.obj).removeClass("selected");break;case AppConst.TOOLBAR_SPEAKING_ACTIVE:$("#"+AppConst.QBTN_RESET,this.obj).removeClass("disabled");break;case AppConst.TOOLBAR_SPEAKING:$("#"+AppConst.QBTN_RESET,this.obj).addClass("disabled")}_isPersistable&&_options.checkAnswer==0&&($("#"+AppConst.QBTN_ANSWERS,this.obj).hide(),$("#"+AppConst.QBTN_EVALUATE,this.obj).hide());if(this.isReview){var t=$("#reviewBtnsContainer",this.screen);$("#assessmentBtnsContainer",this.screen).hide()}else{var t=$("#assessmentBtnsContainer",this.screen);$("#reviewBtnsContainer",this.screen).hide()}t.find("#qMapDesktop").removeClass("disabled"),this.nextBtnEnabled?(t.find("#nextQBtn").removeClass("disabled"),t.find("#nextQBtn").unbind().bind(assessEvent.CLICK,this.nextBtnClick)):t.find("#nextQBtn").addClass("disabled"),this.prevBtnEnabled?(t.find("#prevQBtn").removeClass("disabled"),t.find("#prevQBtn").unbind().bind(assessEvent.CLICK,this.prevBtnClick)):t.find("#prevQBtn").addClass("disabled")},enableCluesIfAvailable:function(){$("#"+AppConst.QBTN_CLUES,this.obj).unbind(),this.clues!=""?($("#"+AppConst.QBTN_CLUES,this.obj).removeClass("disabled"),$("#"+AppConst.QBTN_CLUES,this.obj).removeAttr("disabled"),$("#"+AppConst.QBTN_CLUES,this.obj).bind(assessEvent.CLICK,this.cluesBtnClick)):($("#"+AppConst.QBTN_CLUES,this.obj).addClass("disabled"),$("#"+AppConst.QBTN_CLUES,this.obj).attr("disabled","disabled"),$("#"+AppConst.QBTN_CLUES,this.obj).unbind(assessEvent.CLICK))},handleMarkCorrect:function(e,t){t.id=e,this.userResponse=t,!this.isTest,this.changeToolbarMode({mode:AppConst.TOOLBAR_LOCKED}),this.saveResponse(e,t)},handleMarkIncorrect:function(e,t){t.id=e,this.userResponse=t,!this.isTest,this.changeToolbarMode({mode:AppConst.TOOLBAR_LOCKED}),this.saveResponse(e,t)},handleMarkAnswer:function(e,t){t.id=e,this.userResponse=t,!this.isTest,this.changeToolbarMode({mode:AppConst.TOOLBAR_LOCKED}),this.saveResponse(e,t)},initScroll:function(){utils.log("initScroll :: ",this.iScroll);if(!_isPopupView||_isEditPreview)return;if(this.disableIScroll!=1){var e=$("#footer",_popupView).get(0).offsetTop,t=$("#content",_popupView).get(0).offsetTop,n=e-t;$("#content",_popupView).height(n),$("#ques"+this.curQData.id,_popupView).height(n),$("#ques"+this.curQData.id,_popupView).css("overflow","hidden"),this.iScroll!=null&&this.iScroll.destroy(),this.iScroll=new IScroll($("#ques"+this.curQData.id,_popupView).get(0),{desktopCompatibility:!0,interactiveScrollbars:!0,scrollY:!0,keyBindings:!0}),ths=this,_.delay(function(){ths.iScroll.refresh()},999)}else this.quesView.initScroll();utils.log("initScroll 2:: ",this.iScroll)},handleAnimationComplete:function(e){this.currentView.applyCSS()},handleQuestionAnimationComplete:function(e){},enableButton:function(e){$("#"+e,this.obj).removeClass("disabled")},disableButton:function(e){$("#"+e,this.obj).addClass("disabled")},createQuesMap:function(e,t){var n="";n+='<div class="qmapUlWrappar"><ul class="phone">';for(var r=0;r<t.length;r++)t&&t[r].userResponse!=undefined?n+='<li id="nav'+r+'" class="qno phone attempted" data-id="'+e[r]+'">'+(r+1)+"</li>":n+='<li id="nav'+r+'" class="qno phone notattempted" data-id="'+e[r]+'">'+(r+1)+"</li>";n+="</ul></div>",$(".navigator",this.screen).QAprepend(n),$("#qMapDesktop",this.screen).QAprepend("<div class='showQMapBtn'></div>"),$("#qMapDesktop .showQMapBtn",this.screen).unbind().bind(assessEvent.CLICK,this.showQuesMap),$("#navigatorOverlay").unbind().bind(assessEvent.CLICK,this.hideQMap),$(".qno",this.obj).unbind().bind(assessEvent.CLICK,this.handleMapItemClick)},createQuesMapForDesktop:function(e,t){var n="";n+='<div class="mapDivOuter"><span class="prev disabled"></span><span id="mapDivWrapper"><ul id="mapDiv">';for(var r=0;r<t.length;r++)if(t[r]&&t[r].userResponse!=undefined){var i=t[r].status;if(i==AppConst.CORRECT)n+='<li id="nav'+r+'" class="qno correct" data-id="'+e[r]+'">'+(r+1)+"</li>";else if(i==AppConst.PARTIAL||i==AppConst.INCORRECT)n+='<li id="nav'+r+'" class="qno incorrect" data-id="'+e[r]+'">'+(r+1)+"</li>"}else n+='<li id="nav'+r+'" class="qno" data-id="'+e[r]+'">'+(r+1)+"</li>";n+='</ul></span><span class="next"></span></div>',this.isReview?$("#"+AppConst.REVIEW_BTNS_DIV,this.obj).find("#qMapDesktop").QAprepend(n):$("#"+AppConst.ASSESSMENT_BTNS_DIV,this.obj).find("#qMapDesktop").QAprepend(n),this.createCrousal(),$(".qno",this.obj).unbind().bind(assessEvent.CLICK,this.handleMapItemClick)},createCrousal:function(){var e=this,t=require.s.contexts._.config.theme,n=isNaN(parseInt($("#mapDiv",e.obj).find("li").css("margin-left")))?0:parseInt($("#mapDiv",e.obj).find("li").css("margin-left"));n+=isNaN(parseInt($("#mapDiv",e.obj).find("li").css("margin-right")))?0:parseInt($("#mapDiv",e.obj).find("li").css("margin-right"));var r=$("#mapDiv",e.obj).find("li").outerWidth()+n,i=$("#qMapDesktop",e.obj).outerWidth()-$(".prev",e.obj).width()-$(".next",e.obj).width();i=i>r?i:r,window.navigator.userAgent.toLowerCase().indexOf("firefox")||window.navigator.userAgent.toLowerCase().indexOf("MSIE")?_reqConfig!=="cup"&&($("#mapDivWrapper",e.obj).width(i),$("#mapDiv",e.obj).width(i)):_reqConfig!=="cup"&&($("#mapDivWrapper",e.obj).css("width",i+"px !important"),$("#mapDiv",e.obj).css("width",i+"px !important")),e._visibleElement=Math.floor(i/r),e._visibleElement=e._visibleElement==0?1:e._visibleElement;var s=Math.ceil(this.responseData.length/e._visibleElement),o='<div class="pagination" id="pagination" style="display: none;"></div>';$("#qMapDesktop",e.obj).QAappend(o),$("#page1",e.obj).addClass("selected"),$("#mapDiv",e.obj).carouFredSel({auto:!1,prev:".prev",next:".next",pagination:"#pagination",circular:!1,visibleItemCount:e._visibleElement,infinite:!1,mousewheel:!1,synchronise:!1,swipe:{onMouse:!0,onTouch:!0}}),$("#pagination",e.obj).hide(),window.navigator.userAgent.toLowerCase().indexOf("firefox")||window.navigator.userAgent.toLowerCase().indexOf("MSIE")?_reqConfig!=="cup"&&($("#mapDivWrapper",e.obj).width(i),$("#mapDiv",e.obj).width(i)):_reqConfig!=="cup"&&($("#mapDivWrapper",e.obj).css("width",i+"px !important"),$("#mapDiv",e.obj).css("width",i+"px !important")),e._visibleElement>=this.questionids.length&&$(".next",e.obj).addClass("disabled")},showQuesMap:function(){var e=$(".navigator",this.screen),t=$("#navigatorOverlay",this.screen);if(!this.isNavigatorVisible){$("#navigatorOverlay",this.screen).show(),$(".navigator",this.screen).removeClass("hidden");var n=$(".qmapUlWrappar",this.screen).height();$(".qmapUlWrappar",this.screen).css("position","relative"),this.mapScroll&&(this.mapScroll.destroy(),this.mapScroll=null),this.mapScroll=new IScroll($(".qmapUlWrappar",this.screen).get(0),{desktopCompatibility:!0,hScroll:!0});var r=this.mapScroll;_.delay(function(){r.refresh()},50),this.isNavigatorVisible=!0}else this.hideQMap()},hideQMap:function(){this.mapScroll&&(this.mapScroll.destroy(),this.mapScroll=null),$(".navigator",this.screen).addClass("hidden"),$("#navigatorOverlay",this.screen).hide(),this.isNavigatorVisible=!1},handleMapItemClick:function(e){var t=parseInt(e.target.id.split("nav")[1]);this.hideQMap(),t!=this.curIndex&&($(".overlay",this.screen).show(),t>this.curIndex?this.direction="forward":this.direction="reverse",(this.isBypass!=1&&this.isAnswered==1&&this.quesView.EvaluateFlag==0||this.partialAttempt==0&&this.isAnswered==1)&&this.handleEvaluateClick(),this.curIndex=t,this.handlePreviousandNextClick(),this.getQuestionData(this.questionids[t]))},orientationchange:function(e){this.iScroll!=null&&(this.iScroll.destroy(),_.delay(this.initScroll,1e3));var t=this.quesView;_.delay(function(){t.orientationchange(e)},600)},destroyPrev:function(){utils.log("destroying previous",this.prevQobj.model.get("id")),$("#ques"+this.prevQobj.model.get("id"),this.screen).unbind(),$("#ques"+this.prevQobj.model.get("id"),this.screen).parent().remove(),this.navigatorsDisabled=!1,$(".overlay",this.screen).hide()},destroy:function(){var e=$(".qinstructions",this.screen);this.quesView&&this.quesView.destroy(),$(".header-right-btn",this.screen).unbind(),$(".header-left-btn",this.screen).unbind(),$("#resetQBtn",this.screen).unbind(),$("#"+AppConst.QBTN_ANSWERS,this.screen).unbind(),$("#"+AppConst.QBTN_EVALUATE,this.screen).unbind(),$("#"+AppConst.QBTN_CORRECT_ANS,this.screen).unbind(),$("#"+AppConst.QBTN_USER_ANS,this.screen).unbind(),$("#"+AppConst.QBTN_CLUES,this.obj).unbind(),$(".ui-maximize",this.obj).unbind(),this.reportButton.unbind(),$("#feedbackBtn",this.screen).unbind(),e.unbind(),this.quesView.unbind(),$(".infoButton",this.screen).unbind(),$("#instructionsWrapper",this.screen).unbind(),$("#reviewBtnsContainer",this.screen).find("#nextQBtn").unbind(),$("#assessmentBtnsContainer",this.screen).find("#nextQBtn").unbind(),$("#reviewBtnsContainer",this.screen).find("#prevQBtn").unbind(),$("#assessmentBtnsContainer",this.screen).find("#prevQBtn").unbind(),$(".qMap",this.screen).unbind(),$("#closeQMap",this.obj).unbind(),$(".qno",this.obj).unbind(),this.screen.unbind(),this.screen.remove()}}),assessmentWidgetView=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(_widgetObj={},_widgetObj.id=(new Date).getTime(),_directLaunch=!0):_widgetObj=e.obj,_isEditPreview=e.editPreview,_isListPreview=e.listPreview,_options=e.options,_popupView=e.popupView,_instance=this,_bookURL=_options.bookURL},initCurrWidget:_initialize,destroy:_destroy,widgetResize:_widgetResize,relayout:_relayout,widgetType:_widgetType,onCloseAllWidgets:_onCloseAllWidgets,launch:_launchAssessmentPopup,populateInlineView:_populateInlineView,onPopupShown:_onPopupShown,refreshScroll:_refreshScroll,destroyView:_destroyView});return new assessmentWidgetView(data)};return assessmentWidget}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/inlineViewTemplate.html",[],function(){return"<div class='ui-tip-widget invisible widget-ui ui-border ' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='widget-tip-wrapper'>\r\n		<!--div class='inline-widget-header'>\r\n			<div class='ui-tip-icon'></div>\r\n			<div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n		</div-->\r\n		<div class='tip-list-container'>\r\n			<ul class='ui-tip-list'></ul>\r\n		</div>\r\n		<div class='inline-widget-footer'>\r\n			<!--<div class='ui-tip-icon'></div>-->\r\n            <div class=\"ui-tip-icon icon icon-ic-tip\"></div>\r\n			<div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n			<!--<div class='ui-maximize ui-right-div-control'></div>-->\r\n            <div class=\"ui-maximize ui-right-div-control icon icon-ic-fullscreen\"></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/popupViewTemplate.html",[],function(){return"<div class='ui-tip-widget widget-ui ui-border ' id='<%=uiId%>' >\n	<div class='widget-tip-wrapper'>\n		<div class='tip-list-container'>\n			<ul class='ui-tip-list'></ul>\n		</div>\n	</div>\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/tipsListTemplate.html",[],function(){return"<% _.each(tips, function(item) { %>\n	<li><%=item%></li>\n<% }); %>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui invisible print-border ' id='<%=uiId%>' style='width: <%=width%>;' >\n	<div class='print-widget-header'>\n        <div class=\"ui-tip-icon icon icon-ic-tip\"></div>\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\n	</div>\n	<div id=\"widgetContent\">\n		<ul class='ui-tip-list'>\n			<% _.each(tips, function(item) { %>\n				<li><%=item%></li>\n			<% }); %>\n		</ul>\n	</div>\n</div>"}),define("com/es/widgets/tips/tipsWidget",["com/es/widgets/WidgetUtils","com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/tipsListTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/tipView/printViewTemplate.html"],function(e,t,n,r,i,s){var o=function(o){var u,a,f,l,c,h,p,d,v,m,g,y,b=WIDGET_CONSTANTS.TIP_MIN_WIDTH,w=WIDGET_CONSTANTS.TIP_MIN_HEIGHT,E={},S=!1,x=null,T=!1,N,C=function(){e.log("init tip",u),d=a.bookFrameContent,v=a.bookFrameContentRootEl;if(a.data_json){var t=a.data_json,n=f.split("/");n.pop(),n=n.join("/")+"/"+a.dataURL;var r=n.split("/");r.pop(),l=r.join("/")+"/",L(t)}else k()},k=function(){var t=f.split("/");t.pop(),t=t.join("/")+"/"+a.dataURL,e.log("url",t);var n=t.split("/");n.pop(),l=n.join("/")+"/",e.log("_resourceURL",l),$.getJSON(t,{}).done(function(e){L(e)}).fail(function(t,n,r){e.log("error",r),u.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},L=function(t){p=t,e.log("onDataLoaded ",t),p.formattedTitle&&(p.title=p.formattedTitle),WIDGET_CONSTANTS.PRINT_MODE?A():S||F(),e.log("tips widget initialized ",u),u.trigger(WIDGET_EVENTS.INITIALIZED,u)},A=function(){M(),E={uiId:"ui-"+c.id,tips:p.tips,title:p.title,width:$("#"+c.id,a.bookFrameContent).width()+"px"};var t=_.template(s,E);e.log("str",t),$("#"+E.uiId,d).remove(),a.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?v.QAappend(t):($("#"+c.id,d).empty().addClass("reflow-print").QAappend(t),$("#"+c.id,d).find(".icon").addClass("reflow-print")),u.trigger(WIDGET_EVENTS.RENDER_COMPLETE,u)},O=function(){T&&(a.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(M(),D()),a.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?P():H())},M=function(){if(a.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+c.id,d).width();e<b&&$("#"+c.id,d).width(b),e>y&&$("#"+c.id,d).width(y)}},D=function(){if(a.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE||a.layout===WIDGET_CONSTANTS.DATA_LAYOUT_REFLOW){var e=$("#"+c.id,a.bookFrameContent).width();$("#ui-"+c.id,a.bookFrameContent).width(e);var t=$(".ui-tip-widget#"+E.uiId,a.bookFrameContent),n=$(t).find(".tip-list-container").height()+$(t).find(".inline-widget-footer").height();E.height=n,$("#"+c.id,a.bookFrameContent).css("height",E.height+"px"),$("#ui-"+c.id,a.bookFrameContent).css("height",E.height+"px"),$("#"+c.id,a.bookFrameContent).html()!=""&&z()}},P=function(){var t=$("#"+c.id,d),n=e.getOffset(t).left,r=e.getOffset(t).top,i=$(t).width(),s=$(t).height(),o=$("#ui-"+t.get(0).id,d).get(0);$(o).css({top:r,left:n,width:i+"px",height:s+"px",position:"absolute"})},H=function(){e.log("_setDimensions-------------------------"),$("#"+c.id,d).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+c.id,d)).left,n=e.getOffset($("#"+c.id,d)).top,r=$("#"+c.id,d).width(),i=$("#"+c.id,d).height(),m=$("#ui-"+c.id,d).get(0),a.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT?a.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(m).css({top:n+"px",left:t+"px",position:"absolute"}):$(m).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}):$(m).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+E.uiId,d).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},B=function(){},j=function(){e.log("ImageGalleryWidget > relayout")},F=function(){y=v.width(),M();var r=c.id;E={id:r,uiId:"ui-"+c.id,widgetId:"widget-"+c.id,tips:p.tips,title:p.title,width:$("#"+c.id,a.bookFrameContent).width()+"px"};var s=_.template(t,E);e.log("---str ",s);var o=$("#"+c.id,d).get(0).innerHTML;o=o.trim(),o.length==0?($("#"+c.id,d).get(0).innerHTML=s,v.append($("#"+E.uiId,d))):v.append(s);var f=_.template(i,{tips:E.tips});e.log("---tipsStr",f),$(".ui-tip-list",$("#ui-"+c.id,d)).html(f),$("#"+c.id,d).removeClass("widget-loader"),$("#"+c.id,d).find(".move-icon").removeClass("move-icon-compact");var l=$("#ui-"+c.id,d).get(0);m=l,P();var h="ui-"+c.id,S=$("#"+h,d);g=S;if(a.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){H(),z();var x=$("#"+c.id,d).width();x<b&&($("#"+c.id,d).width(b),$("#ui-"+c.id,d).width(b));if(a.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){E.uiId="ui-"+c.id;var s=_.template(n,{id:E.uiId}),o=$("#"+c.id,d).get(0).innerHTML;o=o.trim(),o.length==0?($("#"+c.id,d).get(0).innerHTML=s,v.append($("#div-border-"+E.uiId,d))):v.append(s),$("#div-border-"+E.uiId,d).css({width:$(m).width()+"px",height:$(m).height()+"px",top:m.style.top,left:m.style.left,position:"absolute"}),$("#div-border-"+E.uiId,d).addClass("transparentWidget ui-hover-class"),$("#div-border-"+E.uiId,d).css({"pointer-events":"none"})}e.log("inline",$(".inline-widget-footer",g.get(0))),$(".inline-widget-footer",g.get(0)).remove(),$(".tip-list-container",g.get(0)).remove(),$(".widget-tip-wrapper",g.get(0)).remove(),$(".ui-button-div",g.get(0)).remove(),$("#"+c.id,d).find(".move-icon").addClass("move-icon-compact"),$("#"+E.uiId,d).QAappend('<div class="ui-clickable-icon ui-tip-icon icon-font"></div>'),g.addClass("transparentWidget"),g.removeClass("ui-border"),$(g).css({width:$(".ui-clickable-icon",g).width()+"px",height:$(".ui-clickable-icon",g).height()+"px"}),$("#"+c.id+" .dummyWidget",d).show(),a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+c.id,d).css({width:$(".ui-clickable-icon",m).width()+"px",height:$(".ui-clickable-icon",m).height()+"px"}),$("#"+c.id+" .dummyWidget",d).hide()),$(".ui-tip-icon",g.get(0)).click({},W)}else if(a.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER){var N=$("#widget-"+c.id,g.get(0));_posterView=N,$(N).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize ui-tip-button'></div></div>"),$(".ui-maximize",N).click({},W),w=b}else a.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(w=$(m).height(),D());$(".ui-maximize",g.get(0)).click({},W)}else $(".ui-maximize",g.get(0)).click({},W);D(),a.align!="fitToWidth"&&$("#"+c.id,d).css("width",$(c).data("width")),T=!0,u.trigger(WIDGET_EVENTS.RENDER_COMPLETE,u,y,b,w)},I=function(){M(),D(),P()},q=function(){a.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_SHOW?$(g.get(0)).addClass("ui-hover-class"):$(g.get(0)).hover(R,U)},R=function(){$(g.get(0)).addClass("ui-hover-class")},U=function(){$(g.get(0)).removeClass("ui-hover-class")},z=function(){var e=$("#"+c.id,d).height();e<w&&($("#"+c.id,d).height(w),$("#ui-"+c.id,d).height(w))},W=function(e){h.addClass("tip-popup");var t={type:"info"};u.trigger(WIDGET_EVENTS.LAUNCHED,u),u.trigger(WIDGET_EVENTS.XAPI_EVENT,u,t)},X=function(){x!=null&&x.destroy(),x=new IScroll($(".tip-list-container",N).get(0),{desktopCompatibility:!0,vScroll:!0,hScroll:!1}),_.delay(function(){x&&x.refresh()},999)},V=function(){N=$("#widgetContent",h);var t="";S?t=(new Date).getTime():t=c.id;var n={uiId:t,tips:p.tips,title:p.title,width:a.width,height:a.height};$("#widgetContent").html(_.template(r,n)),$(".gal-title",h).html(unescape(p.title));var s=_.template(i,{tips:n.tips});e.log("---tipsStr",s),$("#widgetContent").find(".ui-tip-list").html(s),X(),u.trigger(WIDGET_EVENTS.POPULATED,u,200,200)},J=function(){x!=null&&x.destroy(),$(".gal-title",h).html(""),N.empty(),h.removeClass("tip-popup"),u.trigger(WIDGET_EVENTS.DESTROYED,u)},K=function(){return WIDGET_CONSTANTS.TIP_WIDGET},Q=function(e){var t=$(m).get(0).scrollHeight;$("#"+c.id,a.bookFrameContent).css({height:t+"px"})},G=function(){$("#"+c.id,d).remove(),$("#ui-"+c.id,d).remove()},Y=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?S=!0:c=e.obj,a=e.options,h=e.popupView,u=this,f=a.bookURL},initCurrWidget:C,destroy:J,resize:j,relayout:O,widgetType:K,onFontChange:Q,onPopupShown:V,launch:W,destroyView:G});return new Y(o)};return o}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/inlineViewTemplate.html",[],function(){return"<div class='ui-html-widget invisible widget-ui ui-border ' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='widget-html-wrapper'>\r\n		<div class='html-link-div'>\r\n			<div class='html-<%=unescape(type)%>-icon'></div>\r\n			<div id=\"widget-url\" class='ui-gal-text-left'></div>\r\n		</div>\r\n		<!--div class='html-widget-desc'>\r\n			<%=unescape(description)%>\r\n		</div-->\r\n		<div class='inline-widget-footer'>\r\n			<div class=\"ui-html-icon icon icon-ic-code widget-weblink-icon-style\"></div>\r\n			<div class='ui-gal-text-left html-widget-text-style'><%=unescape(title)%></div>\r\n			<!--<div class='ui-maximize ui-right-div-control'></div>-->\r\n            <div class=\"ui-maximize ui-right-div-control icon icon-ic-fullscreen\"></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/weblinkPopupViewTemplate.html",[],function(){return"<div class='ui-html-widget widget-ui ui-border ' id='<%=uiId%>' >\n	<div class='widget-html-wrapper'>\n		<div class=\"file-list-container\">\n			<div class='html-link-div'>\n				<div class=\"content-wrapper bottom-gray-border\">\n					<div class='html-<%=unescape(type)%>-icon'></div>\n					<div class='ui-gal-text-left'><%= WidgetLang.LAUNCH_HTML_LABEL%></div>\n				</div>\n\n				<div class=\"media html-widget-popUp-content\">\n				  <div class=\"media-body\">\n				  	<div class=\"media-object icon icon-ic-info-content\"></div>\n				    <p class=\"media-heading\"><%=unescape(description)%></p>\n				  </div>\n				</div>				\n			</div>\n		</div>\n	</div>\n</div>\n<!--div class='html-info-text info-text'>\n	<div class='html-info-description info-description'>\n		<div><%=unescape(description)%></div>\n	</div>\n</div-->\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='print-widget-header'>\r\n		<div class=\"ui-html-icon icon icon-ic-code widget-weblink-icon-style\"></div>\r\n		<div class='ui-gal-text-left html-widget-text-style'><%=unescape(title)%></div>\r\n	</div>\r\n	\r\n	<%\r\n	var str;\r\n	if(type == \"package\"){\r\n		str = WidgetLang.HTML_PACKAGE_PRINT_NOTE;\r\n	}else{\r\n		str = WidgetLang.HTML_WEBLINK_PRINT_NOTE.replace(\"<url>\",url);\r\n		\r\n	}\r\n	%>\r\n	<div class=\"print-widget-note\"><%=str%></div>\r\n</div>\r\n"}),define("com/es/widgets/html/htmlWidget",["com/es/widgets/WidgetUtils","com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/weblinkPopupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/htmlView/printViewTemplate.html"],function(e,t,n,r,i){var s=function(s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b=WIDGET_CONSTANTS.HTML_MIN_WIDTH,w=WIDGET_CONSTANTS.HTML_MIN_HEIGHT,E={},S=!1,x=null,T=!1,N=[],C,k=!1,L=function(){e.log("init html",o),p=u.bookFrameContent,d=u.bookFrameContentRootEl;if(u.data_json){var t=u.data_json,n=a.split("/");n.pop(),n=n.join("/")+"/"+u.dataURL;var r=n.split("/");r.pop(),f=r.join("/")+"/",O(t)}else A()},A=function(){var t=a.split("/");t.pop(),t=t.join("/")+"/"+u.dataURL,e.log("url",t);var n=t.split("/");n.pop(),f=n.join("/")+"/",e.log("_resourceURL",f),$.getJSON(t,{}).done(function(e){O(e)}).fail(function(t,n,r){e.log("error",r),o.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},O=function(t){h=t,h.formattedTitle&&(h.title=h.formattedTitle),e.log("onDataLoaded html widget",t),WIDGET_CONSTANTS.PRINT_MODE?M():S||D(),e.log("tips widget initialized ",o),o.trigger(WIDGET_EVENTS.INITIALIZED,o)},M=function(){y=d.width(),F(),E={uiId:"ui-"+l.id,title:h.title,type:h.type,url:h.url,description:h.description,width:$("#"+l.id,p).width()+"px"};var t=_.template(i,E);e.log("str",t),$("#"+E.uiId,p).remove(),u.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?d.QAappend(t):($("#"+l.id,p).empty().addClass("reflow-print").QAappend(t),$("#"+l.id,p).find(".icon").addClass("reflow-print")),o.trigger(WIDGET_EVENTS.RENDER_COMPLETE,o)},D=function(){y=d.width(),F(),E={uiId:"ui-"+l.id,title:h.title,type:h.type,url:h.url,description:h.description,width:$("#"+l.id,p).width()+"px"};var n=_.template(t,E);e.log("str",n),$("#"+E.uiId,p).remove(),d.QAappend(n),$("#"+E.uiId+" #widget-url",p).html(WidgetLang.LAUNCH_HTML_LABEL),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&h.type=="package"&&($("#"+E.uiId+" .widget-html-wrapper",p).QAappend("<div class='download-widget-blue-corner' ><span class='download-widget-icon'></span></div>"),$("#"+E.uiId+" .download-widget-icon",p).addClass("white-download-status-"+N[0].downloadStatus),$("#"+E.uiId+" .download-widget-icon",p).unbind("click").bind("click",B)),H($("#"+l.id,p),h),_.delay(function(){P()},50)},P=function(){v=$("#ui-"+l.id,p).get(0),m=$("#ui-"+l.id,p),$("#"+l.id,p).removeClass("widget-loader"),$("#"+l.id,p).find(".move-icon").removeClass("move-icon-compact"),$("#"+l.id,p).attr("data-size",E.size),I();if(u.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){W(),U();var e=$("#"+l.id,p).width();e<b&&($("#"+l.id,p).width(b),$("#ui-"+l.id,p).width(b));if(u.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(u.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){E.uiId="ui-"+l.id;var t=_.template(n,{id:E.uiId});d.QAappend(t),$("#div-border-"+E.uiId,p).css({width:$(v).width()+"px",height:$(v).height()+"px",top:v.style.top,left:v.style.left,position:"absolute"}),$("#div-border-"+E.uiId,p).addClass("transparentWidget ui-hover-class"),$("#div-border-"+E.uiId,p).css({"pointer-events":"none"})}$(".widget-html-wrapper",m.get(0)).remove(),$(".ui-button-div",m.get(0)).remove(),$("#"+l.id,p).find(".move-icon").addClass("move-icon-compact"),$("#ui-"+l.id,p).html('<div class="ui-clickable-icon ui-html-icon icon-font"></div>'),m.addClass("transparentWidget"),m.removeClass("ui-border"),$(m).css({width:$(".ui-clickable-icon",m).width()+"px",height:$(".ui-clickable-icon",m).height()+"px"}),$("#"+l.id+" .dummyWidget",p).show(),u.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+l.id,p).css({width:$(".ui-clickable-icon",v).width()+"px",height:$(".ui-clickable-icon",v).height()+"px"}),$("#"+l.id+" .dummyWidget",p).hide()),$(".ui-html-icon",m.get(0)).click({},K)}else u.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?($(".html-link-div",m.get(0)).remove(),$(".html-widget-desc",m.get(0)).remove(),$(".widget-html-wrapper",m.get(0)).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize ui-html-button'></div></div>"),w=b):u.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(w=$(v).height(),I())}else w=$(v).height();T=!0,$("#"+E.uiId+" .html-weblink-icon",p).off("click").on("click",X),$("#"+E.uiId+" .html-package-icon",p).off("click").on("click",X),$("#"+E.uiId+" #widget-url",p).off("click").on("click",X),$(".ui-maximize",v).click({},K),o.trigger(WIDGET_EVENTS.RENDER_COMPLETE,o,y,b,w)},H=function(e,t){t.type=="package"?($(e).attr({"data-fileSize":t.size,"data-downloadable":!0,"data-launchFile":t.url,"data-downloadUrl":t.zip}),$("#"+E.uiId+" .ui-html-icon",p).removeClass("widget-weblink-icon-style icon-ic-weblink").addClass("widget-html-icon-style")):$(e).attr({"data-fileSize":0,"data-downloadable":!1,"data-launchFile":"","data-downloadUrl":""})},B=function(e){var t=N[0].id,n=N[0].downloadStatus;switch(parseInt(n)){case 0:n=1;break;case 1:case 2:n=2;break;case 3:n=3;break;default:}o.trigger(WIDGET_EVENTS.DOWNLOAD_ACTION,l.id,t,n)},j=function(e,t,n){N[0].downloadStatus=t,$("#ui-"+l.id+" .download-widget-icon",p).removeClass("white-download-status-0 white-download-status-1 white-download-status-2 white-download-status-3"),$("#ui-"+l.id+" .download-widget-icon",p).addClass("white-download-status-"+t);if(C){var r=C.find("#"+l.id);r.length>0&&($("#widget-header .download-widget-icon",c).removeClass("download-status-0 download-status-1 download-status-2 download-status-3"),$("#widget-header .download-widget-icon",c).addClass("download-status-"+t))}},F=function(){if(u.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+l.id,p).width();e<b&&$("#"+l.id,p).width(b),e>y&&$("#"+l.id,p).width(y)}},I=function(){if(u.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE||u.layout===WIDGET_CONSTANTS.DATA_LAYOUT_REFLOW){var e=$("#"+l.id,u.bookFrameContent).width();$("#ui-"+l.id,u.bookFrameContent).width(e);var t=$("#ui-"+l.id,u.bookFrameContent),n=$(t).find(".widget-html-wrapper").height()+$(t).find(".inline-widget-footer").height();E.height=n,$("#"+l.id,u.bookFrameContent).css("height",E.height+"px"),$("#ui-"+l.id,u.bookFrameContent).css("height",E.height+"px")}$("#"+l.id,u.bookFrameContent).html()!=""&&U()},q=function(){F(),I(),z()},R=function(){T&&(u.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(F(),U()),u.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?z():W())},U=function(){var e=$("#"+l.id,p).height();e<w&&($("#"+l.id,p).height(w),$("#ui-"+l.id,p).height(w))},z=function(){var t=$("#"+l.id,p),n=e.getOffset(t).left,r=e.getOffset(t).top,i=$(t).width(),s=$(t).height(),o=$("#ui-"+t.get(0).id,p).get(0);$(o).css({top:r+"px",left:n+"px",width:i+"px",height:s+"px",position:"absolute"})},W=function(){e.log("_setDimensions-------------------------"),$("#"+l.id,p).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+l.id,p)).left,n=e.getOffset($("#"+l.id,p)).top,r=$("#"+l.id,p).width(),i=$("#"+l.id,p).height(),v=$("#ui-"+l.id,p).get(0),u.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT?u.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(v).css({top:n+"px",left:t+"px",position:"absolute"}):$(v).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}):$(v).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),u.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+E.uiId,p).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},X=function(){if(k==1)return;k=!0;var e=J();e=encodeURI(e);var t={type:"html-"+h.type};o.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,e,h.title,h.type,o),o.trigger(WIDGET_EVENTS.XAPI_EVENT,o,t),_.delay(V,500)},V=function(){k=!1},J=function(){var t="";return h.type=="weblink"?t=h.url:WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&N[0].downloadStatus==3?t=WIDGET_CONSTANTS.DOWNLOADED_ASSETS_URL+h.url:t=WIDGET_CONSTANTS.ASSETS_URL+h.url,t=e.getCleanURL(t),t},K=function(){c.addClass("html-popup-widget"),o.trigger(WIDGET_EVENTS.LAUNCHED,o)},Q=function(){C=$("#widgetContent",c);var e="";!S||N.length?e=l.id:e=(new Date).getTime();var t={uiId:e,title:h.title,type:h.type,url:h.url,description:h.description,width:u.width};$("#widgetContent").html(_.template(r,t)),t.description.trim().length==0&&$(".media",c).hide(),$(".html-weblink-icon",c).off("click").on("click",X),$(".html-package-icon",c).off("click").on("click",X),$(".ui-gal-text-left",c).off("click").on("click",X),$(".gal-title",c).html(unescape(h.title)),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&h.type=="package"&&($("#widget-header",c).QAappend("<span class='download-widget-icon'></span>"),$("#widget-header .download-widget-icon",c).addClass("download-status-"+N[0].downloadStatus),$("#widget-header .download-widget-icon",c).unbind("click").bind("click",B)),G(),o.trigger(WIDGET_EVENTS.POPULATED,o,200,200)},G=function(){x!=null&&x.destroy(),x=new IScroll($(".file-list-container",C).get(0),{desktopCompatibility:!0,vScroll:!0,hScroll:!1}),_.delay(function(){x&&x.refresh()},999)},Y=function(){return WIDGET_CONSTANTS.HTML_WIDGET},Z=function(e){var t=$(v).get(0).scrollHeight;$("#"+l.id,u.bookFrameContent).css({height:t+"px"})},et=function(){$(".html-link-div",c).off(),$("#widget-header .download-widget-icon",c).unbind(),$(".gal-title",c).html(""),C.empty(),c.removeClass("html-popup-widget"),o.trigger(WIDGET_EVENTS.DESTROYED,o)},tt=function(){$("#"+E.uiId+" .html-link-div",p).off(),$("#"+E.uiId+" .download-widget-icon",p).unbind(),$("#"+l.id,p).remove(),$("#ui-"+l.id,p).remove()},nt=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(S=!0,e.widgetEnrichmentArr.length&&(l={},l.id=_.findWhere(e.widgetEnrichmentArr,{level:0}).widgetId)):l=e.obj,u=e.options,c=e.popupView,o=this,a=u.bookURL,N=e.widgetEnrichmentArr},initCurrWidget:L,destroy:et,relayout:R,widgetType:Y,onFontChange:Z,widgetResize:q,onPopupShown:Q,launch:K,updateDownloadStatus:j,destroyView:tt});return new nt(s)};return s}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/inlineViewTemplate.html",[],function(){return"<div class='ui-file-widget invisible widget-ui ui-border ' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='widget-file-wrapper'>\r\n		<ul>\r\n			<% _.each(obj.files,function(file){%>\r\n				<li class='file-item '>\r\n					<span class='name icon <%=unescape(file.ext)%>'  data-url='<%=unescape(file.url)%>' data-title='<%=unescape(file.name)%>'><%=unescape(file.name)%></span>\r\n				</li>\r\n			<%}) %>\r\n		</ul>\r\n		<!--div class='file-widget-desc'>\r\n			<%=unescape(description)%>\r\n		</div-->\r\n		<div class='inline-widget-footer'>\r\n			<!--<div class='ui-file-icon'></div>-->\r\n            <div class=\"ui-file-icon icon icon-file\"></div>\r\n			<div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n			<!--<div class='ui-maximize ui-right-div-control'></div>-->\r\n            <div class=\"ui-maximize ui-right-div-control icon icon-ic-fullscreen\"></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/popupViewTemplate.html",[],function(){return"<div class='ui-file-widget  widget-ui ui-border ' id='<%=uiId%>' >\n	<div class='widget-file-wrapper'>\n\n		<div class='file-list-container'>\n			<ul class='ui-file-list'>\n				<% _.each(obj.files,function(file){%>\n					<li class='file-item ' >\n						<span class='name icon <%=unescape(file.ext)%>' data-url='<%=unescape(file.url)%>' data-title='<%=unescape(file.name)%>'><%=unescape(file.name)%></span>\n					</li>\n				<%}) %>\n\n				<li class=\"list-item file-info-desc\">\n					<div class=\"media\">\n					  <div class=\"media-body\">\n					    <div class=\"media-object icon icon-ic-info-content\"></div>\n					    <p class=\"media-heading\"><%=unescape(description)%></p>\n					  </div>\n					</div>				\n				</li>\n			</ul>\n		</div>\n\n	</div>\n</div>\n<!--div class='file-info-text info-text'>\n	<div class='file-info-description info-description' ><%=unescape(description)%></div>\n</div-->\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\n	<div class='print-widget-header'>\n		<!--<div class='ui-file-icon'></div>-->\n        <div class=\"ui-file-icon icon icon-file\"></div>\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\n	</div>\n	<div class=\"print-widget-note\">\n		<%= WidgetLang.FILE_PRINT_NOTE.replace(\"<count>\",files.length) %>\n	</div>\n</div>\n"}),define("com/es/widgets/file/fileWidget",["com/es/widgets/WidgetUtils","com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/fileView/printViewTemplate.html"],function(e,t,n,r,i){var s=function(s){var o,u,a,f,l,c,h,p,d,v,m,g=["doc","xls"],y,b=WIDGET_CONSTANTS.FILE_MIN_WIDTH,w=WIDGET_CONSTANTS.FILE_MIN_HEIGHT,E={},S=!1,x=null,T=!1,N=[],C,k=!1,L=function(){e.log("init file widget",o),p=u.bookFrameContent,d=u.bookFrameContentRootEl;if(u.data_json){var t=u.data_json,n=a.split("/");n.pop(),n=n.join("/")+"/"+u.dataURL;var r=n.split("/");r.pop(),f=r.join("/")+"/",O(t)}else A()},A=function(){var t=a.split("/");t.pop(),t=t.join("/")+"/"+u.dataURL,e.log("url",t);var n=t.split("/");n.pop(),f=n.join("/")+"/",e.log("_resourceURL",f),$.getJSON(t,{}).done(function(e){O(e)}).fail(function(t,n,r){e.log("error",r),o.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},O=function(t){h=t,h.formattedTitle&&(h.title=h.formattedTitle),e.log("onDataLoaded file widget",t),WIDGET_CONSTANTS.PRINT_MODE?M():S||D(),e.log("file widget initialized ",o),o.trigger(WIDGET_EVENTS.INITIALIZED,o)},M=function(){F(),E={uiId:"ui-"+l.id,src:e.getCleanURL(f+h.src),title:h.title,description:h.description,width:$("#"+l.id,p).width()+"px",files:h.files};var t=_.template(i,E);e.log("str",t),$("#"+E.uiId,p).remove(),u.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?d.QAappend(t):($("#"+l.id,p).empty().addClass("reflow-print").QAappend(t),$("#"+l.id,p).find(".icon").addClass("reflow-print")),o.trigger(WIDGET_EVENTS.RENDER_COMPLETE,o)},D=function(){y=d.width(),F(),E={uiId:"ui-"+l.id,title:h.title,description:h.description,files:h.files,width:$("#"+l.id,p).width()+"px"},_.each(E.files,function(e){var t=e.name.substr(e.name.lastIndexOf(".")+1);switch(t){case"doc":case"docx":case"odt":e.ext="doc";break;case"pdf":e.ext="default-type";break;case"xls":case"xlsx":case"ods":e.ext="xls";break;case"zip":e.ext="generic";break;case"txt":e.ext="generic";break;case"mp3":e.ext="audio";break;case"mp4":e.ext="video";break;default:e.ext="generic"}});var n=_.template(t,E);e.log("str",n),$("#"+E.uiId,p).remove(),d.QAappend(n),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&($("#"+E.uiId+" .file-item",p).QAappend("<span class='download-file-icon'></span>"),_.each($("#"+E.uiId+" .file-item",p),function(e){var t=_.findWhere(N,{title:$(e).find(".name").data("title")}).downloadStatus,n=_.findWhere(N,{title:$(e).find(".name").data("title")}).id;$(e).find(".download-file-icon").data({enrichmentId:n,downloadStatus:t}),$(e).find(".download-file-icon").get(0).id=n,$(e).find(".download-file-icon").addClass("blue-download-status-"+t)}),$("#"+E.uiId+" .download-file-icon",p).unbind("click").bind("click",B)),H($("#"+l.id,p),h),_.delay(function(){P()},50),u.align!="fitToWidth"&&$("#"+l.id,p).css("width",$(l).data("width"))},P=function(){v=$("#ui-"+l.id,p).get(0),m=$("#ui-"+l.id,p),$("#"+l.id,p).removeClass("widget-loader"),$("#"+l.id,p).find(".move-icon").removeClass("move-icon-compact"),I();if(u.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){W(),U();var e=$("#"+l.id,p).width();e<b&&($("#"+l.id,p).width(b),$("#ui-"+l.id,p).width(b));if(u.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(u.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){E.uiId="ui-"+l.id;var t=_.template(n,{id:E.uiId});d.QAappend(t),$("#div-border-"+E.uiId,p).css({width:$(v).width()+"px",height:$(v).height()+"px",top:v.style.top,left:v.style.left,position:"absolute"}),$("#div-border-"+E.uiId,p).addClass("transparentWidget ui-hover-class"),$("#div-border-"+E.uiId,p).css({"pointer-events":"none"})}$(".widget-file-wrapper",m.get(0)).remove(),$(".ui-button-div",m.get(0)).remove(),$("#"+l.id,p).find(".move-icon").addClass("move-icon-compact"),$("#ui-"+l.id,p).html('<div class="ui-clickable-icon ui-file-icon icon-font"></div>'),m.addClass("transparentWidget"),m.removeClass("ui-border"),$(m).css({width:$(".ui-clickable-icon",m).width()+"px",height:$(".ui-clickable-icon",m).height()+"px"}),$("#"+l.id+" .dummyWidget",p).show(),u.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+l.id,p).css({width:$(".ui-clickable-icon",v).width()+"px",height:$(".ui-clickable-icon",v).height()+"px"}),$("#"+l.id+" .dummyWidget",p).hide()),$(".ui-file-icon",m.get(0)).click({},J)}else u.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?($(".file-list-container",m.get(0)).remove(),$(".widget-file-wrapper",m.get(0)).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize ui-file-button'></div></div>"),w=b):u.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(w=$(v).height(),I())}else w=$(v).height();T=!0,$("#"+E.uiId+" .file-item",p).find(".name").off("click").on("click",X),$(".ui-maximize",v).click({},J),o.trigger(WIDGET_EVENTS.RENDER_COMPLETE,o,y,b,w)},H=function(e,t){$(e).attr({"data-fileSize":0,"data-downloadable":!1,"data-launchFile":"","data-downloadUrl":"","data-files":JSON.stringify(t.files)})},B=function(e){var t=$(e.target).data("enrichmentId"),n=$(e.target).data("downloadStatus");switch(parseInt(n)){case 0:n=1;break;case 1:case 2:n=2;break;case 3:n=3;break;default:}o.trigger(WIDGET_EVENTS.DOWNLOAD_ACTION,l.id,t,n)},j=function(e,t,n){var r=_.findWhere(N,{id:e});r.downloadStatus=t,$("#ui-"+l.id+" #"+e,p).data("downloadStatus",t),$("#ui-"+l.id+" #"+e,p).removeClass("blue-download-status-0 blue-download-status-1 blue-download-status-2 blue-download-status-3"),$("#ui-"+l.id+" #"+e,p).addClass("blue-download-status-"+t);if(C){var i=C.find("#"+l.id);i.length>0&&($("#"+l.id+" #"+e,C).data("downloadStatus",t),$("#"+l.id+" #"+e,C).removeClass("download-status-0 download-status-1 download-status-2 download-status-3"),$("#"+l.id+" #"+e,C).addClass("download-status-"+t))}},F=function(){if(u.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+l.id,p).width();e<b&&$("#"+l.id,p).width(b),e>y&&$("#"+l.id,p).width(y)}},I=function(){if(u.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE||u.layout===WIDGET_CONSTANTS.DATA_LAYOUT_REFLOW){var e=$("#"+l.id,u.bookFrameContent).width();$("#ui-"+l.id,u.bookFrameContent).width(e);var t=$("#ui-"+l.id,u.bookFrameContent),n=$(t).find(".widget-file-wrapper").height()+$(t).find(".inline-widget-footer").height();E.height=n,$("#"+l.id,u.bookFrameContent).css("height",E.height+"px"),$("#ui-"+l.id,u.bookFrameContent).css("height",E.height+"px")}$("#"+l.id,u.bookFrameContent).html()!=""&&U()},q=function(){F(),I(),z()},R=function(){T&&(u.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(F(),U()),u.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?z():W())},U=function(){var e=$("#"+l.id,p).height();e<w&&($("#"+l.id,p).height(w),$("#ui-"+l.id,p).height(w))},z=function(){var t=$("#"+l.id,p),n=e.getOffset(t).left,r=e.getOffset(t).top,i=$(t).width(),s=$(t).height(),o=$("#ui-"+t.get(0).id,p).get(0);$(o).css({top:r+"px",left:n+"px",width:i+"px",height:s+"px",position:"absolute"})},W=function(){e.log("_setDimensions-------------------------"),$("#"+l.id,p).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+l.id,p)).left,n=e.getOffset($("#"+l.id,p)).top,r=$("#"+l.id,p).width(),i=$("#"+l.id,p).height(),v=$("#ui-"+l.id,p).get(0),u.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT?u.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(v).css({top:n+"px",left:t+"px",position:"absolute"}):$(v).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}):$(v).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),u.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+E.uiId,p).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},X=function(t){if(k==1)return;var n=$(t.target).parent().index()+1;k=!0;var r=$(t.target).data("url"),i="";WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&$(t.target.parentNode).find(".download-file-icon").data("downloadStatus")==3?i=WIDGET_CONSTANTS.DOWNLOADED_ASSETS_URL+r:i=WIDGET_CONSTANTS.ASSETS_URL+r,i=e.getCleanURL(i);var s={fileId:o.identifier+"_"+n};o.trigger(WIDGET_EVENTS.LAUNCH_FILE_CLICKED,i,h.title,o),o.trigger(WIDGET_EVENTS.XAPI_EVENT,o,s),_.delay(V,500)},V=function(){k=!1},J=function(){c.addClass("file-popup"),o.trigger(WIDGET_EVENTS.LAUNCHED,o)},K=function(){C=$("#widgetContent",c);var e="";!S||N.length?e=l.id:e=(new Date).getTime();var t={uiId:e,title:h.title,type:h.type,description:h.description,files:h.files,width:u.width};_.each(t.files,function(e){var t=e.name.substr(e.name.lastIndexOf(".")+1);switch(t){case"doc":case"docx":case"odt":e.ext="doc";break;case"pdf":e.ext="default-type";break;case"xls":case"xlsx":case"ods":e.ext="xls";break;case"zip":e.ext="generic";break;case"txt":e.ext="generic";break;case"mp3":e.ext="audio";break;case"mp4":e.ext="video";break;default:e.ext="generic"}}),$("#widgetContent").html(_.template(r,t)),t.description.trim().length==0&&$(".media",c).hide(),$(".gal-title",c).html(unescape(h.title)),$(".file-item",c).find(".name").off("click").on("click",X),WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED&&($("#"+t.uiId+" .file-item",C).QAappend("<span class='download-file-icon'></span>"),_.each($("#"+t.uiId+" .file-item",C),function(e){var t=_.findWhere(N,{title:$(e).find(".name").data("title")}).downloadStatus,n=_.findWhere(N,{title:$(e).find(".name").data("title")}).id;$(e).find(".download-file-icon").data({enrichmentId:n,downloadStatus:t}),$(e).find(".download-file-icon").get(0).id=n,$(e).find(".download-file-icon").addClass("download-status-"+t)}),$("#"+t.uiId+" .download-file-icon",C).unbind("click").bind("click",B)),Q(),o.trigger(WIDGET_EVENTS.POPULATED,o,200,200)},Q=function(){x!=null&&x.destroy(),x=new IScroll($(".file-list-container",C).get(0),{desktopCompatibility:!0,vScroll:!0,hScroll:!1}),_.delay(function(){x&&x.refresh()},999)},G=function(){return WIDGET_CONSTANTS.FILE_WIDGET},Y=function(e){var t=$(v).get(0).scrollHeight;$("#"+l.id,u.bookFrameContent).css({height:t+"px"})},Z=function(){x!=null&&x.destroy(),$(".file-item",c).find(".name").off(),$("#"+E.uiId+" .download-file-icon",C).unbind(),$(".gal-title",c).html(""),C.empty(),c.removeClass("file-popup"),o.trigger(WIDGET_EVENTS.DESTROYED,o)},et=function(){$("#"+E.uiId+" .file-item",p).find(".name").off(),$("#"+E.uiId+" .download-file-icon",p).unbind(),$("#"+l.id,p).remove(),$("#ui-"+l.id,p).remove()},tt=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(S=!0,e.widgetEnrichmentArr.length&&(l={},l.id=_.findWhere(e.widgetEnrichmentArr,{level:0}).widgetId)):l=e.obj,u=e.options,c=e.popupView,o=this,a=u.bookURL,N=e.widgetEnrichmentArr},initCurrWidget:L,destroy:Z,relayout:R,widgetType:G,onFontChange:Y,widgetResize:q,onPopupShown:K,launch:J,updateDownloadStatus:j,destroyView:et});return new tt(s)};return s}),define("com/es/text!templateBasePath/Reader/popups/widgetPopupTemplate.html",[],function(){return"<div id='widgetPopup' class='modal hide fade lightBox' tabindex='-1' role='dialog' aria-labelledby='windowTitleLabel' aria-hidden='true'>\r\n	<div class='modal-dialog'>\r\n    <div id='widget-header'>\r\n				<span class='gal-title'></span>\r\n                <span class=\"icon icon-ic-close-widget widget-html-icon-style\" id='closePopup' data-dismiss='modal'></span>\r\n				<!--<a id='closePopup' class='icon-fullscreen' data-dismiss='modal' style='float:right;margin:2px;'></a>-->									\r\n			</div>\r\n		<div class='modal-content'>\r\n			\r\n			<div id='widgetContent'></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/widgets/WidgetPopup",["com/es/text!templateBasePath/Reader/popups/widgetPopupTemplate.html","com/es/widgets/WidgetEvents","com/es/widgets/WidgetUtils"],function(e,t,n){var r,i=function(e){$("#widgetPopup .gal-title").html(unescape(e))},s=Backbone.View.extend({initialize:function(){_.extend(this,Backbone.Events),r=this;var t=_.template(e),i=t();$("#QAPlaceHolder")[0].innerHTML=i,$("body").append($("#widgetPopup")[0]),n.isIE()&&$("#widgetPopup").removeClass("fade"),n.log("append in body..")},setTitle:i});return s}),define("com/es/widgets/WidgetLang",["com/es/widgets/WidgetUtils"],function(e){var t={langGlobalObj:"WidgetLang",fileName:"readerStrings.json"};return e.setLangCode(t.langGlobalObj,t.fileName),!1}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/inlineViewTemplate.html",[],function(){return"<div class='widget-ui ui-learnosity ui-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<span class=\"learnosity-player-icon\"></span>\r\n	<div class='inline-widget-footer'>\r\n		<div class='ui-learnosity-icon'></div>\r\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\r\n		<!--<div class='ui-maximize ui-right-div'></div>-->\r\n        <div class=\"ui-maximize ui-right-div icon icon-ic-fullscreen\"></div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/popupViewTemplate.html",[],function(){return'<div id="lrn-loader" class="modal-dialog loading-indicator" >\n	<img src="images/loading.gif"/>\n</div>\n<div class=\'learnosity-container assessment-popup\'>\n	<div id="lrn-start-screen" class="assessment-popup lrn-screen">\n	</div>\n	\n	<div class="js-items-wrap lrn-items-wrapper">\n	</div>\n	\n	<div id="lrn-end-screen" class="assessment-popup lrn-screen">\n	</div>\n	\n</div>\n'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/welcomeScreenView/templateContent.html",[],function(){return'<div id="splashScreen" class="clearfix splashScreen">\n    <div id="container-div"  style="overflow: auto;">\n        <div class="l-column">\n            <div class="splash-title">\n                <%=testTitle%>\n            </div>\n            <h5><%=WidgetLang.ATTEMPTS_LABEL%></h5>\n            <ul id="prevAttemptContainer" style="list-style: none;">\n                \n            </ul>\n        </div>\n        <div class="r-column">\n            <div class="quiz-instruction"><%=WidgetLang.WELCOME_SCREEN_INSTRUCTION_TITLE%></div>\n           <%=WidgetLang.WELCOME_SCREEN_INSTRUCTION_MESSAGE%>\n            <span id="startTest"  class="btn splashScreen-btn"><%=WidgetLang.WELCOME_SCREEN_START_BUTTON%></span>\n        </div>\n    </div>\n</div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/endScreenView/templateContent.html",[],function(){return'<div id="quizFinishScreen" class="clearfix splashScreen">\n	<div id="container" class="quizFinishContainer">\n        <!--h5><%=AssesmentLang.QUIT_RESULTS_LABEL%></h5-->\n        <h2><%=title%></h2>\n        <h5>Your score: </h5>\n        <ul id="prevAttemptContainer">\n            \n        </ul>\n        <span id="tryAgainBtn"  class="btn splashScreen-btn"> <%=AssesmentLang.TRY_AGAIN_LABEL%> </span>\n        <span id="finishedTest"  class="btn splashScreen-btn"> <%=AssesmentLang.FINISH_LABEL%> </span>\n	</div>\n</div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/endScreenView/prevAttemptTemplate.html",[],function(){return'<% _.each(objArr, function(obj, index) { %>\n    <li>\n            <%\n            	var countStr = "Out of ";\n                //var countStr = "Last "+ (objArr.length - index);\n            %>\n            <div class="quiz-attempt">\n                <div class="quiz-attempt-score learnosity-quiz-attempt-score"> <%=parseFloat(parseFloat(obj.score).toFixed(1))%> </div>\n                <h5 class="total-questions"><%=countStr%> <%=parseFloat(parseFloat(obj.maxScore).toFixed(1))%></h5>\n            </div>\n    </li>\n<% }); %>'}),define("com/es/models/LearnosityInlineModel",[],function(){var e=Backbone.Model.extend({defaults:{security:{timestamp:"",consumer_key:"",domain:"",user_id:""},request:{session_id:"",activity_id:"",items:null,name:"",state:"initial",config:{questionsApiVersion:"v2",renderSubmitButton:!1,validateOnSubmit:!0},user_id:"",course_id:"",type:"submit_practice",rendering_type:"inline"}}});return e}),define("com/es/models/LearnosityAssessModel",[],function(){var e=Backbone.Model.extend({defaults:{security:{timestamp:"",consumer_key:"",domain:"",user_id:""},request:{session_id:"",activity_id:"",items:null,name:"",state:"initial",config:{questionsApiVersion:"v2",renderSubmitButton:!1,validateOnSubmit:!0,navigation:{show_intro:!0,show_itemcount:!0}},user_id:"",course_id:"",type:"submit_practice",rendering_type:"assess"}}});return e}),function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,n){var r=e,i=[],s;n=n||r.length;if(t)for(s=0;s<t;s++)i[s]=r[0|Math.random()*n];else{var o;i[8]=i[13]=i[18]=i[23]="-",i[14]="4";for(s=0;s<36;s++)i[s]||(o=0|Math.random()*16,i[s]=r[s==19?o&3|8:o])}return i.join("")},Math.uuidFast=function(){var t=e,n=new Array(36),r=0,i;for(var s=0;s<36;s++)s==8||s==13||s==18||s==23?n[s]="-":s==14?n[s]="4":(r<=2&&(r=33554432+Math.random()*16777216|0),i=r&15,r>>=4,n[s]=t[s==19?i&3|8:i]);return n.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})}}(),define("com/external/mathUuid/uuid",function(){}),define("com/es/widgets/learnosity/learnosityWidget",["com/es/widgets/WidgetUtils","com/es/widgets/WidgetEvents","com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/welcomeScreenView/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/endScreenView/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/learnosityView/endScreenView/prevAttemptTemplate.html","com/es/models/LearnosityInlineModel","com/es/models/LearnosityAssessModel","com/es/utilities/services","com/external/mathUuid/uuid"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=function(t){var s,c,h,p,d,v,m,g=null,y,b={},w=!1,E=!1,S,x=WIDGET_CONSTANTS.ASSESSMENT_MIN_WIDTH,T=WIDGET_CONSTANTS.ASSESSMENT_MIN_HEIGHT,N=null,C=null,k=!1,L,A=null,O=null,M=null,D,P=!1,H=!1,B=null,j=function(){e.log("init learnosity",s),A=F(),v=c.bookFrameContent,m=c.bookFrameContentRootEl,_.delay(function(){X()},20)},F=function(){var t=null,n={},r={},i={},c=null,h=null,d=null,v=null,m=null,g=null,y="<span class='learnosity-item' data-reference='<%=questionId%>'></span>",b="<button type='button' data-loading-text='Submitting...' id='learnosity-submit' class='btn btn-default lrn-save' autocomplete='off'> "+WidgetLang.SUBMIT_ANSWERS_LABEL+"</button>",w=!1;h=WIDGET_CONSTANTS.USER_ID.toString(),v=$(p).attr("data")||O,m=$(p).attr("data-title")||M,O=v,M=m,g=WIDGET_CONSTANTS.BOOK_ISBN_NO.toString();var E=function(){var e="//items.learnosity.com/";window.LearnosityItems||$.getScript(e).done(function(e,t){}).fail(function(e,t,n){console.error("Error in loading Learnosity api: "+n)})},S=function(){e.hideLoader(),z();var t=function(e){var t=e.data[0].data.rendering_type;D=t.toLowerCase(),c=e.data[0].data.items;if(t==="inline"){var n=x();B=new a,n.requestObj(),n.securityObj()}else if(t==="assess"){var r=T();B=new f,r.requestObj(),r.securityObj(),w=!0}k()},n=function(e){console.log(e),W()},r=WIDGET_CONSTANTS.LEARNOSITY_SERVICE_BASE_URL+"learnosity/activity/details"+"?activityId="+encodeURI(v),i={url:r,successCallback:t,errorCallback:n};l.fetchLrnActivity(i)},x=function(){var e=function(){var e=new Date,t={year:e.getUTCFullYear().toString(),months:e.getUTCMonth().toString().length<2?"0"+(e.getUTCMonth()+1):e.getUTCMonth()+1,date:e.getUTCDate().toString().length<2?"0"+e.getUTCDate():e.getUTCDate(),hours:e.getUTCHours().toString().length<2?"0"+e.getUTCHours().toString():e.getUTCHours().toString(),mins:e.getUTCMinutes().toString().length<2?"0"+e.getUTCMinutes():e.getUTCMinutes()};r={},r.timestamp=t.year+t.months+t.date+"-"+t.hours+t.mins,r.consumer_key="CUPfWO9Hh1DRYRlB",r.domain=location.hostname,r.user_id=h},t=function(){n={},d=Math.uuid().toLowerCase(),n.session_id=d,n.activity_id=v,n.items=c,n.name=m,n.state="initial",n.config={questionsApiVersion:"v2",renderSubmitButton:!1,validateOnSubmit:!0},n.user_id=h,n.course_id=g,n.type="submit_practice",n.rendering_type="inline"};return{securityObj:e,requestObj:t}},T=function(){var e=function(){var e=new Date,t={year:e.getUTCFullYear().toString(),months:e.getUTCMonth().toString().length<2?"0"+(e.getUTCMonth()+1):e.getUTCMonth()+1,date:e.getUTCDate().toString().length<2?"0"+e.getUTCDate():e.getUTCDate(),hours:e.getUTCHours().toString().length<2?"0"+e.getUTCHours().toString():e.getUTCHours().toString(),mins:e.getUTCMinutes().toString().length<2?"0"+e.getUTCMinutes():e.getUTCMinutes()};r={},r.timestamp=t.year+t.months+t.date+"-"+t.hours+t.mins,r.consumer_key="CUPfWO9Hh1DRYRlB",r.domain=location.hostname,r.user_id=h},t=function(){n={},d=Math.uuid().toLowerCase(),n.session_id=d,n.activity_id=v,n.items=c,n.name=m,n.state="initial",n.config={questionsApiVersion:"v2",renderSubmitButton:!1,validateOnSubmit:!0,onsubmit_redirect_url:!1,onsave_redirect_url:!1,ondiscard_redirect_url:!1,navigation:{show_intro:!1,show_itemcount:!0,show_save:!1,show_submit:!1,show_fullscreencontrol:!1}},n.user_id=h,n.course_id=g,n.type="submit_practice",n.rendering_type="assess"};return{securityObj:e,requestObj:t}},k=function(){var e={securityObj:r,requestObj:n},i={ops:"http://cup.excelindia.com/OPServicesWithAccessToken/QuizService.svc/learnosity/signature/",localhost:"http://localhost:8080/pubportal/pubservice/learnosity/signature"},s=function(e){t=e,L()},o=function(e){console.log(e),W()},u={data:e,url:WIDGET_CONSTANTS.LEARNOSITY_SERVICE_BASE_URL+"learnosity/signature",successCallback:s,errorCallback:o};l.fetchLrnSignature(u)},L=function(){var e=n.items,t="";w?t='<div id="learnosity_assess"></div>':_.each(e,function(e){t+=_.template(y,{questionId:e})}),$(".learnosity-container .js-items-wrap").append(t),A()},A=function(){var e=null,n,r,i={readyListener:function(){s.trigger(WIDGET_EVENTS.POPULATED,s,N,C),W(),$("#learnosity-submit",".learnosity-container .js-items-wrap")&&$("#learnosity-submit",".learnosity-container .js-items-wrap").remove(),$(".learnosity-container .js-items-wrap").append(b),n()},errorListener:function(e){W()}};LearnosityItems&&(e=LearnosityItems.init(t,i),window.lnact=e);var a=function(e){};n=function(){var t={success:function(t){e.getScores(function(e){var t=getScoreResult(e);onScores(t)})},error:function(e){console.log("submit has failed",e)},progress:function(e){}},n=function(n){e.submit(t),$("#learnosity-submit").button("loading")};$("#learnosity-submit").on("click",n)},onScores=function(e){var t=e;$("#learnosity-submit").button("reset").empty().text("Submitted"),_.delay(function(){$("#learnosity-submit").prop("disabled",!0)},200),!P&&D==="assess"&&(LearnosityAssess.remove("learnosity_assess"),P=!0),$(".js-items-wrap").empty(),$("#lrn-end-screen").append(_.template(o,{title:M+" "+WidgetLang.RESULTS_LABEL})),$("#prevAttemptContainer").html(_.template(u,{objArr:t})),H?$("#finishedTest").off(WIDGET_EVENTS.CLICK).on(WIDGET_EVENTS.CLICK,R):$("#finishedTest").on(WIDGET_EVENTS.CLICK,q),$("#tryAgainBtn").on(WIDGET_EVENTS.CLICK,U)},getScoreResult=function(e){var t={maxScore:0,score:0},n,r,i=0,s=_.values(e),o=_.keys(e);return n=o.length,r=n,_.each(s,function(e){parseInt(e.score,10)===1&&i++}),t.maxScore=r,t.score=i,[t]},r=function(){$("#learnosity-submit").off("click"),$("#learnosity-get-score").off("click")}};return{loadApi:E,getActivity:S}},I=function(){P=!1,A.getActivity()},q=function(e){$("#closePopup").trigger("click")},R=function(){s.trigger(WIDGET_EVENTS.DESTROY_WEBVIEW,s)},U=function(){$(".js-items-wrap, #lrn-end-screen").empty(),P=!1,A.getActivity()},z=function(){$("#lrn-loader").show("slow")},W=function(){$("#lrn-loader").hide("slow")},X=function(){w||Y(),s.trigger(WIDGET_EVENTS.INITIALIZED,s)},V=function(t){if(e.isTouchDevice()&&!H){var n=WIDGET_CONSTANTS.LEARNOSITY_READER_HTML_URL+"learnosity-reader.html?userId="+WIDGET_CONSTANTS.USER_ID.toString()+"&courseId="+WIDGET_CONSTANTS.BOOK_ISBN_NO.toString()+"&serviceBaseUrl="+WIDGET_CONSTANTS.LEARNOSITY_SERVICE_BASE_URL.toString()+"&lrnAccessToken="+WIDGET_CONSTANTS.LEARNOSITY_ACCESS_TOKEN.toString()+"&activityId="+O+"&activityTitle="+M+"&locale="+WIDGET_CONSTANTS.LOCALE;s.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,n,M)}else d.addClass("learnosity-popup"),s.trigger(WIDGET_EVENTS.LAUNCHED,s)},J=function(){E=!0,L=$("#widgetContent",d),WIDGET_CONSTANTS.NETWORK_AVAILABLE===!1&&s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE);if(H){var e="<div id='widgetContent' class=''></div>";$("#widgetPopup").before(e).remove(),$(".modal-backdrop").remove(),$("#widgetContent").html(_.template(i))}else $("#widgetContent").html(_.template(i)),$(".gal-title",d).html(M);z(),I()},K=function(){var e=$("#widget-header").height(),t=$("#widgetContent").find("img").get(0).naturalHeight,n=parseFloat($(".image-content").css("padding-top"))+parseFloat($(".image-content").css("padding-bottom")),r=parseFloat($(".image-content").css("margin-top"))+parseFloat($(".image-content").css("margin-bottom")),i=parseFloat($(".image-content").css("top")),s=$(".image-info-text").height();C=e+t+n+r+i+s,N=$("#widgetContent").find("img").width()},Q=function(){$(y).addClass("ui-hover-class")},G=function(){$(y).removeClass("ui-hover-class")},Y=function(){st(),b={uiId:"ui-"+p.id,widgetId:"widget-"+p.id,title:$(p).data("title"),width:$("div[id='"+p.id+"']",v).width()+"px"};var t=_.template(n,b);e.log("str",t),$("div[id='ui-"+p.id+"']",v).remove();var r=$("div[id='"+p.id+"']",v).get(0).innerHTML;r=r.trim(),r.length==0?($("div[id='"+p.id+"']",v).get(0).innerHTML=t,m.append($("div[id='ui-"+p.id+"']",v))):m.append(t),Z()},Z=function(){c.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(x=m.width()*.7),c.bookFrameContent&&(S=m.width()),e.log("learnosity loaded ",S),$("div[id='"+p.id+"']",v).removeClass("widget-loader"),$("div[id='"+p.id+"']",v).find(".move-icon").removeClass("move-icon-compact"),rt();var t=$("div[id='ui-"+p.id+"']",v).get(0);if(c.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED&&E===!1){tt();var n=$("div[id='"+p.id+"']",v).height();n<T&&($("div[id='"+p.id+"']",v).height(T),$("div[id='ui-"+p.id+"']",v).height(T));var i=$("div[id='"+p.id+"']",v).width();i<x&&($("div[id='"+p.id+"']",v).width(x),$("div[id='ui-"+p.id+"']",v).width(x));if(c.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(c.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){var o=_.template(r,{id:b.uiId}),u=$("div[id='"+p.id+"']",v).get(0).innerHTML;u=u.trim(),u.length==0?($("div[id='"+p.id+"']",v).get(0).innerHTML=o,m.append($("div[id='div-border-ui-"+p.id+"']",v))):m.append(o),$("div[id='div-border-ui-"+p.id+"']",v).css({width:$(t).width()+"px",height:$(t).height()+"px",top:t.style.top,left:t.style.left,position:"absolute"}),$("div[id='div-border-ui-"+p.id+"']",v).addClass("transparentWidget ui-hover-class"),$("div[id='div-border-ui-"+p.id+"']",v).css({"pointer-events":"none"})}$(".learnosity-player-icon",t).remove(),$(".inline-widget-footer",t).remove(),$(t).QAappend('<div class="ui-clickable-icon ui-learnosity-icon icon-font"></div>'),$(t).addClass("transparentWidget"),$(t).removeClass("ui-border"),$(t).css({width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("div[id='"+p.id+"']",v).find(".move-icon").addClass("move-icon-compact"),$("#"+p.id+" .dummyWidget",v).show(),c.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("div[id='"+p.id+"']",v).css({"min-width":"0px",width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("#"+p.id+" .dummyWidget",v).hide()),$(".ui-learnosity-icon",t).click({},V)}else c.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?$(".ui-maximize, .learnosity-player-icon",t).click({},V):c.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&$(".ui-maximize, .learnosity-player-icon",t).click({},V)}else $(".ui-maximize, .learnosity-player-icon",t).click({},V);k=!0,s.trigger(WIDGET_EVENTS.RENDER_COMPLETE,s,S,x)},et=function(){k&&(c.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(st(),rt()),c.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?nt():tt())},tt=function(){e.log("_setDimensions-------------------------"),$("div[id='"+p.id+"']",v).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("div[id='"+p.id+"']",v)).left,n=e.getOffset($("div[id='"+p.id+"']",v)).top,r=$("div[id='"+p.id+"']",v).width(),i=$("div[id='"+p.id+"']",v).height(),y=$("div[id='ui-"+p.id+"']",v).get(0),c.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(y).css({top:n+"px",left:t+"px",position:"absolute"}):$(y).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),c.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("div[id='div-border-ui-"+p.id+"']",v).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},nt=function(){if(c.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t=c.bookFrameContent,n,r,i,s;n=e.getOffset($("div[id='"+p.id+"']",v)).left,r=e.getOffset($("div[id='"+p.id+"']",v)).top,i=$("div[id='"+p.id+"']",v).width(),s=$("div[id='"+p.id+"']",v).height(),y=$("div[id='ui-"+p.id+"']",v).get(0),$(y).css({top:r,left:n,width:i,height:s+"px",position:"absolute"})}},rt=function(){if(c.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT&&c.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE)var e=$("div[id='"+p.id+"']",v).height();else var e=$("div[id='"+p.id+"']",v).width();b.height=e,$("div[id='"+p.id+"']",c.bookFrameContent).css("height",b.height+"px")},it=function(){if(c.dataMode!==WIDGET_CONSTANTS.DATA_MODE_COMPACT&&!E){var e=$("div[id='"+p.id+"']",v).height();e<T&&($("div[id='"+p.id+"']",v).height(T),$("div[id='ui-"+p.id+"']",v).height(T))}},st=function(){if(c.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("div[id='"+p.id+"']",v).width();e<x&&$("div[id='"+p.id+"']",v).width(x),e>S&&$("div[id='"+p.id+"']",v).width(S)}},ot=function(){st(),rt(),nt()},ut=function(){c.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_SHOW?$(y).addClass("ui-hover-class"):$(y).hover(Q,G)},at=function(){},ft=function(){!P&&D==="assess"&&(LearnosityAssess.remove("learnosity_assess"),P=!0),L.empty(),d.removeClass("learnosity-popup"),E=!1,$(".gal-title",d).html(""),$(".zoom-controls",d).remove(),g!=null&&(g.destroy(),g=null),s.trigger(WIDGET_EVENTS.DESTROYED,s)},lt=function(){return WIDGET_CONSTANTS.LEARNOSITY_WIDGET},ct=function(){$(".ui-learnosity#"+b.uiId+" img",v).off(),$("div[id='"+p.id+"']",v).remove(),$("div[id='ui-"+p.id+"']",v).remove()},ht=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?w=!0:p=e.obj,c=e.options,d=e.popupView,s=this,h=c.bookURL,c.activity_id&&(O=c.activity_id),c.activity_title&&(M=c.activity_title),H=c.standalone===!0?!0:!1,j()},events:{},destroy:ft,relayout:et,widgetType:lt,widgetResize:ot,launch:V,onPopupShown:J,destroyView:ct,learnosity:A});return new ht(t)};return h}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/inlineViewTemplate.html",[],function(){return"<div class='widget-ui ui-eow ui-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\n	<span class=\"eow-player-icon\"></span>\n	<% if (src) { %>\n		<img class=\"img-cover\" src=\"<%=unescape(src)%>\" />\n	<% } %>\n	<div class='inline-widget-footer'>\n		<div class='ui-eow-icon'></div>\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\n		<div class='ui-maximize ui-right-div'></div>\n	</div>\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/popupViewTemplate.html",[],function(){return'<div id="lrn-loader" class="modal-dialog loading-indicator" >\n	<img src="images/loading.gif"/>\n</div>\n\n<div class="eow-container">\n	<iframe id="eow-frame" class="eow-frame" frameborder="0" src="">\n	</iframe>\n</div>\n'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/welcomeScreenView/templateContent.html",[],function(){return'<div id="splashScreen" class="clearfix splashScreen">\n    <div id="container-div"  style="overflow: auto;">\n        <div class="l-column">\n            <div class="splash-title">\n                <%=testTitle%>\n            </div>\n            <h5><%=WidgetLang.ATTEMPTS_LABEL%></h5>\n            <ul id="prevAttemptContainer" style="list-style: none;">\n                \n            </ul>\n        </div>\n        <div class="r-column">\n            <div class="quiz-instruction"><%=WidgetLang.WELCOME_SCREEN_INSTRUCTION_TITLE%></div>\n           <%=WidgetLang.WELCOME_SCREEN_INSTRUCTION_MESSAGE%>\n            <span id="startTest"  class="btn splashScreen-btn"><%=WidgetLang.WELCOME_SCREEN_START_BUTTON%></span>\n        </div>\n    </div>\n</div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/endScreenView/templateContent.html",[],function(){return'<div id="quizFinishScreen" class="clearfix splashScreen">\n	<div id="container" class="quizFinishContainer">\n        <!--h5><%=AssesmentLang.QUIT_RESULTS_LABEL%></h5-->\n        <h2><%=title%></h2>\n        <h5>Your score: </h5>\n        <ul id="prevAttemptContainer">\n            \n        </ul>\n        <span id="tryAgainBtn"  class="btn splashScreen-btn"> <%=AssesmentLang.TRY_AGAIN_LABEL%> </span>\n        <span id="finishedTest"  class="btn splashScreen-btn"> <%=AssesmentLang.FINISH_LABEL%> </span>\n	</div>\n</div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/endScreenView/prevAttemptTemplate.html",[],function(){return'<% _.each(objArr, function(obj, index) { %>\n    <li>\n            <%\n            	var countStr = "Out of ";\n                //var countStr = "Last "+ (objArr.length - index);\n            %>\n            <div class="quiz-attempt">\n                <div class="quiz-attempt-score learnosity-quiz-attempt-score"> <%=parseFloat(parseFloat(obj.score).toFixed(1))%> </div>\n                <h5 class="total-questions"><%=countStr%> <%=parseFloat(parseFloat(obj.maxScore).toFixed(1))%></h5>\n            </div>\n    </li>\n<% }); %>'}),define("com/es/models/EowModel",[],function(){var e=Backbone.Model.extend({defaults:{security:{timestamp:"",consumer_key:"",domain:"",user_id:""},request:{session_id:"",activity_id:"",items:null,name:"",state:"initial",config:{questionsApiVersion:"v2",renderSubmitButton:!1,validateOnSubmit:!0},user_id:"",course_id:"",type:"submit_practice",rendering_type:"inline"}}});return e}),define("com/es/widgets/eow/eowWidget",["com/es/widgets/WidgetUtils","com/es/widgets/WidgetEvents","com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/popupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/welcomeScreenView/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/endScreenView/templateContent.html","com/es/text!templateBasePath/Reader/widgetsTemplates/eowView/endScreenView/prevAttemptTemplate.html","com/es/models/EowModel","com/es/utilities/services","com/external/mathUuid/uuid"],function(e,t,n,r,i,s,o,u,a,f,l){var c=function(t){var s,o,u,a,f,l,c,h=null,p,d={},v=!1,m=!1,g,y=WIDGET_CONSTANTS.ASSESSMENT_MIN_WIDTH,b=WIDGET_CONSTANTS.ASSESSMENT_MIN_HEIGHT,w=null,E=null,S=!1,x,T=null,N=null,C=null,k=WIDGET_CONSTANTS.EOW_SERVICE_BASE_URL+"eow/signature",L=WIDGET_CONSTANTS.EOW_LDL_SERVER,A=WIDGET_CONSTANTS.EOW_LDL_SERVICE_URL,O="",M="",D=!1,P=null,H="",B="",j="",F=WIDGET_CONSTANTS.USER_ROLE,I=function(){e.log("init Eow widget",s),C||(C=$(a).attr("data-title")),N||(N=a.id.toString()),T=R(),l=o.bookFrameContent,c=o.bookFrameContentRootEl;if(o.data_json){var t=o.data_json,n=u.split("/");n.pop(),n=n.join("/")+"/"+o.dataURL;var r=n.split("/");r.pop(),_resourceURL=r.join("/")+"/",_onDataLoaded(t)}else q()},q=function(){var t=u.split("/");t.pop(),t=t.join("/")+"/"+o.dataURL,e.log("url",t);var n=t.split("/");n.pop(),_resourceURL=n.join("/")+"/",e.log("_resourceURL",_resourceURL),$.getJSON(t,{}).done(function(e){M=_resourceURL+e.src,H=e.widgetIdDefinedByPublisher,Q()}).fail(function(t,n,r){e.log("error",r),s.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},R=function(){var t={},n={},r=WIDGET_CONSTANTS.USER_ID,i=WIDGET_CONSTANTS.BOOK_ID,o=N,u="",a="",f="",l="",c=function(){},h=function(){t={};if(!WIDGET_CONSTANTS.NETWORK_AVAILABLE||!navigator.onLine)return s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE),!1;t={bookId:i,widgetId:H,userId:r,timeStamp:(new Date).getTime().toString()};var n=function(t){t=typeof t=="string"?JSON.parse(t):t,u=t.signature,a=t.timeStamp||t.timestamp,f=t.selectedGroup?t.selectedGroup:null,B=t.avatar?t.avatar:null;if(e.isTouchDevice()){var n={signature:u,userId:r,bookId:WIDGET_CONSTANTS.BOOK_ID,widgetId:H,timestamp:a,avatar:B,selectedGroup:f,user:{id:r,name:WIDGET_CONSTANTS.USER_NAME,role:F},book:{id:WIDGET_CONSTANTS.BOOK_ID,name:WIDGET_CONSTANTS.BOOK_TITLE,isbn:WIDGET_CONSTANTS.BOOK_ISBN_NO},langCode:WIDGET_CONSTANTS.LOCALE,eowLdlserver:L,eowLdlservice:A};n=$.param(n);var i=WIDGET_CONSTANTS.EOW_RDR_HTML_PATH+"eow-reader.html?"+n;return s.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,i,C),!1}p()},o=function(e){console.log(e),J(),K()},l=JSON.stringify(t);G(l,k,n,o,"POST","application/json",!0)},p=function(){n={},n={signature:u,userId:r,bookId:WIDGET_CONSTANTS.BOOK_ID,widgetId:H,timestamp:a,avatar:B,selectedGroup:f,user:{id:r,name:WIDGET_CONSTANTS.USER_NAME,role:F},book:{id:WIDGET_CONSTANTS.BOOK_ID,name:WIDGET_CONSTANTS.BOOK_TITLE,isbn:WIDGET_CONSTANTS.BOOK_ISBN_NO}};var e=function(e){l=O=L+e,U(),s.trigger(WIDGET_EVENTS.POPULATED,s,w,E)},t=function(e){console.log(e),J(),K()},i="data="+JSON.stringify(n);G(i,A,e,t,"POST","",!1)};return{loadApi:c,setSignObj:h}},U=function(){var e;O.length>0&&(e=$("#eow-frame",x),e.attr({src:O}).on("load",Z))},z=function(){T.setSignObj()},W=function(e){f.modal("hide")},X=function(){s.trigger(WIDGET_EVENTS.DESTROY_WEBVIEW,s)},V=function(){$("#lrn-loader").show("slow")},J=function(){$("#lrn-loader").hide("slow")},K=function(){s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.ERROR_LOADING_ASSESSMENT),f.find("#widget-header").removeClass("hide")},Q=function(){v||it(),s.trigger(WIDGET_EVENTS.INITIALIZED,s)},G=function(t,n,r,i,o,u,a){var f={data:t,url:n,type:o,contentType:u},l=e.getSvcParams(f),c={svcParams:l,identifier:WIDGET_CONSTANTS.EOW_WIDGET,allowAccessToken:a,success:r,error:i};s.trigger(WIDGET_EVENTS.INVOKE_SERVICE,c)},Y=function(t){if(WIDGET_CONSTANTS.NETWORK_AVAILABLE!==!0||!navigator.onLine)return s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE),!1;e.isTouchDevice()?z():(f.addClass("eow-popup").find("#widget-header").addClass("hide"),s.trigger(WIDGET_EVENTS.LAUNCHED,s))},Z=function(){var e,t,n,r,i;e="http://ldluat.ldldev.co.uk/authoriseWidget.php",frameWindow=$("#eow-frame").get(0).contentWindow,n=function(){var t={msg:"Eow Widget initialized",time:(new Date).getTime().toString()};frameWindow.postMessage(t,e)},r=function(e){var t=window.addEventListener?"addEventListener":"attachEvent",n=window[t],r=t=="attachEvent"?"onmessage":"message";n(r,function(e){var t=e.message?"message":"data",n=e[t];n==WIDGET_CONSTANTS.EOW_CLOSE_ETA_POPUP&&W()},!1)}()},et=function(){m=!0,x=$("#widgetContent",f);if(!WIDGET_CONSTANTS.NETWORK_AVAILABLE||!navigator.onLine)return s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE),!1;if(D){var e="<div id='widgetContent' class=''></div>";$("#widgetPopup").before(e).remove(),$(".modal-backdrop").remove(),$("#widgetContent").html(_.template(i))}else $("#widgetContent").html(_.template(i)),$(".gal-title",f).html(C);z()},tt=function(){var e=$("#widget-header").height(),t=$("#widgetContent").find("img").get(0).naturalHeight,n=parseFloat($(".image-content").css("padding-top"))+parseFloat($(".image-content").css("padding-bottom")),r=parseFloat($(".image-content").css("margin-top"))+parseFloat($(".image-content").css("margin-bottom")),i=parseFloat($(".image-content").css("top")),s=$(".image-info-text").height();E=e+t+n+r+i+s,w=$("#widgetContent").find("img").width()},nt=function(){$(p).addClass("ui-hover-class")},rt=function(){$(p).removeClass("ui-hover-class")},it=function(){ct(),d={uiId:"ui-"+a.id,widgetId:"widget-"+a.id,title:$(a).data("title"),width:$("div[id='"+a.id+"']",l).width()+"px",src:M};var t=_.template(n,d);e.log("str",t),o.align!="fitToWidth"&&$("#"+a.id,l).css("width",$(a).data("width")),$("div[id='ui-"+a.id+"']",l).remove();var r=$("div[id='"+a.id+"']",l).get(0).innerHTML;r=r.trim(),r.length==0?($("div[id='"+a.id+"']",l).get(0).innerHTML=t,c.append($("div[id='ui-"+a.id+"']",l))):c.append(t),st()},st=function(){o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(y=c.width()*.7),o.bookFrameContent&&(g=c.width()),e.log("learnosity loaded ",g),$("div[id='"+a.id+"']",l).removeClass("widget-loader"),$("div[id='"+a.id+"']",l).find(".move-icon").removeClass("move-icon-compact"),ft();var t=$("div[id='ui-"+a.id+"']",l).get(0);if(o.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED&&m===!1){ut();var n=$("div[id='"+a.id+"']",l).height();n<b&&($("div[id='"+a.id+"']",l).height(b),$("div[id='ui-"+a.id+"']",l).height(b));var i=$("div[id='"+a.id+"']",l).width();i<y&&($("div[id='"+a.id+"']",l).width(y),$("div[id='ui-"+a.id+"']",l).width(y));if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){var u=_.template(r,{id:d.uiId}),f=$("div[id='"+a.id+"']",l).get(0).innerHTML;f=f.trim(),f.length==0?($("div[id='"+a.id+"']",l).get(0).innerHTML=u,c.append($("div[id='div-border-ui-"+a.id+"']",l))):c.append(u),$("div[id='div-border-ui-"+a.id+"']",l).css({width:$(t).width()+"px",height:$(t).height()+"px",top:t.style.top,left:t.style.left,position:"absolute"}),$("div[id='div-border-ui-"+a.id+"']",l).addClass("transparentWidget ui-hover-class"),$("div[id='div-border-ui-"+a.id+"']",l).css({"pointer-events":"none"})}$(".eow-player-icon",t).remove(),$(".inline-widget-footer",t).remove(),$(t).QAappend('<div class="ui-clickable-icon ui-eow-icon icon-font"></div>'),$(t).addClass("transparentWidget"),$(t).removeClass("ui-border"),$(t).css({width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("div[id='"+a.id+"']",l).find(".move-icon").addClass("move-icon-compact"),$("#"+a.id+" .dummyWidget",l).show(),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("div[id='"+a.id+"']",l).css({"min-width":"0px",width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("#"+a.id+" .dummyWidget",l).hide()),$(".ui-eow-icon",t).click({},Y)}else o.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?$(".ui-maximize, .eow-player-icon",t).click({},Y):o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&$(".ui-maximize, .eow-player-icon",t).click({},Y)}else $(".ui-maximize, .eow-player-icon",t).click({},Y);S=!0,s.trigger(WIDGET_EVENTS.RENDER_COMPLETE,s,g,y)},ot=function(){S&&(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(ct(),ft()),o.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?at():ut())},ut=function(){e.log("_setDimensions-------------------------"),$("div[id='"+a.id+"']",l).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("div[id='"+a.id+"']",l)).left,n=e.getOffset($("div[id='"+a.id+"']",l)).top,r=$("div[id='"+a.id+"']",l).width(),i=$("div[id='"+a.id+"']",l).height(),p=$("div[id='ui-"+a.id+"']",l).get(0),o.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(p).css({top:n+"px",left:t+"px",position:"absolute"}):$(p).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("div[id='div-border-ui-"+a.id+"']",l).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},at=function(){if(o.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t=o.bookFrameContent,n,r,i,s;n=e.getOffset($("div[id='"+a.id+"']",l)).left,r=e.getOffset($("div[id='"+a.id+"']",l)).top,i=$("div[id='"+a.id+"']",l).width(),s=$("div[id='"+a.id+"']",l).height(),p=$("div[id='ui-"+a.id+"']",l).get(0),$(p).css({top:r,left:n,width:i,height:s+"px",position:"absolute"})}},ft=function(){if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT&&o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE)var e=$("div[id='"+a.id+"']",l).height();else var e=$("div[id='"+a.id+"']",l).width();d.height=e,$("div[id='"+a.id+"']",o.bookFrameContent).css("height",d.height+"px")},lt=function(){if(o.dataMode!==WIDGET_CONSTANTS.DATA_MODE_COMPACT&&!m){var e=$("div[id='"+a.id+"']",l).height();e<b&&($("div[id='"+a.id+"']",l).height(b),$("div[id='ui-"+a.id+"']",l).height(b))}},ct=function(){if(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("div[id='"+a.id+"']",l).width();e<y&&$("div[id='"+a.id+"']",l).width(y),e>g&&$("div[id='"+a.id+"']",l).width(g)}},ht=function(){ct(),ft(),at()},pt=function(){o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_SHOW?$(p).addClass("ui-hover-class"):$(p).hover(nt,rt)},dt=function(){},vt=function(){x.empty(),f.removeClass("eow-popup"),m=!1,$(".gal-title",f).html(""),$(".zoom-controls",f).remove(),h!=null&&(h.destroy(),h=null),s.trigger(WIDGET_EVENTS.DESTROYED,s)},mt=function(){return WIDGET_CONSTANTS.EOW_WIDGET},gt=function(){},yt=function(){$(".ui-eow#"+d.uiId+" img",l).off(),$("div[id='"+a.id+"']",l).remove(),$("div[id='ui-"+a.id+"']",l).remove()},bt=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(a={},a.id=(new Date).getTime(),v=!0):a=e.obj,o=e.options,f=e.popupView,s=this,u=o.bookURL,o.activity_id&&(N=o.activity_id),o.activity_title&&(C=o.activity_title);var t=WIDGET_CONSTANTS.APPLICATION_TYPE.toString().toLowerCase(),n=WIDGET_CONSTANTS.EDITOR_LABEL.toString().toLowerCase();t===n&&(F="2",j=WIDGET_CONSTANTS.EDITOR_LABEL),D=o.standalone===!0?!0:!1},events:{},initCurrWidget:I,destroy:vt,relayout:ot,widgetType:mt,widgetResize:ht,launch:Y,onPopupShown:et,destroyView:yt,eow:T});return new bt(t)};return c}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/hodderAssessView/inlineViewTemplate.html",[],function(){return"<div class='widget-ui ui-HDLAssess ui-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\n	<span class=\"HDLAssess-player-icon\"></span>\n	<% if (src) { %>\n		<img class=\"img-cover\" src=\"<%=unescape(src)%>\" />\n	<% } %>\n	<div class='inline-widget-footer'>\n		<div class='ui-HDLAssess-icon'></div>\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\n		<div class='ui-maximize ui-right-div'></div>\n	</div>\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/hodderAssessView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/hodderAssessView/popupViewTemplate.html",[],function(){return'<div id="lrn-loader" class="modal-dialog loading-indicator" >\n	<img src="images/loading.gif"/>\n</div>\n\n<div class="HDLAssess-container">\n	<iframe id="HDLAssess-frame" class="HDLAssess-frame" frameborder="0" src="<%=( WIDGET_CONSTANTS.HOME_PAGE_URL+ WIDGET_CONSTANTS.HDL_WIDGET_CODE_BASE_PATH)  %>">\n	</iframe>\n</div>\n'}),define("com/es/models/HodderAssessModel",function(){}),define("com/es/widgets/hodderAssess/hodderAssessWidget",["com/es/widgets/WidgetUtils","com/es/widgets/WidgetEvents","com/es/text!templateBasePath/Reader/widgetsTemplates/hodderAssessView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/hodderAssessView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/hodderAssessView/popupViewTemplate.html","com/es/models/HodderAssessModel","com/es/utilities/services"],function(e,t,n,r,i,s,o){var u=function(t){var s,o,u,a,f,l,c,h,p={},d=!1,v=!1,m,g=WIDGET_CONSTANTS.ASSESSMENT_MIN_WIDTH,y=WIDGET_CONSTANTS.ASSESSMENT_MIN_HEIGHT,b=null,w=null,E=!1,S,x,T,N=WIDGET_CONSTANTS.BOOK_ISBN_NO,C="",k="",L,A=WIDGET_CONSTANTS.HOME_PAGE_URL,O=function(){e.log("init HodderAssess widget",s),l=o.bookFrameContent,c=o.bookFrameContentRootEl;if(o.data_json){var t=o.data_json,n=u.split("/");n.pop(),n=n.join("/")+"/"+o.dataURL;var r=n.split("/");r.pop(),_resourceURL=r.join("/")+"/",$(a).attr("data-folder",_resourceURL),C=_resourceURL+t.src,_hodderAssessWidgetId=t.widgetIdDefinedByPublisher,D()}else M()},M=function(){var t=u.split("/");t.pop(),t=t.join("/")+"/"+o.dataURL,e.log("url",t);var n=t.split("/");n.pop(),_resourceURL=n.join("/")+"/",e.log("_resourceURL",_resourceURL),$(a).attr("data-folder",_resourceURL),$.getJSON(t,{}).done(function(e){C=_resourceURL+e.src,_hodderAssessWidgetId=e.widgetIdDefinedByPublisher,D()}).fail(function(t,n,r){e.log("error",r),s.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},D=function(){d||P(),WIDGET_CONSTANTS.HDL_ASSESS_PROPERTIES?s.trigger(WIDGET_EVENTS.INITIALIZED,s):_.delay(function(){s.trigger(WIDGET_EVENTS.INITIALIZED,s)},100)},P=function(){j(),p={uiId:"ui-"+a.id,widgetId:"widget-"+a.id,title:$(a).data("title"),width:$("div[id='"+a.id+"']",l).width()+"px",src:C};var t=_.template(n,p);e.log("str",t),o.align!="fitToWidth"&&$("#"+a.id,l).css("width",$(a).data("width")),$("div[id='ui-"+a.id+"']",l).remove();var r=$("div[id='"+a.id+"']",l).get(0).innerHTML;r=r.trim(),r.length==0?($("div[id='"+a.id+"']",l).get(0).innerHTML=t,c.append($("div[id='ui-"+a.id+"']",l))):c.append(t),Q()},H=function(){$(h).addClass("ui-hover-class")},B=function(){$(h).removeClass("ui-hover-class")},j=function(){if(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("div[id='"+a.id+"']",l).width();e<g&&$("div[id='"+a.id+"']",l).width(g),e>m&&$("div[id='"+a.id+"']",l).width(m)}},F=function(){e.log("_setDimensions-------------------------"),$("div[id='"+a.id+"']",l).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("div[id='"+a.id+"']",l)).left,n=e.getOffset($("div[id='"+a.id+"']",l)).top,r=$("div[id='"+a.id+"']",l).width(),i=$("div[id='"+a.id+"']",l).height(),h=$("div[id='ui-"+a.id+"']",l).get(0),o.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(h).css({top:n+"px",left:t+"px",position:"absolute"}):$(h).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("div[id='div-border-ui-"+a.id+"']",l).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},I=function(){if(o.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t=o.bookFrameContent,n,r,i,s;n=e.getOffset($("div[id='"+a.id+"']",l)).left,r=e.getOffset($("div[id='"+a.id+"']",l)).top,i=$("div[id='"+a.id+"']",l).width(),s=$("div[id='"+a.id+"']",l).height(),h=$("div[id='ui-"+a.id+"']",l).get(0),$(h).css({top:r,left:n,width:i,height:s+"px",position:"absolute"})}},q=function(){if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT&&o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE)var e=$("div[id='"+a.id+"']",l).height();else var e=$("div[id='"+a.id+"']",l).width();p.height=e,$("div[id='"+a.id+"']",o.bookFrameContent).css("height",p.height+"px")},R=function(){var e;d?e=_resourceURL:e=$(a).data("folder"),L={widgetId:a.id,userId:WIDGET_CONSTANTS.USER_ID,userName:WIDGET_CONSTANTS.USER_NAME,widgetLaunchUrl:A+WIDGET_CONSTANTS.HDL_WIDGET_CODE_BASE_PATH,widgetDataFolder:e,properties:WIDGET_CONSTANTS.HDL_ASSESS_PROPERTIES,isbn:WIDGET_CONSTANTS.BOOK_ISBN_NO,bookName:WIDGET_CONSTANTS.BOOK_TITLE,enviroment:WIDGET_CONSTANTS.APPLICATION_TYPE}},U=function(t){R(),e.isTouchDevice()?s.trigger(WIDGET_EVENTS.THIRD_PARTY_WIDGET_LAUNCH,L):(f.addClass("HDLAssess-popup"),s.trigger(WIDGET_EVENTS.LAUNCHED,s))},z=function(){var e;e=$("#HDLAssess-frame",S);var t=$("#HDLAssess-frame")[0].contentWindow;t.addEventListener("TPReady",function(){t.document.TPCommunicator.setInitializationProperties(L)})},W=function(e){f.modal("hide")},X=function(){$("#lrn-loader").show("slow")},V=function(){$("#lrn-loader").hide("slow")},J=function(){s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.ERROR_LOADING_ASSESSMENT),f.find("#widget-header").removeClass("hide")},K=function(){v=!0,S=$("#widgetContent",f);if(!WIDGET_CONSTANTS.NETWORK_AVAILABLE&&!navigator.onLine)return s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE),!1;$("#widgetContent").html(_.template(i)),z(),s.trigger(WIDGET_EVENTS.POPULATED,s,b,w)},Q=function(){o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(g=c.width()*.7),o.bookFrameContent&&(m=c.width()),e.log("HodderAssess widget loaded ",m),$("div[id='"+a.id+"']",l).removeClass("widget-loader"),$("div[id='"+a.id+"']",l).find(".move-icon").removeClass("move-icon-compact"),q();var t=$("div[id='ui-"+a.id+"']",l).get(0);if(o.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED&&v===!1){F();var n=$("div[id='"+a.id+"']",l).height();n<y&&($("div[id='"+a.id+"']",l).height(y),$("div[id='ui-"+a.id+"']",l).height(y));var i=$("div[id='"+a.id+"']",l).width();i<g&&($("div[id='"+a.id+"']",l).width(g),$("div[id='ui-"+a.id+"']",l).width(g));if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){var u=_.template(r,{id:p.uiId}),f=$("div[id='"+a.id+"']",l).get(0).innerHTML;f=f.trim(),f.length==0?($("div[id='"+a.id+"']",l).get(0).innerHTML=u,c.append($("div[id='div-border-ui-"+a.id+"']",l))):c.append(u),$("div[id='div-border-ui-"+a.id+"']",l).css({width:$(t).width()+"px",height:$(t).height()+"px",top:t.style.top,left:t.style.left,position:"absolute"}),$("div[id='div-border-ui-"+a.id+"']",l).addClass("transparentWidget ui-hover-class"),$("div[id='div-border-ui-"+a.id+"']",l).css({"pointer-events":"none"})}$(".HDLAssess-player-icon",t).remove(),$(".inline-widget-footer",t).remove(),$(t).QAappend('<div class="ui-clickable-icon ui-HDLAssess-icon icon icon-ic-assessment"></div>'),$(t).addClass("transparentWidget"),$(t).removeClass("ui-border"),$(t).css({width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("div[id='"+a.id+"']",l).find(".move-icon").addClass("move-icon-compact"),$("#"+a.id+" .dummyWidget",l).show(),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("div[id='"+a.id+"']",l).css({"min-width":"0px",width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("#"+a.id+" .dummyWidget",l).hide()),$(".ui-HDLAssess-icon",t).on("click",U)}else o.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?$(".ui-maximize, .HDLAssess-player-icon",t).click({},U):o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&$(".ui-maximize, .HDLAssess-player-icon",t).click({},U)}else $(".ui-maximize, .HDLAssess-player-icon",t).click({},U);E=!0,s.trigger(WIDGET_EVENTS.RENDER_COMPLETE,s,m,g),WIDGET_CONSTANTS.HDL_ASSESS_PROPERTIES||nt()},G=function(){E&&(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(j(),q()),o.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?I():F())},Y=function(){j(),q(),I()},Z=function(){S.empty(),f.removeClass("HDLAssess-popup"),v=!1,$(".gal-title",f).html(""),$(".zoom-controls",f).remove(),s.trigger(WIDGET_EVENTS.DESTROYED,s)},et=function(){return WIDGET_CONSTANTS.HODDERASSESS_WIDGET},tt=function(){$(".ui-HDLAssess#"+p.uiId+" img",l).off(),$("div[id='"+a.id+"']",l).remove(),$("div[id='ui-"+a.id+"']",l).remove()},nt=function(){var t={type:"HDLAssess",successCallback:rt};WIDGET_CONSTANTS.APPLICATION_TYPE=="Editor"?e.getWidgetProperties(t):s.trigger(WIDGET_EVENTS.FETCH_WIDGET_PROPERTIES,t)},rt=function(e){WIDGET_CONSTANTS.HDL_ASSESS_PROPERTIES=JSON.parse(e)},it=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(a={},a.id=(new Date).getTime(),d=!0):a=e.obj,o=e.options,f=e.popupView,s=this,u=o.bookURL,x=WIDGET_CONSTANTS.USER_NAME,T=WIDGET_CONSTANTS.ACCESS_TOKEN,o.activity_id&&(_hodderAssessActivityId=o.activity_id),o.activity_title&&(_hodderAssessActivityTitle=o.activity_title);var t=WIDGET_CONSTANTS.APPLICATION_TYPE.toString().toLowerCase(),n=WIDGET_CONSTANTS.EDITOR_LABEL.toString().toLowerCase();t===n&&(k=WIDGET_CONSTANTS.EDITOR_LABEL)},initCurrWidget:O,destroy:Z,relayout:G,widgetType:et,widgetResize:Y,launch:U,onPopupShown:K,destroyView:tt});return new it(t)};return u}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/reportView/inlineViewTemplate.html",[],function(){return"<div class='widget-ui ui-HDLReports ui-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\n	<span class=\"HDLReports-player-icon\"></span>\n	<% if (src) { %>\n		<div class=\"img-cover\"></div>\n	<% } %>\n	<div class='inline-widget-footer'>\n		<div class='ui-HDLReports-icon'></div>\n		<div class='ui-gal-text-left'><%=unescape(title)%></div>\n		<div class='ui-maximize ui-right-div'></div>\n	</div>\n</div>"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/reportView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/reportView/popupViewTemplate.html",[],function(){return'<div id="lrn-loader" class="modal-dialog loading-indicator" >\n	<img src="images/loading.gif"/>\n</div>\n\n<div class="HDLReports-container">\n	<iframe id="HDLReports-frame" class="HDLReports-frame" frameborder="0" src="<%=( WIDGET_CONSTANTS.HOME_PAGE_URL+ WIDGET_CONSTANTS.HDL_REPORT_WIDGET_CODE_BASE_PATH)  %>">\n	</iframe>\n</div>\n'}),define("com/es/widgets/report/reportWidget",["com/es/widgets/WidgetUtils","com/es/widgets/WidgetEvents","com/es/text!templateBasePath/Reader/widgetsTemplates/reportView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/reportView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/reportView/popupViewTemplate.html","com/es/utilities/services"],function(e,t,n,r,i,s){var o=function(t){var s,o,u,a,f,l,c,h,p={},d=!1,v=!1,m,g=WIDGET_CONSTANTS.ASSESSMENT_MIN_WIDTH,y=WIDGET_CONSTANTS.ASSESSMENT_MIN_HEIGHT,b=null,w=null,E=!1,S,x="",T="",N,C=WIDGET_CONSTANTS.HOME_PAGE_URL,k=function(){e.log("init Report widget",s),l=o.bookFrameContent,c=o.bookFrameContentRootEl;if(o.data_json){var t=o.data_json,n=u.split("/");n.pop(),n=n.join("/")+"/"+o.dataURL;var r=n.split("/");r.pop(),_resourceURL=r.join("/")+"/",x=_resourceURL+t.src,A()}else L()},L=function(){var t=u.split("/");t.pop(),t=t.join("/")+"/"+o.dataURL,e.log("url",t);var n=t.split("/");n.pop(),_resourceURL=n.join("/")+"/",e.log("_resourceURL",_resourceURL),$.getJSON(t,{}).done(function(e){x=_resourceURL+e.src,A()}).fail(function(t,n,r){e.log("error",r),s.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},A=function(){d||O(),WIDGET_CONSTANTS.HDL_REPORTS_PROPERTIES?s.trigger(WIDGET_EVENTS.INITIALIZED,s):_.delay(function(){s.trigger(WIDGET_EVENTS.INITIALIZED,s)},100)},O=function(){P(),p={uiId:"ui-"+a.id,widgetId:"widget-"+a.id,title:$(a).data("title"),width:$("div[id='"+a.id+"']",l).width()+"px",src:x};var t=_.template(n,p);e.log("str",t),$("div[id='ui-"+a.id+"']",l).remove();var r=$("div[id='"+a.id+"']",l).get(0).innerHTML;r=r.trim(),r.length==0?($("div[id='"+a.id+"']",l).get(0).innerHTML=t,c.append($("div[id='ui-"+a.id+"']",l))):c.append(t),V()},M=function(){$(h).addClass("ui-hover-class")},D=function(){$(h).removeClass("ui-hover-class")},P=function(){if(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("div[id='"+a.id+"']",l).width();e<g&&$("div[id='"+a.id+"']",l).width(g),e>m&&$("div[id='"+a.id+"']",l).width(m)}},H=function(){if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT&&o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE)var e=$("div[id='"+a.id+"']",l).height();else var e=$("div[id='"+a.id+"']",l).width();p.height=e,$("div[id='"+a.id+"']",o.bookFrameContent).css("height",p.height+"px")},B=function(){e.log("_setDimensions-------------------------"),$("div[id='"+a.id+"']",l).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("div[id='"+a.id+"']",l)).left,n=e.getOffset($("div[id='"+a.id+"']",l)).top,r=$("div[id='"+a.id+"']",l).width(),i=$("div[id='"+a.id+"']",l).height(),h=$("div[id='ui-"+a.id+"']",l).get(0),o.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(h).css({top:n+"px",left:t+"px",position:"absolute"}):$(h).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("div[id='div-border-ui-"+a.id+"']",l).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},j=function(){if(o.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){var t=o.bookFrameContent,n,r,i,s;n=e.getOffset($("div[id='"+a.id+"']",l)).left,r=e.getOffset($("div[id='"+a.id+"']",l)).top,i=$("div[id='"+a.id+"']",l).width(),s=$("div[id='"+a.id+"']",l).height(),h=$("div[id='ui-"+a.id+"']",l).get(0),$(h).css({top:r,left:n,width:i,height:s+"px",position:"absolute"})}},F=function(t){z(),e.isTouchDevice()?s.trigger(WIDGET_EVENTS.THIRD_PARTY_WIDGET_LAUNCH,N):(f.addClass("HDLReports-popup"),s.trigger(WIDGET_EVENTS.LAUNCHED,s))},I=function(e){f.modal("hide")},q=function(){$("#lrn-loader").show("slow")},R=function(){$("#lrn-loader").hide("slow")},U=function(){s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.ERROR_LOADING_ASSESSMENT),f.find("#widget-header").removeClass("hide")},z=function(){N={widgetId:a.id,userId:WIDGET_CONSTANTS.USER_ID,userName:WIDGET_CONSTANTS.USER_NAME,widgetLaunchUrl:C+WIDGET_CONSTANTS.HDL_REPORT_WIDGET_CODE_BASE_PATH,widgetDataFolder:_resourceURL,properties:WIDGET_CONSTANTS.HDL_REPORTS_PROPERTIES,isbn:WIDGET_CONSTANTS.BOOK_ISBN_NO,bookName:WIDGET_CONSTANTS.BOOK_TITLE,enviroment:WIDGET_CONSTANTS.APPLICATION_TYPE}},W=function(){var e;e=$("#HDLReports-frame",S);var t=$("#HDLReports-frame")[0].contentWindow;t.addEventListener("TPReady",function(){t.document.TPCommunicator.setInitializationProperties(N)})},X=function(){v=!0,S=$("#widgetContent",f);if(!WIDGET_CONSTANTS.NETWORK_AVAILABLE&&!navigator.onLine)return s.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,WidgetLang.NO_INTERNET_CONNECTION_PLEASE_CHECK_AND_TRY_AGAIN_MESSAGE),!1;$("#widgetContent").html(_.template(i)),W(),s.trigger(WIDGET_EVENTS.POPULATED,s,b,w)},V=function(){o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(g=c.width()*.7),o.bookFrameContent&&(m=c.width()),e.log("Reporty Widget loaded ",m),$("div[id='"+a.id+"']",l).removeClass("widget-loader"),$("div[id='"+a.id+"']",l).find(".move-icon").removeClass("move-icon-compact"),H();var t=$("div[id='ui-"+a.id+"']",l).get(0);if(o.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED&&v===!1){B();var n=$("div[id='"+a.id+"']",l).height();n<y&&($("div[id='"+a.id+"']",l).height(y),$("div[id='ui-"+a.id+"']",l).height(y));var i=$("div[id='"+a.id+"']",l).width();i<g&&($("div[id='"+a.id+"']",l).width(g),$("div[id='ui-"+a.id+"']",l).width(g));if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){var u=_.template(r,{id:p.uiId}),f=$("div[id='"+a.id+"']",l).get(0).innerHTML;f=f.trim(),f.length==0?($("div[id='"+a.id+"']",l).get(0).innerHTML=u,c.append($("div[id='div-border-ui-"+a.id+"']",l))):c.append(u),$("div[id='div-border-ui-"+a.id+"']",l).css({width:$(t).width()+"px",height:$(t).height()+"px",top:t.style.top,left:t.style.left,position:"absolute"}),$("div[id='div-border-ui-"+a.id+"']",l).addClass("transparentWidget ui-hover-class"),$("div[id='div-border-ui-"+a.id+"']",l).css({"pointer-events":"none"})}$(".HDLReports-player-icon",t).remove(),$(".inline-widget-footer",t).remove(),$(t).QAappend('<div class="ui-clickable-icon ui-HDLReports-icon icon icon-ic-assessment"></div>'),$(t).addClass("transparentWidget"),$(t).removeClass("ui-border"),$(t).css({width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("div[id='"+a.id+"']",l).find(".move-icon").addClass("move-icon-compact"),$("#"+a.id+" .dummyWidget",l).show(),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("div[id='"+a.id+"']",l).css({"min-width":"0px",width:$(".ui-clickable-icon",t).width()+"px",height:$(".ui-clickable-icon",t).height()+"px"}),$("#"+a.id+" .dummyWidget",l).hide()),$(".ui-HDLReports-icon",t).click({},F)}else o.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?$(".ui-maximize, .HDLReports-player-icon",t).click({},F):o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&$(".ui-maximize, .HDLReports-player-icon",t).click({},F)}else $(".ui-maximize, .HDLReports-player-icon",t).click({},F);E=!0,s.trigger(WIDGET_EVENTS.RENDER_COMPLETE,s,m,g),WIDGET_CONSTANTS.HDL_REPORTS_PROPERTIES||Z()},J=function(){E&&(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(P(),H()),o.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?j():B())},K=function(){P(),H(),j()},Q=function(){S.empty(),f.removeClass("HDLReports-popup"),v=!1,$(".gal-title",f).html(""),$(".zoom-controls",f).remove(),s.trigger(WIDGET_EVENTS.DESTROYED,s)},G=function(){return WIDGET_CONSTANTS.HDLREPORTS_WIDGET},Y=function(){$(".ui-report#"+p.uiId+" img",l).off(),$("div[id='"+a.id+"']",l).remove(),$("div[id='ui-"+a.id+"']",l).remove()},Z=function(){var t={type:"HDLReports",successCallback:et};WIDGET_CONSTANTS.APPLICATION_TYPE=="Editor"?e.getWidgetProperties(t):s.trigger(WIDGET_EVENTS.FETCH_WIDGET_PROPERTIES,t)},et=function(e){WIDGET_CONSTANTS.HDL_REPORTS_PROPERTIES=JSON.parse(e)},tt=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(a={},a.id=(new Date).getTime(),d=!0):a=e.obj,o=e.options,f=e.popupView,s=this,u=o.bookURL,o.activity_id&&(_reportActivityId=o.activity_id),o.activity_title&&(_reportActivityTitle=o.activity_title);var t=WIDGET_CONSTANTS.APPLICATION_TYPE.toString().toLowerCase(),n=WIDGET_CONSTANTS.EDITOR_LABEL.toString().toLowerCase();t===n&&(T=WIDGET_CONSTANTS.EDITOR_LABEL)},initCurrWidget:k,destroy:Q,relayout:J,widgetType:G,widgetResize:K,launch:F,onPopupShown:X,destroyView:Y});return new tt(t)};return o}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/inlineViewTemplate.html",[],function(){return"<div class='ui-saras-widget invisible widget-ui ui-border ' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='widget-saras-wrapper'>\r\n		<div class='saras-link-div'>\r\n			<div class='tpwidget-<%=unescape(type)%>-icon'></div>\r\n			<div id=\"widget-url\" class='ui-gal-text-left'></div>\r\n		</div>\r\n		<!--div class='html-widget-desc'>\r\n			<%=unescape(description)%>\r\n		</div-->\r\n		<div class='inline-widget-footer'>\r\n			<div class=\"ui-saras-icon icon icon-ic-code widget-saras-icon-style\"></div>\r\n			<div class='ui-gal-text-left saras-widget-text-style'><%=unescape(title)%></div>\r\n			<!--<div class='ui-maximize ui-right-div-control'></div>-->\r\n          <!--  <div class=\"ui-maximize ui-right-div-control icon icon-ic-fullscreen\"></div>-->\r\n		</div>\r\n	</div>\r\n</div>\r\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/borderDivTemplate.html",[],function(){return'<div id="div-border-<%=id%>"></div>'}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/weblinkPopupViewTemplate.html",[],function(){return"<div class='ui-html-widget widget-ui ui-border ' id='<%=uiId%>' >\n	<div class='widget-html-wrapper'>\n		<div class=\"file-list-container\">\n			<div class='html-link-div'>\n				<div class=\"content-wrapper bottom-gray-border\">\n					<div class='html-<%=unescape(type)%>-icon'></div>\n					<div class='ui-gal-text-left'><%= WidgetLang.LAUNCH_HTML_LABEL%></div>\n				</div>\n\n				<div class=\"media html-widget-popUp-content\">\n				  <div class=\"media-body\">\n				  	<div class=\"media-object icon icon-ic-info-content\"></div>\n			<!--	    <p class=\"media-heading\"><%=unescape(description)%></p> -->\n				  </div>\n				</div>				\n			</div>\n		</div>\n	</div>\n</div>\n<!--div class='html-info-text info-text'>\n	<div class='html-info-description info-description'>\n		<div><%=unescape(description)%></div>\n	</div>\n</div-->\n"}),define("com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/printViewTemplate.html",[],function(){return"<div class='print-widget-ui print-border invisible' id='<%=uiId%>' style='width: <%=width%>;' >\r\n	<div class='print-widget-header'>\r\n		<div class=\"ui-html-icon icon icon-ic-code widget-weblink-icon-style\"></div>\r\n		<div class='ui-gal-text-left html-widget-text-style'><%=unescape(title)%></div>\r\n	</div>\r\n	\r\n	<%\r\n	var str;\r\n	if(type == \"package\"){\r\n		str = WidgetLang.HTML_PACKAGE_PRINT_NOTE;\r\n	}else{\r\n		str = WidgetLang.HTML_WEBLINK_PRINT_NOTE.replace(\"<url>\",url);\r\n		\r\n	}\r\n	%>\r\n	<div class=\"print-widget-note\"><%=str%></div>\r\n</div>\r\n"}),define("com/es/widgets/thirdParty/TPWidget",["com/es/widgets/WidgetUtils","com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/inlineViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/borderDivTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/weblinkPopupViewTemplate.html","com/es/text!templateBasePath/Reader/widgetsTemplates/thirdPartyView/printViewTemplate.html"],function(e,t,n,r,i){var s=function(r){var s,o,u,a,f,l,c,h,p,d,v,m=WIDGET_CONSTANTS.TP_MIN_WIDTH,g=WIDGET_CONSTANTS.TP_MIN_HEIGHT,y={},b=!1,w=null,E=!1,S=[],x,T=!1,N=WIDGET_CONSTANTS.HOME_PAGE_URL,C=function(){e.log("init html",s),c=o.bookFrameContent,h=o.bookFrameContentRootEl;if(o.data_json){var t=o.data_json,n=u.split("/");n.pop(),n=n.join("/")+"/"+o.dataURL;var r=n.split("/");r.pop(),a=r.join("/")+"/",L(t)}else k()},k=function(){var t=u.split("/");t.pop(),t=t.join("/")+"/"+o.dataURL,e.log("url",t);var n=t.split("/");n.pop(),a=n.join("/")+"/",e.log("_resourceURL",a),$.getJSON(t,{}).done(function(e){L(e)}).fail(function(t,n,r){e.log("error",r),s.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,r.message)})},L=function(t){l=t,l.formattedTitle&&(l.title=l.formattedTitle),e.log("onDataLoaded html widget",t),WIDGET_CONSTANTS.PRINT_MODE?A():b||O(),e.log("tips widget initialized ",s),s.trigger(WIDGET_EVENTS.INITIALIZED,s)},A=function(){v=h.width(),P(),y={uiId:"ui-"+f.id,title:l.title,type:l.type,url:l.url,testID:l.testID,description:l.description,width:$("#"+f.id,c).width()+"px"};var t=_.template(i,y);e.log("str",t),$("#"+y.uiId,c).remove(),o.layout==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?h.QAappend(t):($("#"+f.id,c).empty().addClass("reflow-print").QAappend(t),$("#"+f.id,c).find(".icon").addClass("reflow-print")),s.trigger(WIDGET_EVENTS.RENDER_COMPLETE,s)},O=function(){v=h.width(),P(),y={uiId:"ui-"+f.id,title:l.title,type:o.type,url:l.url,description:l.description,width:$("#"+f.id,c).width()+"px"};var n=_.template(t,y);e.log("str",n),$("#"+y.uiId,c).remove(),h.QAappend(n),$("#"+y.uiId+" #widget-url",c).html(WidgetLang.LAUNCH_HTML_LABEL),D($("#"+f.id,c),l),_.delay(function(){M()},50)},M=function(){p=$("#ui-"+f.id,c).get(0),d=$("#ui-"+f.id,c),$("#"+f.id,c).removeClass("widget-loader"),$("#"+f.id,c).find(".move-icon").removeClass("move-icon-compact"),$("#"+f.id,c).attr("data-size",y.size),H();if(o.layout===WIDGET_CONSTANTS.DATA_LAYOUT_FIXED){q(),F();var e=$("#"+f.id,c).width();e<m&&($("#"+f.id,c).width(m),$("#ui-"+f.id,c).width(m));if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT){if(o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE){y.uiId="ui-"+f.id;var t=_.template(n,{id:y.uiId});h.QAappend(t),$("#div-border-"+y.uiId,c).css({width:$(p).width()+"px",height:$(p).height()+"px",top:p.style.top,left:p.style.left,position:"absolute"}),$("#div-border-"+y.uiId,c).addClass("transparentWidget ui-hover-class"),$("#div-border-"+y.uiId,c).css({"pointer-events":"none"})}$(".widget-saras-wrapper",d.get(0)).remove(),$(".ui-button-div",d.get(0)).remove(),$("#"+f.id,c).find(".move-icon").addClass("move-icon-compact"),$("#ui-"+f.id,c).html('<div class="ui-clickable-icon ui-html-icon icon-font"></div>'),d.addClass("transparentWidget"),d.removeClass("ui-border"),$(d).css({width:$(".ui-clickable-icon",d).width()+"px",height:$(".ui-clickable-icon",d).height()+"px"}),$("#"+f.id+" .dummyWidget",c).show(),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_FALSE&&($("#"+f.id,c).css({width:$(".ui-clickable-icon",p).width()+"px",height:$(".ui-clickable-icon",p).height()+"px"}),$("#"+f.id+" .dummyWidget",c).hide())}else o.dataMode===WIDGET_CONSTANTS.DATA_MODE_POSTER?($(".widget-saras-wrapper",d.get(0)).QAprepend("<div class='ui-button-div quiz-slide'><div class='ui-maximize ui-html-button'></div></div>"),g=m):o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE&&(g=$(p).height(),H())}else g=$(p).height();E=!0,$("#"+y.uiId+" .tpwidget-saras-icon",c).off("click").on("click",R),$("#"+y.uiId+" .saras-package-icon",c).off("click").on("click",R),$("#"+y.uiId+" #widget-url",c).off("click").on("click",R),$(".ui-maximize",p).click({},U),s.trigger(WIDGET_EVENTS.RENDER_COMPLETE,s,v,m,g)},D=function(e,t){t.type=="package"?($(e).attr({"data-launchFile":t.url}),$("#"+y.uiId+" .ui-html-icon",c).removeClass("widget-weblink-icon-style").addClass("widget-html-icon-style")):$(e).attr({"data-launchFile":""})},P=function(){if(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT){var e=$("#"+f.id,c).width();e<m&&$("#"+f.id,c).width(m),e>v&&$("#"+f.id,c).width(v)}},H=function(){if(o.dataMode===WIDGET_CONSTANTS.DATA_MODE_INLINE||o.layout===WIDGET_CONSTANTS.DATA_LAYOUT_REFLOW){var e=$("#"+f.id,o.bookFrameContent).width();$("#ui-"+f.id,o.bookFrameContent).width(e);var t=$("#ui-"+f.id,o.bookFrameContent),n=$(t).find(".widget-saras-wrapper").height()+$(t).find(".inline-widget-footer").height();y.height=n,$("#"+f.id,o.bookFrameContent).css("height",y.height+"px"),$("#ui-"+f.id,o.bookFrameContent).css("height",y.height+"px")}$("#"+f.id,o.bookFrameContent).html()!=""&&F()},B=function(){P(),H(),I()},j=function(){E&&(o.dataMode!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&(P(),F()),o.layout!==WIDGET_CONSTANTS.DATA_LAYOUT_FIXED?I():q())},F=function(){var e=$("#"+f.id,c).height();e<g&&($("#"+f.id,c).height(g),$("#ui-"+f.id,c).height(g))},I=function(){var t=$("#"+f.id,c),n=e.getOffset(t).left,r=e.getOffset(t).top,i=$(t).width(),s=$(t).height(),o=$("#ui-"+t.get(0).id,c).get(0);$(o).css({top:r+"px",left:n+"px",width:i+"px",height:s+"px",position:"absolute"})},q=function(){e.log("_setDimensions-------------------------"),$("#"+f.id,c).css({position:"absolute"});var t,n,r,i;t=e.getOffset($("#"+f.id,c)).left,n=e.getOffset($("#"+f.id,c)).top,r=$("#"+f.id,c).width(),i=$("#"+f.id,c).height(),p=$("#ui-"+f.id,c).get(0),o.dataMode===WIDGET_CONSTANTS.DATA_MODE_COMPACT?o.dataBorder==WIDGET_CONSTANTS.DATA_BORDER_TRUE?$(p).css({top:n+"px",left:t+"px",position:"absolute"}):$(p).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}):$(p).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute"}),o.dataBorder===WIDGET_CONSTANTS.DATA_BORDER_TRUE&&$("#div-border-"+y.uiId,c).css({top:n+"px",left:t+"px",width:r+"px",height:i+"px",position:"absolute","z-index":1e4})},R=function(){var e,t=window.location.origin,n=window.location.pathname.split("/");n.pop(),e=t+n.join("/")+"/"+WIDGET_CONSTANTS.THIRD_PARTY_PATH[o.type];var r={url:e,initData:{data:l,testID:l.testId},launchMode:"popout",type:o.type};s.trigger(WIDGET_EVENTS.LAUNCH_TPCONTENT,r)},U=function(){s.trigger(WIDGET_EVENTS.LAUNCHED,s)},z=function(){w!=null&&w.destroy(),w=new IScroll($(".file-list-container",x).get(0),{desktopCompatibility:!0,vScroll:!0,hScroll:!1}),_.delay(function(){w&&w.refresh()},999)},W=function(){return WIDGET_CONSTANTS.HTML_WIDGET},X=function(e){var t=$(p).get(0).scrollHeight;$("#"+f.id,o.bookFrameContent).css({height:t+"px"})},V=function(){x.empty(),s.trigger(WIDGET_EVENTS.DESTROYED,s)},J=function(){$("#"+y.uiId+" .html-link-div",c).off(),$("#"+y.uiId+" .download-widget-icon",c).unbind(),$("#"+f.id,c).remove(),$("#ui-"+f.id,c).remove()},K=Backbone.View.extend({initialize:function(e){_.extend(this,Backbone.Events),e.directLaunch?(b=!0,e.widgetEnrichmentArr.length&&(f={},f.id=_.findWhere(e.widgetEnrichmentArr,{level:0}).widgetId)):f=e.obj,o=e.options,s=this,u=o.bookURL,S=e.widgetEnrichmentArr},initCurrWidget:C,destroy:V,relayout:j,widgetType:W,onFontChange:X,widgetResize:B,launch:U,destroyView:J});return new K(r)};return s}),define("com/es/widgets/WidgetsController",["com/es/widgets/WidgetConstants","com/es/widgets/WidgetEvents","com/es/widgets/WidgetUtils","com/es/widgets/imageGallery/ImageGalleryWidget","com/es/widgets/image/ImageWidget","com/es/widgets/video/VideoWidget","com/es/widgets/audio/AudioWidget","com/es/widgets/assessment/view/assesmentWidget","com/es/widgets/tips/tipsWidget","com/es/widgets/html/htmlWidget","com/es/widgets/file/fileWidget","com/es/widgets/WidgetPopup","com/es/widgets/WidgetLang","com/es/widgets/learnosity/learnosityWidget","com/es/widgets/eow/eowWidget","com/es/widgets/hodderAssess/hodderAssessWidget","com/es/widgets/report/reportWidget","com/es/widgets/thirdParty/TPWidget"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y=function(e){var t,y,b,w,E=null,S,x=0,T=0,N=0,C="",k,L=new Array,A=null,O=[],M=!1,D=[],P=!1,H,B,j=null,F=function(){WIDGET_CONSTANTS.HDL_ASSESS_PROPERTIES||Xt(),WIDGET_CONSTANTS.HDL_REPORTS_PROPERTIES||$t(),$.fn.QAappend=function(e){var t=n.getAndroidVersion(),r=navigator.userAgent.toLowerCase(),i=r.match(/(iPad|iPhone|iPod)/i);t>=4.4||i?($("#QAPlaceHolder")[0].innerHTML=e,this.append($("#QAPlaceHolder").children()[0])):this.append(e)},$.fn.QAprepend=function(e){var t=n.getAndroidVersion(),r=navigator.userAgent.toLowerCase(),i=r.match(/(iPad|iPhone|iPod)/i);t>=4.4||i?($("#QAPlaceHolder")[0].innerHTML=e,this.prepend($("#QAPlaceHolder").children()[0])):this.prepend(e)},WIDGET_CONSTANTS.DEVICE_PIXEL_RATIO=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI,_isFullScreen=!1,n.log("WidgetController initialized"),n.log("---WidgetPopup ",c);if($("#widgetPopup").length===0)var e=new c;S=$("#widgetPopup"),n.log("book URL",C,$),$(".widget-placeholder",b).addClass("widgetFrame"),_.each($(".widget-placeholder.widget-learnosity",b),function(e){e.id=e.id.replace(/[ .:]/g,"-"),n.isTouchDevice()&&$(e).attr({data:""}).addClass("lrn-hide")}),O=$(".widget-placeholder[data][data !='']",b),n.log("widgets",O,O.length);var t=O.length;t>0&&I(),t==0&&(J(),K()),q()},I=function(){H=decodeURIComponent(H);var e=C+H+"_widgets_data.json";$.getJSON(e,{}).done(function(t){j=t,U(O[0])}).fail(function(t,n,r){U(O[0])})},q=function(){if(WIDGET_CONSTANTS.PRINT_MODE){var e={image:"icon icon-ic-image",imageGal:"ui-play-button icon icon-ic-play",audio:"icon icon-ic-headphone",video:"icon ui-video-icon",file:"icon icon-file",html:"icon icon-ic-code",tip:"icon icon-ic-tip",assessment:"icon icon-ic-assessment"};if(WIDGET_CONSTANTS.BOOK_TYPE=="fixed"){var t=b[0].body;$(t).append("<p style='page-break-after:always;'></p>\n<h3 style='color:#000;'>Widgets</h3>")}$(".widget-placeholder",b).addClass(function(){return e[$(this).data("type")]})}},R=function(e){var t=null;return j&&(t=j[e]||null),t},U=function(e){var c=$(e),h=W(e),y,b=[];b=_.where(D,{widgetId:c.get(0).id}),c.hasClass("widget-loader")||c.addClass("widget-loader"),c.removeClass("widgetFrame");if(c.hasClass("widget-img-gal"))y=new r({obj:e,options:h,popupView:S});else if(c.hasClass("widget-img"))y=new i({obj:e,options:h,popupView:S});else if(c.hasClass("widget-audio"))y=new o({obj:e,options:h,popupView:S,widgetEnrichmentArr:b}),y.on(WIDGET_EVENTS.PLAY_CLICKED,tt);else if(c.hasClass("widget-video"))y=new s({obj:e,options:h,popupView:S,widgetEnrichmentArr:b}),y.on(WIDGET_EVENTS.PLAY_CLICKED,tt),y.on(WIDGET_EVENTS.VIDEO_TOUCHSTART,function(){t.trigger(WIDGET_EVENTS.VIDEO_CONTROL_TOUCHSTART)}),y.on(WIDGET_EVENTS.VIDEO_TOUCHEND,function(){t.trigger(WIDGET_EVENTS.VIDEO_CONTROL_TOUCHEND)});else if(c.hasClass("widget-assessment"))y=new u({obj:e,options:h,popupView:S}),y.on(WIDGET_EVENTS.HEIGHT_UPDATED,wt),y.off(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA).on(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA,function(e,n){t.trigger(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA,e,n)}),y.off(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA).on(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA,function(e,n){t.trigger(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA,e,n)});else if(c.hasClass("widget-tip"))y=new a({obj:e,options:h,popupView:S});else if(c.hasClass("widget-html"))y=new f({obj:e,options:h,popupView:S,widgetEnrichmentArr:b}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,_t);else if(c.hasClass("widget-file"))y=new l({obj:e,options:h,popupView:S,widgetEnrichmentArr:b}),y.on(WIDGET_EVENTS.LAUNCH_FILE_CLICKED,Dt);else if(c.hasClass("widget-learnosity"))y=new p({obj:e,options:h,popupView:S}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,Pt),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft);else if(c.hasClass("widget-eow"))y=new d({obj:e,options:h,popupView:S}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,Ht),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft);else if(c.hasClass("widget-HDLAssess"))y=new v({obj:e,options:h,popupView:S}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,Bt),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft);else if(c.hasClass("widget-HDLReports"))y=new m({obj:e,options:h,popupView:S}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,jt),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft);else{if(!c.hasClass("widget-tpwidget")){n.log("Unsupported widget type ",e);return}y=new g({obj:e,options:h,popupView:S,widgetEnrichmentArr:b}),y.on(WIDGET_EVENTS.LAUNCH_TPCONTENT,Y)}y.identifier=e.id,L.push(y),x++,y.on(WIDGET_EVENTS.INITIALIZED,X),y.on(WIDGET_EVENTS.INITTIALIZE_ERROR,V),y.on(WIDGET_EVENTS.LAUNCHED,Q),y.on(WIDGET_EVENTS.POPULATED,Z),y.on(WIDGET_EVENTS.DESTROYED,et),y.on(WIDGET_EVENTS.RENDER_COMPLETE,z),y.on(WIDGET_EVENTS.DOWNLOAD_ACTION,Mt),y.on(WIDGET_EVENTS.SHOW_ALERT_MSG,It),y.on(WIDGET_EVENTS.INVOKE_SERVICE,at),y.on(WIDGET_EVENTS.FETCH_WIDGET_PROPERTIES,function(e){ft(e)}),y.on(WIDGET_EVENTS.THIRD_PARTY_WIDGET_LAUNCH,lt),y.on(WIDGET_EVENTS.XAPI_EVENT,G),y.initCurrWidget(),c.attr("data-mode")=="compact"&&c.removeClass("widget-center")},z=function(e,n,r,i){e.relayout(),N++,t.trigger(WIDGET_EVENTS.RENDER_COMPLETE,e,n,r,i),O.length>N?U(O[N]):N===x&&K()},W=function(e){var t=e,n={layout:t.getAttribute("data-layout"),dataMode:t.getAttribute("data-mode"),dataBorder:t.getAttribute("data-border"),align:t.getAttribute("data-align"),popout:t.getAttribute("data-popout"),width:t.style.width.split("px")[0],height:t.style.height.split("px")[0],dataURL:t.getAttribute("data"),top:t.style.top.split("px")[0],left:t.style.left.split("px")[0],bookURL:C,baseMediaURL:k,bookFrameContent:b,bookFrameContentRootEl:w,type:t.getAttribute("data-type"),data_json:R(e.id)};return require.s.contexts._.config.theme=="ngl"&&t.getAttribute("data-type")=="assessment"&&(n.checkAnswer=t.getAttribute("data-checkanswer"),n.checkAnswer=n.checkAnswer==0||n.checkAnswer=="false"?!1:!0),n},X=function(e){T++,n.log("_onWidgetInitialized",e),t.trigger(WIDGET_EVENTS.INITIALIZED,e),T===x&&J()},V=function(e){T++,n.log("_onWidgetInitializeError",e),t.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,e),T===x&&(J(),K())},J=function(){t.trigger(WIDGET_EVENTS.ALL_WIDGETS_INITIALIZED)},K=function(){x>0&&(M=!0,st(),WIDGET_CONSTANTS.APPLICATION_TYPE=="Reader"&&_.delay(function(){b.find(".ui-HDLReports").attr("style","display: none !important"),b.find(".widget-HDLReports").attr("style","display: none !important")},0),b.find(".widget-ui").removeClass("invisible"),WIDGET_CONSTANTS.PRINT_MODE&&(b.find(".print-widget-ui").removeClass("invisible"),b.find(".widget-placeholder").removeClass("widget-loader widget-right widget-left widget-center").css("width","auto")));var e=$(".widget-placeholder[data =  '']",b);e.find(".dummyWidget").removeClass("invisible"),b.find(".move-icon").removeClass("invisible"),t.trigger(WIDGET_EVENTS.ALL_RENDER_COMPLETE)},Q=function(e,n){P=!0,tt(e),E=e,E.widgetType()==="assessment"&&(E.off(WIDGET_EVENTS.FETCH_PREVIUOUS_ATTEMPTS).on(WIDGET_EVENTS.FETCH_PREVIUOUS_ATTEMPTS,function(e){t.trigger(WIDGET_EVENTS.FETCH_PREVIUOUS_ATTEMPTS,e)}),E.off(WIDGET_EVENTS.SEND_RESPONSE_DATA).on(WIDGET_EVENTS.SEND_RESPONSE_DATA,function(e){t.trigger(WIDGET_EVENTS.SEND_RESPONSE_DATA,e)}),E.off(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA).on(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA,function(e,n){t.trigger(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA,e,n)}),E.off(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA).on(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA,function(e,n){t.trigger(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA,e,n)})),E.off(WIDGET_EVENTS.POPULATE_MORE).on(WIDGET_EVENTS.POPULATE_MORE,St),rt(),t.trigger(WIDGET_EVENTS.LAUNCHED,e)},G=function(e,n,r){var i={event:r?r:"experienced",data:{widgetId:e.identifier,type:e.widgetType(),mode:P?"popout":"inline",spineId:H,chapterId:B}};_.extend(i.data,n),t.trigger(WIDGET_EVENTS.XAPI_EVENT,i),console.log("XAPI event",i)},Y=function(e){t.trigger(WIDGET_EVENTS.LAUNCH_TPCONTENT,e)},Z=function(e,r,i){n.log("widget populated ",e);if(i&&r){var s,o,u,a;s=i>200?i:200,o=r+30,o=o>200?o:200,s=s>$("body").height()?$("body").height()-50:s,o=s>$("body").width()?$("body").height()-50:o;var u=($("body").height()-s)/2,a=($("body").width()-o)/2}t.trigger(WIDGET_EVENTS.POPULATED,E)},et=function(e){ot(),t.trigger(WIDGET_EVENTS.DESTROYED,e)},tt=function(e,r){try{E&&e!==E&&(E.widgetType()==="video"&&E.pause(),E.widgetType()==="audio"&&E.pause()),E=e,t.trigger(WIDGET_EVENTS.PLAY_CLICKED,e)}catch(i){n.log(i)}},nt=function(){E&&(E.widgetType()==="video"&&E.pause(),E.widgetType()==="audio"&&E.pause())},rt=function(){n.log("curr obj",E,S),S.modal("show"),$("#closePopup",S).click(pt),E.widgetType()!="assessment"?$(".modal-backdrop").click(pt):$(".modal-backdrop:last").unbind("click"),$(".modal-backdrop").on("touchmove",function(e){return e.preventDefault(),!1}),$("#widgetPopup")[0].addEventListener("touchmove",function(e){var t=$(e.target).attr("type");if(t!=="range")return e.preventDefault(),!1},!1),$("#toggleFullscreen",S).click(ht),E.off(WIDGET_EVENTS.ON_DONE).on(WIDGET_EVENTS.ON_DONE,it),S.on(WIDGET_EVENTS.POPUP_HIDDEN,dt),S.on(WIDGET_EVENTS.POPUP_SHOWN,mt),$("#widgetPopup").removeClass("hide"),n.isIE()&&mt()},it=function(e){E&&E.identifier&&E.widgetType()==="assessment"&&E.populateInlineView(e),pt()},st=function(){if(!M)return;for(var e=0;e<L.length;e++){var t=L[e];t.widgetType!=undefined&&t.relayout()}},ot=function(){E&&pt()},ut=function(e){if(!M)return;for(var t=0;t<L.length;t++){var n=L[t];n.onCloseAllWidgets!=undefined&&n.onCloseAllWidgets(e)}},at=function(e){var n={params:e.svcParams,identifier:e.identifier,allowAccessToken:e.allowAccessToken,successCallback:e.success,errorCallback:e.error};t.trigger(WIDGET_EVENTS.INVOKE_SERVICE,n)},ft=function(e){t.trigger(WIDGET_EVENTS.FETCH_WIDGET_PROPERTIES,e)},lt=function(e){t.trigger(WIDGET_EVENTS.THIRD_PARTY_WIDGET_LAUNCH,e)},ct=function(){if(!M)return;for(var e=0;e<L.length;e++){var t=L[e];t.removeMedia!=undefined&&t.removeMedia()}},ht=function(){S.hasClass("fullscreen")?(n.log("restore screen"),S.removeClass("fullscreen"),$("#toggleFullscreen",S).removeClass("icon-resize-small"),$("#toggleFullscreen",S).addClass("icon-fullscreen"),E.resize()):(n.log("fullscreen"),S.addClass("fullscreen"),$("#toggleFullscreen",S).removeClass("icon-fullscreen"),$("#toggleFullscreen",S).addClass("icon-resize-small"),E.resize())},pt=function(){S.modal("hide")},dt=function(e){P=!1,$(window).off("resize",vt),E&&(E.widgetType()==="video",E.destroy(),$("#closePopup",S).unbind(),$(".modal-backdrop").unbind(),$("#toggleFullscreen",S).unbind(),$("#widget-header .download-widget-icon",S).unbind(),$("#widget-header .download-widget-icon",S).remove(),S.unbind(),t.trigger(WIDGET_EVENTS.CLOSED,E),E.widgetType()!=="video"&&(E=null),$(".modal-backdrop,#widgetPopup").off("touchmove"))},vt=function(){var e=$("#widgetPopup .modal-dialog").outerHeight(),t=$("#widgetPopup #widget-header").outerHeight();$("#widgetPopup .modal-content").css("height",e-t),E.refreshScroll&&E.refreshScroll();var n=$("#widgetContent",S);$(".more-less-description",n).html()==WIDGET_CONSTANTS.DESCRIPTION_COLLAPSE&&$(".more-less-description",n).trigger(WIDGET_EVENTS.CLICK),_.delay(function(){St($(".fig-description",n).html(),".info-description",n)},500)},mt=function(e){S.focus(),$(window).off("resize",vt).on("resize",vt),E.onPopupShown();var t=$("#widgetPopup .modal-dialog").outerHeight(),n=$("#widgetPopup #widget-header").outerHeight();$("#widgetPopup .modal-content").css("height",t-n)},gt=function(e){if(!M)return;for(var t=0;t<L.length;t++){var n=L[t];n.widgetType!=undefined&&n.widgetType()===WIDGET_CONSTANTS.TIP_WIDGET&&n.onFontChange()}st()},yt=function(){if(!M)return;for(var e=0;e<L.length;e++){var t=L[e];t.widgetResize!=undefined&&t.widgetResize()}st()},bt=function(){_.delay(function(){yt();var e=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI;WIDGET_CONSTANTS.DEVICE_PIXEL_RATIO!=e&&(WIDGET_CONSTANTS.DEVICE_PIXEL_RATIO=e)},999)},wt=function(){yt()},Et=function(){var e="portrait",t="landscape",n=window.orientation;return n===90||n===-90?t:e},St=function(e,t,n){e||(e=""),$(t,n).html('<span class="fig-description">'+e+"</span>"),$(t,n).parent().find(".more-less-description").length||$(t,n).after('<a class="more-less-description icon icon-ic-info"></a>'),$(t,n).css({opacity:0,height:0});if(e&&e.trim().length>0){$(".fig-description",n).html(e);var r=$(".fig-description",n).height(),i=$(".info-description",n).get(0).clientHeight;e.length>0?($(".more-less-description",n).css("opacity",1),$(".more-less-description",n).off("click").on("click",function(r){Nt(r,e,t,n)})):($(".more-less-description",n).css("opacity",0),$(".more-less-description",n).addClass("disabled"))}else $(".more-less-description",n).css("opacity",0)},xt=function(e){A!=null&&A.destroy();if(e==".galleria-info-description"){var t=$("#widgetContent").height()/2;$(".fig-description").css({height:t+"px"})}var n=parseFloat($(".fig-description").css("padding-top")),r=$(".fig-description>div").height();$(".fig-description>div").height(r+n),A=new IScroll($(".fig-description").get(0),{desktopCompatibility:!0,vScroll:!0,hScroll:!1}),$(".fig-description .iScrollIndicator").css("opacity",0),_.delay(function(){A&&(A.refresh(),$(".fig-description .iScrollIndicator").css("opacity",1))},999)},Tt=function(){A!=null&&A.destroy()},Nt=function(e,t,n,r){var i=$(".fig-description",r).height();i+=isNaN(parseInt($(".info-description",r).css("padding-top")))?0:parseInt($(".info-description",r).css("padding-top")),i+=isNaN(parseInt($(".info-description",r).css("padding-bottom")))?0:parseInt($(".info-description",r).css("padding-bottom"));var s=$(e.target),o=s.html();s.hasClass("overflowed-content")?($(".info-description",r).scrollTop(0),$(".info-description",r).css({height:0,opacity:0,overflow:""}),s.removeClass("overflowed-content")):($(".info-description",r).css({height:i,opacity:1}),i>=300&&$(".info-description",r).css("overflow","auto"),s.addClass("overflowed-content"))},Ct=function(e){H=e.spineId,B=e.chapterId,WIDGET_CONSTANTS.HDL_ASSESS_PROPERTIES||Xt(),WIDGET_CONSTANTS.HDL_REPORTS_PROPERTIES||$t(),ut(),n.log("_launchExternalWidget ",e);var c={dataURL:e.dataURL+"?"+(new Date).getTime(),bookURL:C?C:e.bookURL,baseMediaURL:e.widgetBasePath};c.baseMediaURL!=""&&c.baseMediaURL.charAt(c.baseMediaURL.length-1)!="/"&&(c.baseMediaURL=c.baseMediaURL+"/");var g=e.enrichmentJSONObj?e.enrichmentJSONObj:[],y;if(e.type==="widget-img-gal")y=new r({directLaunch:!0,options:c,popupView:S});else if(e.type==="widget-img")y=new i({directLaunch:!0,options:c,popupView:S});else if(e.type==="widget-audio")y=new o({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.PLAY_CLICKED,tt);else if(e.type==="widget-video")y=new s({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.PLAY_CLICKED,tt);else if(e.type==="widget-assessment")y=new u({directLaunch:!0,options:c,popupView:S}),y.on(WIDGET_EVENTS.HEIGHT_UPDATED,wt);else if(e.type==="widget-tip")y=new a({directLaunch:!0,options:c,popupView:S});else if(e.type==="widget-html")y=new f({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,_t);else if(e.type==="widget-file")y=new l({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.LAUNCH_FILE_CLICKED,Dt);else if(e.type==="widget-learnosity")c.activity_id=e.enrichmentJSONObj[0].widgetId,c.activity_title=e.enrichmentJSONObj[0].title,c.standalone=e.standalone,c.standalone&&(WIDGET_CONSTANTS.LEARNOSITY_STANDALONE=!0),y=new p({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,Pt),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft);else if(e.type==="widget-eow"){if(e.enrichmentJSONObj){var b=e.enrichmentJSONObj[0];b.widgetId&&(c.activity_id=e.enrichmentJSONObj[0].widgetId),b.title&&(c.activity_title=e.enrichmentJSONObj[0].title)}c.standalone=e.standalone,c.standalone&&(WIDGET_CONSTANTS.EOW_STANDALONE=!0),y=new d({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,Ht),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft)}else if(e.type==="widget-HDLAssess"){WIDGET_CONSTANTS.HOME_PAGE_URL||(WIDGET_CONSTANTS.HOME_PAGE_URL=window.location.origin+"/pubportal/QA/");if(e.enrichmentJSONObj){var b=e.enrichmentJSONObj[0];b.widgetId&&(c.activity_id=e.enrichmentJSONObj[0].widgetId),b.title&&(c.activity_title=e.enrichmentJSONObj[0].title)}y=new v({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,Bt),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft)}else{if(e.type!=="widget-HDLReports"){n.log("Unsupported widget type ",e.type);return}if(WIDGET_CONSTANTS.APPLICATION_TYPE=="Reader"&&WIDGET_CONSTANTS.USER_ROLE=="2")return t.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,h.REPORTCARD_UNAVAILABLE_TEACHER_ROLE),!1;if(e.enrichmentJSONObj){var b=e.enrichmentJSONObj[0];b.widgetId&&(c.activity_id=e.enrichmentJSONObj[0].widgetId),b.title&&(c.activity_title=e.enrichmentJSONObj[0].title)}y=new m({directLaunch:!0,options:c,popupView:S,widgetEnrichmentArr:g}),y.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,jt),y.on(WIDGET_EVENTS.DESTROY_WEBVIEW,Ft)}g.length&&(y.identifier=_.findWhere(g,{level:0}).widgetId),y.on(WIDGET_EVENTS.INITIALIZED,kt),y.on(WIDGET_EVENTS.INITTIALIZE_ERROR,Lt),y.on(WIDGET_EVENTS.LAUNCHED,Q),y.on(WIDGET_EVENTS.POPULATED,Z),y.on(WIDGET_EVENTS.DESTROYED,et),y.on(WIDGET_EVENTS.DOWNLOAD_ACTION,Mt),y.on(WIDGET_EVENTS.SHOW_ALERT_MSG,It),y.on(WIDGET_EVENTS.INVOKE_SERVICE,at),y.on(WIDGET_EVENTS.FETCH_WIDGET_PROPERTIES,function(e){ft(e)}),y.on(WIDGET_EVENTS.THIRD_PARTY_WIDGET_LAUNCH,lt),y.on(WIDGET_EVENTS.XAPI_EVENT,G),y.initCurrWidget()},kt=function(e){n.log("_onExternalWidgetInitialized",e),t.trigger(WIDGET_EVENTS.INITIALIZED,e),e.launch()},Lt=function(e){T++,n.log("_onWidgetInitializeError",e),t.trigger(WIDGET_EVENTS.INITTIALIZE_ERROR,e),T===x&&(J(),K())},At=function(e){var t;_.each(L,function(n){n.identifier==e&&(t=n)}),t&&(L=_.without(L,t),x--,N--,T--)},Ot=function(e,t,n,r){if(L.length){var i=_.findWhere(L,{identifier:e});i&&i.updateDownloadStatus(t,n,r)}E&&E.identifier==e&&E.updateDownloadStatus(t,n,r)},Mt=function(e,n,r){t.trigger(WIDGET_EVENTS.DOWNLOAD_ACTION,e,n,r)},_t=function(e,n,r,i){t.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,e,n,r)},Dt=function(e,n,r,i){t.trigger(WIDGET_EVENTS.LAUNCH_FILE_CLICKED,e,n)},Pt=function(e,n){t.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,e,n)},Ht=function(e,n){t.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,e,n)},Bt=function(e,n){t.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,e,n)},jt=function(e,n){t.trigger(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,e,n)},Ft=function(){t.trigger(WIDGET_EVENTS.DESTROY_WEBVIEW)},It=function(e){t.trigger(WIDGET_EVENTS.SHOW_ALERT_MSG,e)},qt=function(){$(window).off("resize",vt),_.each(L,function(e){e.destroyView&&e.destroyView(),e.unbind(),e.off(),e.remove()})},Rt=function(e){WIDGET_CONSTANTS.NETWORK_AVAILABLE=e},Ut=function(e){var t=e&&typeof e=="string"?e:"Reader";WIDGET_CONSTANTS.APPLICATION_TYPE=t},zt=function(){var e="//items.learnosity.com/";$("script[src*='://items.learnosity.com']").length<=0&&!n.isTouchDevice()&&$.getScript(e).done(function(e,t){console.log("Succesfully loaded Learnosity api: "+t)}).fail(function(e,t,n){console.error("Error in loading Learnosity api: "+n)})},Wt=function(e){var e=e;return e&&e.charAt(e.length-1)!=="/"&&(e+="/"),!e&&typeof e=="undefined"&&(e=null),e},Xt=function(){var e={type:"HDLAssess",successCallback:Vt};WIDGET_CONSTANTS.APPLICATION_TYPE=="Editor"?n.getWidgetProperties(e):t.trigger(WIDGET_EVENTS.FETCH_WIDGET_PROPERTIES,e)},Vt=function(e){e&&(WIDGET_CONSTANTS.HDL_ASSESS_PROPERTIES=JSON.parse(e))},$t=function(){var e={type:"HDLReports",successCallback:Jt};WIDGET_CONSTANTS.APPLICATION_TYPE=="Editor"?n.getWidgetProperties(e):t.trigger(WIDGET_EVENTS.FETCH_WIDGET_PROPERTIES,e)},Jt=function(e){e&&(WIDGET_CONSTANTS.HDL_REPORTS_PROPERTIES=JSON.parse(e))},Kt=Backbone.View.extend({initialize:function(e,r){H=r.spineId,B=r.chapterId;if(t===undefined){n.log("initialize -- ",t,r.frameSelector),r.userId&&(WIDGET_CONSTANTS.USER_ID=r.userId),r.courseId&&(WIDGET_CONSTANTS.BOOK_ISBN_NO=r.courseId),r.bookType&&(WIDGET_CONSTANTS.BOOK_TYPE=r.bookType),r.lrnReaderPath&&(r.lrnReaderPath.charAt(r.lrnReaderPath.length-1)!=="/"&&(r.lrnReaderPath+="/"),WIDGET_CONSTANTS.LEARNOSITY_READER_HTML_URL=r.lrnReaderPath),r.serviceBaseUrl&&(r.serviceBaseUrl.charAt(r.serviceBaseUrl.length-1)!=="/"&&(r.serviceBaseUrl+="/"),WIDGET_CONSTANTS.LEARNOSITY_SERVICE_BASE_URL=r.serviceBaseUrl),r.lrnAccessToken&&(WIDGET_CONSTANTS.LEARNOSITY_ACCESS_TOKEN=r.lrnAccessToken,WIDGET_CONSTANTS.ACCESS_TOKEN=r.lrnAccessToken),r.homePageUrl&&(WIDGET_CONSTANTS.HOME_PAGE_URL=r.homePageUrl);if(r.widgetParams&&typeof r.widgetParams.eow=="object"){r.widgetParams.eow.userName&&(WIDGET_CONSTANTS.USER_NAME=r.widgetParams.eow.userName),r.widgetParams.eow.userRole&&(WIDGET_CONSTANTS.USER_ROLE=r.widgetParams.eow.userRole),r.widgetParams.eow.bookId&&(WIDGET_CONSTANTS.BOOK_ID=r.widgetParams.eow.bookId),r.widgetParams.eow.bookName&&(WIDGET_CONSTANTS.BOOK_TITLE=r.widgetParams.eow.bookName),r.widgetParams.eow.environment&&(WIDGET_CONSTANTS.APPLICATION_TYPE=r.widgetParams.eow.environment);var i=Wt(r.widgetParams.eow.lampServer);WIDGET_CONSTANTS.EOW_LDL_SERVER=i,WIDGET_CONSTANTS.EOW_LDL_SERVICE_URL=r.widgetParams.eow.lampService;var s=Wt(r.widgetParams.eow.serviceBaseUrl);WIDGET_CONSTANTS.EOW_SERVICE_BASE_URL=s;var o=Wt(r.widgetParams.eow.readerHtmlPath);WIDGET_CONSTANTS.EOW_RDR_HTML_PATH=o}WIDGET_CONSTANTS.USER_ROLE=="1"?WIDGET_CONSTANTS.USER_LOGIN_TYPE="student":WIDGET_CONSTANTS.USER_ROLE=="2"?WIDGET_CONSTANTS.USER_LOGIN_TYPE="teacher":WIDGET_CONSTANTS.USER_LOGIN_TYPE="",_.extend(this,Backbone.Events),t=this;if(require.s.contexts._.config.allowBookTheme)var u=$(r.frameSelector).get(0).contentWindow;b=$(r.frameSelector).contents(),w=b.find("body #reflow-scrolling-container").length>0?b.find("body #reflow-scrolling-container"):b.find("body"),C=r.contentBaseUrl,WIDGET_CONSTANTS.CONTENT_BASE_URL=r.contentBaseUrl,k=r.baseMediaURL,k!=""&&k.charAt(k.length-1)!="/"&&(k+="/"),r.enrichmentJSONObj&&(D=r.enrichmentJSONObj),r.downloadBasePath&&(WIDGET_CONSTANTS.DOWNLOAD_SUPPORTED=!0,WIDGET_CONSTANTS.DOWNLOADED_ASSETS_URL=r.downloadBasePath),WIDGET_CONSTANTS.ASSETS_URL=r.baseMediaURL,n.log("initialize -- ",t),WIDGET_CONSTANTS.PRINT_MODE=r.printMode,zt(),n.isIE()&&w.addClass(" ie ie10")}else n.log("instance already created")},initializeWidgets:F,initWidget:U,relayout:st,closeWidget:ot,closeAllWidgets:ut,onFontChange:gt,windowResize:yt,launchExternalWidget:Ct,updateWidgetList:At,removeAllMedia:ct,onWindowResize:bt,updateDownloadStatus:Ot,stopMedia:nt,destroyController:qt,setNetworkState:Rt,setApplicationType:Ut}),Qt;return typeof arguments[0]=="object"&&arguments.length==1?Qt=e:Qt={frameSelector:arguments[0],contentBaseUrl:arguments[1],baseMediaURL:arguments[2],downloadBasePath:arguments[3],enrichmentJSONObj:arguments[4],userId:arguments[5],courseId:arguments[6],serviceBaseUrl:arguments[7],lrnAccessToken:arguments[8],lrnReaderPath:arguments[9],widgetParams:arguments[10],homePageUrl:arguments[11],spineId:arguments[12],chapterId:arguments[13],printMode:arguments[14]},new Kt({},Qt)};return y}),define("com/es/text!templateBasePath/Editor/author/contextMenuTemplate.html",[],function(){return'<div class="modal fade contextMenu">\r\n<div class="modal-dialog contextMenu-dialog">\r\n    <div class="modal-content contextMenu-content">\r\n      <div class="modal-body">\r\n        <ul class="contextMenuUL" role="menu">\r\n	          <li role="menuitem" id="edit" class="edit"><%=AppLang.EDIT_POPUP_LABEL%></li>\r\n	   		  <li role="menuitem" id="settings" class="settings"><%=AppLang.SETTINGS_LABEL%></li>\r\n	          <li role="menuitem" id="remove" class="remove"><%=AppLang.REMOVE_LABEL%></li>\r\n	        </ul>\r\n      </div>\r\n     \r\n    </div>\r\n  </div>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/author/tocView/tocModEditorContextMenuTemplate.html",[],function(){return'<div class="modal fade contextMenu">\n<div class="modal-dialog contextMenu-dialog">\n    <div class="modal-content contextMenu-content">\n      <div class="modal-body">\n        <ul class="contextMenuUL" role="menu">\n	          <li role="menuitem" id="link" class="link"><%=AppLang.LINK_LABEL%></li>\n	   		  <li role="menuitem" id="insert-after" class="insert-after"><%=AppLang.INSERT_AFTER_LABEL%></li>\n	          <li role="menuitem" id="insert-before" class="insert-before"><%=AppLang.INSERT_BEFORE_LABEL%></li>\n	          <li role="menuitem" id="insert-child" class="insert-child"><%=AppLang.INSERT_CHILD_LABEL%></li>\n	   		  <li role="menuitem" id="rename" class="rename"><%=AppLang.RENAME_LABEL%></li>\n	          <li role="menuitem" id="delete" class="delete"><%=AppLang.DELETE_LABEL%></li>\n	        </ul>\n      </div>\n    </div>\n  </div>\n</div>'}),define("com/es/views/ContextMenuView",["com/es/text!templateBasePath/Editor/author/contextMenuTemplate.html","com/es/text!templateBasePath/Editor/author/tocView/tocModEditorContextMenuTemplate.html","com/es/text!templateBasePath/Editor/popups/popUpTemplate.html"],function(e,t,n){var r=Backbone.View.extend({el:null,currentWidget:null,isTOCModInvoke:null,initialize:function(e){this.isTOCModInvoke=e.isTOCModInvoke,this.el=$(".contextMenu"),this.render()},render:function(){var r=this;$(this.el).remove(),r.isTOCModInvoke?($(document.body).append(_.template(n)),$(".popUpContainer").append(_.template(t)),this.el=$(".contextMenu"),this.el.addClass("editTocMenu")):($(".popUpContainer").append(_.template(e)),this.el=$(".contextMenu")),this.el=$(".contextMenu"),$(".contextMenu").attr("tabindex","-1"),$(this.el).find("li").unbind().bind(AppEvent.CLICK,function(e){r.trigger(AppEvent.CONTEXTMENU_ITEM_SELECTED,r,r.currentWidget,e.target.id)})},setPositionX:function(e){var t=$(e).offset().left,n=$(e).width(),r=0,i=0,s=0,o=0,u=$(e).offset().right,a=$(e).css("right");$("#authoringIframe").size()>0&&$("#authoringIframe").length>0?(r=$("#authoringIframe").offset().left+parseInt($("#authoringIframe").css("padding-left")),i=$("#authoringIframe").width(),s=$("#authoringIframe").contents().find("body").scrollLeft(),o=r+t-window.scrollX-s):o=t;var f=$(".contextMenu-content",this.el).width();if(this.isTOCModInvoke&&AppConst.ALLOW_SAMPLE_BOOK_DEFINITION){var l=$(e).parent().siblings(".sample-checkbox-wrapper").offset().left;$(".contextMenu-dialog",this.el).css("left",l+1)}else $(".contextMenu-dialog",this.el).css("left",o+n)},setPositionY:function(e){var t=$(e).offset().top,n=$(e).height(),r=window.pageYOffset||document.body.scrollTop,i=Math.max($(window).height(),$("html").height());if($("#authoringIframe").size()>0&&$("#authoringIframe").length>0){var s=$("#authoringIframe").offset().top,o=$("#authoringIframe").contents().find("body").scrollTop(),u=t,a=o,f=t+s-o-r;if(u>a)$(".contextMenu-dialog",this.el).css("top",f);else{var l=$(".contextMenu-content").get(0).clientHeight;$(".contextMenu-dialog",this.el).css("top",f+n-l)}}else if(this.isTOCModInvoke){var c=parseInt($(".contextMenu-dialog .contextMenuUL li").css("border-bottom-width"),10)+parseInt($(".contextMenu-dialog .contextMenuUL li").css("padding-top"),10)+parseInt($(".contextMenu-dialog .contextMenuUL li").css("padding-bottom"),10)+parseInt($(".contextMenu-dialog .contextMenuUL li").css("line-height"),10),h=$(".contextMenu-dialog .contextMenuUL li").length,p=h*c,d=t+n+p>i+r;d?$(".contextMenu-dialog",this.el).css("top",t+n-p-r):$(".contextMenu-dialog",this.el).css("top",t-r)}else $(".contextMenu-dialog",this.el).css("top",t-r)},makeInsertChildOptDisable:function(){var e=$(this.currentWidget).parent().parent();if(!e.hasClass("jqtree_common"))return!1;var t=$("#tocContainerContent").tree("getNodeById",e.attr("id"));t.getLevel()=="2"?$("#insert-child",this.el).addClass("disable").attr("disabled",!0):$("#insert-child",this.el).removeClass("disable").attr("disabled",!1)},show:function(e){var t=e.target;$(t).hasClass("widget-placeholder")||(t=t.parentNode),this.currentWidget=t,this.setPositionX(t),this.setPositionY(t),this.makeInsertChildOptDisable(),$(this.el).modal("show"),$(".modal-backdrop").css("opacity",0)},hide:function(){$(this.el).modal("hide")}});return r}),define("com/es/models/ContextMenuModel",[],function(){var e=Backbone.Model.extend({defaults:{screen:null}});return e}),define("com/es/models/AssetModel",[],function(){var e=Backbone.Model.extend({defaults:{id:"",type:"",title:"",thumbnail:"",description:"",src:""}});return e}),define("com/es/collections/AssetCollection",["com/es/models/AssetModel"],function(e){var t=Backbone.Collection.extend({model:e,url:"app/data/assetList.json"});return t}),define("com/es/models/AssetListModel",[],function(){var e=Backbone.Model.extend({defaults:{id:"",type:"",title:"",thumbnail:"",description:"",src:""}});return e}),define("com/es/collections/AssetListCollection",["com/es/models/AssetListModel"],function(e){var t=Backbone.Collection.extend({model:e,url:"app/data/assetList.json"});return t}),define("com/es/text!templateBasePath/Editor/popups/assetPopup/assetPopupTemplate.html",[],function(){return'<div class="assetPopupCover modal fade in">\r\n	<div class="assetPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n			<div class="popUpTitle modal-title"><%=AppLang.CHOOSE_WIDGET_LABEL%> </div>\r\n			\r\n			</div>	\r\n<div class="popup-content-spacing clearfix">\r\n				<span class="input-group searchBar pull-left">\r\n					<input type="text" class="form-control searchInput" placeholder="Search Widget">\r\n  					<span class="searchIcon"></span>\r\n				</span>\r\n				<span class="sortBar pull-right"><%=AppLang.SORT_LABEL%>\r\n					<select id="sortBy" class="sortBy">\r\n					  <option value="name"><%=AppLang.NAME_LABEL%></option>	\r\n					  <option value="date"><%=AppLang.DATE_LABEL%></option>\r\n					  				  \r\n					</select>\r\n				</span>\r\n			</div>			\r\n			<div id="assetList" class="assetList popup-content-spacing pagination-pop">\r\n			\r\n			</div>\r\n			<div class="pagination-wrap">\r\n			</div>\r\n			\r\n			<div class="bottomBar modal-footer">\r\n				<div class="paging"></div>\r\n				<div>\r\n					 <button type="button" class="btn btn-default cancelbtn" data-dismiss="modal"><%=AppLang.CANCEL_LABEL%> </button>\r\n	       			 <button type="button" class="doneBtn btn btn-primary"  ><%=AppLang.DONE_LABEL%></button>\r\n					\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Editor/popups/assetPopup/assetTemplate.html",[],function(){return"<li class='assetItem hand-cursor' id ='assetItem<%=id%>'>\r\n	<span class='popUpThumbnail'>\r\n		<img src='<%=thumbnail %>'/>\r\n	</span>\r\n	<span class='radiobutton-col-3'>\r\n		<input id ='<%=id%>' class='inputBtn hand-cursor' type='radio' name='asset-selector' value='<%=src%>'></input>\r\n	</span>\r\n	<span class='details-col-2'>\r\n		<span class='title'><%=title%></span>\r\n		<span class='description'><%=description%></span>\r\n		<% if (tags.length > 0) { %>\r\n			<span class='tags'>\r\n				<i><b><%=AppLang.TAGS_WITH_COLON_LABEL%></b><%=tags.join().replace(/,/g,' ')%></i>\r\n			</span>\r\n		<%}%>\r\n		<span class='date'><%=date%></span>\r\n	</span>\r\n</li>"}),define("com/es/text!templateBasePath/Editor/popups/assetPopup/paginationTemplate.html",[],function(){return'<ul class="pagination">\n	<li><a class="pagination-first" data-pageIndex="<%=list.firstPage%>" ><%=AppLang.FIRST_LABEL%></a></li>\n	<li><a class="pagination-prev" data-pageIndex="pg-prev"><%=AppLang.PREV_LABEL%></a></li>\n	<% _.each(list.pageList, function(text) { %>\n		<li><a class="pagination-list" id="page-<%=text%>" data-pageIndex="<%=text%>"><%=text%></a></li>\n	<% }); %>\n    <li><a class="pagination-next" data-pageIndex="pg-next"><%=AppLang.NEXT_LABEL%></a></li>\n    <li><a class="pagination-last" data-pageIndex="<%=list.lastPage%>"><%=AppLang.LAST_LABEL%></a></li>\n</ul>'}),define("com/es/text!templateBasePath/Editor/popups/assetPopup/learnosityPopupTemplate.html",[],function(){return'<div class="assetPopupCover modal fade in learnosity-cover">\r\n	<div class="assetPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n			<div class="popUpTitle modal-title"><%=AppLang.CHOOSE_ACTIVITY%> </div>\r\n			\r\n			</div>	\r\n<div class="popup-content-spacing clearfix">\r\n				<span class="input-group searchBar pull-left">\r\n					<input type="text" class="form-control searchInput" placeholder="Search Activity">\r\n  					<span class="searchIcon"></span>\r\n				</span>\r\n			</div>\r\n			<div id="assetList" class="assetList popup-content-spacing pagination-pop">\r\n			\r\n			</div>\r\n			<div class="bottomBar modal-footer">\r\n				<div class="paging"></div>\r\n				<div>\r\n					 <button type="button" class="btn btn-default cancelbtn" data-dismiss="modal"><%=AppLang.CANCEL_LABEL%> </button>\r\n	       			 <button type="button" class="doneBtn btn btn-primary"  ><%=AppLang.DONE_LABEL%></button>\r\n					\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Editor/popups/assetPopup/learnosityActivityDetailsTemplate.html",[],function(){return'<section class="lrn-section">\n  <h4 class="lrn-activity-desc"><%=description%></h4>\n\n  <ul class="lrn-items-container list-group">\n\n  	 <% _.each(items, function(item) { %>\n  	 	<li class="lrn-item"><%=item%></li>\n  	<% }); %>\n  </ul>\n</section>'}),define("com/es/views/AssetPopupView",["com/es/collections/AssetCollection","com/es/collections/AssetListCollection","com/es/text!templateBasePath/Editor/popups/assetPopup/assetPopupTemplate.html","com/es/text!templateBasePath/Editor/popups/assetPopup/assetTemplate.html","com/es/text!templateBasePath/Editor/popups/assetPopup/paginationTemplate.html","com/es/text!templateBasePath/Editor/popups/assetPopup/learnosityPopupTemplate.html","com/es/text!templateBasePath/Editor/popups/assetPopup/learnosityActivityDetailsTemplate.html","com/es/utilities/services","com/es/utilities/utils"],function(e,t,n,r,i,s,o,u,a){var f=Backbone.View.extend({el:null,tagName:"div",iScroll:null,selectedItemId:null,selectedItem:null,assetListCollectionObj:null,totalRecordsForWidget:null,totalPages:null,recordsOnPage:5,displayedPages:5,pageIndex:1,term:"",widgetType:null,sortedby:1,serviceUrl:"",hasViewRender:!1,firstPage:null,lastPage:null,isLearnosityPopup:!1,lrnActivityId:null,learnosityInit:null,initialize:function(){this.el=$(".assetPopupCover"),_.bindAll(this,"createPopup","render","fetchData","handleDoneClick","handleCancelClick","handleInputClick","handleSearchClick","bindEvents","unbindEvents","createAssetsList","handleSortByClick","createPaginationList","handlePaginItemClick","fetchServiceData","navigatePaginList","assetPopupViewHidden","disableFirstAndPrevPage","lrnChooseActivity","lrnInit")},render:function(e,t,n){this.selectedItemId="assetItem"+t,e==="learnosity"&&n?(this.learnosityInit=this.lrnInit(),this.learnosityInit.render()):this.fetchData(e)},lrnInit:function(){var e={viewRef:this};return new this.lrnChooseActivity(e)},lrnChooseActivity:function(e){e.viewRef.isLearnosityPopup=!0;var t=null,n=null,r=null,i=function(){var i=function(i){if(i.data.length==0&&i.meta.records==0)return a.hideLoader(),a.showToasterMessage(WidgetLang.NO_RESULT_FOUND_WITH_EXCLAMATION_MARK_LABEL),$("#assetList",e.viewRef.el).empty().append("<span class='noResult'>"+WidgetLang.NO_RESULT_FOUND_WITH_EXCLAMATION_MARK_LABEL+"</span>"),e.viewRef.lrnActivityId=null,!1;var s={};t=i.data[0].data.items,n=i.data[0].reference,r=i.data[0].description,s.items=t,s.description=r,f(s)},s=function(e){console.log(e),a.hideLoader()},o=WIDGET_CONSTANTS.LEARNOSITY_SERVICE_BASE_URL+"learnosity/activity/details"+"?activityId="+encodeURI(e.viewRef.lrnActivityId.trim()),l={url:o,successCallback:i,errorCallback:s};a.showLoader(),u.fetchQuestionData(l)},s=function(){e.viewRef.createPopup()},f=function(t){var n=_.template(o,t);$("#assetList",e.viewRef.el).empty().addClass("lrn-container").append(n),a.hideLoader()};return{getActivity:i,render:s}},defaultPaginConfig:function(){var e=this;e.displayedPages=5,e.recordsOnPage=5,e.pageIndex=1,e.sortedby=1,e.term=""},handlePaginItemClick:function(e){var t,n,r,i,s,o;t=$(e.target),n=$(e.target.parentNode),r=$(e.target).attr("data-pageIndex"),s=$(".pagination-list",".pagination"),o=null,i=this;if(t.hasClass("pagination")||t.hasClass("pagination-wrap"))return!1;$(e.target).hasClass("pagination-list")&&n.addClass("active");if(i.pageIndex==parseInt(r,10))return!1;switch(r){case"pg-prev":i.pageIndex-=1,i.pageIndex=i.pageIndex<i.firstPage?i.firstPage:i.pageIndex,o="prev";break;case"pg-next":i.pageIndex+=1,i.pageIndex=i.pageIndex>i.lastPage?i.lastPage:i.pageIndex,o="next";break;default:if(parseInt(r,10)>i.pageIndex||t.hasClass("pagination-last"))o="next";if(parseInt(r,10)<i.pageIndex||t.hasClass("pagination-first"))o="prev";i.pageIndex=parseInt(r,10)}i.navigatePaginList(s,i.pageIndex,o),i.fetchServiceData(!1);var u=function(){var e,n;e=$(".pagination-first, .pagination-prev",".pagination").parent(),n=$(".pagination-last, .pagination-next",".pagination").parent(),i.pageIndex==i.firstPage||t.hasClass("pagination-first")?(e.addClass("disabled"),i.navigatePaginList(s,i.firstPage,"prev")):e.removeClass("disabled"),i.pageIndex==i.lastPage||t.hasClass("pagination-last")?(n.addClass("disabled"),i.navigatePaginList(s,i.lastPage,"next")):n.removeClass("disabled")}()},navigatePaginList:function(e,t,n){var e,r,i,s,o,u,a=this,f;e=e,i=parseInt(t,10),s=a.firstPage,o=a.lastPage,u=a.displayedPages,f=null;if(!(parseInt(e.first().text(),10)>s||o>parseInt(e.last().text(),10)))return $(".active",".pagination").removeClass("active"),$("#page-"+i).parent().addClass("active"),!1;switch(n){case"prev":i-s<u?f=_.range(s,u+1):f=_.range(i-(u-1),i+1);break;case"next":o-i<u?f=_.range(o+1-u,o+1):f=_.range(i,i+u);break;default:}e.each(function(e,t){$(t).text(f[e]).attr("data-pageIndex",f[e]).attr("id","page-"+f[e])}),$(".active",".pagination").removeClass("active"),$("#page-"+i).parent().addClass("active")},fetchServiceData:function(e){var n,r,i,s=this,o,a,f;f=new t,o=function(t){s.totalRecordsForWidget=0<t.models[0].get("totalRecord")?t.models[0].get("totalRecord"):0,t.models.splice(0,1),s.assetListCollectionObj=t,s.hasViewRender||s.createPopup(),e&&s.createPaginationList(),s.hasViewRender&&s.createAssetsList(s.assetListCollectionObj.models)},a=function(e){console.log(e)},i={assetListCollection:f,type:parseInt(s.widgetType,10),term:s.term,pageSize:parseInt(s.recordsOnPage,10),pageIndex:parseInt(s.pageIndex,10),url:s.serviceUrl,sortedby:parseInt(s.sortedby,10),successCallback:o,errorCallback:a},u.getAssetList(i)},createPaginationList:function(){var e=this.totalRecordsForWidget,t=this.displayedPages,n,r=this,s,o=$(".pagination-wrap",r.el),u=$(".assetList",r.el);r.totalPages=Math.ceil(e/r.recordsOnPage);if(!(e>r.displayedPages))return u.hasClass("pagination-pop")&&u.removeClass("pagination-pop"),o.empty(),!1;r.displayedPages>r.totalPages?n=_.range(1,r.totalPages+1):n=_.range(1,r.displayedPages+1),u.hasClass("pagination-pop")||u.addClass("pagination-pop"),r.firstPage=n[0],r.lastPage=r.totalPages,s={firstPage:r.firstPage,lastPage:r.lastPage,pageList:n},o.empty().append(_.template(i,{list:s})),r.disableFirstAndPrevPage()},createPopup:function(){var e=this;$(this.el).remove(),e.isLearnosityPopup?($(".popUpContainer").append(_.template(s)),this.el=$(".assetPopupCover.learnosity-cover")):($(".popUpContainer").append(_.template(n)),this.el=$(".assetPopupCover"),this.createAssetsList(this.assetListCollectionObj.models),e.hasViewRender=!0),$(".assetPopupCover").attr("tabindex","-1"),$(".assetPopupCover").modal("show"),this.unbindEvents(),this.bindEvents()},assetPopupViewHidden:function(){var e=this;e.hasViewRender=!1,e.defaultPaginConfig()},bindEvents:function(){$(".doneBtn",this.el).bind(AppEvent.CLICK,this.handleDoneClick),$(".cancelBtn",this.el).bind(AppEvent.CLICK,this.handleCancelClick),$(".searchInput",this.el).bind(AppEvent.KEYUP,this.handleSearchClick),$(".searchIcon",this.el).off(AppEvent.CLICK).on(AppEvent.CLICK,this.handleSearchClick),$(".sortBy",this.el).bind(AppEvent.CHANGE,this.handleSortByClick),$(".pagination-wrap",this.el).bind(AppEvent.CLICK,this.handlePaginItemClick),$(".assetPopupCover").bind("hidden.bs.modal",this.assetPopupViewHidden)},fetchData:function(e){var t=this,n;switch(e){case"image":n=1;break;case"video":n=2;break;case"audio":n=3;break;case"imageGal":n=4;break;case"assessment":require.s.contexts._.config.theme=="cup"?n=5:n=100;break;case"tip":n=6;break;case"file":n=7;break;case"html":n=8;break;case"eow":n=10;break;case"HDLAssess":n=121;break;case"HDLReports":n=122;break;case"saras":n=123;break;default:n=1}t.widgetType=n,t.serviceUrl=AppConst.SERVICE_BASE_URL+"book/"+AppConst.BOOK_ID+"/widget",t.fetchServiceData(!0)},handleDoneClick:function(){a.log("handleDoneClick");var t=this;if(t.isLearnosityPopup){var n,r=$(".searchInput",t.el).val().trim();return r.length==0||t.lrnActivityId===null?(a.showToasterMessage(AppLang.SEARCH_AN_ACTIVITY_FIRST),!1):(n={src:t.lrnActivityId,title:t.lrnActivityId},t.trigger(AppEvent.ASSET_SELECTED,t.lrnActivityId.replace(/[ .:]/g,"-"),n),t.isLearnosityPopup=!1,t.lrnActivityId=null,$(".assetPopupCover").modal("hide"),!0)}if($('input:radio[name="asset-selector"]:checked').length==0){a.showToasterMessage(AppLang.NO_ASSET_SELETED_MESSAGE);return}var i=_.find(t.assetListCollectionObj.models,function(e){return t.selectedItemId==e.id}),n=i.attributes;t.trigger(AppEvent.ASSET_SELECTED,t.selectedItemId,n),$(".assetPopupCover").modal("hide");return;var s,o,f,l},selectAsset:function(e){var t=$("#"+e,this.el).find(".inputBtn");t.prop("checked",!0),t.length>0&&(this.selectedItemId=t[0].id,this.selectedItem=t.val())},handleCancelClick:function(){var e=this;e.isLearnosityPopup=!1,e.trigger(AppEvent.ASSETPOPUP_CANCEL_CLICKED)},handleInputClick:function(e){this.selectAsset(e.currentTarget.id)},disableFirstAndPrevPage:function(){var e=this;e.navigatePaginList($(".pagination-list",".pagination"),e.pageIndex,"prev"),$(".pagination-first, .pagination-prev",".pagination").parent().addClass("disabled"),$(".pagination-last, .pagination-next",".pagination").parent().removeClass("disabled")},handleSearchClick:function(e){var t,n,r=this,i,s,o,u;i=$(".searchInput",this.el),s=$(e.target,this.el),t=i.val().trim(),n=t.length>0?!0:!1,u=function(){if(r.isLearnosityPopup)return n?($("#assetList",r.el).empty().removeClass("lrn-container"),r.lrnActivityId=t,r.learnosityInit.getActivity(),!1):(a.showToasterMessage(AppLang.ENTER_VALUE_SEARCH_ACTIVITY),!1)},s.hasClass("searchIcon")&&u();if(s.hasClass("searchIcon")||e.which=="13"){if(r.isLearnosityPopup)return u(),!1;r.pageIndex=1,n?r.term=t:r.term="",r.fetchServiceData(!0),(!n||t=="")&&i.val("")}else{if(r.isLearnosityPopup&&!n)return $("#assetList",r.el).empty().removeClass("lrn-container"),r.lrnActivityId=null,!1;n||(r.term="",r.fetchServiceData(!0))}},handleSortByClick:function(e){var t,n=this;t=$($(e.target).get(0).selectedOptions).val();switch(t){case"name":n.sortedby=1;break;case"date":n.sortedby=2;break;default:n.sortedby=1}n.pageIndex=1,n.fetchServiceData(!1),n.disableFirstAndPrevPage()},createAssetsList:function(e){var t=this;$(this.el).find(".assetList").html("");if(e.length>0){$(".doneBtn",this.el).removeClass("disabled");var n="<ul>";_.each(e,function(e){var t=e.attributes;t.date=a.getDateFormat(t.date),t.id!=undefined&&t.id!=""&&(n+=_.template(r,t))}),n+="</ul>",$(this.el).find(".assetList").append(n),$(".assetItem",this.el).bind(AppEvent.CLICK,this.handleInputClick),this.selectedItemId.indexOf("assetItem")<0&&(this.selectedItemId="assetItem"+this.selectedItemId),this.selectAsset(this.selectedItemId)}else $(this.el).find(".assetList").append("<span class='noResult'>"+WidgetLang.NO_RESULT_FOUND_WITH_EXCLAMATION_MARK_LABEL+"</span>"),$(".doneBtn",this.el).addClass("disabled")},unbindEvents:function(){$(".doneBtn",this.el).unbind(),$(".cancelBtn",this.el).unbind(),$(".searchInput",this.el).unbind(),$(".searchIcon",this.el).off(AppEvent.CLICK),$(".sortBy",this.el).unbind(),$(".pagination-wrap",this.el).unbind()}});return f}),define("com/es/text!templateBasePath/Editor/popups/configPopupTemplate.html",[],function(){return'<div id="configPopupCover" class="configPopupCover modal fade in">\r\n	<div class="configPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n				<div class="popUpTitle modal-title"> <%=AppLang.SETTINGS_LABEL%> </div>\r\n			</div>		\r\n			\r\n			<div id="configOptionsContainer" class="modal-body">\r\n				<div class=\'configOptions\'>\r\n					\r\n				</div>\r\n			</div>\r\n			\r\n			<div class="bottomBar modal-footer">\r\n				<div class="paging"></div>\r\n				<div>\r\n					<button type="button" class="btn btn-default cancelbtn" data-dismiss="modal"><%=AppLang.CANCEL_LABEL%> </button>\r\n	       			<button type="button" class="doneBtn btn btn-primary"  ><%=AppLang.DONE_LABEL%> </button>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Editor/configTemplates/imgConfig/imageReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/imgConfig/imageFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n       <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n      <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\" /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\" />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\" />  <%=AppLang.RIGHT_LABEL%></span>  \n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/imgGalleryConfig/imageGalleryReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/imgGalleryConfig/imageGalleryFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\" /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\" />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right'  disabled=\"true\" />  <%=AppLang.RIGHT_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/audioConfig/audioReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/audioConfig/audioFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\"/> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\"/> <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\"/> <%=AppLang.RIGHT_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/videoConfig/videoReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/videoConfig/videoFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n       <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\" /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\" />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\" />  <%=AppLang.RIGHT_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/assessmentConfig/assessmentReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n	        <option id=\"poster\" ><%=AppLang.POSTER_LABEL%></option>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode'/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/assessmentConfig/assessmentFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"poster\"><%=AppLang.POSTER_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled=\"true\"/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\"/> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\"/> <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\"/> <%=AppLang.RIGHT_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/tipConfig/tipReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/tipConfig/tipFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n       <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\" /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\" />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\" />  <%=AppLang.RIGHT_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/htmlConfig/htmlReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/htmlConfig/htmlFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n       <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\" /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\" />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\" />  <%=AppLang.RIGHT_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/fileConfig/fileReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/fileConfig/fileFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n       <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\" /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\" />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\" />  <%=AppLang.RIGHT_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/learnosityConfig/learnosityReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"poster\" ><%=AppLang.POSTER_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/learnosityConfig/learnosityFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"poster\"><%=AppLang.POSTER_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled=\"true\"/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\"/> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\"/> <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\"/> <%=AppLang.RIGHT_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/eowConfig/eowReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/eowConfig/eowFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"poster\"><%=AppLang.POSTER_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled=\"true\"/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\"/> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\"/> <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\"/> <%=AppLang.RIGHT_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/HDLAssessConfig/HDLAssessReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/HDLAssessConfig/HDLAssessFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"poster\"><%=AppLang.POSTER_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled=\"true\"/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left'  disabled=\"true\"/> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center'  disabled=\"true\"/> <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right'  disabled=\"true\"/> <%=AppLang.RIGHT_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/HDLReportsConfig/HDLReportsReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/HDLReportsConfig/HDLReportsFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"poster\"><%=AppLang.POSTER_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled=\"true\"/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left'  disabled=\"true\"/> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center'  disabled=\"true\"/> <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right'  disabled=\"true\"/> <%=AppLang.RIGHT_LABEL%></span>\n    </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/tpConfig/thirdPartyReflowConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode' disabled>\n            <option id=\"inline\" ><%=AppLang.INLINE_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' disabled/>\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n     <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' />  <%=AppLang.RIGHT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='fitToWidth' />  <%=AppLang.FIT_TO_WIDTH_LABEL%></span>\n      </div>\n</div>"}),define("com/es/text!templateBasePath/Editor/configTemplates/tpConfig/thirdPartyFixedConfigTemplate.html",[],function(){return"<div id=\"configmode\">\n    <label><%=AppLang.MODE_LABEL%></label>\n    <span>\n        <select id='selectMode'>\n            <option id=\"inline\"><%=AppLang.INLINE_LABEL%></option>\n            <option id=\"compact\"><%=AppLang.COMPACT_LABEL%></option>\n        </select>\n    </span>\n</div>\n<div id=\"configborder\">\n    <label><%=AppLang.BORDER_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setBorder' />\n    </span>\n</div>\n<div id=\"configpopout\">\n    <label><%=AppLang.POPOUT_LABEL%></label>\n    <span>\n        <input type='checkbox' id='setPopoutMode' disabled/>\n    </span>\n</div>\n<div class=\"seprator\"></div>\n<div id=\"configalign\">\n    <div class=\"align-label\">\n        <label><%=AppLang.ALIGN_LABEL%></label>\n    </div>					\n    <div class=\"align-selection\">\n       <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='left' disabled=\"true\" /> <%=AppLang.LEFT_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='center' disabled=\"true\" />  <%=AppLang.CENTER_LABEL%></span>\n        <span class=\"align-block\"><input type='radio' name='setAlignment' class='setAlignment' value='right' disabled=\"true\" />  <%=AppLang.RIGHT_LABEL%></span>\n      </div>\n</div>"}),define("com/es/views/ConfigPopupView",["com/es/text!templateBasePath/Editor/popups/configPopupTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/imgConfig/imageReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/imgConfig/imageFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/imgGalleryConfig/imageGalleryReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/imgGalleryConfig/imageGalleryFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/audioConfig/audioReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/audioConfig/audioFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/videoConfig/videoReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/videoConfig/videoFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/assessmentConfig/assessmentReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/assessmentConfig/assessmentFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/tipConfig/tipReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/tipConfig/tipFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/htmlConfig/htmlReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/htmlConfig/htmlFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/fileConfig/fileReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/fileConfig/fileFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/learnosityConfig/learnosityReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/learnosityConfig/learnosityFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/eowConfig/eowReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/eowConfig/eowFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/HDLAssessConfig/HDLAssessReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/HDLAssessConfig/HDLAssessFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/HDLReportsConfig/HDLReportsReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/HDLReportsConfig/HDLReportsFixedConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/tpConfig/thirdPartyReflowConfigTemplate.html","com/es/text!templateBasePath/Editor/configTemplates/tpConfig/thirdPartyFixedConfigTemplate.html"],function(configPopupViewTemplate,image_reflowable,image_fixed,imageGal_reflowable,imageGal_fixed,audio_reflowable,audio_fixed,video_reflowable,video_fixed,assessment_reflowable,assessment_fixed,tip_reflowable,tip_fixed,html_reflowable,html_fixed,file_reflowable,file_fixed,learnosity_reflowable,learnosity_fixed,eow_reflowable,eow_fixed,HDLAssess_reflowable,HDLAssess_fixed,HDLReports_reflowable,HDLReports_fixed,saras_reflowable,saras_fixed){var ConfigPopupView=Backbone.View.extend({el:null,_dataObj:null,initialize:function(){this.el=$("#configPopupCover"),_.bindAll(this,"handleDoneClick","handleCancelClick","updateSettings","bindEvents","getSettings","renderSettings","bindConfigSettings","setConfigSettings"),this.render()},render:function(e){$(this.el).remove(),$(".popUpContainer").append(_.template(configPopupViewTemplate)),this.el=$("#configPopupCover"),$("#configPopupCover").attr("tabindex","-1"),this.bindEvents()},show:function(e){this.renderSettings(e),require.s.contexts._.config.theme=="ngl"&&e.type=="assessment"&&($(".configPopup .modal-content").addClass("ngl-assessment-config"),e.checkanswer=e.checkanswer==undefined?!0:e.checkanswer,$("#setCheckAnswer",this.el).prop("checked",e.checkanswer)),_dataObj=e,this.updateSettings(e),$("#configPopupCover").modal("show")},bindEvents:function(){$(".doneBtn",this.el).unbind().bind(AppEvent.CLICK,this.handleDoneClick),$(".cancelBtn",this.el).unbind().bind(AppEvent.CLICK,this.handleCancelClick)},bindConfigSettings:function(){$("#selectMode",this.el).unbind().bind(AppEvent.CHANGE,this.setConfigSettings)},setConfigSettings:function(e){var t=e.target?e.target.selectedOptions[0].id:e;$("#selectMode",this.el).attr("data-mode",t);switch(t){case"inline":case"poster":$("#setBorder",this.el).prop({checked:!1,disabled:!0}),$("#setPopoutMode",this.el).prop({checked:!0,disabled:!0});break;case"compact":$("#setBorder",this.el).prop({checked:!0,disabled:!1}),$("#setPopoutMode",this.el).prop({checked:!1,disabled:!0});break;default:}},renderSettings:function(dataObj){var tempObj=dataObj.type+"_"+AppConst.BOOK_TYPE;tempObj=eval(tempObj),$(".configOptions",this.el).html(_.template(tempObj)),this.setConfigSettings(dataObj.mode),this.bindConfigSettings(),require.s.contexts._.config.fitToWidth||$("input[value='fitToWidth']").parent().hide()},updateSettings:function(e){$("#selectMode",this.el).attr("data-mode",e.mode),$("#selectMode",this.el).val($("#"+e.mode).text()),$("#setBorder",this.el).prop("checked",e.border),$("#setPopoutMode",this.el).prop("checked",e.popout),$('.setAlignment[value="'+e.align+'"]',this.el).prop("checked",!0)},getSettings:function(){return{mode:$("#selectMode",this.el).attr("data-mode"),border:$("#setBorder",this.el).prop("checked"),popout:$("#setPopoutMode",this.el).prop("checked"),align:$(".setAlignment:checked",this.el).val()}},handleDoneClick:function(){var e=this.getSettings();require.s.contexts._.config.theme=="ngl"&&_dataObj.type=="assessment"&&(e.checkanswer=$("#setCheckAnswer",this.el).prop("checked")),$("#configPopupCover").modal("hide"),this.trigger(AppEvent.CONFIG_UPDATED,e)},handleCancelClick:function(){$("#configPopupCover").modal("hide")}});return ConfigPopupView}),define("com/es/views/WidgetsEditor",["com/es/widgets/WidgetEvents","com/es/utilities/utils","com/es/widgets/WidgetsController","com/es/text!templateBasePath/Editor/author/contextMenuTemplate.html","com/es/views/ContextMenuView","com/es/models/ContextMenuModel","com/es/views/AssetPopupView","com/es/models/AssetPopupModel","com/es/views/ConfigPopupView"],function(e,t,n,r,i,s,o,u,a){var f=function(e){var r,f,l,c,h,p=0,d=0,v=0,m="",g=new Array,y="",b="1",w=null,E=null,S=null,c=null,x=null,T=!1,N=!1,C=null,k=AppConst.CONTENT_BASE_URL+"/",L={eow:{userName:AppConst.USER_NAME,userRole:AppConst.USER_ROLE,bookId:AppConst.BOOK_ID,bookName:AppConst.BOOK_TITLE,lampServer:t.checkProtocol(AppConst.EOW_LDL_SERVER),lampService:t.checkProtocol(AppConst.EOW_LDL_SERVICE_URL),serviceBaseUrl:AppConst.SERVICE_BASE_URL,readerHtmlPath:AppConst.EOW_RDR_HTML_PATH}};C=new n(e,k,AppConst.WIDGET_HTTP_BASE_PATH,"","",AppConst.USER_ID,AppConst.BOOK_ISBN_NO,AppConst.SERVICE_BASE_URL,"learnosity-access-token","learnosity-reader-path",L,AppConst.HOME_PAGE_URL),C.setApplicationType("Editor");var A=function(){C.on(WIDGET_EVENTS.INITIALIZED,function(e){t.log("wc1 initialized -- ",e)}),C.on(WIDGET_EVENTS.ALL_WIDGETS_INITIALIZED,function(){t.log("wc1 all widgets initialized")}),C.on(WIDGET_EVENTS.ALL_RENDER_COMPLETE,function(){t.log("wc1 all widgets rendered"),r.trigger(WIDGET_EVENTS.ALL_RENDER_COMPLETE,T)}),C.on(WIDGET_EVENTS.RENDER_COMPLETE,function(e,n,r,i){t.log("wc1 single widget rendered"+n),D(e),Z(e,n,r,i)}),C.on(WIDGET_EVENTS.LAUNCHED,function(e){t.log("widget launched",e),t.showLoader()}),C.on(WIDGET_EVENTS.CLOSED,function(e){t.log("widget closed",e)}),C.on(WIDGET_EVENTS.DESTROYED,function(e){t.log("widget destroyed",e)}),C.on(WIDGET_EVENTS.PLAY_CLICKED,function(e){t.log("widget play clicked",e)}),C.on(WIDGET_EVENTS.POPULATED,function(e){t.log("widget populated",e),t.hideLoader()}),C.on(WIDGET_EVENTS.FETCH_PREVIUOUS_ATTEMPTS,function(e){var t={testId:"",testTitle:"",result:[]};e.callbkFn(t)}),C.on(WIDGET_EVENTS.SEND_RESPONSE_DATA,function(e){}),C.on(WIDGET_EVENTS.SAVE_USER_RESPONSE_DATA,function(e,t){typeof Storage!="undefined"?localStorage.setItem(e,JSON.stringify(t)):console.log("Sorry! No Web Storage support..")}),C.on(WIDGET_EVENTS.FETCH_USER_RESPONSE_DATA,function(e,t){typeof Storage!="undefined"?t(JSON.parse(localStorage.getItem(e))):console.log("Sorry! No Web Storage support..")}),C.on(WIDGET_EVENTS.LAUNCH_HTML_CLICKED,O),C.on(WIDGET_EVENTS.LAUNCH_FILE_CLICKED,O),C.on(WIDGET_EVENTS.SHOW_ALERT_MSG,function(e){t.showAlert(e)}),C.on(WIDGET_EVENTS.INVOKE_SERVICE,function(e){$.ajax(e.params).done(function(t,n,r){console.log("success: ",t),e.successCallback(t)}).fail(function(t,n,r){console.log("some error occured: ",n),e.errorCallback(n)})}),M(),C.initializeWidgets(),B(l),F(l),q(l),window.onresize=function(){C.onWindowResize()}},O=function(e){window.open(e)},M=function(){var e=$(".widget-placeholder",$("#authoringIframe").contents());e.find(".dummyWidget").remove().find(".move-icon").remove(),e.each(function(e,t){var n=$(t).attr("data-type");switch(n){case"image":$(t).append('<div class="dummyWidget imageIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"imageGal":$(t).append('<div class="dummyWidget imageGalIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"audio":$(t).append('<div class="dummyWidget audioIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"video":$(t).append('<div class="dummyWidget videoIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"assessment":$(t).append('<div class="dummyWidget assessmentIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"tip":$(t).append('<div class="dummyWidget tipIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"html":$(t).append('<div class="dummyWidget htmlIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"file":$(t).append('<div class="dummyWidget fileIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"learnosity":$(t).append('<div class="dummyWidget learnosityIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"eow":$(t).append('<div class="dummyWidget assessmentIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"HDLAssess":$(t).append('<div class="dummyWidget HDLAssessIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"HDLReports":$(t).append('<div class="dummyWidget HDLReportsIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;case"saras":$(t).append('<div class="dummyWidget sarasIconDummyWidget invisible" draggable="false"></div><span class="move-icon invisible"></span>');break;default:return}})},D=function(e){$("#"+e.identifier,l).find(".dummyWidget").addClass("invisible")},P=function(e){x===null&&(K(),G()),y=e;var n=$("[class^='widget-']",l);t.log("widgets",n.length);var r=$(".widget-placeholder",l),i=$(".widget-ui",l);t.log("widgets",r.length);if(e==="true"){r.unbind(AppEvent.CLICK).bind(AppEvent.CLICK,H),i.removeClass("disabledWidgets").addClass("disabledWidgets"),r.removeClass("disabledWidgets"),$(".ui-clickable-icon",l).removeClass("hand-cursor"),$(r).show(),$(".move-icon",r).removeClass("invisible");var s=$(".widget-placeholder[data ='']",l);$(".dummyWidget",s).removeClass("invisible"),C.closeAllWidgets(!0),Y("true"),x.engage(),r.removeClass("disablePlaceholder"),$(".header .button-label:contains('Edit')").addClass("activeMode"),$(".header .button-label:contains('Preview')").removeClass("activeMode")}else{r.unbind(AppEvent.CLICK),Y("false"),x.disengage(),i.removeClass("disabledWidgets"),r.addClass("disablePlaceholder"),$(".ui-clickable-icon",l).addClass("hand-cursor"),$(".move-icon",r).removeClass("invisible").addClass("invisible");var s=$(".widget-placeholder[data !='']",l);$(".dummyWidget",s).removeClass("invisible").addClass("invisible"),$(".header .button-label:contains('Preview')").addClass("activeMode"),$(".header .button-label:contains('Edit')").removeClass("activeMode"),_.each(r,function(e){$(e).data("mode")==WIDGET_CONSTANTS.DATA_MODE_COMPACT&&$(e).data("border")==1&&$(e).removeClass("disabledWidgets").addClass("disabledWidgets")})}},H=function(e){N=!1,$(".settings").removeClass("disable").addClass("disable"),t.log("show context menu"),c=e.target,$(c).hasClass("widget-placeholder")||(c=c.parentNode),$(c).attr("data")!==""?(N=!0,$(".settings").removeClass("disable")):(N=!1,$(".settings").removeClass("disable").addClass("disable")),w.show(e)},B=function(e){var t=new s({screen:e});w=new i({model:t}),w.bind(AppEvent.CONTEXTMENU_ITEM_SELECTED,j)},j=function(e,n,r){t.log(n);switch(r){case"edit":var i=$(n).attr("data-type"),s=$(n).attr("id");I(i,s,n);break;case"settings":N&&R();break;case"remove":Q(n)}},F=function(e){var t=new u({});E=new o({model:t}),E.bind(AppEvent.ASSET_SELECTED,z)},I=function(e,t,n){w.hide(),e==="learnosity"?E.render(e,t,n):E.render(e,t,null)},q=function(e){S=new a,S.bind(AppEvent.CONFIG_UPDATED,U)},R=function(){w.hide(),S.show($(c).data())},U=function(e){var n,i;n=_.clone($(c).data()),_.each(e,function(e,t){e!=undefined&&($(c).data(t,e),$(c).attr("data-"+t,e))}),i=_.clone($(c).data()),_.isEqual(n,i)||(r.trigger(WIDGET_EVENTS.EDITED),t.showLoader(),W(),C.initWidget($(c).get(0)),G(),et($($(c).get(0)),i.align))},z=function(e,n){var i=n.src.replace(/\\/g,"/"),s=n.title;G(e);if($("#"+e,l).length){t.showToasterMessage(AppLang.SELECTED_ASSET_REPEATED_MESSAGE);return}$(c).get(0).id!=e&&(r.trigger(WIDGET_EVENTS.EDITED),t.showLoader(),$(c).attr("data")!==""&&W(),b=e,X(e,i,s),C.initWidget($(c).get(0)))},W=function(){$("#ui-"+$(c).get(0).id,l).find("*").andSelf().unbind().off(),$("#ui-"+$(c).get(0).id,l).remove(),$("#div-border-ui-"+$(c).get(0).id,l).remove(),C.updateWidgetList($(c).get(0).id)},X=function(e,t,n){var r=V($(c).data("type"));$(c).get(0).id=e,$(c).get(0).className+=r,$(c).attr("data-title",n),AppConst.BOOK_TYPE=="fixed"?($(c).attr({data:t,"data-layout":"fixed"}),$(c).css({width:$(c).css("width"),height:$(c).css("height"),top:$(c).css("top"),left:$(c).css("left"),position:"absolute"})):($(c).attr({data:t,"data-layout":"reflow"}),$(c).get(0).style.width=$(c).width()/l.width()*100+"%"),$(c).attr({"data-fileSize":0,"data-downloadable":!1,"data-launchFile":"","data-downloadUrl":""}),$("div[id='"+$(c).get(0).id+"']",l).bind(AppEvent.CLICK,H)},V=function(e){var t="";switch(e){case"image":t=" widget-img widget-loader";break;case"imageGal":t=" widget-img-gal widget-loader";break;case"audio":t=" widget-audio widget-loader";break;case"video":t=" widget-video widget-loader";break;case"tip":t=" widget-tip widget-loader";break;case"assessment":t=" widget-assessment widget-loader";break;case"html":t=" widget-html widget-loader";break;case"file":t=" widget-file widget-loader";break;case"learnosity":t=" widget-learnosity widget-loader";break;case"eow":t=" widget-eow widget-loader";break;case"HDLAssess":t=" widget-HDLAssess widget-loader";break;case"HDLReports":t=" widget-HDLReports widget-loader";break;case"saras":t=" widget-tpwidget widget-saras widget-loader";break;default:}return t},J=function(e){T=!0,t.log("add widget",e);var n=$(e).attr("id"),r=$("#"+n,l);r.bind(AppEvent.CLICK,H),G(n),C.relayout(),x!==null&&x.disengage(),x=null,K(),x.engage()},K=function(){var e=document.getElementById("authoringIframe"),t=e.contentWindow,n=t.document,r=n.body,i={};i.widgetAdded=J,x=new DRAGON_DROP({draggables:$(".widget-placeholder",n),dropzones:$("body",n),noDrags:$(".widgetFrame .dummyWidget"),dragWindow:t,dropWindow:t,triggeredFrom:i,inIframe:!0})},Q=function(e){w.hide();var n=this;t.showConfirmPopUp(AppLang.DELETE_WIDGET_CONFIMATION_MESSAGE,AppLang.DELETE_WIDGET_CONFIMATION_TITLE,["cancel"],function(n){if(n.toLowerCase()==="yes"){t.log("delete widget",e);var i=e.id;if(AppConst.BOOK_TYPE=="reflowable"){var s=$(e).prev().get(0),o=$(e).next().get(0);s!=undefined&&o!=undefined&&!s.classList.contains("widget-placeholder")&&!o.classList.contains("widget-placeholder")&&s.className==o.className&&(s.innerHTML+=o.innerHTML,o.remove())}var u=l.find("div[id='"+i+"']"),a=l.find("div[id='ui-"+i+"']"),f=l.find("div[id='div-border-ui-"+i+"']");u.unbind(),u.remove(),a.unbind(),a.remove(),f.unbind(),f.remove(),C.updateWidgetList(i),r.trigger(WIDGET_EVENTS.EDITED),C.relayout()}})},G=function(e){var t=$("#authoringIframe").contents().get(0),n=$(".widget-placeholder",t);n.resizable(),_.each(n,function(e){var t=$(e);t.hasClass("ui-resizable")&&t.resizable("destroy")});var i=$(".widget-placeholder[data-mode ='compact'][data-border ='false']",t),s=[];$.grep(n,function(e){$.inArray(e,i)==-1&&s.push(e)}),$(s).resizable(),_.each(s,function(e){var n,i=$(e);AppConst.BOOK_TYPE=="reflowable"&&i.attr("contenteditable","false"),i.hasClass("ui-resizable")&&i.resizable("destroy"),i.data("mode")==WIDGET_CONSTANTS.DATA_MODE_COMPACT&&i.data("border")==1||i.data("type")=="assessment"||i.data("type")=="saras"?i.data("mode")!=WIDGET_CONSTANTS.DATA_MODE_POSTER||i.data("type")!="assessment"&&i.data("type")!="saras"?n=!1:n=i.width()/i.height():n=i.width()/i.height();var s=["assessment","tip","file","html","learnosity","HDLAssess","saras"],o=["image","imageGal","video"];_.contains(s,i.data("type"))&&i.data("mode")==WIDGET_CONSTANTS.DATA_MODE_INLINE?i.resizable({handles:"e",maxWidth:$(t).find("body").width(),minWidth:WIDGET_CONSTANTS.MIN_WIDTH,resize:function(e,t){r.trigger(WIDGET_EVENTS.EDITED),C.relayout()}}):i.data("align")=="fitToWidth"&&(_.contains(o,i.data("type"))&&i.data("mode")==WIDGET_CONSTANTS.DATA_MODE_INLINE||i.data("mode")==WIDGET_CONSTANTS.DATA_MODE_POSTER&&i.data("type")=="assessment")?i.resizable({handles:"s",resize:function(e,t){r.trigger(WIDGET_EVENTS.EDITED),C.relayout()}}):i.resizable({aspectRatio:n,maxWidth:$(t).find("body").width(),minWidth:WIDGET_CONSTANTS.MIN_WIDTH,resize:function(e,t){r.trigger(WIDGET_EVENTS.EDITED),C.relayout()}})});var o=$(".widget-placeholder[data =  '']",t);o.resizable("disable")},Y=function(e){var t=$(".widget-placeholder",l),n=$(".widget-placeholder[data-mode ='compact'][data-border ='false']",l),r=[];$.grep(t,function(e){$.inArray(e,n)==-1&&r.push(e)}),r=$(r);var i=r.resizable("option","disabled");e==="true"?r.resizable("enable"):r.resizable("disable");var s=$(".widget-placeholder[data =  '']",l);s.resizable("disable")},Z=function(e,t,n,r){var i=$(c);i.data("mode")!=WIDGET_CONSTANTS.DATA_MODE_COMPACT&&i.resizable({aspectRatio:$(c).width()/$(c).height(),maxWidth:t,minWidth:n});if(i.data("type")=="assessment"||i.data("type")=="learnosity"||i.data("type")=="tip")i.data("mode")==WIDGET_CONSTANTS.DATA_MODE_POSTER?i.resizable({aspectRatio:$(c).width()/$(c).height(),maxWidth:t,minWidth:n}):i.data("mode")==WIDGET_CONSTANTS.DATA_MODE_INLINE&&i.resizable({aspectRatio:$(c).width()/$(c).height(),maxWidth:t,minWidth:n,minHeight:r})},et=function(e,t){e.removeClass("widget-left widget-center widget-right widget-fitToWidth"),t=="fitToWidth"&&(e.removeClass("ui-resizable"),e.attr("data-width",e.css("width"))),e.addClass("widget-"+t)},tt=Backbone.View.extend({initialize:function(e,n){r===undefined?(t.log("initialize -- ",r,n),_.extend(this,Backbone.Events),r=this,l=$(n).contents(),m=l[0].URL,t.log("initialize -- ",r)):t.log("instance already created")},initializeWidgets:A,relayout:C.relayout,closeWidget:C.closeWidget,closeAllWidgets:C.closeAllWidgets,launchExternalWidget:C.launchExternalWidget,initWidget:C.initWidget,windowResize:C.windowResize,addWidget:J,deleteWidget:Q,setEditable:P});return new tt({},e)};return f}),define("com/es/text!templateBasePath/Editor/author/widgetFrameTemplate.html",[],function(){return'<div id="" class="widgetFrame widget-placeholder" style="" data="">\n	<div class = "dummyWidget"></div>\n	<span class= "move-icon"></span>\n</div>'}),define("com/es/views/WidgetFrameView",["com/es/text!templateBasePath/Editor/author/widgetFrameTemplate.html","com/es/text!templateBasePath/Editor/author/contextMenuTemplate.html","com/es/views/ContextMenuView","com/es/models/ContextMenuModel"],function(e,t,n,r){var i=Backbone.View.extend({el:"",contextMenuObj:null,events:{"click .widget-placeholder":"showContextMenu"},initialize:function(e){_.extend(this,Backbone.Events),_.bindAll(this,"showContextMenu"),this.options=e||{}},render:function(e){this.insertWidgetFrame(e)},insertWidgetFrame:function(t){var n=t.iframeEditor,r=$(t.dropLoad),i=r.children()[0].id,s=$(e);s.find(".dummyWidget").addClass(i+"DummyWidget"),window.innerDiv=s;var o=s.get(0);rangy.init();var u=rangy.getIframeSelection(n).getRangeAt(0);u.insertNode(o),this.trigger(AppEvent.WIDGET_ADDED,o),$(t.iframeEditor).contents().find(".widget-placeholder").bind(AppEvent.CLICK,this.showContextMenu),this.createContextMenu($(t.iframeEditor).contents())},showContextMenu:function(e){this.contextMenuObj.show(e)},createContextMenu:function(e){var t=new r({screen:e}),i=new n({model:t});this.contextMenuObj=i}});return i}),define("com/es/utilities/fontObfuscationManager",["com/es/utilities/utils"],function(e){var t=Backbone.Model.extend({initialize:function(e){this.keyId=e.keyId,this.baseURL=e.baseURL,this.callback=e.callback,this.setCipherKey(),this.loadEncryptionXML(this.baseURL+"/META-INF/encryption.xml")},setCipherKey:function(){var t=this.keyId,n=e.encode_utf8(t.trim()),r=window.Crypto.SHA1(n,{asBytes:!0});this.chipherKey=r},loadEncryptionXML:function(t){this.encryptedFonts=[];var n=this,r=t;$.ajax({type:"GET",url:r,dataType:"xml",success:function(e){var t=$(e).find("CipherReference");t.each(function(e,t){n.encryptedFonts.push({uri:$(t).attr("URI")})})},error:function(t){e.log(t)}})},fixFonts:function(t,n){if(t.indexOf("OTTO")==0||t.indexOf("wOFF")==0)return t;var r=t.slice(0,1040),i=e.string2Bin(r),s=this.chipherKey.length;for(var o=0;o<1040;o++)i[o]=i[o]^this.chipherKey[o%s];var u=e.bin2String(i);return u+t.slice(1040)},updateFontOnPage:function(t,n){var r=this.getFontObjByURI(n.uri);if(!r.hasOwnProperty("decryptedString")){var i="",s,o,u=new XMLHttpRequest;u.open("GET",this.baseURL+"/"+n.uri,!0),u.responseType="arraybuffer";var a=this;u.onload=function(i){var s=u.response,f=e.arrayBufferToBinaryString(s);o=a.fixFonts(f),r.decryptedString=o,a.applyFont(n.name,o,t)},u.send(null)}else this.applyFont(n.name,r.decryptedString,t)},applyFont:function(e,t,n){var r,i=n.styleSheets.length,s=n.styleSheets[i-1];s.cssRules.length==0?r=1:r=s.cssRules.length,s.insertRule("@font-face{font-family: "+e+"; src: url(data:font/otf;base64,"+window.btoa(t)+") format('opentype')}",r-1)},getFontObjByURI:function(e){for(var t=0;t<this.encryptedFonts.length;t++)if(this.encryptedFonts[t].uri==e)return this.encryptedFonts[t];return""},getFontFaimlyAndURI:function(e){var t=[],n=e.styleSheets;for(var r in n){var i=n[r].cssRules;for(var s in i){var o=i[s].cssText;if(o&&o.indexOf("@font-face")!=-1){var u=this.checkForEncryptedFonts(o);if(u!=""){var a=/font-family\:([^;]*)/i,f=a.exec(o)[1].trim();t.push({name:f,uri:u})}}}}return t},checkForEncryptedFonts:function(e){for(var t=0;t<this.encryptedFonts.length;t++)if(e.indexOf(this.encryptedFonts[t].uri)!=-1)return this.encryptedFonts[t].uri;return""}});return t}),define("com/es/views/ContentAuthoringView",["com/es/text!templateBasePath/Editor/author/ContentAuthoringTemplate.html","com/es/views/WidgetsEditor","com/es/views/WidgetFrameView","com/es/utilities/utils","com/es/utilities/services","com/es/text!templateBasePath/Editor/author/widgetFrameTemplate.html","com/es/utilities/fontObfuscationManager"],function(e,t,n,i,o,u,a){var f=Backbone.View.extend({el:$("#contentIframeContainer"),wc:null,iframe:null,dirty:!1,widgetEditor:null,fontManager:null,initialize:function(e,t){_.bindAll(this,"onFrameContentLoaded","onWidgetAdded","onWidgetDrag","onWidgetDrop","setDefaultConfig","saveContent","setHeight","onSaveSuccess","saveKeyPadEvent"),_.extend(this,Backbone.Events),this.render()},render:function(){i.showLoader(),i.log(this.model);var t=this;this.el=$("#contentIframeContainer");var n=_.template(e);this.el.append(n),this.setHeight(),iframe=$("#authoringIframe",this.el),iframe.get(0).onload=this.onFrameContentLoaded,this.initializeWidgetFrameView(),$(window).resize(function(){t.setHeight()})},setPage:function(e){e=e.replace("&#47;","/");var t,n=(new Date).getTime();this.setDirty(!1),AppConst.PAGE_NAME=e;if(e.indexOf("#")>=0){var r=e.split("#");t=r[0]+"?"+n+"#"+r[r.length-1]}else t=e+"?"+n;GlossaryController.disableTermsOnPage("#authoringIframe"),this.widgetEditor&&this.widgetEditor.closeAllWidgets(),iframe.attr("src",AppConst.CONTENT_BASE_URL+"/"+t)},setHeight:function(){var e=$("#widgetsContainer").height();e+=parseFloat($("#widgetsContainer").css("margin-top")),e+=parseFloat($("#widgetsContainer").css("margin-bottom"));var t=$("body").height()-(e+6);this.el.height(t)},initWidgetEditor:function(){var e=this;this.widgetEditor!==null&&(this.widgetEditor=null),this.widgetEditor=new t("#authoringIframe"),this.widgetEditor.on(WIDGET_EVENTS.ALL_RENDER_COMPLETE,function(t){i.log("wc1 all widgets renderred"),t!=="true"&&e.setEditable(e.model.get("editable")),i.hideLoader()}),this.widgetEditor.on(WIDGET_EVENTS.EDITED,function(){i.log("widget edited"),e.setDirty(!0)}),this.widgetEditor.initializeWidgets()},onFrameContentLoaded:function(){var e=["widgets_iFrameWidget.css","widget_color.css","widget_global.css"],t=document.getElementById("authoringIframe"),n=t.contentWindow.document.documentElement;i.removeCssFile(e,n),AppConst.FONT_MANAGER.encryptedFonts&&this.updateObfuscatedFonts(t),this.setDirty(!1),i.log("frame content loaded"),this.loadWidgetCss(),this.initWidgetEditor(),$(document.getElementById("authoringIframe").contentWindow.document).bind(AppEvent.KEYDOWN,this.saveKeyPadEvent),GlossaryController.enableTermsOnPage("#authoringIframe")},updateObfuscatedFonts:function(e){if(AppConst.FONT_MANAGER.encryptedFonts.length>0){var t=e.contentDocument,n=AppConst.FONT_MANAGER.getFontFaimlyAndURI(e.contentDocument);for(var r=0;r<n.length;r++)AppConst.FONT_MANAGER.updateFontOnPage(t,n[r])}},saveKeyPadEvent:function(e){if(e.ctrlKey&&e.which==83||e.metaKey&&e.which==83)return $(".modal").is(":visible")||(e.preventDefault(),this.trigger(AppEvent.SAVE_CONTENT,function(){})),!1},initializeWidgetFrameView:function(){},initializeWidgetDragOnDrop:function(){i.log("load");var e=document.getElementById("authoringIframe"),t=e.contentWindow,n=t.document,r=n.body;window.DragonDrop=new DRAGON_DROP({draggables:$(".widgetIcon"),dropzones:$("body",n),noDrags:$(".widgetIcon .imageIcon"),dragWindow:window,dropWindow:t,triggeredFrom:this,inIframe:!1}),window.DragonDrop.engage()},insertWidgetFrame:function(e){var t=$(e),n=t.children()[0].id,r=$(u);r.attr("id",(new Date).getTime()),r.attr("data-type",n.split("Icon")[0]),r.addClass("widget-center"),this.setDefaultConfig(n.split("Icon")[0],r),r.find(".dummyWidget").addClass(n+"DummyWidget"),window.innerDiv=r;var i=r.get(0).outerHTML;return i},setDefaultConfig:function(e,t){switch(e){case"image":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center");break;case"imageGal":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center");break;case"audio":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center");break;case"video":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center");break;case"learnosity":case"eow":case"HDLAssess":case"HDLReports":case"assessment":t.attr("data-mode","poster"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center"),require.s.contexts._.config.theme=="ngl"&&t.attr("data-checkanswer",!0);break;case"saras":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!1),t.attr("data-align","center");break;case"tip":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center");break;case"html":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center");break;case"file":t.attr("data-mode","inline"),t.attr("data-border",!1),t.attr("data-popout",!0),t.attr("data-align","center");break;default:}},widgetAdded:function(e){this.widgetEditor.addWidget(e),this.widgetEditor.relayout(),this.setDirty(!0),delete window.DragonDrop,this.initializeWidgetDragOnDrop()},onWidgetAdded:function(e){i.log("widget added",e),this.setDirty(!0),this.widgetEditor.addWidget(e)},onWidgetDrag:function(e){var t=$("#authoringIframe").contents().get(0);s=t.getSelection(),r=t.caretRangeFromPoint(e.originalEvent.clientX,e.originalEvent.clientY),r.setStart(r.startOffset,r.endOffset),r.collapse(!0),s.removeAllRanges(),s.addRange(r),e.preventDefault()},onWidgetDrop:function(e){i.log(e.originalEvent.dataTransfer)},loadWidgetCss:function(){var e=$("#authoringIframe");i.checkAddJsCssFile(e,AppConst.HOME_PAGE_URL+"com/external/jquery-ui","jquery-ui","css"),i.checkAddJsCssFile(e,AppConst.HOME_PAGE_URL+"com/external/videojs","video-js","css"),i.checkAddJsCssFile(e,AppConst.HOME_PAGE_URL+"css","widget_global","css"),i.checkAddJsCssFile(e,AppConst.HOME_PAGE_URL+"css","widget_color","css"),i.checkAddJsCssFile(e,AppConst.HOME_PAGE_URL+"css","widgets_iFrameWidget","css"),i.checkAddJsCssFile(e,AppConst.HOME_PAGE_URL+"css","widgets_iFrameWidgetEditor","css"),i.checkAddJsCssFile(e,AppConst.HOME_PAGE_URL+"themes/"+require.s.contexts._.config.theme+"/css","widgets_iframeTheme","css")},setEditable:function(e){this.model.set("editable",e),this.widgetEditor.setEditable(e),e==="true"?this.initializeWidgetDragOnDrop():window.DragonDrop.disengage()},setDirty:function(e){this.dirty=e,this.trigger(AppEvent.DIRTY_STATE_CHANGED,e)},getDirty:function(){return this.dirty},showSavePopUp:function(e){var t=this;i.showConfirmPopUp(AppLang.SAVE_CONFIMATION_MESSAGE,AppLang.SAVE_CONFIMATION_TITLE,"",function(n){if(n.toLowerCase()==="yes")t.saveContent(e,n);else{if(n.toLowerCase()!=="no")return;i.hideLoader(),e(n)}})},saveContent:function(e,t){i.log("saveContent called"),i.showLoader();var n=this.composeEnrichmentJSON(),r=i.getIframePageHtml(),s=this.onSaveSuccess,u=this.onSaveError,a={data:r,enrichment:JSON.stringify(n.enrichMentObject),quiz:JSON.stringify(n.quizObject),successCallback:s,errorCallback:u,callback:e,status:t};o.saveAndPublish(a)},composeEnrichmentJSON:function(){var e=[],t=[],n=$("#authoringIframe").contents(),r=document.getElementById("authoringIframe").contentWindow.location.href,i=r.split("/"),s=i.pop(),o,r=this.model.attributes.pageUrl;r=r.split("#")[0];var u=this.model.attributes.topicId,a=this.model.attributes.spineId,f=a.split(".")[0],l=this.model.attributes.chapterId;$(".widget-placeholder",n).each(function(i,s){if($(s).attr("data")!==""&&$(s).attr("data")!==undefined&&$(s).attr("data")!==null){var c,h,p,d,v,m,g,y,b,w,E,S,x;c=s.id,h=$(s).attr("data-title"),y=$(s).attr("data-testid"),b=$(s).attr("data-fileSize")?$.parseJSON($(s).attr("data-fileSize")):0,w=$(s).attr("data-downloadable")?$.parseJSON($(s).attr("data-downloadable")):!1,S=$(s).attr("data-launchFile"),x=$(s).attr("data-downloadUrl")?$(s).attr("data-downloadUrl"):"",x!=""&&x.indexOf("/")!==0&&(x="/"+x),o=$("#"+s.id,n).data("type");switch(o){case"image":p="image",v="widget-img";break;case"imageGal":p="gallery",v="widget-img-gal";break;case"audio":p="audio",v="widget-audio";break;case"video":p="video",v="widget-video";break;case"assessment":p="quiz",v="widget-assessment";break;case"tip":p="tip",v="widget-tip";break;case"html":p="html",v="widget-html",size=$(s).attr("data-size");break;case"file":p="file",v="widget-file";break;case"saras":p="quiz",v="widget-saras";break;default:return}m=$(s).attr("data");if(o==="assessment")t.push({id:f+"_"+c,title:h,widgetId:c,testId:y,type:p,thumb:"",spineId:a,topicId:u,chapterId:l,widgetType:v,data_url:m,url:r+"#"+c});else if(o=="file"){var T=[{id:f+"_"+c,fileSize:0,title:h,type:p,downloadable:!1,level:0,launchFile:"",downloadUrl:""}],N=$(s).data("files");_.each(N,function(e,t){var n=t+1,r="",i=e.name.substr(e.name.lastIndexOf(".")+1);switch(i){case"doc":case"docx":case"odt":r="doc";break;case"pdf":r="pdf";break;case"xls":case"xlsx":case"ods":r="spreadsheet";break;case"zip":r="compressed";break;case"txt":r="text";break;default:r="other"}T.push({id:f+"_"+c+"_"+n,fileSize:e.size,title:e.name,type:r,downloadable:!0,level:1,launchFile:e.url,downloadUrl:e.url})}),_.each(T,function(t,n){e.push({id:t.id,title:t.title,widgetId:c,type:t.type,thumb:"",spineId:a,topicId:u,chapterId:l,widgetType:v,data_url:m,url:r+"#"+c,fileSize:t.fileSize,downloadable:t.downloadable,level:t.level,launchFile:t.launchFile,downloadUrl:t.downloadUrl})})}else e.push({id:f+"_"+c,title:h,widgetId:c,type:p,thumb:"",spineId:a,topicId:u,chapterId:l,widgetType:v,data_url:m,url:r+"#"+c,fileSize:b,downloadable:w,level:0,launchFile:S,downloadUrl:x})}});var c={enrichMentObject:e,quizObject:t};return c},onSaveSuccess:function(e,t){i.hideLoader(),this.setDirty(!1),i.showToasterMessage(AppLang.SAVE_PAGE_SUCCESS_MESSAGE,"",e,t)},onSaveError:function(){i.hideLoader(),i.showToasterMessage(AppLang.SAVE_PAGE_SUCCESS_MESSAGE)}});return f}),define("com/es/text!templateBasePath/Editor/author/headerViewTemplate.html",[],function(){return'<div class="navbar header">\n	<div class="container">\n		<div class="navbar-header">\n        	<a class="navbar-brand logo" href="#" id="iconLibraryContainer"  ></a>\n		  	<!--div class="btn-group" style="position: absolute;">\n			    <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">Select Template<span class="caret"></span></a>\n			    <ul class="dropdown-menu">\n			        <li>\n					  <a data-type="<%=AppLang.MCSR_LABEL%>"><%=AppLang.MCSR_LABEL%></a>\n			        </li>\n			        <li>\n					  <a data-type="<%=AppLang.MCMR_LABEL%>"><%=AppLang.MCMR_LABEL%></a>\n			        </li>\n			        <li>\n					  <a data-type="<%=AppLang.FIB_LABEL%>"><%=AppLang.FIB_LABEL%></a>\n			        </li> \n			        <li>\n					  <a data-type="<%=AppLang.BINARY_LABEL%>"><%=AppLang.BINARY_LABEL%></a>\n			        </li> \n			        <li>\n					  <a data-type="<%=AppLang.MATCHING_LABEL%>"><%=AppLang.MATCHING_LABEL%></a>\n			        </li> \n			       	<li>\n					  <a data-type="<%=AppLang.GROUPING_LABEL%>"><%=AppLang.GROUPING_LABEL%></a>\n			        </li>\n			        <li>\n					  <a data-type="<%=AppLang.FIB_TP_LABEL%>"><%=AppLang.FIB_TP_LABEL%></a>\n			        </li> \n			        <li>\n					  <a data-type="<%=AppLang.FIB_DD_LABEL%>"><%=AppLang.FIB_DD_LABEL%></a>\n			        </li>            \n			    </ul>\n			</div>\n			\n			<div class="btn-group" style="position: absolute;left: 340px;">\n			    <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">Select Default Template<span class="caret"></span></a>\n			    <ul class="dropdown-menu">\n			        <li>\n					  <a data-type="MCQ_SingleDefaultQuestionData"><%=AppLang.MCSR_LABEL%></a>\n			        </li>\n			        <li>\n					  <a data-type="MCQ_MultipeDefaultQuestionData"><%=AppLang.MCMR_LABEL%></a>\n			        </li>\n			        <li>\n					  <a data-type="FIBTextDefaultQuestionData"><%=AppLang.FIB_LABEL%></a>\n			        </li> \n			        <li>\n					  <a data-type="MCQ_BinaryDefaultQuestionData"><%=AppLang.BINARY_LABEL%></a>\n			        </li> \n			        <li>\n					  <a data-type="MatchingDefaultQuestionData"><%=AppLang.MATCHING_LABEL%></a>\n			        </li> \n			       	<li>\n					  <a data-type="GroupingDefaultQuestionData"><%=AppLang.GROUPING_LABEL%></a>\n			        </li>\n			        <li>\n					  <a data-type="FIBTapPlaceDefaultQuestionData"><%=AppLang.FIB_TP_LABEL%></a>\n			        </li> \n			        <li>\n					  <a data-type="FIBDropdownDefaultQuestionData"><%=AppLang.FIB_DD_LABEL%></a>\n			        </li>            \n			    </ul>\n			</div-->\n			\n		</div>\n		<div class="right-action-bar pull-right">\n		  \n		   \n		  \n    </div><div class="right-action-bar pull-right">\n    		<!--a id="iconGlossaryContainer" class="pull-left">  <span id="iconGlossary" class="glossary-icon"><%=AppLang.GLOSSARY_LABEL%></span></a>\n    		<div class="seprator-toolbar"></div-->\n		  <div class="pull-left radiobuttons"><label class="button-label"><%=AppLang.EDIT_LABEL%></label>  \n		    	<div id="editPreviewToggle" class="btn-group  edit-preview-buttons" data-toggle="buttons">\n		    		<label class="btn btn-primary active">\n		    			<input type="radio" name="editPreviewToggle" value="true"> <!--<span><%=AppLang.EDIT_LABEL%></span>-->\n			    	</label>\n			    	<label class="btn btn-primary">\n			    		<input type="radio" name="editPreviewToggle" value="false">  <!--<span><%=AppLang.PREVIEW_LABEL%></span>-->\n			    	</label>\n			    </div>\n		  <label class="button-label"><%=AppLang.PREVIEW_LABEL%></label></div>\n			<div class="seprator-toolbar"></div>\n			<a id="iconSavePublishContainer" class="pull-left">  <span id="iconSavePublish" class="save-publish-icon"></span></a>\n			<label class="button-label save-button-label"><%=AppLang.SAVE_LABEL%></label>\n		</div>\n		</div>\n	</div>\n</div>\n'}),define("com/es/views/headerView",["com/es/text!templateBasePath/Editor/author/headerViewTemplate.html","com/es/utilities/services","com/es/utilities/utils"],function(e,t,n){var r=Backbone.View.extend({events:{"click #iconLibraryContainer":"handleLibraryClick","click #iconGlossaryContainer":"handleGlossaryClick","click #iconSavePublishContainer":"handleSaveClick","click #logoutBtn":"handleLogoutClick","change input[name=editPreviewToggle]:radio":"handleModeSelect","click .dropdown-menu a":"launchEditor"},initialize:function(e){_.extend(this,Backbone.Events),this.options=e||{},this.render()},render:function(){var t=_.template(e);this.$el.append(t),this.setUserData(this.options.userData),$("#dropDownImage").dropdown()},setUserData:function(e){$(".user-name").text(e.attributes.name),e.attributes.image!=""&&$(".user-info-icon").css("background",'url("'+e.attributes.image+'")')},handleSaveClick:function(){this.trigger(AppEvent.SAVE_CONTENT,function(){})},handleGlossaryClick:function(){this.trigger(AppEvent.SHOW_GLOSSARY,function(){})},handleLibraryClick:function(){this.trigger(AppEvent.SAVE_CONTENT,function(){t.redirectLibrary(!0)})},handleLogoutClick:function(){this.trigger(AppEvent.SAVE_CONTENT,t.redirectLogout)},handleModeSelect:function(e){n.log("handleModeSelect",e),this.trigger(AppEvent.ON_MODE_SELECT,e.target.value)},enableSaveButton:function(e){e===!0?$("#iconSavePublishContainer").removeClass("disable"):$("#iconSavePublishContainer").addClass("disable")},launchEditor:function(e){var t=$(e.currentTarget).text(),n=$(e.currentTarget).attr("data-type");QuizEditor.init(t,$(".popUpContainer"),"./com/es/quizEditor/data/"+(n==="FIBTapPlace"?"FIBTapPlaceQuestion":n)+".json")}});return r}),define("com/es/text!templateBasePath/Editor/author/editTocViewTemplate.html",[],function(){return'<div class="bookMetaData">\n	<span class="cover"><img/></span>\n	<div class="inline-block"><span class="title"></span>\n	<span class="author"></span></div>\n	\n</div>\n<div class="editTocContent">\n	<div class="editBtnContainer">\n		<a href="javascript:void(0)" id="doneTocBtn"><%=AppLang.DONE_LABEL%> </a>\n	</div>\n</div>\n<nav id = "editTocContainerContent" class="toc-container" role="navigation">\n		</nav>  \n<div class="version-no"  id="appVersion" >\n	<%=AppLang.VERSION%>\n</div>'}),define("com/es/models/editTocModel",[],function(){var e=Backbone.Model.extend({defaults:{url:""}});return e}),define("com/es/collections/editTocCollection",["com/es/models/AssetPopupModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),define("com/es/views/editTocView",["com/es/text!templateBasePath/Editor/author/editTocViewTemplate.html","com/es/models/editTocModel","com/es/collections/editTocCollection","com/es/utilities/services","com/es/utilities/utils"],function(e,t,n,r,i){var s=Backbone.View.extend({el:$("#container"),url:"",iScroll:null,sortStartIndex:null,isNodeComplete:!1,editTocViewTpl:'<% _.each(childrenArr, function(obj) { %>					  <li id="<%=obj.url%>" data-id="<%=obj.id%>" data-parentid="<%=obj.parent.id%>">						  <div class="edit-details-div">							  <span class="dragIcon"></span>							  <input type="text" class="nodeName" value="<%=obj.name%>" data-label="<%=obj.name%>"/>						  </div>						  <div class="manage-list-items">							  <span class="addItemIcon"></span>							  <span class="deleteItemIcon"></span>							  <span class="addLinkIcon"></span>						  </div>						  <div class="uilist">						  	 <% _.each(obj.spines, function(spine) { %>						  	 	<span class="label label-default"><%=spine%></span>						  	<% }); %>						  </div>					  </li>					<% }); %>',addTocItemTpl:'<li class="newNode" data-id="" data-parentid="">					  <div class="edit-details-div">						  <span class="dragIcon"></span>						  <input type="text" class="nodeName" value=""/>					  </div>					  <div class="manage-list-items">						  <span class="addItemIcon"></span>						  <span class="deleteItemIcon"></span>						  <span class="addLinkIcon"></span>					  </div>					  <div class="uilist">					  </div>				  </li>',addNodeSpines:' <% _.each(spines, function(spine) { %>					 	<span class="label label-default"><%=spine%></span>					 <% }); %>',events:{"click #doneTocBtn":"doneTocClicked","click .addItemIcon":"addTocItemClicked","click .deleteItemIcon":"deleteTocItemClicked","click .addLinkIcon":"showLinkPopUp","blur .nodeName":"updateLabel","keypress .nodeName":"pressEnterKey"},prevOpenNode:null,initialize:function(e){_.bindAll(this,"closeAllNodes","showLinkPopUp","doneTocClicked","updateTocTreeData","updateNodeSpines"),this.options=e||{},this.url=window.location.href;var t=this;_.delay(function(){t.render(t.options.tocData)},100)},render:function(t){$("#editTocView").html(_.template(e)),this.el=$("#editTocContainerContent");var n=this;tttRef=n;var r=[],s=$("#editTocView").find(".bookMetaData");$(s).find(".title").html(t.title),t.author&&$(s).find(".author").html(t.author),t.cover&&$(s).find(".cover img").attr("src",t.baseUrl+"/"+t.cover),_.each(t.toc[0],function(e){i.rewriteProperty(e,"title","label"),i.rewriteProperty(e,"topics","children"),e.label=e.label,_.each(e.children,function(e){e.label=e.label}),r.push(e)},this),$(n.el).tree({data:r,autoEscape:!1,autoOpen:!1,keyboardSupport:!1}),this.setHeight(),this.initScroll();var o=$("#editTocContainerContent").find("li").get(0);$(o).addClass("jqtree-selected"),$(o).addClass("firstnode"),$(n.el).bind("tree.click",function(e){if(e.node){var t=e.node,r=$(n.el).tree("getSelectedNode");t!=r&&(e.preventDefault(),n.trigger(AppEvent.TOC_ITEM_CLICK,function(e){if(e.toLowerCase()==="cancel")return;if(t.element.classList.contains("jqtree-folder")||t.element.parentNode.classList.contains("jqtree-tree")){var r=$(n.el).tree("getTree").children[0].children,i=!1;if($(t.parent.element).hasClass("jqtree-folder")){var s=_.without(r,t.parent);n.closeAllNodes(s,t.parent)}else{var s=_.without(r,t);n.closeAllNodes(s,t)}$(n.el).tree("openNode",t)}$(".jqtree-folder",n.el).removeClass("jqtree-selected");var o=$("#editTocContainerContent").find("li").get(0);$(o).addClass("jqtree-selected"),$(n.el).tree("selectNode",t),n.setSelection(t),n.onEditTocItemSelected(t),n.prevOpenNode=t}))}}),$(n.el).bind("tree.open",function(e){n.iScroll.refresh()}),$(n.el).bind("tree.close",function(e){n.iScroll.refresh()});var u;AppConst.PAGE_ID&&(u=$(document.getElementById(AppConst.PAGE_ID)).attr("data-id")),u||(u=r[0].children[0].id);var a=$(n.el).tree("getNodeById",u);$(n.el).tree("selectNode",a);if(a.element.classList.contains("jqtree-folder")||a.element.parentNode.classList.contains("jqtree-tree")){var f=$(n.el).tree("getTree").children[0].children,l=_.without(f,a);n.closeAllNodes(l,a),$(n.el).tree("openNode",a)}n.setSelection(a),n.onEditTocItemSelected(a),$(window).resize(function(){n.setHeight(),n.initScroll()}),n.prevOpenNode=a},closeAllNodes:function(e,t){var n=this;if(n.prevOpenNode===null)return;n.prevOpenNode.id!==t.id&&((n.prevOpenNode.topicId===undefined||n.prevOpenNode.topicId!==t.topicId)&&$(n.el).tree("closeNode",n.prevOpenNode),(n.prevOpenNode.chapterId===undefined||n.prevOpenNode.chapterId!==t.chapterId)&&$(n.el).tree("closeNode",n.prevOpenNode)),_.each(e,function(e){$(n.el).tree("closeNode",e);if(e.children.length>0)for(var t=0;t<e.children.length;t++){var r=e.children[t];$(n.el).tree("closeNode",r)}})},onEditTocItemSelected:function(e){var t;e.children.length==0?t=this.addTocItemTpl:t=_.template(this.editTocViewTpl,{childrenArr:e.children}),$("#editableTocContainer").html(t);var n=$("#editableTocContainer").find("li");n.length==1&&(n.attr("data-parentid",e.id),n.attr("data-insertmode","append"),$(n).find(".deleteItemIcon").addClass("disable")),this.makeListSortable($("#editableTocContainer"))},showLinkPopUp:function(e){var t,n=$(e.target.parentNode.parentNode),r=$(e.target.parentNode.parentNode).attr("data-parentid"),s=$(e.target.parentNode.parentNode).attr("data-id"),o=this.el.tree("getNodeById",s);o&&(o.spines?t=o.spines:t=[o.spineId]);var u=n.find("input").val();u=u.trim();if(u.length==0){i.showAlert(AppLang.NODE_CANNOT_BE_ADDED_OR_UPDATED_MESSAGE);return}this.trigger(AppEvent.EDIT_LINK_CLICKED,n,t)},getAllNodes:function(e){},setHeight:function(){var e=$("#widgetsContainer").height();e+=parseFloat($("#widgetsContainer").css("margin-top")),e+=parseFloat($("#widgetsContainer").css("margin-bottom"));var t=$("body").height();$("#editTocView").height(t)},fetchTocData:function(){var e=this,t=new n,s=function(t){i.log("success"),e.render(t)},o=function(){console.log(error)},u={tocCollection:t,id:this.options.baseUrl,successCallback:s,errorCallback:o};r.tocData(u)},initScroll:function(){var e=this,t=$(this.el).get(0),n=$("#editTocView").height()-$("#editTocView").find(".bookMetaData").outerHeight()-$("#editTocView").find(".editTocContent").outerHeight()-$(".version-no").outerHeight();$(this.el).height(n),this.iScroll!=null&&this.iScroll.destroy(),this.iScroll=new IScroll($(this.el).get(0),{desktopCompatibility:!0,interactiveScrollbars:!0,scrollY:!0}),_.delay(function(){e.iScroll.refresh()},999),window.iscroll=this.iScroll},setState:function(e){var t={open_nodes:[],selected_node:"1"}},setSelection:function(e){e.parent&&(e.parent.id&&$(e.parent.element).addClass("jqtree-selected"),e.parent.parent&&e.parent.parent.id&&$(e.parent.parent.element).addClass("jqtree-selected"))},doneTocClicked:function(e){this.checkCompleteState();if(!this.isNodeComplete){i.showAlert(AppLang.ADD_SPINE_LINKS_TO_NEW_NODE_MESSAGE);return}var t=this.updateTocTreeData();r.saveTOCData({data:t[0].topics}),this.trigger(AppEvent.DONE_TOC_CLICK,t)},deleteTocItemClicked:function(e){var t=$(e.target),n=$("#editableTocContainer"),r=$(e.target).parentsUntil("#editableTocContainer"),i=t.parent().parent(),s=i.find("input").val(),o=n.find("li"),u=t.parent().parent().attr("data-id"),a;if(o.length==1&&s.length==0)return;if(u!=null&&u!=""){var f=this.el.tree("getNodeById",u);f&&f!=null&&f!=""&&this.el.tree("removeNode",f)}$(r[r.length-1]).remove(),a=n.find("li"),a.length===1&&a.find("input").val().length==0&&a.find(".deleteItemIcon").addClass("disable");if(n.find("li").length===0){var l=$(n).append(this.addTocItemTpl);l.find("li").find(".deleteItemIcon").addClass("disable")}},addTocItemClicked:function(e){var t=$(e.target).parentsUntil("#editableTocContainer"),n=$(t[t.length-1]).after(this.addTocItemTpl),r="ts_"+(new Date).getTime(),i="append",s=n.attr("data-parentid");s&&n.next().attr("data-parentid",s),n.attr("data-insertmode")==i&&n.next().attr("data-insertmode",i),$(n).next().attr("data-id",r),$("#editableTocContainer").find(".deleteItemIcon").removeClass("disable")},makeListSortable:function(e){var t=this;e.sortable({containment:"#editableTocWrapper",start:function(n,r){t.startMoveNode(e,r)},stop:function(n,r){t.moveNode(e,r);var i=$("#editTocContainerContent").find("li").get(0);$(i).addClass("jqtree-selected"),$(i).addClass("firstnode")}}),e.disableSelection()},updateTocTreeData:function(){var e=JSON.parse($("#editTocContainerContent").tree("toJson")),t=[];return _.each(e,function(e){var n=i.rewriteProperty(e,"name","title");n=i.rewriteProperty(n,"children","topics");var r=[];delete n.is_open,_.each(n.topics,function(e){delete e.is_open}),t.push(n)},this),t},updateLabel:function(e){var t=$(e.target),n=t.parent().parent(),r=n.data("id"),s=this.el.tree("getNodeById",r),o=t.val();if(o.length==0){var u=t.data("label");t.val(u),i.showToasterMessage(AppLang.NODE_CANNOT_BE_UPDATE_WITH_BLANK_TITLE_MESSAGE,3e3,function(){});return}n.hasClass("newNode")||(this.el.tree("updateNode",s,{label:o}),t.attr("data-label",o))},startMoveNode:function(e,t){var n=e.sortable("toArray",{attribute:"data-id"});this.sortStartIndex=$.inArray($(t.item[0]).attr("data-id").toString(),n)},moveNode:function(e,t){var n=e.sortable("toArray",{attribute:"data-id"}),r=$.inArray($(t.item[0]).attr("data-id").toString(),n);if(r==this.sortStartIndex)return;var i=t.item.attr("data-id"),s=this.el.tree("getNodeById",i),o=t.item.data("parentid"),u=this.el.tree("getNodeById",o),a=u.children;r<this.sortStartIndex?this.el.tree("moveNode",s,a[r],"before"):this.el.tree("moveNode",s,a[r],"after"),this.initScroll()},updateNodeLink:function(e,t,n){var r=this,i=$("#editableTocContainer").find("li").index(e),s=e.data("parentid"),o=this.el.tree("getNodeById",s),u=o.children,a="ts_"+(new Date).getTime();i>u.length&&(i=u.length);if(e.hasClass("newNode")){var f={label:e.find("input").val(),id:a,spines:n,url:t};e.data("insertmode")=="append"?this.el.tree("appendNode",f,o):this.el.tree("addNodeAfter",f,u[i-1]),this.el.tree("openNode",o),e.removeClass("newNode").attr({"data-id":f.id}),this.updateNodeSpines(e,n)}else{var l={spines:n,url:t},c=e.attr("data-id"),h=this.el.tree("getNodeById",c);this.el.tree("updateNode",h,l),this.updateNodeSpines(e,n)}$("#editableTocContainer").find(".deleteItemIcon").removeClass("disable")},updateNodeSpines:function(e,t){var n=$(e),r=$(".uilist",n),i=_.template(this.addNodeSpines,{spines:t});r.empty().append(i)},checkCompleteState:function(){var e=this,t=$("#editableTocContainer").find(".newNode").find("input");if(t.length==0){e.isNodeComplete=!0;return}$(t).each(function(){if($(this).val().trim().length>0)return e.isNodeComplete=!1,!1;var n=t.index($(this));n==t.length-1&&(e.isNodeComplete=!0)})},pressEnterKey:function(e){var t=e.keyCode?e.keyCode:e.which;t=="13"&&this.updateLabel(e)}});return s}),define("com/es/models/LinkModel",[],function(){var e=Backbone.Model.extend({defaults:{id:"",type:"",title:"",thumbnail:"",description:"",src:""}});return e}),define("com/es/collections/linkCollection",["com/es/models/LinkModel"],function(e){var t=Backbone.Collection.extend({model:e,url:""});return t}),define("com/es/text!templateBasePath/Editor/popups/linkPopup/linkPopupTemplate.html",[],function(){return'<div class="linkPopupCover modal fade in">\r\n	<div class="linkPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n			<div class="popUpTitle modal-title"><%=AppLang.ADD_LINK_LABEL%> </div>\r\n			\r\n			</div>	\r\n<div class="popup-content-spacing clearfix">		\r\n				<span class="input-group searchBar pull-left link-search">\r\n					<input type="text" class="form-control searchInput" placeholder="Search">\r\n  					<span class="searchIcon"></span>\r\n				</span>	         				\r\n			</div>			\r\n			<div id="linkList modal-body" class="popup-content-spacing linkList">\r\n			\r\n			</div>\r\n			\r\n			<div class="bottomBar modal-footer">\r\n				<div class="paging"></div>\r\n				<div>\r\n					 <button type="button" class="btn btn-default cancelbtn" data-dismiss="modal"><%=AppLang.CANCEL_LABEL%> </button>\r\n	       			 <button type="button" class="doneBtn btn btn-primary"  ><%=AppLang.DONE_LABEL%> </button>\r\n					\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Editor/popups/linkPopup/linkTemplate.html",[],function(){return"<li class='linkItem hand-cursor' id ='linkItem-<%=_idref%>'>\r\n	<input id ='<%=_idref%>' data-href='<%=_href%>' class='inputBtn hand-cursor' type='checkbox' name='link-selector'></input>\r\n	<span class='href'><%=_href%></span>\r\n</li>"}),define("com/es/views/LinkPopupView",["com/es/collections/linkCollection","com/es/text!templateBasePath/Editor/popups/linkPopup/linkPopupTemplate.html","com/es/text!templateBasePath/Editor/popups/linkPopup/linkTemplate.html","com/es/utilities/services","com/es/utilities/utils"],function(e,t,n,r,i){var s=Backbone.View.extend({el:null,tagName:"div",iScroll:null,selectedItemId:null,selectedItem:null,selectedLinks:null,filteredAssets:null,linkListCollectionObj:null,filteredList:null,initialize:function(e){this.el=$(".assetPopupCover"),_.bindAll(this,"render","handleDoneClick","handleCancelClick","handleInputClick","handleSearchClick","bindEvents","unbindEvents","createLinkList","show","updateSelectedLinks"),this.options=e||{};var t=this.options.manifestData,n=this,r=this.options.spineData;_.each(r,function(e){var n=_.where(t,{_id:e._idref});try{e._href=n[0]._href}catch(r){console.log("_href not found for "+e._idref)}}),this.spineData=r},render:function(){this.linkListCollectionObj=this.spineData;var e=this;$(this.el).remove(),$(".popUpContainer").append(_.template(t)),this.el=$(".linkPopupCover"),this.filteredList=this.linkListCollectionObj,this.createLinkList(this.linkListCollectionObj),$(".linkPopupCover").attr("tabindex","-1"),this.unbindEvents(),this.bindEvents()},bindEvents:function(){$(".doneBtn",this.el).bind(AppEvent.CLICK,this.handleDoneClick),$(".cancelBtn",this.el).bind(AppEvent.CLICK,this.handleCancelClick),$(".searchInput",this.el).bind(AppEvent.KEYUP,this.handleSearchClick),$(".linkList",this.el).bind(AppEvent.CLICK,this.updateSelectedLinks)},show:function(e,t){this.selectedItemId=e,this.selectedLinks=t,$(".searchInput").val(""),this.createLinkList(this.spineData),$(".linkPopupCover").modal("show")},hide:function(){$(".linkPopupCover").modal("hide")},handleDoneClick:function(){var e=this;i.log("handleDoneClick");var t=$('input:checkbox[name="link-selector"]:checked'),n=e.selectedLinks,r=[];if(n.length==0){i.showToasterMessage(AppLang.NO_LINK_SELETED_MESSAGE);return}r=n;var s=$(t.get(0)).attr("data-href");e.trigger(AppEvent.LINKS_SELECTED,e.selectedItemId,s,r),this.hide();return},handleCancelClick:function(){var e=this;e.trigger(AppEvent.ASSETPOPUP_CANCEL_CLICKED)},handleInputClick:function(e){var t=e.target;if(t.tagName.toLowerCase()=="input")return;t.tagName.toLowerCase()!="li"&&(t=t.parentNode);var n=t.id.split("linkItem-")[1];$("#"+n,this.el).prop("checked")?$("#"+n,this.el).prop("checked",!1):$("#"+n,this.el).prop("checked",!0)},handleSearchClick:function(e){var t=$(".searchInput",this.el).val();t=t.toLowerCase();var n=this.linkListCollectionObj.filter(function(e){if(e._href.toString().toLowerCase().indexOf(t)>-1)return e}),r=_.difference(this.filteredList,n),i=_.difference(n,this.filteredList);if(r.length!=0||i.length!=0)this.filteredList=n,this.createLinkList(this.filteredList)},createLinkList:function(e){var t=this;$(this.el).find(".linkList").html("");if(e.length>0){var r="<ul>";_.each(e,function(e){r+=_.template(n,e)}),r+="</ul>",$(this.el).find(".linkList").append(r),_.each(t.selectedLinks,function(e){var t=$("#"+e,this.el);t.prop("checked",!0)}),$(".linkItem",this.el).bind(AppEvent.CLICK,this.handleInputClick)}else $(this.el).find(".linkList").append("<span class='noResult'> "+WidgetLang.NO_RESULT_FOUND_WITH_EXCLAMATION_MARK_LABEL+"</span>")},unbindEvents:function(){$(".doneBtn",this.el).unbind(),$(".cancelBtn",this.el).unbind(),$(".searchInput",this.el).unbind(),$(".linkList",this.el).unbind()},updateSelectedLinks:function(e){var t,n,r,i;i=this,t=$(e.target),n=i.selectedLinks||[],r=t.attr("id");if(e.target.type!=="checkbox")return!1;_.contains(n,r)?n=_.without(n,r):n.push(r),i.selectedLinks=n}});return s}),define("com/es/glossary/GlossaryReaderLang",["com/es/widgets/WidgetUtils"],function(e){var t={langGlobalObj:"GlossaryReaderLang",fileName:"glossaryReaderStrings.json"};return e.setLangCode(t.langGlobalObj,t.fileName),!1}),define("com/es/text!templateBasePath/Reader/glossary/glossaryModuleTemplate.html",[],function(){return'<div id="glossaryList" class="slider-content">\r\n	<ul>\r\n		<% _.each(listAttr, function(listItem, i){ availableKeys.push(i.toLowerCase());%>\r\n		  \r\n      <li id=<%=i %>><a class="glossaryListTitle" name=<%=i %> > <%=i %></a>\r\n      	<% _.each(listItem, function(item, i){ %>\r\n        <ul data-id="<%=item.attributes.id%>" class="clearfix">\r\n          <li class="heading term" data-key= "term" data-term=<%=item.attributes.term%>><%=item.attributes.term %>\r\n          </li>\r\n          \r\n\r\n           <li class="delete-heading" data-key= "term">\r\n            <% if(item.attributes.audiofiles){%> <span class="audioPlayPauseBtn"  data-src=<%=GLOSSARY_CONSTANTS.MEDIA_BASE_URL+"/"+item.attributes.audiofiles %> ></span><% } %>\r\n            <span class="edit-term"></span>\r\n            <span class="delete-term"></span>\r\n          </li>\r\n          <li class="clear"></li>\r\n\r\n          <% if(item.attributes.imagefiles){ %><li class="image"> <img src=<%=GLOSSARY_CONSTANTS.CONTENT_BASE_URL+"/"+item.attributes.imagefiles%> class = "imageAssocistedWithGlossaryTerm"></li><% } %>\r\n\r\n                     \r\n          <li class="description" data-key= "description"> <%=item.attributes.description %></li>\r\n          <span class="more-less-definition" style="display: none"><%=GlossaryReaderLang.MORE_LABEL%></span>\r\n        </ul>\r\n          <% }); %>\r\n      </li>\r\n      <% }); %>\r\n	</ul>\r\n	<div class = "selectedAlphabet" style="display: none"><%=GlossaryReaderLang.SELECTED_ALPHABHET%></div>\r\n</div>'}),define("com/es/text!templateBasePath/Reader/glossary/glossaryTipPopUpTemplate.html",[],function(){return'<div class="modal glossaryTipPopUp" tabindex="-1">\r\n  <div class="modal-dialog">\r\n  	<!--div class="arrow up"></div-->\r\n    <div class="modal-content">\r\n      <div class="modal-header clearfix">\r\n        <h4 class="modal-title"></h4>\r\n        <span class="toolTipAudio"></span>\r\n      </div>     \r\n          \r\n      <div class="modal-body">       \r\n        <img class="toolTipImage"/>\r\n        <span class="tipDesc"></span>           \r\n      </div>\r\n\r\n    </div>\r\n    <!--div class="arrow down"></div-->\r\n  </div>\r\n</div>'}),define("com/es/models/GlossaryTerm",[],function(){var e=Backbone.Model.extend({defaults:{id:null,term:"",description:"",dirty:!1},url:function(){return AppConst.SERVICE_BASE_URL+"book/"+AppConst.BOOK_ID+"/glossary"}});return e.sync=function(e,t,n){console.log("override model")},e}),define("com/es/collections/GlossaryCollection",["com/es/models/GlossaryTerm"],function(e){var t=Backbone.Collection.extend({model:e,clone:function(e,t){return t?new e.constructor(_.map(e.where({dirty:!0}),function(e){return e.clone()})):Backbone.Collection.prototype.clone.apply(this)},sync:function(e,t,n){var r,i;switch(e){case"create":r="POST",i=n.data;break;case"read":Backbone.sync.call(t,e,t,n);return;case"delete":r="delete",i=n.deletedItems;break;case"update":Backbone.sync.call(t,e,t,n);return}$.ajax({url:t.url,type:r,contentType:!1,processData:!1,data:i,success:n.success,error:n.error})}});return t});var GLOSSARY_EVENTS={INITIALIZED:"initialized",RENDER_COMPLETE:"renderComplete",CONTAINER_RENDER_COMPLETE:"containerRenderComplete",SHOWN:"shown",CLOSED:"closed",CLICK:String(document.documentElement.ontouchmove)!="undefined"?"touchend":"click",CHANGE:"change",ON_MODE_CHANGE:"onModeChange",NO_GLOSSARY_ITEM:"noGlossaryItem"},GLOSSARY_TERM_EVENTS={SHOWN:"shown",CLOSED:"closed"};define("com/es/glossary/GlossaryEvents",function(){}),define("com/es/glossary/GlossaryConstants",[],function(){return window.GLOSSARY_CONSTANTS||(window.GLOSSARY_CONSTANTS={BOOK_ID:"",ROOT_URL:"",ROOT_PATH:"",SERVICE_BASE_URL:"",CONTENT_BASE_URL:"",MEDIA_BASE_URL:"",IMAGE_FILE_LIMIT:0,AUDIO_FILE_LIMIT:0,A_LIST:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#"],V_LIST:["a","ă","â","b","c","d","đ","e","ê","g","h","i","k","l","m","n","o","ô","ơ","p","q","r","s","t","u","ư","v","x","y","#"]}),window.GLOSSARY_CONSTANTS}),define("com/es/text!templateBasePath/Reader/glossary/glossaryPopupTemplate.html",[],function(){return'<div id="glossaryPopupCover" class="glossaryPopupCover modal fade">\r\n	<div class="glossaryPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<!--div class="header modal-header">\r\n			</div-->		\r\n			\r\n			<div id="glossaryPopup" class="modal-body" style="height: 60%;">\r\n				<div id=\'slider\' class=\'glossaryListDiv\'>\r\n					\r\n				</div>\r\n			</div>\r\n			\r\n			<!--div class="bottomBar modal-footer">\r\n				<div>\r\n					<button type="button" class="cancelBtn btn btn-default" data-dismiss="modal">Cancel</button>\r\n	       			<button type="button" class="doneBtn btn btn-primary"  >Done</button>\r\n				</div>\r\n			</div-->\r\n		</div>\r\n	</div>\r\n</div>\r\n'});var indexOfIndexBar=null,prevSelectedEle=null;$.fn.sliderNav=function(e){function f(e,n){if(!e)return;var r=e.substr(1)+"anchor",i=$("[id = "+r+"]").hasClass("disable");if(i)return;if($("[id = "+e.substr(1)+"]",$(".slider-content")).length<1){var u=_.indexOf(t,e.substring(1,2));u==t.length&&(u-=1),e="#"+t[u]}if(indexOfIndexBar==e)return;indexOfIndexBar=e,prevSelectedEle&&prevSelectedEle.removeClass("selectIndexBar"),$("[id = "+e.substr(1)+"anchor]").addClass("selectIndexBar"),$(".selectedAlphabet").hide(),n=="move"&&($(".selectedAlphabet").html(e.substring(1,2).toUpperCase()),$(".selectedAlphabet").show()),_.delay(function(){$(".selectedAlphabet").hide()},2e3),prevSelectedEle=$("[id = "+e.substr(1)+"anchor]");var a=$(".slider-content",o).offset().top,f=$("[id = "+e.substr(1).toUpperCase()+"]",o).offset().top,l=$(".slider-nav",o).height();s.height&&(l=s.height);var c=f-a-l/8;$(".slider-content",o).stop().animate({scrollTop:"+="+c+"px"})}function l(e){_.each(e,function(e){$("[id = "+e+"anchor]").addClass("disable")})}var t=e,n={items:GlossaryReaderLang.LIST_ALPHABET,debug:!1,height:null,arrows:!0},r=_.difference(n.items,e),i=$.extend(n,e),s=$.meta?$.extend({},i,$$.data()):i,o=$(this);$(o).addClass("slider"),$(o).append('<div class="mainSlider"><div class="sliderContent"><div class="slider-nav"><ul></ul></div></div></div>');for(var u in s.items)$(".slider-nav ul",o).append("<li><a id = '"+s.items[u]+"anchor' class = 'navIndexBar' alt='#"+s.items[u]+"'>"+s.items[u]+"</a></li>");var a=$(".slider-nav",o).height();s.height&&(a=s.height),l(r),$(".slider-nav a").bind("click",function(e){var t=$(this).attr("alt");f(t,"click")}),$(".slider-nav").bind("mousedown",function(e){e.button==0&&$(".slider-nav").bind("mousemove",function(e){e.preventDefault();var t=document.elementFromPoint(e.pageX,e.pageY),n=$(t).attr("alt");return f(n,"move"),!1})}),$("body").bind("mouseup",function(e){$(".slider-nav").unbind("mousemove")}),$(".slider-nav").bind("touchmove",function(e){e.preventDefault();var t=document.elementFromPoint(e.touches[0].pageX,e.touches[0].pageY),n=$(t).attr("alt");f(n,"move")})},define("com/es/glossary/slidernav",function(){}),define("com/es/glossary/GlossaryView",["com/es/glossary/GlossaryEvents","com/es/glossary/GlossaryConstants","com/es/utilities/utils","com/es/text!templateBasePath/Reader/glossary/glossaryPopupTemplate.html","com/es/glossary/slidernav"],function(e,t,n,r,i){var s=function(e,t,r,i){var s,o,u,a=0,f,l=new Audio,c=null,h=require.s.contexts._.config.glossaryConfig,p=h.lineCount,d=function(){var t=y(e.models);t=_sortObject(t),v(t)},v=function(e){var n={listAttr:e,availableKeys:[]},r=_.template(t,n);f=n.availableKeys,b(r),l.onended=m},m=function(){$(".audioPlayPauseBtn.audioPlayBtn").removeClass("audioPlayBtn"),g()},g=function(){l&&(l.pause(),$(".audioPlayPauseBtn.audioPlayBtn").removeClass("audioPlayBtn"),l.duration&&(l.currentTime=0))},y=function(e){var t={};e=_.sortBy(e,function(e){return e.attributes.term});for(var n=0;n<e.length;n++){var r=e[n].attributes.term.substr(0,1).toUpperCase();$.inArray(r.toLowerCase(),GlossaryReaderLang.LIST_ALPHABET)<0&&(r="#"),t[r]==undefined&&(t[r]=[]),t[r].push(e[n])}return t};_sortObject=function(e){var t={},n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(n);r.sort(),$.inArray("#",r)>-1&&(r=$.grep(r,function(e){return e!="#"}),r.push("#"));for(n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t};var b=function(e){r.html(e),r.show(),r.sliderNav(f),$(".more-less-definition",$("#glossaryList")).on("click",S),_.delay(function(){s.trigger(GLOSSARY_EVENTS.RENDER_COMPLETE,s)},100),_.delay(function(){E()},500),$("span.audioPlayPauseBtn").off(),$("span.audioPlayPauseBtn",$("#glossaryList")).on("click",w)},w=function(e){var t=e.target;c!==t&&(l.src=$(t).attr("data-src"),$(c).removeClass("audioPlayBtn"),c=t),l.paused?(l.play(),$(t).addClass("audioPlayBtn")):($(t).removeClass("audioPlayBtn"),g())},E=function(){var e=$(".description",$("#glossaryList"));_.each(e,function(e){var t=e.scrollHeight,n=parseInt($(e).css("line-height"),10),r=n*p;parseInt(t)>r&&($(e).parent().find(".more-less-definition").show(),$(e).css("height",r+"px"),$(e).css("overflow","hidden"))})},S=function(e){var t=$(e.target),n=t.parent().find(".description"),r=parseInt($(n).css("line-height"),10),i=r*p,s=$(n)[0].scrollHeight,o=t.html();o==GlossaryReaderLang.MORE_LABEL?$(n).animate({height:s+"px"},600,function(){t.html(GlossaryReaderLang.LESS_LABEL).addClass("makeLess")}):$(n).animate({height:i},600,function(){t.html(GlossaryReaderLang.MORE_LABEL).removeClass("makeLess")})},x=function(e){var t=this;this.iScroll!=null&&this.iScroll.destroy(),this.iScroll=new IScroll(e.get(0),{desktopCompatibility:!0,interactiveScrollbars:!0,scrollY:!0}),_.delay(function(){t.iScroll.refresh()},999)},T=Backbone.View.extend({initialize:function(e,t,r,i){s===undefined?(_.extend(this,Backbone.Events),s=this,n.log("initialize -- ",s)):n.log("instance already created");for(var o=0;o<e.length;o++)e.models[o].attributes.imagefiles=escape(e.models[o].attributes.imagefiles),e.models[o].attributes.audiofiles=escape(e.models[o].attributes.audiofiles);d()},stopAudio:g});return new T(e,t,r,i)};return s}),define("com/es/glossary/GlossaryController",["com/es/glossary/GlossaryReaderLang","com/es/text!templateBasePath/Reader/glossary/glossaryModuleTemplate.html","com/es/text!templateBasePath/Reader/glossary/glossaryTipPopUpTemplate.html","com/es/models/GlossaryTerm","com/es/collections/GlossaryCollection","com/es/glossary/GlossaryView","com/es/utilities/utils","com/es/utilities/services","com/es/text!templateBasePath/Reader/glossary/glossaryPopupTemplate.html","com/es/glossary/GlossaryEvents"],function(e,t,n,r,i,s,o,u,a,f){var l=function(e){var r,u,f,l=0,c=null,h=null,p=!1,d,v=null,m=null,g=null,y=function(e,t,n,s){var o=this;e&&(GLOSSARY_CONSTANTS.CONTENT_BASE_URL=e),t?(t.charAt(t.length-1)==="/"&&(t=t.substr(0,t.length-1)),GLOSSARY_CONSTANTS.MEDIA_BASE_URL=t):GLOSSARY_CONSTANTS.MEDIA_BASE_URL=e,d=n,c=new i,c.url=GLOSSARY_CONSTANTS.CONTENT_BASE_URL+"glossary.json",b(),N(),r.trigger(GLOSSARY_EVENTS.INITIALIZED,r)},b=function(){var e={success:w,error:S};c.fetch(e)},w=function(e){o.log("success glossaryCollection data"),o.log(c),c.length<=0&&r.trigger(GLOSSARY_EVENTS.NO_GLOSSARY_ITEM,r)},E=function(){var e=c.length?!0:!1;return e},S=function(e){o.log(e)},x=function(){p=!0;if(d)var e=$(d);else var e=$("#glossaryPopup").find(".glossaryListDiv");h=new s(c,t,e),r.trigger(GLOSSARY_EVENTS.RENDER_COMPLETE,r)},T=function(){F(),h&&h.stopAudio()},N=function(){$("body").append(_.template(a)),$("body").append(_.template(n));var e=$(".glossaryTipPopUp");o.isIE()&&(e.removeClass("fade"),$("#glossaryPopup").removeClass("fade")),e.hide();var t=$(".glossaryTipPopUp .modal-dialog");t.css({top:-250,left:-250});var r=$("#glossaryPopup").find(".glossaryListDiv")},C=function(e){p||x(),r.trigger(GLOSSARY_EVENTS.SHOWN,r)},k=function(){p,r.trigger(GLOSSARY_EVENTS.CLOSED,r)},L=function(e){var t;return _.where(c.models,{id:e})[0]?(t=_.where(c.models,{id:e})[0].attributes,t):(t=null,t)},A=function(e){u=$(e).contents();var t=$(e).contents();$(".qa-glossary-term",u).unbind().bind(GLOSSARY_EVENTS.CLICK,function(t){var n=navigator.userAgent.toLowerCase(),r=n.indexOf("android")>-1;r?_.delay(function(){M(t,e)},300):M(t,e)}),_.delay(function(){$(".qa-glossary-term",t).length>0&&!$._data($(".qa-glossary-term",t).get(0),"events")&&($._data($(".qa-glossary-term",t).get(0),"events").click||A(e))},0)},O=function(e){u=$(e).contents(),$(".qa-glossary-term",u).unbind(GLOSSARY_EVENTS.CLICK)},M=function(e,t){e.preventDefault();var n=$(".glossaryTipPopUp"),i=$(".glossaryTipPopUp .modal-dialog");m=e.target;var s=parseInt($(e.target).attr("data-id")),u=L(s);if(!u)return;$(n).show(),u.imagefiles&&($(n).find(".modal-body").find("img").get(0).src=GLOSSARY_CONSTANTS.CONTENT_BASE_URL+"/"+u.imagefiles,$(n).find(".modal-body").find("img").css("display","block")),u.audiofiles&&(g=new Audio,g.onended=F,g.src=GLOSSARY_CONSTANTS.MEDIA_BASE_URL+"/"+u.audiofiles,$(n).find(".toolTipAudio").css("display","inline-block"),$(n).find(".toolTipAudio").off("click").on("click",D)),$(n).find(".modal-title").html(u.term),$(n).find(".modal-body").find(".tipDesc").html(u.description),H(e,t),$(n).on("shown.bs.modal",function(e){$(".modal-backdrop").bind(GLOSSARY_EVENTS.CLICK,P)}),o.mouseWheel($(n).find(".modal-body")),r.trigger(GLOSSARY_TERM_EVENTS.SHOWN,s),$(n).on("hidden.bs.modal",function(e){$(".modal-backdrop").removeClass("transparent"),$(".modal-backdrop").unbind(),$(n).unbind(),i.css({top:-250,left:-250}),$(n).find(".modal-title").html(""),$(n).find(".modal-body").find("img").get(0).src="",$(n).find(".modal-body").find(".tipDesc").html(""),$(".toolTipAudio").removeClass("play"),$(n).find(".toolTipAudio").hide(),$(n).find(".modal-body").find("img").hide(),g&&F(),g=null,m=null,r.trigger(GLOSSARY_TERM_EVENTS.CLOSED,s)}),$(n).modal("show"),$(".modal-backdrop").addClass("transparent")},D=function(e){g.paused?(g.play(),$(e.target).addClass("play")):(F(),$(e.target).removeClass("play"))},P=function(e){T(),$(".glossaryTipPopUp").modal("hide")},H=function(e,t){var n=$(".glossaryTipPopUp .modal-dialog"),r=115,i,s;e.type=="touchend"&&(e.changedTouches?e=e.changedTouches[0]:e.touches&&(e=e.touches[0]),r=0),i=e.clientX,s=e.clientY,n.css({left:i+$(t).offset().left,top:s+$(t).offset().top-n.outerHeight()-15});var u=i+n.width(),a=$(t).offset().left+parseInt($(t).css("padding-left")),f=a+$(t).width();if(u>f){var l=f-n.width()-10;n.css("left",l)}if(n.offset().top<0){var c=s+$(t).offset().top+20;n.css("top",c)}o.isPhone()&&n.css({left:"25%",width:"50%"})},B=function(){P()},j=function(){},F=function(){g&&(g.pause(),$(".toolTipAudio").removeClass("play"),g.duration&&(g.currentTime=0))},I=Backbone.View.extend({initialize:function(e,t,n,r){},init:function(e,t,n,i){r===undefined?(o.log("initialize -- ",r),_.extend(this,Backbone.Events),r=this,o.log("initialize -- ",r),y(e,i,t,n)):o.log("instance already created")},stopMedia:T,show:C,hide:k,enableTermsOnPage:A,disableTermsOnPage:O,onResize:B,hideDescription:P,hasGlossary:E});return new I};return window.GlossaryController=new l,window.GlossaryController}),define("com/es/views/AuthoringView",["com/es/text!templateBasePath/Editor/author/authorViewTemplate.html","com/es/text!templateBasePath/Editor/popups/popUpTemplate.html","com/es/views/TocView","com/es/models/ContentAuthoringModel","com/es/views/ContentAuthoringView","com/es/views/AssetPopupView","com/es/models/AssetPopupModel","com/es/views/headerView","com/es/utilities/utils","com/es/views/editTocView","com/es/views/LinkPopupView","com/es/glossary/GlossaryController","com/es/utilities/fontObfuscationManager"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=Backbone.View.extend({el:$("#container"),events:{"click #showPopUp":"showAssetPopup"},headerView:null,tocView:null,contentView:null,editable:"true",editTocView:null,linkPopupView:null,glossaryController:null,initialize:function(e){this.options=e||{},_.extend(this,Backbone.Events),_.bindAll(this,"onTocItemSelected","onModeSelected","onFrameContentLoaded","saveContent","onTocItemClicked","onEditTocItemClicked","onEditTocClicked","onDoneTocClicked","showEditTocView","onDirtyStateChanged","saveKeyPadEvent","onEditLinkClicked","onLinkSelected"),this.render()},render:function(){AppConst.BOOK_BASE_URL&&AppConst.KEY_IDENTIFIER&&(AppConst.FONT_MANAGER=new h({keyId:AppConst.KEY_IDENTIFIER,baseURL:AppConst.BOOK_BASE_URL}));var s=_.template(e);$(this.el).html(s),$(this.el).append(_.template(t)),this.headerView=new u({userData:this.options.headerModel,el:$("#widgetsContainer")}),this.tocView=new n({baseUrl:AppConst.CONTENT_BASE_URL,tocData:this.options.tocData}),this.linkPopupView=new l({manifestData:this.options.manifestData,spineData:this.options.spineData}),this.linkPopupView.render(),this.linkPopupView.bind(AppEvent.LINKS_SELECTED,this.onLinkSelected),this.tocView.bind(AppEvent.TOC_ITEM_SELECT,this.onTocItemSelected),this.tocView.bind(AppEvent.TOC_ITEM_CLICK,this.onTocItemClicked),this.tocView.bind(AppEvent.EDIT_TOC_CLICK,this.onEditTocClicked),this.headerView.bind(AppEvent.ON_MODE_SELECT,this.onModeSelected);var o=new r;this.contentView=new i({model:o}),this.headerView.bind(AppEvent.SAVE_CONTENT,this.saveContent),this.headerView.bind(AppEvent.SHOW_GLOSSARY,this.showGlossary),this.contentView.bind(AppEvent.SAVE_CONTENT,this.saveContent),this.contentView.bind(AppEvent.DIRTY_STATE_CHANGED,this.onDirtyStateChanged),$(document).bind(AppEvent.KEYDOWN,this.saveKeyPadEvent);var a={container:$(".popUpContainer"),contentBaseUrl:AppConst.CONTENT_BASE_URL,bookId:AppConst.BOOK_ID,mode:"popup"};GlossaryEditor.init(a)},saveKeyPadEvent:function(e){if(e.ctrlKey&&e.which==83||e.metaKey&&e.which==83)return $(".modal").is(":visible")||(e.preventDefault(),this.headerView.trigger(AppEvent.SAVE_CONTENT,function(){})),!1},onDirtyStateChanged:function(e){this.headerView.enableSaveButton(e)},saveContent:function(e){this.contentView.getDirty()?this.contentView.showSavePopUp(e):e("")},onTocItemClicked:function(e){this.saveContent(e)},onTocItemSelected:function(e){var t,n,r,i,s;s=e.url;var o=e.id;e.hasOwnProperty("chapterTitleId")&&(o=e.chapterTitleId);var u=o.split("_");n=u[0],t=u.length>1?o:"",e.url.indexOf("#")>=0?(i=e.url.split("#"),i=i[0]):i=e.url;var a=_.findWhere(this.options.manifestData,{_href:i});if(a!==undefined)var r=a._id;else var r=e.parent.spineId;this.contentView.model.set("chapterId",n),this.contentView.model.set("topicId",t),this.contentView.model.set("spineId",r),this.contentView.model.set("pageUrl",s),window.location.href=AppConst.ROOT_URL+"#"+AppConst.USER_ID+"/"+AppConst.BOOK_ID+"/"+e.url.replace(/\//g,"&#47;")},onEditTocClicked:function(e){this.contentView.getDirty()?a.showToasterMessage(AppLang.EDITED_PAGEDATA_MESSAGE):this.showEditTocView()},showEditTocView:function(){$("#overlay").show(),$("#editTocViewContainer").show(),$("#editTocViewContainer").css({top:"0px",right:"0px",position:"absolute","z-index":"99",height:"100%",display:"inline-flex"}),$("#editTocContainerContent").css({"z-index":"99"}),$("#editTocViewContainer").animate({width:"900px"},500,"linear");var e=a.clone(this.options.rawTocData);e.toc[0]=[{id:"",label:'<span class="tocItem" data-id='+this.options.rawTocData.id+">"+this.options.rawTocData.title+"</span>",spineId:"",spines:[],url:"",children:this.options.rawTocData.toc[0]}],this.editTocView?this.editTocView.render(e):(this.editTocView=new f({baseUrl:AppConst.CONTENT_BASE_URL,tocData:e}),this.editTocView.bind(AppEvent.DONE_TOC_CLICK,this.onDoneTocClicked),this.editTocView.bind(AppEvent.TOC_ITEM_CLICK,this.onEditTocItemClicked),this.editTocView.bind(AppEvent.EDIT_LINK_CLICKED,this.onEditLinkClicked))},onEditTocItemClicked:function(e){this.contentView.getDirty()?a.showToasterMessage(AppLang.EDITED_PAGEDATA_MESSAGE):e("")},onDoneTocClicked:function(e){this.trigger(AppEvent.DONE_TOC_CLICK,e),$("#editTocViewContainer").animate({width:"0px"},500,"linear"),_.delay(function(){$("#editTocViewContainer").hide()},700),$("#overlay").hide()},onModeSelected:function(e){this.editable=e,this.editable==="true"?$(".widgetIcon").removeClass("disabled"):$(".widgetIcon").addClass("disabled"),this.contentView.setEditable(this.editable)},setPage:function(e){this.contentView.setPage(e)},onEditLinkClicked:function(e,t){this.linkPopupView.show(e,t)},onLinkSelected:function(e,t,n){this.editTocView.updateNodeLink(e,t,n)},onFrameContentLoaded:function(e){this.contentView.setEditable(this.editable)},showGlossary:function(){GlossaryEditor.show()}});return p}),define("com/es/models/BooksListModel",[],function(){var e=Backbone.Model.extend({});return e}),define("com/es/models/UserInfoModel",[],function(){var e=Backbone.Model.extend({});return e}),define("com/es/utilities/dragNdrop",function(){}),define("com/external/xml2json",function(){}),(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e=window.Crypto={},t=e.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var n=0;n<e.length;n++)e[n]=t.endian(e[n]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((e[n]&15).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){if(typeof btoa=="function")return btoa(n.bytesToString(e));for(var t=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],s=0;s<4;s++)r*8+s*6<=e.length*8?t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){if(typeof atob=="function")return n.stringToBytes(atob(e));for(var e=e.replace(/[^A-Z0-9+\/]/ig,""),t=[],r=0,i=0;r<e.length;i=++r%4)i!=0&&t.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r))>>>6-i*2);return t}},e=e.charenc={};e.UTF8={stringToBytes:function(e){return n.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bytesToString(e)))}};var n=e.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}(),function(){var e=Crypto,t=e.util,n=e.charenc,r=n.UTF8,i=n.Binary,s=e.SHA1=function(e,n){var r=t.wordsToBytes(s._sha1(e));return n&&n.asBytes?r:n&&n.asString?i.bytesToString(r):t.bytesToHex(r)};s._sha1=function(e){e.constructor==String&&(e=r.stringToBytes(e));var n=t.bytesToWords(e),i=e.length*8,e=[],s=1732584193,o=-271733879,u=-1732584194,f=271733878,l=-1009589776;n[i>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+15]=i;for(i=0;i<n.length;i+=16){for(var c=s,h=o,p=u,d=f,v=l,g=0;g<80;g++){if(g<16)e[g]=n[i+g];else{var y=e[g-3]^e[g-8]^e[g-14]^e[g-16];e[g]=y<<1|y>>>31}y=(s<<5|s>>>27)+l+(e[g]>>>0)+(g<20?(o&u|~o&f)+1518500249:g<40?(o^u^f)+1859775393:g<60?(o&u|o&f|u&f)-1894007588:(o^u^f)-899497514),l=f,f=u,u=o<<30|o>>>2,o=s,s=y}s+=c,o+=h,u+=p,f+=d,l+=v}return[s,o,u,f,l]},s._blocksize=16,s._digestsize=20}(),define("com/external/crypto-sha1",function(){}),define("com/es/app",["com/es/controllers/router","com/es/views/AuthoringView","com/es/models/BooksListModel","com/es/models/UserInfoModel","com/es/utilities/services","com/es/text!templateBasePath/Editor/popups/popUpTemplate.html","com/es/utilities/utils","com/es/utilities/dragNdrop","com/external/xml2json","com/external/crypto-sha1"],function(e,t,n,r,i,s,o,u,a){var f=function(){var e=this,s,u=!1,a=null,f=null,l=null,c=function(){AppConst.ROOT_URL=location.href.split("#")[0],AppConst.ROOT_PATH=window.location.pathname.split("/")[1],AppConst.SERVICE_BASE_URL=window.location.origin+"/"+AppConst.ROOT_PATH+"/pubservice/"},h=function(e,t){e!=t&&o.showToasterMessage(AppLang.BOOK_CURRENTLY_EDITED_BY_OTHER_USER_MESSAGE,function(){i.redirectLibrary(!1)})},p=function(e,t){f=o.clone(e.attributes),AppConst.BOOK_ISBN_NO=e.get("bookIsbn"),AppConst.USER_NAME=t.get("name"),AppConst.BOOK_TITLE=e.get("title"),u=!0,AppConst.CONTENT_BASE_URL=e.attributes.baseUrl.replace(/\\/g,"/"),AppConst.BOOK_BASE_URL=e.attributes.bookBaseUrl,AppConst.KEY_IDENTIFIER=e.attributes.keyIdentifier,AppConst.BOOK_TYPE=e.attributes.bookType,AppConst.WIDGET_HTTP_BASE_PATH=f.Opcr_Location,AppConst.BOOK_TYPE=="pre-paginated"&&(AppConst.BOOK_TYPE="fixed"),h(e.attributes.lockedByUserId,t.id),w(AppConst.CONTENT_BASE_URL,e,t)},d=function(e){console.log("Error while loading book meta data ",e),o.showToasterMessage(AppLang.ERROR_LOADING_BOOK_METADATA,2e3,function(){window.location.href=window.location.origin+"/pubportal/bookdefault.excel"})},v=function(e,t,r,s){AppConst.BOOK_ID=e;var o=window.location.href;AppConst.HOME_PAGE_URL=o.substring(0,o.indexOf("editor.html"));var u=new n,a=function(e){p(e,t)},f=d,l={model:u,successCallback:a,errorCallback:f,id:e};i.getBookMetadata(l)},m=function(e,t){AppConst.BOOK_ID=e,AppConst.PAGE_ID=t,AppConst.PAGE_NAME||(AppConst.PAGE_NAME=t),s.setPage(t)},g=function(e){},y=function(e,t,n){},b=function(e,t,n){AppConst.USER_ID=e;var s=function(e){t(e)},o=function(e){console.log(e)},u=new r,a={model:u,successCallback:s,errorCallback:o,id:e};i.getUserInfo(a)},w=function(e,n,r){var o=function(e){a=e.manifest.item,l=e.spine.itemref,_.each(n.attributes.toc[0],function(e){S(e,a)}),s=new t({headerModel:r,tocData:n.attributes,rawTocData:f,manifestData:a,spineData:l}),s.bind(AppEvent.DONE_TOC_CLICK,E)},u=function(e){console.log("Invalid Content.opf ")},c=n.attributes.opfPath,h={successCallback:o,errorCallback:u,baseUrl:window.location.origin+"/"+c};i.getOPFData(h)},E=function(e){f.toc[0]=o.clone(e[0].topics),_.each(e[0].topics,function(e){S(e,a)});var t=o.clone(f);t.toc[0]=o.clone(e[0].topics),s.options.rawTocData=f,s.tocView.render(t)},S=function(e,t,n){if(e.hasOwnProperty("spines")){var r=e.url;r=r.split("#")[0];var i=_.findWhere(a,{_href:r});if(i!==undefined)var s=i._id;else var s=n;var o=e.id;i!==undefined&&i.hasOwnProperty("chapterTitleId")&&(o=i.chapterTitleId);if(s!==undefined){e.spineId=s;var u=_.without(e.spines,s);u.length>0&&x(e,u,t,o,s)}}if(e.hasOwnProperty("topics")){var f=e.topics;_.each(f,function(e){S(e,null,s)})}},x=function(e,t,n,r,i){e.topics||(e.topics=[]);var s="",o=[];_.each(t,function(t){var n=_.find(a,function(e){return e._id==t}),s={id:n._id,url:n._href,title:n._href,chapterTitleId:r,spineId:i};e.topics.push(s)})};return c(),{launchBook:v,loadBookPage:m,setDisplayMode:g,savePageData:y,getUserInfo:b,isBookMetaLoaded:function(){return u}}};return f}),define("com/es/utilities/AppConst",[],function(){var e={USER_ID:"",USER_NAME:"",USER_ROLE:"",USER_LOGIN_TIME:"",PAGE_ID:"",BOOK_ID:"",BOOK_TITLE:"",BOOK_TYPE:"",HOME_PAGE_URL:"",SERVICE_BASE_URL:"",contentBaseUrl:"",CONTENT_BASE_URL:"",ROOT_URL:"",PAGE_NAME:"",DEVICE_PIXEL_RATIO:"",WIDGET_HTTP_BASE_PATH:"",BOOK_BASE_URL:"",KEY_IDENTIFIER:"",FONT_MANAGER:"",TOC_DATA_BASE_URL:"",USER_SERVICE_SUB_URL:"/user/profile/",LOGOUT_SERVICE_SUB_URL:"logout.excel",BOOK_ISBN_NO:"",ALLOW_SAMPLE_BOOK_DEFINITION:!1,EOW_LDL_SERVER:"http://ldluat.ldldev.co.uk/",EOW_LDL_SERVICE_URL:"http://ldluat.ldldev.co.uk/authoriseWidget.php",EOW_RDR_HTML_PATH:"http://localhost:8080/pubportal/QA"};window.AppConst=e}),define("com/es/utilities/AppEvent",[],function(){var e={CLICK:"click",CHANGE:"change",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",TIME_UPDATE:"timeupdate",ASSET_SELECTED:"onAssetSelected",ASSETPOPUP_CANCEL_CLICKED:"onAssetpopUpCancelClick",CONFIG_UPDATED:"onConfigUpdated",CONTEXTMENU_ITEM_SELECTED:"onContextMenuItemClick",SHOW_CONTEXTMENU_CLICKED:"onShowContextMenuClick",SAVE_CONTENT:"onSavePageInitiated",ON_MODE_SELECT:"onModeSelected",TOC_ITEM_SELECT:"onTocItemSelected",TOC_ITEM_CLICK:"onTocItemClick",EDIT_TOC_CLICK:"onEditTocClick",DONE_TOC_CLICK:"onDoneTocClick",TOC_TREE_ITEM_RENAMED:"onTOCTreeItemRenamed",WIDGET_ADDED:"onWidgetAdd",DIRTY_STATE_CHANGED:"onDirtyStateChanged",EDIT_LINK_CLICKED:"onEditLinkClick",SHOW_GLOSSARY:"showGlossary",OPTION_ADDED:"optionAdded",FIB_ANSWER_ADDED:"onFibActivityAppend",ADD_ASSET:"onAssetAdd",DONE_LINK_POPUP_CLICK:"onDoneLinkPopupClick",TOC_EDITABLE_NODE_CLICKED:"onTOCTreeEditableItemClick",TOC_EDITABLE_NODE_BLURRED:"onTOCTreeEditableItemBlur",TOC_RENDER_COMPLETE:"onTOCRenderComplete",REPORTING_READY:"reporting_ready",EDITOR_READY:"qa_editor_ready",RENDERER_READY:"qa_renderer_ready",QUESTION_CREATED:"question_created",GLOSSARY_EDITOR_READY:"glossary_editor_ready",TOCEDITOR_READY:"toc_editor_ready",QUIZ_CREATOR_READY:"quiz_creator_ready",INPUT_PROPERTY_CHANGE:"input propertychange"};window.AppEvent=e}),define("com/es/utilities/AppLang",["com/es/widgets/WidgetUtils"],function(e){var t={langGlobalObj:"AppLang",fileName:"editorStrings.json"};return e.setLangCode(t.langGlobalObj,t.fileName),!1}),define("com/es/text!templateBasePath/Editor/glossary/glossaryEditorPopupTemplate.html",[],function(){return'<div id="glossaryEditorPopupCover" class="glossaryEditorPopupCover modal fade in">\r\n	<div class="glossaryEditorPopup modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header clearfix">\r\n                            <div class="GlossaryEditorPopUpTitle modal-title"><%=AppLang.GLOSSARY_LABEL%></div>\r\n                            <div class="right-action-bar pull-right">\r\n\r\n				<div class="pull-left radiobuttons">\r\n                                    <label class="button-label"><%=AppLang.EDIT_LABEL%></label>\r\n\r\n                                    <div id="editPreviewToggle" class="btn-group  edit-preview-buttons" data-toggle="buttons">\r\n                                        <label class="btn btn-primary">\r\n                                            <input type="radio" name="glossaryEditPreviewToggle" value="true">\r\n                                        </label>\r\n                                        <label class="btn btn-primary active">\r\n                                            <input type="radio" name="glossaryEditPreviewToggle" value="false">\r\n                                        </label>\r\n                                    </div>\r\n                                    <label class="button-label"><%=AppLang.PREVIEW_LABEL%></label>\r\n                                </div>\r\n                                <button type="button" id ="closeIcon" class="close-pop" data-dismiss="modal"></button>\r\n                            </div> \r\n			</div>		\r\n			\r\n			<div id="glossaryEditorPopup" class="modal-body">\r\n                            <div id=\'glossaryEditorList\' class=\'glossaryListDiv\'>\r\n					\r\n			    </div> \r\n			</div>\r\n			\r\n			<div class="bottomBar modal-footer">\r\n				<div>\r\n				    <button type="button" id ="glossaryAddWordBtn" class="btn-addword" style="display: none"><%=AppLang.ADD_WORD_LABEL%></button>\r\n                                    <button type="button" id ="glossarySaveBtn" class="btn btn-default" style="display: none"><%=AppLang.SAVE_LABEL%></button>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("com/es/text!templateBasePath/Editor/glossary/glossaryAddNewTermTemplate.html",[],function(){return'<div id="glossaryAddNewTermPopupCover" class="glossaryAddNewTermPopupCover modal fade in">\r\n    <div class="glossaryEditorPopup glossaryAddNewTermPopup modal-dialog">\r\n        <div class="modal-content">\r\n            <div class="header modal-header clearfix">\r\n\r\n                            <div class="GlossaryEditorPopUpTitle modal-title"><span class="back-arrow"></span><%=AppLang.ADD_WORD_LABEL%></div>\r\n                            <button type="button" id ="closeIcon" class="close-pop f-right" ></button>\r\n\r\n                            \r\n            </div>      \r\n            \r\n            <div id="addWordContainer" class="modal-body" style="height: 500px">\r\n				<form method="post" name="glossary" id="add-glossary" action="" enctype="multipart/form-data">\r\n                            <div class="form-group clearfix">\r\n                                <label for="name"><%=AppLang.WORD_LABEL%><span><%=AppLang.ASTERISK_LABEL%></span></label>\r\n                                    <input type="text" class="form-control" name="term" id="inputWord">\r\n\r\n                                </div>\r\n                                <div class="form-group clearfix">\r\n                                   <label for="inputfile"><%=AppLang.DEFINITION_LABEL%><span><%=AppLang.ASTERISK_LABEL%></span></label>\r\n\r\n                                    <textarea class="form-control" name="description" rows="5" id="inputDescription"></textarea>\r\n                            </div>\r\n\r\n                            <div id="imageFileContainer" class="form-group clearfix">\r\n                                <label for="name"><%=AppLang.BROWSE_IMAGE_LABEL%></label>\r\n                                <div class="browseBox">\r\n                                    <div class="clearfix">\r\n                                        <span id="selectedImageName"></span>\r\n                                        <button type="button" id="browseImage"><%=GlossaryEditorLang.BROWSE_LABEL%></button><br> \r\n                                        <input  type="file" name="imagefiles" id="imageFile" style="display:none" class="filestyle" accept=".jpg, .jpeg, .png">  \r\n                                    </div>       \r\n                                    <div id="imageSelectionInfo">\r\n                                        <%=AppLang.IMAGE_SELECTION_INFO%>\r\n                                        <span id="gsAddImageFileSizeInfo" class="fs-info"></span>\r\n                                    </div>\r\n                                    <div class="imagePreviewBOx">\r\n                                        <img id="imagePreview" class="imagePreview"/>   \r\n                                        <span id="resetImageSelection" class="resetSelection"></span> \r\n                                    </div>\r\n                                </div>                             \r\n                            </div>\r\n\r\n                            <div id="audioFileContainer"  class="form-group clearfix">\r\n                                <label for="name"><%=AppLang.BROWSE_AUDIO_LABEL%></label>                              \r\n                                <div class="browseBox">\r\n                                    <span id="selectedAudioName"></span>\r\n                                <button type="button" id="browseAudio"><%=GlossaryEditorLang.BROWSE_LABEL%></button><br>\r\n                                    <input type="file" id="audioFile" name="audiofiles" style="display:none" accept=".mp3">\r\n                                    <span id="audioSelectionInfo">\r\n                                        <%=AppLang.AUDIO_SELECTION_INFO%>\r\n                                        <span id="gsAddAudioFileSizeInfo" class="fs-info"></span>\r\n                                    </span> \r\n                                    <div class="audioPlayPauseBtn audioPlayPauseBtnAddNewGlossaryTerm" id="audioPlayPauseImage"></div>\r\n                                    <span id="resetAudioSelection" class="resetSelection"></span>\r\n                                </div>\r\n                            </div>\r\n            </div>\r\n            \r\n            <div class="bottomBar modal-footer">\r\n                <div>\r\n                    <button type="button" id ="glossaryAddWordSaveBtn" class="btn"><%=AppLang.SAVE_LABEL%></button>\r\n                                    <button type="button" id ="glossaryAddWordContinueBtn" class="btn" ><%=AppLang.SAVE_LABEL%><%=AppLang.AND_WITH_SPACE_LABEL%><%=AppLang.CONTINUE_LABEL%></button>\r\n                                    <button type="button" id ="glossaryCancelBtn" class="btn" ><%=AppLang.CANCEL_LABEL%></button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/glossary/glossaryEditTermTemplate.html",[],function(){return'<div id="glossaryEditNewTermPopupCover" class="glossaryEditNewTermPopupCover modal fade in">\n	<div class="glossaryEditorPopup glossaryEditTermPopup modal-dialog">\n		<div class="modal-content">\n			<div class="header modal-header clearfix">\n\n                            <div class="GlossaryEditorPopUpTitle modal-title"><span class="back-arrow"></span><%=AppLang.EDIT_WORD_LABEL%></div>\n                            <button type="button" id ="closeIcon" class="close-pop f-right"></button>\n\n                            \n			</div>\n			\n			<div id="editTermContainer" class="modal-body" style="height: 500px">\n				<form method="post" name="glossary" id="add-glossary" action="" enctype="multipart/form-data">\n                            <div class="form-group clearfix">\n                                <label for="name"><%=AppLang.WORD_LABEL%><span><%=AppLang.ASTERISK_LABEL%></span></label>\n                                    <input type="text" class="form-control" name="term" id="inputWord">\n\n                                </div>\n                                <div class="form-group clearfix">\n                                   <label for="inputfile"><%=AppLang.DEFINITION_LABEL%><span><%=AppLang.ASTERISK_LABEL%></span></label>\n\n                                    <textarea class="form-control" name="description" rows="5" id="inputDescription"></textarea>\n                            </div>\n\n                            <div id="imageFileContainer" class="form-group clearfix">\n                                <label for="name"><%=AppLang.BROWSE_IMAGE_LABEL%></label>\n                                <div class="browseBox">\n                                    <div class="clearfix">\n                                        <span id="selectedImageName"></span>\n                                        <button type="button" id="browseImage"><%=GlossaryEditorLang.BROWSE_LABEL%></button><br> \n                                        <input  type="file" name="imagefiles" id="imageFile" style="display:none" class="filestyle" accept=".jpg, .jpeg, .png">  \n                                    </div>           \n                                    <div id="imageSelectionInfo">\n                                        <%=AppLang.IMAGE_SELECTION_INFO%>\n                                        <span id="gsEditImageFileSizeInfo" class="fs-info"></span>\n                                    </div>\n                                    <div class="imagePreviewBOx">\n                                        <img id="imagePreview" class="imagePreview"/>   \n                                        <span id="resetImageSelection" class="resetSelection"></span> \n                                    </div>\n                                </div>                            \n\n                            </div>\n\n                            <div id="audioFileContainer"  class="form-group clearfix">\n\n                                <label for="name"><%=AppLang.BROWSE_AUDIO_LABEL%></label>   \n                                <div class="browseBox">  \n                                <span id="selectedAudioName"></span>\n                                <button type="button" id="browseAudio"><%=GlossaryEditorLang.BROWSE_LABEL%></button><br>                        \n                                    <input type="file" id="audioFile" name="audiofiles" style="display:none" accept=".mp3">\n                                    <span id="audioSelectionInfo">\n                                        <%=AppLang.AUDIO_SELECTION_INFO%>\n                                        <span id="gsEditAudioFileSizeInfo" class="fs-info"></span>\n                                    </span> \n                                    <div class="audioPlayPauseBtn audioPlayPauseBtnAddNewGlossaryTerm" id="audioPlayPauseImage"></div>\n                                    <span id="resetAudioSelection" class="resetSelection"></span>\n                                </div>\n\n                            </div>\n                            <input type="text" style="display: none;" name="imageChanged" id="imageChanged" value="false">\n                            <input type="text" style="display: none;" name="audioChanged" id="audioChanged" value="false">\n                            </form>\n            </div>\n			\n			<div class="bottomBar modal-footer">\n				<div>\n				    <button type="button" id ="glossaryEditTermSaveBtn" class="btn"><%=AppLang.SAVE_LABEL%></button>\n                                    \n                                    <button type="button" id ="glossaryCancelBtn" class="btn" ><%=AppLang.CANCEL_LABEL%></button>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("com/es/glossary/GlossaryEditorLang",["com/es/widgets/WidgetUtils"],function(e){var t={langGlobalObj:"GlossaryEditorLang",fileName:"glossaryEditorStrings.json"};return e.setLangCode(t.langGlobalObj,t.fileName),!1}),define("com/es/text!templateBasePath/Editor/glossary/glossaryEditorInlineTemplate.html",[],function(){return'<div id="glossaryEditorPopupCover" class="glossaryEditorPopupCover  glossaryInlineContainer">\n	<div class="glossaryEditorPopup ">\n		<div >\n			<div class="header clearfix">\n                <div class="GlossaryEditorPopUpTitle "><%=AppLang.GLOSSARY_LABEL%></div>\n                <div class="right-action-bar pull-right">\n\n					<span class="radiobuttons">\n                        <label class="button-label"><%=AppLang.EDIT_LABEL%></label>\n\n                        <div id="editPreviewToggle" class="btn-group  edit-preview-buttons" data-toggle="buttons">\n                            <label class="btn btn-primary">\n                                <input type="radio" name="glossaryEditPreviewToggle" value="true">\n                            </label>\n                            <label class="btn btn-primary active">\n                                <input type="radio" name="glossaryEditPreviewToggle" value="false">\n                            </label>\n                        </div>\n                        <label class="button-label"><%=AppLang.PREVIEW_LABEL%></label>\n                    </span>\n                <span>\n			    	<button type="button" id ="glossaryAddWordBtn" class="btn-addword" style="display: none"><%=AppLang.ADD_WORD_LABEL%></button>\n                	<button type="button" id ="glossarySaveBtn" class="btn btn-default" style="display: none"><%=AppLang.SAVE_LABEL%></button>\n				</span>\n            </div> \n                    \n			</div>		\n			\n			<div id="glossaryEditorPopup">\n                            <div id=\'glossaryEditorList\' class=\'glossaryListDiv\'>\n					\n			    </div> \n			</div>\n			\n			<div class="bottomBar">\n				<!--div>\n				    <button type="button" id ="glossaryAddWordBtn" class="btn-addword" style="display: none"><%=AppLang.ADD_WORD_LABEL%></button>\n                    <button type="button" id ="glossarySaveBtn" class="btn btn-default" style="display: none"><%=AppLang.SAVE_LABEL%></button>\n				</div-->\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("com/es/glossary/GlossaryEditor",["com/es/text!templateBasePath/Reader/glossary/glossaryModuleTemplate.html","com/es/glossary/GlossaryConstants","com/es/models/GlossaryTerm","com/es/collections/GlossaryCollection","com/es/glossary/GlossaryView","com/es/utilities/utils","com/es/utilities/services","com/es/text!templateBasePath/Editor/glossary/glossaryEditorPopupTemplate.html","com/es/text!templateBasePath/Editor/glossary/glossaryAddNewTermTemplate.html","com/es/text!templateBasePath/Editor/glossary/glossaryEditTermTemplate.html","com/es/glossary/GlossaryEditorLang","com/es/text!templateBasePath/Editor/glossary/glossaryEditorInlineTemplate.html"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=function(t){var n,o,l,h=0,p=null,d=null,v=!1,m=[],g=null,y="33px",b=null,w="inline",E=[],S=new Audio,x=require.s.contexts._.config.glossaryConfig,T=x.lineCount,N=function(e){var t=this;GLOSSARY_CONSTANTS.CONTENT_BASE_URL=e,GLOSSARY_CONSTANTS.MEDIA_BASE_URL=e,p=new r,O(),M(),wt(),C()},C=function(){var e={success:k,error:L};p.url=GLOSSARY_CONSTANTS.SERVICE_BASE_URL+"book/"+GLOSSARY_CONSTANTS.BOOK_ID+"/glossary",p.fetch(e)},k=function(e){s.log("success glossaryCollection data"),GC=p,s.log(p),$(window.GlossaryEditor).trigger(GLOSSARY_EVENTS.CONTAINER_RENDER_COMPLETE)},L=function(e){s.log(e)},A=function(){s.showLoader(),v=!0;var t=$("#glossaryEditorPopup").find("#glossaryEditorList");w=="inline"&&(t.empty(),t.html("")),d=new i(p,e,t),d.on(GLOSSARY_EVENTS.RENDER_COMPLETE,X)},O=function(){w=="inline"?($(b).html(_.template(c)),$(".GlossaryEditorPopUpTitle",$(b)).html(GLOSSARY_CONSTANTS.BOOK_NAME)):$(b).append(_.template(u)),$("input[name=glossaryEditPreviewToggle]:radio").on("change",function(e){K(e.target.value)})},M=function(){$(b).append(_.template(a)),$(b).append(_.template(f)),D(),$("#glossaryAddWordSaveBtn",$("#glossaryAddNewTermPopupCover")).on("click",{isContinue:!1},nt),$("#glossaryAddWordContinueBtn",$("#glossaryAddNewTermPopupCover")).on("click",{isContinue:!0},nt),$("#glossaryAddNewTermPopupCover").on("click",function(e){e.target.id=="glossaryAddNewTermPopupCover"&&st()}),$("#glossaryCancelBtn",$("#glossaryAddNewTermPopupCover")).on("click",st),$("#closeIcon",$("#glossaryAddNewTermPopupCover")).on("click",st),$(".back-arrow",$("#glossaryAddNewTermPopupCover")).on("click",st),$("#browseImage",$("#glossaryAddNewTermPopupCover")).on("click",function(){$("#imageFile",$("#glossaryAddNewTermPopupCover")).click()}),$("#browseAudio",$("#glossaryAddNewTermPopupCover")).on("click",function(){$("#audioFile",$("#glossaryAddNewTermPopupCover")).click()}),$("#imageFile",$("#glossaryAddNewTermPopupCover")).on("change",function(e){var t=e.currentTarget.files[0].name,n=t.substr(t.lastIndexOf("."),t.length),r=parseInt(e.currentTarget.files[0].size,10);if(n!==".jpeg"&&n!==".jpg"&&n!==".png"){var i={};i.data=$("#glossaryAddNewTermPopupCover"),B(i),s.showToasterMessage(GlossaryEditorLang.FILE_FORMAT_ERROR,3e3);return}if(parseInt(GLOSSARY_CONSTANTS.IMAGE_FILE_LIMIT,10)>0&&r>parseInt(GLOSSARY_CONSTANTS.IMAGE_FILE_LIMIT,10)){s.showToasterMessage(GlossaryEditorLang.FILE_SIZE_ERROR,2e3);var i={};return i.data=$("#glossaryAddNewTermPopupCover"),B(i),!1}$("#selectedImageName",$("#glossaryAddNewTermPopupCover")).html(this.files[0].name),P(this,$("#glossaryAddNewTermPopupCover"))}),$("#audioFile",$("#glossaryAddNewTermPopupCover")).on("change",function(e){var t=e.currentTarget.files[0].name,n=t.substr(t.lastIndexOf("."),t.length),r=parseInt(e.currentTarget.files[0].size,10);if(n!==".mp3"){var i={};i.data=$("#glossaryAddNewTermPopupCover"),I(i),s.showToasterMessage(GlossaryEditorLang.FILE_FORMAT_ERROR,2e3);return}if(parseInt(GLOSSARY_CONSTANTS.AUDIO_FILE_LIMIT,10)>0&&r>parseInt(GLOSSARY_CONSTANTS.AUDIO_FILE_LIMIT,10)){s.showToasterMessage(GlossaryEditorLang.FILE_SIZE_ERROR,2e3);var i={};return i.data=$("#glossaryAddNewTermPopupCover"),I(i),!1}$("#selectedAudioName",$("#glossaryAddNewTermPopupCover")).html(this.files[0].name),j(this,$("#glossaryAddNewTermPopupCover"))}),S.onended=J},D=function(){$("#glossaryEditTermSaveBtn",$("#glossaryEditNewTermPopupCover")).on("click",{isContinue:!1},rt),$("#glossaryCancelBtn",$("#glossaryEditNewTermPopupCover")).on("click",at),$("#closeIcon",$("#glossaryEditNewTermPopupCover")).on("click",at),$(".back-arrow",$("#glossaryEditNewTermPopupCover")).on("click",at),$("#browseImage",$("#glossaryEditNewTermPopupCover")).on("click",function(){$("#imageFile",$("#glossaryEditNewTermPopupCover")).click()}),$("#browseAudio",$("#glossaryEditNewTermPopupCover")).on("click",function(){$("#audioFile",$("#glossaryEditNewTermPopupCover")).click()}),$("#imageFile",$("#glossaryEditNewTermPopupCover")).on("change",function(e){var t=e.currentTarget.files[0].name,n=t.substr(t.lastIndexOf("."),t.length),r=parseInt(e.currentTarget.files[0].size,10);if(n!==".jpeg"&&n!==".jpg"&&n!==".png"){var i={};i.data=$("#glossaryEditNewTermPopupCover"),B(i),s.showToasterMessage(GlossaryEditorLang.FILE_FORMAT_ERROR);return}if(parseInt(GLOSSARY_CONSTANTS.IMAGE_FILE_LIMIT,10)>0&&r>parseInt(GLOSSARY_CONSTANTS.IMAGE_FILE_LIMIT,10)){s.showToasterMessage(GlossaryEditorLang.FILE_SIZE_ERROR,2e3);var i={};return i.data=$("#glossaryAddNewTermPopupCover"),B(i),!1}$("#imageChanged",$("#glossaryEditNewTermPopupCover")).val("true"),$("#selectedImageName",$("#glossaryEditNewTermPopupCover")).html(this.files[0].name),P(this,$("#glossaryEditNewTermPopupCover"))}),$("#audioFile",$("#glossaryEditNewTermPopupCover")).on("change",function(e){var t=e.currentTarget.files[0].name,n=t.substr(t.lastIndexOf("."),t.length),r=parseInt(e.currentTarget.files[0].size,10);if(n!==".mp3"){var i={};i.data=$("#glossaryEditNewTermPopupCover"),I(i),s.showToasterMessage(GlossaryEditorLang.FILE_FORMAT_ERROR);return}if(parseInt(GLOSSARY_CONSTANTS.AUDIO_FILE_LIMIT,10)>0&&r>parseInt(GLOSSARY_CONSTANTS.AUDIO_FILE_LIMIT,10)){s.showToasterMessage(GlossaryEditorLang.FILE_SIZE_ERROR,2e3);var i={};return i.data=$("#glossaryAddNewTermPopupCover"),I(i),!1}$("#audioChanged",$("#glossaryEditNewTermPopupCover")).val("true"),$("#selectedAudioName",$("#glossaryEditNewTermPopupCover")).html(this.files[0].name),j(this,$("#glossaryEditNewTermPopupCover"))})},P=function(e,t){if(e.files&&e.files[0]){var n=new FileReader;n.onload=function(e){H(e.target.result,t)},n.readAsDataURL(e.files[0])}},H=function(e,t){$("#imageSelectionInfo",t).hide(),$("#imagePreview",t).show(),$("#imagePreview",t).attr("src",e),$("#resetImageSelection",t).addClass("inline-block"),$("#resetImageSelection",t).off(),$("#resetImageSelection",t).on("click",t,B)},B=function(e){var t=e.data;t.hasClass("glossaryEditNewTermPopupCover")&&$("#imageChanged",$("#glossaryEditNewTermPopupCover")).val("true");var n=$("#imageFile",t);n.replaceWith(n.val("").clone(!0)),$("#selectedImageName",t).html(""),$("#imagePreview",t).hide(),$("#resetImageSelection",t).removeClass("inline-block"),$("#resetImageSelection",t).off(),$("#resetImageSelection",t).unbind(),$("#imageSelectionInfo",t).show()},j=function(e,t){S.src="",$("#audioPlayPauseImage",t).off();if(e.files&&e.files[0]){var n=new FileReader;n.onload=function(e){F(e.target.result,t)},n.readAsDataURL(e.files[0])}},F=function(e,t){$("#audioSelectionInfo",t).hide(),$("#audioPlayPauseImage",t).addClass("inline-block"),$("#resetAudioSelection",t).addClass("inline-block"),S.src=e,$("#audioPlayPauseImage",t).off(),$("#audioPlayPauseImage",t).removeClass("audioPlayBtn"),$("#audioPlayPauseImage",t).on("click",q),$("#resetAudioSelection",t).bind("click",t,I)},I=function(e){var t=e.data;t.hasClass("glossaryEditNewTermPopupCover")&&$("#audioChanged",$("#glossaryEditNewTermPopupCover")).val("true");var n=$("#audioFile",t);V(),n.replaceWith(n.val("").clone(!0)),$("#selectedAudioName",t).html(""),$("#resetAudioSelection",t).removeClass("inline-block"),$("#audioPlayPauseImage",t).removeClass("inline-block"),$("#audioPlayPauseImage",t).off(),$("#resetAudioSelection",t).unbind(),$("#audioSelectionInfo",t).show()},q=function(e){var t=e.target;S.paused?(S.play(),$(t).addClass("audioPlayBtn")):(V(),$(t).removeClass("audioPlayBtn"))},R=function(e){v?U():A()},U=function(){w=="inline"?$("#glossaryEditorPopupCover").show():$("#glossaryEditorPopupCover").modal("show")},z=function(){v&&(v=!1,$("#glossaryPopupCover").modal("hide"))},W=function(){w!="inline"&&$("#glossaryEditorPopupCover").modal("hide")},X=function(e){var t=null;s.hideLoader(),U(),G(),vt(),dt(),_makeDisable(),$("#glossarySaveBtn",$("#glossaryEditorPopupCover")).on("click",tt),$("#glossaryAddWordBtn",$("#glossaryEditorPopupCover")).on("click",et),$(".delete-term",$("#glossaryEditorPopupCover")).on("click",ft),$(".edit-term",$("#glossaryEditorPopupCover")).on("click",lt),$("#glossaryEditorPopupCover").off("hidden.bs.modal").on("hidden.bs.modal",function(){$("span.audioPlayPauseBtn").removeClass("audioPlayBtn"),V(),v=!1,$("input[name=glossaryEditPreviewToggle]:radio").trigger("click")}),$(".glossaryEditNewTermPopupCover").on("hidden.bs.modal",function(){w=="inline"&&$("input[name=glossaryEditPreviewToggle]:radio").trigger("click");var e={};e.data=$("#glossaryEditNewTermPopupCover"),V(),B(e),I(e)}),$(".glossaryAddNewTermPopupCover").on("hidden.bs.modal",function(){var e={};e.data=$("#glossaryAddNewTermPopupCover"),V(),B(e),I(e)}),$("#glossaryEditorPopupCover").on("shown.bs.modal",function(){Y(),g&&it()}),$("span.audioPlayPauseBtn").off(),$("span.audioPlayPauseBtn").on("click",function(e){var n=e.target,r=$(n).parent().parent().attr("data-id");t!==n&&(S.src=$(n).attr("data-src"),$(S).attr("data-id",r),$(t).removeClass("audioPlayBtn"),t=n),S.paused?(S.play(),$(n).addClass("audioPlayBtn")):($(n).removeClass("audioPlayBtn"),V())}),$("#glossaryEditorPopupCover, .glossaryAddNewTermPopup, .glossaryEditTermPopup").off("paste").on("paste",mt)};_makeDisable=function(){$(".term").length>0?($("#editPreviewToggle").prop("disabled",!1),$("#editPreviewToggle").removeClass("disable")):($("#editPreviewToggle").prop("disabled",!0),$("#editPreviewToggle").addClass("disable"),$("#glossaryList").find("ul").html('<div class="noData"><span class="infoIcon"></span><p>'+GlossaryEditorLang.NO_GLOSSARY_TERM+"</p></div>"))};var V=function(){S&&(S.pause(),S.duration&&(S.currentTime=0))},J=function(){$(".audioPlayPauseBtnAddNewGlossaryTerm.audioPlayBtn").removeClass("audioPlayBtn"),$(".audioPlayPauseBtn.audioPlayBtn").removeClass("audioPlayBtn"),V()},K=function(e){e=="true"?Q():G()},Q=function(){$("#glossaryList").find(".term, .description").attr("contentEditable",!0),$("#glossaryList > ul").addClass("editableBackground"),$("#glossarySaveBtn",$("#glossaryEditorPopupCover")).show(),$("#glossaryAddWordBtn",$("#glossaryEditorPopupCover")).hide(),$(".delete-term,.delete-heading",$("#glossaryEditorPopupCover")).show(),$(".delete-term,.edit-term",$("#glossaryEditorPopupCover")).show(),$(".glossaryEditorPopup .button-label:contains('Edit')").addClass("activeMode"),$(".glossaryEditorPopup .button-label:contains('Preview')").removeClass("activeMode"),J(),Z()},G=function(){$("#glossaryList").find(".term, .description").attr("contentEditable",!1),$("#glossaryList>ul").removeClass("editableBackground"),$("#glossarySaveBtn",$("#glossaryEditorPopupCover")).hide(),$("#glossaryAddWordBtn",$("#glossaryEditorPopupCover")).show(),$(".delete-term,.edit-term",$("#glossaryEditorPopupCover")).hide(),$(".glossaryEditorPopup .button-label:contains('Preview')").addClass("activeMode"),$(".glossaryEditorPopup .button-label:contains('Edit')").removeClass("activeMode"),J(),Y(),tt()},Y=function(){var e=$(".description",$("#glossaryList"));_.each(e,function(e){var t=e.scrollHeight,n=parseInt($(e).css("line-height"),10),r=n*T;parseInt(t)>r&&($(e).parent().find(".more-less-definition").show(),$(e).css("height",r+"px"),$(e).css("overflow","hidden"))})},Z=function(){var e=$(".description",$("#glossaryList"));_.each(e,function(e){$(e).parent().find(".more-less-definition").hide(),$(e).parent().find(".more-less-definition").html(GlossaryReaderLang.MORE_LABEL),$(e).css("height","auto"),$(e).css("overflow","auto")})},et=function(){$(".glossaryAddNewTermPopupCover").modal("show"),W(),$("#inputWord",$("#glossaryAddNewTermPopupCover")).val(""),$("#inputDescription",$("#glossaryAddNewTermPopupCover")).val("")},tt=function(e){var t=p.clone(p,!0),n={success:function(n){s.log("updated glossary"),s.hideLoader(),s.showToasterMessage(GlossaryEditorLang.CHANGED_SUCCESSFULLY),_.each(t.models,function(e){p.get(e.id).set({dirty:!1})}),typeof e=="function"&&e()},error:function(e){s.log(e)}};t.url=GLOSSARY_CONSTANTS.SERVICE_BASE_URL+"book/"+GLOSSARY_CONSTANTS.BOOK_ID+"/glossary",t.models.length>0&&(s.showLoader(),t.sync("update",t,n));var r={success:function(e){s.hideLoader(),s.showToasterMessage(GlossaryEditorLang.DELETED_SUCCESSFULLY),m=[],$(".term").length>0||($("input[name=glossaryEditPreviewToggle]:radio").trigger("click"),_makeDisable())},error:function(e){s.log(e)},deletedItems:JSON.stringify(m)};m.length>0&&(s.showLoader(),p.url=GLOSSARY_CONSTANTS.SERVICE_BASE_URL+"book/"+GLOSSARY_CONSTANTS.BOOK_ID+"/glossary",p.sync("delete",p,r))},nt=function(e){var t,n;J(),e&&(t=e.data.isContinue);var r=pt($("#glossaryAddNewTermPopupCover"));if(!r)return;var i=$("#inputWord",$("#glossaryAddNewTermPopupCover")).val().trim(),n=GC.find(function(e){return e.get("term").toLowerCase()==i.toLowerCase()});if(n){s.showAlert(GlossaryEditorLang.TERM_ALREADY_EXIST);return}var o=$("#inputDescription",$("#glossaryAddNewTermPopupCover")).val().trim();o=o.replace(/\r?\n/g,"<br />");var u={term:i,description:o},a=$("#add-glossary",$("#glossaryAddNewTermPopupCover"))[0],f=new FormData(a),l={success:function(e){typeof e=="string"&&(e=JSON.parse(e)),e.id&&p.add([{term:e.term,description:u.description,id:e.id,audiofiles:e.audiofiles,imagefiles:e.imagefiles}]);if(t){$("#inputWord",$("#glossaryAddNewTermPopupCover")).val(""),$("#inputDescription",$("#glossaryAddNewTermPopupCover")).val("");var n={};n.data=$("#glossaryAddNewTermPopupCover"),B(n),I(n)}else ct(),g=e.term;s.hideLoader()},error:function(e){s.hideLoader()}};s.showLoader(),l.data=f,p.url=GLOSSARY_CONSTANTS.SERVICE_BASE_URL+"/book/"+GLOSSARY_CONSTANTS.BOOK_ID+"/addMediaGlossary.excel",p.sync("create",p,l)},rt=function(e){var t,n;J(),e&&(t=e.data.isContinue);var r=pt($("#glossaryEditNewTermPopupCover"));if(!r)return;var i=$("#inputWord",$("#glossaryEditNewTermPopupCover")).val().trim(),n=GC.find(function(e){return e.get("term").toLowerCase()==i.toLowerCase()}),o=$("#inputDescription",$("#glossaryEditNewTermPopupCover")).val().trim();o=o.replace(/\r?\n/g,"<br />");var u=$("#glossaryEditNewTermPopupCover").attr("current-model-id"),a={term:i,description:o,id:u},f=$("#add-glossary",$("#glossaryEditNewTermPopupCover"))[0],l=new FormData(f);l.append("id",a.id);var c={success:function(e){typeof e=="string"&&(e=JSON.parse(e));var n=p.get(e.id);e.id&&n.set({term:e.term,description:a.description,id:e.id,audiofiles:e.audiofiles,imagefiles:e.imagefiles}),t?($("#inputWord",$("#glossaryEditNewTermPopupCover")).val(""),$("#inputDescription",$("#glossaryEditNewTermPopupCover")).val("")):(console.log(e),$("#glossaryEditNewTermPopupCover").modal("hide"),d.remove(),A(),U(),g=e.term),s.hideLoader()},error:function(e){console.log(e),s.hideLoader()}};s.showLoader(),c.data=l,p.url=GLOSSARY_CONSTANTS.SERVICE_BASE_URL+"/book/"+GLOSSARY_CONSTANTS.BOOK_ID+"/updateMediaGlossary.excel",p.sync("create",p,c)},it=function(){var e=$("#glossaryList"),t=$("#glossaryList .heading[data-term = "+g+"]");e.animate({scrollTop:t.offset().top-e.offset().top+e.scrollTop()}),g=null},st=function(){V();var e=$("#inputWord",$("#glossaryAddNewTermPopupCover")).val(),t=$("#inputDescription",$("#glossaryAddNewTermPopupCover")).val();if(e==""&&t==""){ct();return}s.showConfirmPopUp(GlossaryEditorLang.SAVE_TERM_CONFIMATION_MESSAGE,GlossaryEditorLang.SAVE_CONFIMATION_TITLE,"",function(e){if(e.toLowerCase()==="yes")nt();else{if(e.toLowerCase()!=="no")return;s.hideLoader(),ct()}})},ot=function(){var e=p.clone(p,!0);return e},ut=function(e){var t=ot();_.delay(function(){t.length>0?s.showConfirmPopUp(GlossaryEditorLang.SAVE_TERM_CONFIMATION_MESSAGE,GlossaryEditorLang.SAVE_CONFIMATION_TITLE,"",function(t){if(t.toLowerCase()==="yes")tt(e);else{if(t.toLowerCase()!=="no")return;s.hideLoader(),e()}}):e()},100)},at=function(){V();var e=$("#inputWord",$("#glossaryEditNewTermPopupCover")).val(),t=$("#inputDescription",$("#glossaryEditNewTermPopupCover")).val();if(e==""&&t==""){ht();return}$("#confirmPopupCover").appendTo($(b)),s.showConfirmPopUp(GlossaryEditorLang.SAVE_TERM_CONFIMATION_MESSAGE,GlossaryEditorLang.SAVE_CONFIMATION_TITLE,"",function(e){if(e.toLowerCase()==="yes")rt();else{if(e.toLowerCase()!=="no")return;s.hideLoader(),ht()}})},ft=function(e){var t=$(e.target).parent().parent(),n=t.parent(),r=t.data("id");r==$(S).attr("data-id")&&J(),m.push({id:""+r}),t.remove();var i=n.find("ul");if(i.length==0){var s=n.attr("id").toLowerCase();$("[id = "+s+"anchor").addClass("disable"),n.remove()}p.remove(p.get(r))},lt=function(e){var t=$(e.target).parent().parent();$("#audioPlayPauseImage").off(),$("#resetImageSelection").off(),V(),$(".glossaryEditNewTermPopupCover").modal("show"),W();var n=t.data("id");$("#glossaryEditNewTermPopupCover").attr("current-model-id",n);var r=p.get(n).attributes,i=r.imagefiles,s=r.audiofiles;$("#inputWord",$("#glossaryEditNewTermPopupCover")).val(r.term),$("#inputDescription",$("#glossaryEditNewTermPopupCover")).val(r.description),$("#selectedImageName",$("#glossaryEditNewTermPopupCover")).html(i.substring(i.lastIndexOf("/")+1,i.length)),$("#selectedAudioName",$("#glossaryEditNewTermPopupCover")).html(s.substring(s.lastIndexOf("/")+1,s.length)),$("#imageChanged",$("#glossaryEditNewTermPopupCover")).val("false"),$("#audioChanged",$("#glossaryEditNewTermPopupCover")).val("false"),r.imagefiles&&H(GLOSSARY_CONSTANTS.CONTENT_BASE_URL+"/"+r.imagefiles,$("#glossaryEditNewTermPopupCover")),r.audiofiles&&F(GLOSSARY_CONSTANTS.CONTENT_BASE_URL+"/"+r.audiofiles,$("#glossaryEditNewTermPopupCover"))},ct=function(e){var t={};t.data=$("#glossaryAddNewTermPopupCover"),$("#inputWord",$("#glossaryAddNewTermPopupCover")).val(""),$("#inputDescription",$("#glossaryAddNewTermPopupCover")).val(""),B(t),I(t),$("#glossaryAddNewTermPopupCover").modal("hide"),d.remove(),A(),U()},ht=function(){var e={};e.data=$("#glossaryEditNewTermPopupCover"),$("#inputWord",$("#glossaryEditNewTermPopupCover")).val(""),$("#inputDescription",$("#glossaryEditNewTermPopupCover")).val(""),B(e),I(e),$("#glossaryEditNewTermPopupCover").modal("hide"),d.remove(),A(),U()},pt=function(e){var t=$("#inputWord",e).val(),n=$("#inputDescription",e).val();return t.trim()==""?(s.showAlert(GlossaryEditorLang.TERM_VALIDATION_MESSAGE),!1):n.trim()==""?(s.showAlert(GlossaryEditorLang.DEFINITION_VALIDATION_MESSAGE),!1):!0},dt=function(){$("#glossaryList").on("keyup","[contenteditable]",function(){var e=$(this),t=e.parent().data("id"),n=p.get(t),r=e.data("key"),i=new Object,o=e.html().replace(/&nbsp;/g," ");i[r]=o.trim();if(i[r]==""){e.blur(),s.showToasterMessage(GlossaryEditorLang.YOU_CANNOT_SAVE_BLANK_MESSAGE+r),e.focus();return}i.dirty=!0,n.set(i),E=[],_.each(p.models,function(e){E.push(p.get(e.id).get("term"))}),_.indexOf(E,i.term)!==_.lastIndexOf(E,i.term)?$("#glossarySaveBtn").unbind().hide():($("#glossarySaveBtn").unbind().show(),$("#glossarySaveBtn",$("#glossaryEditorPopupCover")).on("click",tt))})},vt=function(){$("#glossaryList").find(".term, .description").on("keyup mouseup",function(){!this.lastChild||this.lastChild.nodeName.toLowerCase()!="br"}).on("keydown",function(e){if(e.which==13&&window.getSelection){var t=window.getSelection(),n=t.getRangeAt(0),r=document.createElement("br");return n.deleteContents(),n.insertNode(r),n.setStartAfter(r),n.setEndAfter(r),n.collapse(!1),t.removeAllRanges(),t.addRange(n),!1}})},mt=function(e){e.preventDefault();var t=undefined;window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.originalEvent.clipboardData&&e.originalEvent.clipboardData.getData&&(t=e.originalEvent.clipboardData.getData("text/plain"));if(t){t="<span>"+t+"</span>";var n=s.removeNbsp($(t.toString()).text()),r=$(e.target).text();gt(n,$(e.target))}},gt=function(e,t){var n,r,i;if(window.getSelection){n=window.getSelection();if(n.getRangeAt&&n.rangeCount){r=n.getRangeAt(0),t.get(0).nodeName==="INPUT"||t.get(0).nodeName==="TEXTAREA"?i=$(t):i="",r.deleteContents();var s=document.createElement("span");s.innerHTML=e;var o=document.createDocumentFragment(),u,a;while(u=s.firstChild)a=o.appendChild(u);if(i.length>0){var f=i.get(0).selectionStart,l=i.get(0).selectionEnd,c=i.val(),h=$(a).text(),p="";p=yt(c,h,f),i.val(p),bt(f+h.length,i.get(0))}else r.insertNode(o);a&&i.length===0&&(r=r.cloneRange(),r.setStartAfter(a),r.collapse(!0),n.removeAllRanges(),n.addRange(r))}}else document.selection&&document.selection.type!="Control"&&document.selection.createRange().pasteHTML(e)},yt=function(e,t,n){return e.slice(0,n)+t+e.slice(n)},bt=function(e,t){typeof t.selectionStart=="number"&&typeof t.selectionEnd=="number"&&(t.selectionStart=e,t.selectionEnd=e)},wt=function(){var e=GLOSSARY_CONSTANTS.AUDIO_FILE_LIMIT,t=GLOSSARY_CONSTANTS.IMAGE_FILE_LIMIT,n,r,i,s;e>0&&(i=Et(e),n=AppLang.FILE_SIZE_INFO+" "+i+AppLang.MEGABYTE_ABBR,$("#gsAddAudioFileSizeInfo, #gsEditAudioFileSizeInfo",b).text(n)),t>0&&(s=Et(t),r=AppLang.FILE_SIZE_INFO+" "+s+AppLang.MEGABYTE_ABBR,$("#gsAddImageFileSizeInfo, #gsEditImageFileSizeInfo",b).text(r))},Et=function(e){return e/1048576},St=Backbone.View.extend({initialize:function(){GLOSSARY_CONSTANTS.ROOT_URL=location.href.split("#")[0],GLOSSARY_CONSTANTS.ROOT_PATH=window.location.pathname.split("/")[1],GLOSSARY_CONSTANTS.SERVICE_BASE_URL=window.location.origin+"/"+GLOSSARY_CONSTANTS.ROOT_PATH+"/pubservice/"},init:function(e){n===undefined?(_.extend(this,Backbone.Events),n=this,b=e.container,GLOSSARY_CONSTANTS.BOOK_ID=e.bookId,GLOSSARY_CONSTANTS.BOOK_NAME=e.bookName,w=e.mode,e.audioFileLimit&&(GLOSSARY_CONSTANTS.AUDIO_FILE_LIMIT=parseInt(e.audioFileLimit,10)),e.imageFileLimit&&(GLOSSARY_CONSTANTS.IMAGE_FILE_LIMIT=parseInt(e.imageFileLimit,10)),s.log("initialize -- ",n),N(e.contentBaseUrl)):s.log("instance already created")},show:R,hide:z,checkUnsavedData:ut});return new St};return window.GlossaryEditor=new h,window.GlossaryEditor}),define("com/es/quizEditor/QuizEditorConstants",[],function(){return window.QUIZ_EDITOR_CONSTANTS||(window.QUIZ_EDITOR_CONSTANTS={BOOK_ID:"",ROOT_URL:"",ROOT_PATH:"",SERVICE_BASE_URL:"",QUESTION_ASSET_BASE_PATH:"",MCQ_SINGLE_RESPONSE_QUESTION_TYPE_ID:101,MCQ_MULTIPLE_RESPONSE_QUESTION_TYPE_ID:102,FIB_TEXT_QUESTION_TYPE_ID:103,FIB_TAP_AND_PLACE_QUESTION_TYPE_ID:104,FIB_DROP_DOWN_QUESTION_TYPE_ID:105,MATCHING_QUESTION_TYPE_ID:106,GROUPING_QUESTION_TYPE_ID:107,TRUE_OR_FALSE_QUESTION_TYPE_ID:108,COLLECTION_QUESTION_TYPE_ID:109,ALL_QUESTION_TYPE_ID:0,QUES_ID:"",MAX_TITLE_LENGTH:500}),window.QUIZ_EDITOR_CONSTANTS}),define("com/es/text!templateBasePath/Editor/quiz/baseTemplate.html",[],function(){return'<div class="quiz-editor-popup">\r\n	<div class="header modal-header question-tabs">				\r\n				<span type="button" id="editBtn" class="active" ><%=AppLang.EDIT_LABEL%> </span>\r\n				<span type="button" id="previewBtn" class="" ><%=AppLang.SAVE_AND_PREVIEW%> </span>\r\n	</div>	\r\n	<div id="modal-body" class="quiz-container">\r\n		<div class="activity-container"> </div>\r\n		<div class="preview-container-title" style="display: none"> </div>\r\n		<div class="preview-container" style="display: none"> </div>\r\n		<div class="modal-footer activityFooter">	\r\n			<div>\r\n				 <button type="button" class="doneBtn"><%=AppLang.SAVE_LABEL%> </button>		       			\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/quiz/FIBDropdownTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n	<div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<%=title %>\r\n	</div>\r\n    <span class="activityType"><%=AppLang.EDIT_FIB_DROPDOWN%></span>\r\n</div>\r\n\r\n<div class="rubric-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n	<div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% _.each(rubric, function(item, i){ %>\r\n			<%=item.data %>\r\n			 <% }); %>\r\n	</div>\r\n</div>\r\n\r\n\r\n<div class="question-text-Wrapper">\r\n<span class="formLabel"><%=AppLang.QUESTION_TEXT_LABEL_FIB%></span>\r\n<div class="question-option-Wrapper questionContentWrapper" id="question-option-Wrapper">\r\n	<div class="question-option fib-dropdown add-img questionText formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% var gapCount = 0 %>\r\n		<% _.each(questionBody, function(item, i){ %>\r\n		<% if(item == "GAP"){ %>\r\n			<div data-name="fillup" class="data-values-activity-fill FIB_dropdown" contenteditable="false"><span id="dd<%=gapCount%>" class=" FIBtext spantext" contenteditable="false"><%=options[gapCount][answers[gapCount][0]].data%></span><div class="close-pop remove-option"></div></div>\r\n			<% gapCount++ %>\r\n		<%	}else{	%>\r\n				<%if(item.type === "text" && (item.data)){%>\r\n					<%=item.data%>\r\n					<%} else if(item.type === "image"){%>					\r\n								<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />													\r\n					<% } %>\r\n			<%	}%>\r\n			<% }); %>\r\n	</div>\r\n</div>\r\n</div>\r\n    		\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>	\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>	\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>  '}),define("com/es/text!templateBasePath/Editor/quiz/FIBDropdown_option_template.html",[],function(){return'<div class="add_dropdown_options editor-popup modal in" data-backdrop="static">\r\n	<div class="modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n	            <ul class="answerOptions">\r\n                    <li class="text-left"><div class="title modal-title"><%=AppLang.ADD_ALTERNATIVES_LABEL%></div></li>\r\n                    <li class="text-right"><button class="addIcon btn-add"><%=AppLang.ADD_TEXT%> </button></li>\r\n                </ul>\r\n			</div>	\r\n			<div id="modal-body" class="quiz-container popup-content-spacing">\r\n				<div class="activity-container"> \r\n					<div id="question-options">\r\n						<ul>\r\n							<% _.each(options, function(item, i){ %>\r\n								<li class=\'option-div\' id="li<%=i %>">	\r\n										<span class="dragIcon"></span>			\r\n										<!-- <div class="numbering"><%=i+1 %>)</div>-->\r\n                                     <div class="formPlaceholder">\r\n											 <input type=\'radio\' id="option<%=i%>" class="css-radio"  value=\'<%=i %>\' name=\'options\' <%= (answers.indexOf(i)	 											 > -1)?"checked=true":"" %>></input>\r\n                                             <label class="css-radio-label" for="option<%=i%>" ></label>\r\n										<div class="option-text add-img " contenteditable="true" spellcheck="false" role="textbox">\r\n												<%=item.data %>\r\n										 	</div>				 \r\n                                            </div>\r\n										 <div class="addremove-btn">\r\n						        			\r\n						        			<span class="removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>\r\n						       			 </div>	   		\r\n								</li>\r\n							 <% }); %>\r\n						</ul>\r\n					</div>\r\n\r\n					</div>\r\n	   \r\n				<div class="modal-footer activityFooter">	\r\n					<div>\r\n						 <button type="button" class="cancelBtn" ><%=AppLang.CANCEL_LABEL%> </button>\r\n		       			 <button type="button" class="doneBtn"  ><%=AppLang.DONE_LABEL%> </button>	\r\n					</div>\r\n				</div>\r\n			</div> \r\n		</div>\r\n	</div>\r\n</div> \r\n\r\n    	'}),define("com/es/quizEditor/models/QuestionEditorModel",[],function(){var e=Backbone.Model.extend({defaults:{id:null,metadata:"",answers:[],heading:[],leftCol:[],modelParagraph:"",options:[],optionsLayout:"",questionBody:[],questionLayout:"",responseType:"BUTTON",rightCol:[],rubric:[],questionMedia:[],optionsMedia:[],title:"",maxpoints:[""],type:""},url:function(){return"./com/es/quizEditor/data/MCQ_DefaultQuestionData.json"},sync:function(e,t,n){n||(n={});var r;switch(e){case"create":r="POST",questionData=t;break;case"update":r="PUT",questionData=t;break;case"delete":break;case"read":r="get",questionData={}}$.ajax({url:this.url,type:r,dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(questionData),success:n.success,error:n.error})}});return e}),define("com/es/quizEditor/views/DropdownOptionsEditView",["com/es/text!templateBasePath/Editor/quiz/FIBDropdown_option_template.html","com/es/utilities/utils"],function(e,t){var n=Backbone.View.extend({el:null,data:null,isDirty:!1,events:{},initialize:function(e){_.extend(this,Backbone.Events),_.bindAll(this,"render","addOption","removeOption","updateOptions","handleDoneClick","handleCancelClick")},render:function(n){this.options=n||{};var r=_.template(e,this.options.data);$(this.options.container).after(r),this.el=$(".add_dropdown_options");var i=this;$(this.el).on(AppEvent.CLICK,".addIcon",this.addOption),$(this.el).on(AppEvent.CLICK,".removeIcon",this.removeOption),$(this.el).on(AppEvent.CLICK,".doneBtn",this.handleDoneClick),$(this.el).on(AppEvent.CLICK,".cancelBtn",this.handleCancelClick),$(this.el).on(AppEvent.CHANGE,i.correctOptionChanged.bind(i)),$(".option-div").on(AppEvent.INPUT_PROPERTY_CHANGE,function(){i.isDirty=!0}),t.makeOptionsSortable("div#question-options > ul","#question-options",this.updateOptions),$(this.el).modal("show")},correctOptionChanged:function(){this.isDirty=!0},addOption:function(e){this.isDirty=!0;var t=$("ul","#question-options").children().first(),n=t.clone(),r=parseInt($("ul","#question-options").children().length);$(n.children().get(1)).find("input").attr("id","option"+parseInt(r+1)),$(n.children().get(1)).find("label").attr("for","option"+parseInt(r+1)),n.find(".option-text").html(AppLang.NEW_OPTION_LABEL),n.find("input[name=options]").removeAttr("checked"),t.before(n),this.updateOptions()},removeOption:function(e){this.isDirty=!0;var n=$(".option-div",this.el);if(n.length>2){var r=$(e.target.parentNode.parentNode);r.remove(),this.updateOptions()}else t.showToasterMessage(AppLang.DROPDOWN_MIN_OPTION_TEXT)},updateOptions:function(){this.isDirty=!0;var e=$(".option-div",this.el);_.each(e,function(e,t){$(e).attr("id","li"+t),$(e).find(".numbering").html(t+1+")"),$(e).find("input[name=options]").val(t)})},handleDoneClick:function(){this.isDirty=!1;var e=$("input[name=options]",this.el),n=$("input[name=options]:checked",this.el);if(n.length<1){t.showToasterMessage(AppLang.DROPDOWN_SELECT_ANSWER_TEXT);return}var r=[];_.each(n,function(e){r.push(parseInt($(e).val()))});var i=$(".option-text",this.el),s=[];for(var o=0;o<i.length;o++){var u=/ style.*?=.*('|").*?('|")/ig,a=$(i[o]).html().replace(/&nbsp;/g," ").replace(u,"").trim();if(a==AppLang.NEW_OPTION_LABEL){t.showToasterMessage(AppLang.EDIT_OPTION_TEXT);return}if(a==""){t.showToasterMessage(AppLang.BLANK_OPTION_TEXT);return}s.push({data:a,type:"text"})}var f=s[r[0]].data;$(this.options.elem).attr("data-options",JSON.stringify(s)),$(this.options.elem).attr("data-answers",JSON.stringify(r)),$(".selectedFIB").removeClass("selectedFIB"),$(this.el).modal("hide");var l=this;_.delay(function(){$(l.el).remove()},100);var a={answer:f,elem:this.options.elem};this.trigger("options_updated",a)},handleCancelClick:function(){var e=this;this.isDirty===!0?t.showConfirmPopUp(AppLang.SAVE_WIDGET_CONFIMATION_MESSAGE,"Confirm",["cancel"],function(t){if(t.toLowerCase()!=="yes")return;e.isDirty=!1,$(".selectedFIB").removeClass("selectedFIB"),_.delay(function(){$(e.el).modal("hide"),_.delay(function(){$(e.el).remove()},100)},70)}):(e.isDirty=!1,$(".selectedFIB").removeClass("selectedFIB"),_.delay(function(){$(e.el).modal("hide"),_.delay(function(){$(e.el).remove()},100)},70))}});return n}),define("com/es/quizEditor/views/FIBDropDownEditView",["com/es/text!templateBasePath/Editor/quiz/FIBDropdownTemplate.html","com/es/text!templateBasePath/Editor/quiz/FIBDropdown_option_template.html","com/es/quizEditor/models/QuestionEditorModel","com/es/quizEditor/views/DropdownOptionsEditView","com/es/utilities/utils","com/es/utilities/services"],function(e,t,n,r,i,s){var o=function(t){var o=null,u=null,a=null,f=null,l="",c=null,h=[],p=!1,d=function(){var t=f.attributes,n=_.template(e,t);$(".activity-container",u).html(n),$(".header > div.title",u).html(AppLang.EDIT_ACTIVITY+AppLang.EDIT_FIB_DROPDOWN),c=new r,c.on("options_updated",b);var i=$(".FIB_dropdown",u);_.each(i,function(e,n){$(e).attr("data-options",JSON.stringify(t.options[n])),$(e).attr("data-answers",JSON.stringify(t.answers[n]))}),o.trigger("render_complete")},v=function(e,t,n){$(t).addClass("FIB_dropdown"),$(t).find(".spantext").addClass("FIBtext");var r=[{data:n,type:"text"},{data:AppLang.NEW_OPTION_LABEL,type:"text"}];$(t).attr("data-options",JSON.stringify(r)),$(t).attr("data-answers","[0]")},m=function(e){l=e;var t=function(t){e?f=new n(t.questionsData[0]):f=new n(t),d()},r=function(e){console.log(e)},i=require.toUrl("./com/es/quizEditor/data/FIBDropdownDefaultQuestionData.json"),o=e?e:i,u={url:o,successCallback:t,errorCallback:r};s.fetchQuestionData(u)},g=function(e){if(p==1)return;p=!0;var t=e.target;$(t).hasClass("FIBtext")&&(t=t.parentNode),$(t).addClass("selectedFIB");if(!$(t).attr("data-options"))var n={options:[{data:"Option 1",type:"text"},{data:"Option 2",type:"text"}],answers:[]};else var n={options:JSON.parse($(t).attr("data-options")),answers:JSON.parse($(t).attr("data-answers"))};var r={elem:t,container:u,data:n};$(e.target).parent().parent().hasClass("question-option")?$(e.target).parent().parent().blur():$(e.target).parent().parent().hasClass("question-option-Wrapper")&&$(e.target).parent().blur(),_.delay(function(){c.render(r),_.delay(y,500)},150),$(".add_dropdown_options").modal("show")},y=function(){p=!1},b=function(e){$(e.elem).find(".spantext").html(e.answer)},w=function(e,t,n){var r=0,i=e.length,s,o=[];n||(t=t.toLowerCase(),e=e.toLowerCase());while((s=t.indexOf(e,r))>-1)o.push(s),r=s+i;return o},E=function(){activityDiv=$(".activity-container",u);var e=$(".question-title",activityDiv).html().trim(),t=!1;e=i.removeNbsp(e),t=i.userInputValidator($(".question-title",activityDiv),!1);if(!t)return i.showToasterMessage(AppLang.BLANK_TITLE),!1;var n=[],r=!1,s="",o;h=[];var a=$(".question-option",activityDiv).clone(),l=$(a).find("img"),c=$(a).find(".data-values-activity-fill");_.each(c,function(e){c.after("[GAP]"),c.remove()}),_.each(l,function(e){var t={},r=$(e);n.push(r.attr("src")),t.id=r.attr("data-id"),t.name=r.attr("src").substr(r.attr("src").lastIndexOf("/")+1,r.attr("src").length),h.push(t)}),_.each(l,function(e){l.after("[IMAGE]"),l.remove()});var p=$(a).html();t=i.userInputValidator($(a),!0);if(!t)return i.showToasterMessage(AppLang.BLANK_QUESTION_TEXT),!1;if(r)return i.showToasterMessage(AppLang.BLANK_FIB_TEXT),!1;var d=p.split("[GAP]"),v=[];for(var m=0;m<d.length;m++)if(m!=d.length-1&&d[m]=="")v.push("GAP");else{var g=d[m].indexOf("[IMAGE]"),y=d[m],b="",w=0;if(g>=0){while(g>=0){b=y.substr(w,g),b=i.removeNbsp(b),y=y.substr(g+7,y.length),g=y.indexOf("[IMAGE]"),v.push({data:b,type:"text"}),o=n.shift();var E;$("img[src='"+o+"']").length>0&&(E=$($("img[src='"+o+"']").get(0)).attr("data-id")),s=o.substr(o.lastIndexOf("/")+1,o.length),v.push({data:s,type:"image",id:E})}y=i.removeNbsp(y),v.push({data:y,type:"text"})}else d[m]=i.removeNbsp(d[m]),v.push({data:d[m],type:"text"});m!=d.length-1&&v.push("GAP")}var S=$(".rubric-text",activityDiv).html().trim(),x=[];S!=""&&(S=i.removeNbsp(S),x=[{data:S,type:"text"}]);var T=$(".metadata",activityDiv).html().trim();T=i.removeNbsp(T);var N=[],C=[],c=$(".FIB_dropdown",u);if(c.length===0)return i.showToasterMessage(AppLang.BLANK_MIN_TEXT),!1;_.each(c,function(e,t){C.push(JSON.parse($(e).attr("data-options"))),N.push(JSON.parse($(e).attr("data-answers")))}),QUIZ_EDITOR_CONSTANTS.QUES_ID&&(f.attributes.id=QUIZ_EDITOR_CONSTANTS.QUES_ID);var k=f.attributes;return k.answers=N,k.options=C,k.questionBody=v,k.rubric=x,k.title=e,k.metadata=T,f.attributes=k,f.attributes},S=function(e,t){var n,r,s,u;r=function(e){e.status===!0?o.trigger(AppEvent.QUESTION_CREATED,e.url):e.status===!1&&i.showToasterMessage(AppLang.QUESTION_SAVE_ERROR)},s=function(e){console.log(e)},u={url:QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID,success:r,error:s},l=t,l?(n="update",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/book/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"/question/"+QUIZ_EDITOR_CONSTANTS.QUES_ID):(n="create",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID),h=_.uniq(h,function(e){return JSON.stringify(e)});var a={};a.title=f.get("title"),a.questionType=QUIZ_EDITOR_CONSTANTS.FIB_DROP_DOWN_QUESTION_TYPE_ID,a.assetIds=h,a.questionsData=e,f.sync(n,a,u)},x=function(e){e.stopPropagation();if($(e.target).siblings().hasClass("FIBtext")){var t=$(e.target).siblings().text();$(e.target).parent().after(" "+t).remove()}},T=function(e){parseInt($(".question-title").text().length)>=QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&e.preventDefault()},N=Backbone.View.extend({events:{"click .FIB_dropdown":g,"click .data-values-activity-fill > .remove-option":x,"keypress .question-title":T},initialize:function(e){o=this,a=e||{},u=a.el},fetchData:m,syncData:S,handleDoneClick:E,fibAnswerAdded:v});return new N(t)};return o}),define("com/es/text!templateBasePath/Editor/quiz/FIBTextTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n	<div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<%=title%>\r\n	</div>\r\n    <span class="activityType"><%=AppLang.EDIT_FIB_TEXT%></span>\r\n</div>\r\n\r\n\r\n<div class="rubric-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n	<div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% _.each(rubric, function(item, i){ %>\r\n			<%=item.data %>\r\n			 <% }); %>\r\n	</div>\r\n</div>\r\n\r\n<div class="question-text-Wrapper">\r\n<span class="formLabel"><%=AppLang.QUESTION_TEXT_LABEL_FIB%></span>\r\n<div class="question-option-Wrapper questionContentWrapper " id="question-option-Wrapper">\r\n	<div class="question-option fib-option add-img questionText formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% var gapCount = 0 %>\r\n		<% _.each(questionBody, function(item, i){ %>\r\n		<% if(item === "GAP"){ %>\r\n			<div data-name="fillup" class="data-values-activity-fill fib-text-blank" contenteditable="false"><span class="FIBtext spantext" contenteditable="false"><%=answers[gapCount][0]%></span><div class="close-pop remove-option"></div></div>\r\n			<% gapCount++ %>\r\n		<%	}else{	%>\r\n				<%if(item.type === "text" && (item.data)){%>\r\n					<%=item.data%>\r\n					<%} else if(item.type === "image"){%>					\r\n								<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />													\r\n					<% } %>\r\n			<%	}%>\r\n			<% }); %>\r\n	</div>\r\n</div>\r\n</div>\r\n\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>	\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>	\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/quiz/FIBText_option_template.html",[],function(){return'<div class="add_fib_options editor-popup modal in" data-backdrop="static">\r\n	<div class="modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="header modal-header">\r\n            <ul class="answerOptions">\r\n            	<li class="text-left"><div class="title modal-title"><%=AppLang.ADD_LABEL%></div></li>\r\n                <li class="text-right"><button class="addIcon btn-add"><%=AppLang.ADD_TEXT%> </button></li>\r\n            </ul>\r\n			</div>	\r\n			<div id="modal-body" class="quiz-container popup-content-spacing">\r\n				<div class="activity-container"> \r\n					<div id="question-options">\r\n						<ul>\r\n							<% _.each(options, function(item, i){ %>\r\n								<li class=\'option-div\' id="li<%=i %>">	\r\n									<!--<span class="dragIcon"></span>	-->		\r\n									<!--<div class="numbering"><%=i+1 %>)</div>-->\r\n									<div class="option-text add-img formPlaceholder" contenteditable="true" spellcheck="false" role="textbox"><%=item%></div>				 \r\n									<div class="addremove-btn">										\r\n										<span class="removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>\r\n									</div>	   		\r\n								</li>\r\n							<% }); %>\r\n						</ul>\r\n					</div>\r\n				</div>\r\n				<div class="modal-footer activityFooter">	\r\n					<div>\r\n						<button type="button" class="cancelBtn" ><%=AppLang.CANCEL_LABEL%> </button>\r\n		       			<button type="button" class="doneBtn"  ><%=AppLang.DONE_LABEL%> </button>	\r\n					</div>\r\n				</div>\r\n			</div> \r\n		</div>\r\n	</div>\r\n</div>'}),define("com/es/quizEditor/views/FIBOptionsEditView",["com/es/text!templateBasePath/Editor/quiz/FIBText_option_template.html","com/es/utilities/utils"],function(e,t){var n=function(n){var r=null,i=null,s=!1,o=function(n){i=n||{};var o=_.template(e,i.data);$(i.container).after(o),r=$(".add_fib_options"),t.makeOptionsSortable("div#question-options > ul","#question-options",f),$(r).modal("show"),$(r).on(AppEvent.CLICK,".addIcon",u),$(r).on(AppEvent.CLICK,".removeIcon",a),$(r).on(AppEvent.CLICK,".doneBtn",l),$(r).on(AppEvent.CLICK,".cancelBtn",c),$(".option-text").on(AppEvent.INPUT_PROPERTY_CHANGE,function(){s=!0})},u=function(e){s=!0;var t=$("ul","#question-options").children().first(),n=t.clone();n.find(".option-text").html(AppLang.NEW_OPTION_LABEL),t.before(n),f()},a=function(e){s=!0;var n=$(".option-div",r);if(n.length>1){var i=$(e.target.parentNode.parentNode);i.remove(),f()}else t.showToasterMessage(AppLang.FIB_MIN_OPTION_TEXT)},f=function(){s=!0;var e=$(".option-div",r);_.each(e,function(e,t){$(e).attr("id","li"+t),$(e).find(".numbering").html(t+1+")")})},l=function(){s=!1;var e=$(".option-text",r),n=[];for(var o=0;o<e.length;o++){var u=/ style.*?=.*('|").*?('|")/ig,a=$(e[o]).html().replace(/&nbsp;/g," ").replace(u,"").trim();if(a==AppLang.NEW_OPTION_LABEL)return t.showToasterMessage(AppLang.EDIT_OPTION_TEXT),!1;if(a=="")return t.showToasterMessage(AppLang.BLANK_OPTION_TEXT),!1;n.push(a),n=n.reverse()}$(i.elem).attr("data-options",JSON.stringify(n)),$(i.elem).find(".FIBtext").html(JSON.parse($(i.elem).attr("data-options"))[0]),$(".fib-text-blank",$(".question-option")).removeClass("selectedFIB"),$(r).modal("hide"),_.delay(function(){$(r).remove()},100)},c=function(){s===!0?t.showConfirmPopUp(AppLang.SAVE_WIDGET_CONFIMATION_MESSAGE,"Confirm",["cancel"],function(e){if(e.toLowerCase()!=="yes")return;$(".fib-text-blank",$(".question-option")).removeClass("selectedFIB"),$(r).modal("hide"),_.delay(function(){$(r).remove()},100)}):($(".fib-text-blank",$(".question-option")).removeClass("selectedFIB"),$(r).modal("hide"),_.delay(function(){$(r).remove()},100))},h=Backbone.View.extend({events:{},initialize:function(){},render:o});return new h(n)};return n}),define("com/es/quizEditor/views/FIBEditView",["com/es/text!templateBasePath/Editor/quiz/FIBTextTemplate.html","com/es/quizEditor/models/QuestionEditorModel","com/es/quizEditor/views/FIBOptionsEditView","com/es/utilities/utils","com/es/utilities/services"],function(e,t,n,r,i){var s=function(s){var o=null,u=null,a=null,f=!1,l="",c=null,h=[],p=!1,d=function(){var t=a.attributes,r=_.template(e,t);$(".activity-container",o).html(r),$(".header > div.title",o).html(AppLang.EDIT_ACTIVITY+AppLang.EDIT_FIB_TEXT),c=new n;var i=$(".fib-text-blank",o);_.each(i,function(e,n){$(e).attr("data-options",JSON.stringify(t.answers[n]))}),_instance.trigger("render_complete")},v=function(e,t,n){$(t).addClass("fib-text-blank"),$(t).find(".spantext").addClass("FIBtext"),$(t).attr("data-options",JSON.stringify([n]))},m=function(e){l=e;var n=function(n){e?a=new t(n.questionsData[0]):a=new t(n),d()},r=function(e){console.log(e)},s=require.toUrl("./com/es/quizEditor/data/FIBTextDefaultQuestionData.json"),o=e?e:s,u={url:o,successCallback:n,errorCallback:r};i.fetchQuestionData(u)},g=function(e){if(p==1)return;p=!0;var t=e.target;$(e.target).hasClass("fib-text-blank")?$(e.target).addClass("selectedFIB"):$(e.target.parentNode).addClass("selectedFIB"),$(t).hasClass("FIBtext")&&(t=t.parentNode);if(!$(t).attr("data-options")){r.showAlert("FIB must have a value/text");return}var n={options:JSON.parse($(t).attr("data-options"))};n.options=n.options.reverse();var i={elem:t,container:o,data:n};$(e.target).parent().parent().hasClass("question-option")?$(e.target).parent().parent().blur():$(e.target).parent().parent().hasClass("question-option-Wrapper")&&$(e.target).parent().blur(),_.delay(function(){c.render(i),_.delay(y,500)},150)},y=function(){p=!1},b=function(){var e=!1,t=$(".question-title",n).html().trim();t=r.removeNbsp(t),e=r.userInputValidator($(".question-title",n),!1);if(!e)return r.showToasterMessage(AppLang.BLANK_TITLE),!1;var n=$(".activity-container",o),i=[];f=!1,h=[];var s=$(".question-option",n).clone(),u=$(s).find(".data-values-activity-fill");_.each(u,function(e){u.after("[GAP]"),u.remove()});var l=w(s),c=$(s).html();e=r.userInputValidator($(s),!0);if(!e)return r.showToasterMessage(AppLang.BLANK_QUESTION_TEXT),!1;if(f)return r.showToasterMessage(AppLang.BLANK_FIB_TEXT),!1;var p=c.split("[GAP]"),d=E(p,l),v=$(".rubric-text",n).html().trim();v=r.removeNbsp(v);var m=[{data:v,type:"text"}],u=$(".fib-text-blank",o);if(u.length===0)return r.showToasterMessage(AppLang.BLANK_MIN_TEXT),!1;_.each(u,function(e,t){var n=$(e).attr("data-options");n=JSON.parse(n);var s=[];for(var t=0;t<n.length;t++)n[t]=r.removeNbsp(n[t]),s.push(n[t]);i.push(s)}),QUIZ_EDITOR_CONSTANTS.QUES_ID&&(a.attributes.id=QUIZ_EDITOR_CONSTANTS.QUES_ID);var g=$(".metadata",n).html().trim();g=r.removeNbsp(g);var y=a.attributes;return y.answers=i,y.questionBody=d,y.rubric=m,y.metadata=g,a.attributes.title=t,a.attributes=y,a.attributes},w=function(e){var t=$(e).find("img"),n=[];return _.each(t,function(e){var t={},r=$(e);n.push(r.attr("src")),t.id=r.attr("data-id"),t.name=r.attr("src").substr(r.attr("src").lastIndexOf("/")+1,r.attr("src").length),h.push(t)}),_.each(t,function(e){t.after("[IMAGE]"),t.remove()}),n},E=function(e,t){var n=[],i={},s={};for(var o=0;o<e.length;o++)if(e[o].indexOf("[IMAGE]")>-1){var u=e[o].split("[IMAGE]");for(var a=0;a<u.length;a++){u[a]=r.removeNbsp(u[a]),i={data:u[a],type:"text"},n.push(i);if(a<u.length-1){var f=t.shift(),l;$("img[src='"+f+"']").length>0&&(l=$($("img[src='"+f+"']").get(0)).attr("data-id"));var c=f.substr(f.lastIndexOf("/")+1,f.length);s={data:c,type:"image",id:l},n.push(s)}}o<e.length-1&&n.push("GAP")}else e[o]=r.removeNbsp(e[o]),i={data:e[o],type:"text"},n.push(i),o<e.length-1&&n.push("GAP");return n},S=function(e,t){var n,i,s,o;i=function(e){e.status===!0?_instance.trigger(AppEvent.QUESTION_CREATED,e.url):e.status===!1&&r.showToasterMessage(AppLang.QUESTION_SAVE_ERROR)},s=function(e){console.log(e)},o={url:QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID,success:i,error:s},l=t,l?(n="update",a.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/book/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"/question/"+QUIZ_EDITOR_CONSTANTS.QUES_ID):(n="create",a.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID),h=_.uniq(h,function(e){return JSON.stringify(e)});var u={};u.title=a.get("title"),u.questionType=QUIZ_EDITOR_CONSTANTS.FIB_TEXT_QUESTION_TYPE_ID,u.assetIds=h,u.questionsData=e,a.sync(n,u,o)},x=function(e){e.stopPropagation();if($(e.target).siblings().hasClass("FIBtext")){var t=$(e.target).siblings().text();$(e.target).parent().after(" "+t).remove()}},T=function(e){parseInt($(".question-title").text().length)>=QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&e.preventDefault()},N=Backbone.View.extend({events:{"click .fib-text-blank":g,"click .data-values-activity-fill > .remove-option":x,"keypress .question-title":T},initialize:function(e){_instance=this,u=e||{},o=u.el},fetchData:m,syncData:S,handleDoneClick:b,fibAnswerAdded:v});return new N(s)};return s}),define("com/es/text!templateBasePath/Editor/quiz/MCQSingleResponseTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n    <span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n    <div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n    	<%=title %>\r\n    </div>\r\n    <span class="activityType"><%=AppLang.EDIT_MCQ_SINGLE%></span>\r\n</div>\r\n\r\n<div class="rubric-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n	<div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(rubric[0]){ %>	\r\n			<%=rubric[0].data %>\r\n		<% } %>		\r\n	</div>\r\n</div>\r\n\r\n<div class="question-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TEXT_LABEL%></span>\r\n	<div class="question-text add-img formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% _.each(questionBody, function(item, i){ %>\r\n			<%if(item.type === "text" && (item.data)){%>\r\n			<%=item.data%>\r\n			<%} else if(item.type === "image"){%>					\r\n						<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />					\r\n			<% } %>\r\n			 <% }); %>\r\n	</div>\r\n</div>\r\n\r\n<ul class="answerOptions">\r\n<li class="formLabel text-left"><%=AppLang.ANSWER_OPTIONS_LABEL%></li>\r\n<li class="text-right"><button class="btn-add addIcon"><%=AppLang.ADD_LABEL%></button></li>\r\n</ul>\r\n\r\n<div class="question-option-Wrapper" id="question-options">\r\n	<ul>\r\n		<% _.each(options, function(listItem, i){ %>\r\n			<li class=\'option-div\' id="li<%=(i) %>">		\r\n					<span class="dragIcon"></span>		\r\n					 <!--<div class="numbering"><%=i+1 %>)</div>-->\r\n                     <div class="formPlaceholder">\r\n					 <input type=\'radio\' class="css-radio" id="option<%=(i)%>" \r\n                     value=\'<%=(i) %>\' name=\'options\' <%= (answers.indexOf(i+1) > -1)?"checked=true": "" %>></input>\r\n                     <label class="css-radio-label" for="option<%=i%>"></label>\r\n					 <div class="option-text editable add-img" contenteditable="true" spellcheck="false" role="textbox">\r\n						 <% _.each(listItem, function(item, i){ %>\r\n							<%if(item.type === "text" && (item.data)){%>\r\n								<%=item.data%>\r\n								<%} else if(item.type === "image"){%>					\r\n											<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />																\r\n								<% } %>\r\n\r\n						 <% }); %>\r\n					 	</div>				 \r\n					 </div>\r\n                     <div class="addremove-btn">\r\n	        			<span class="removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>\r\n	       			 </div>	   		\r\n			</li>\r\n		 <% }); %>\r\n	</ul>\r\n</div>\r\n\r\n\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>	\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>		\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>\r\n\r\n    	'}),define("com/es/text!templateBasePath/Editor/quiz/MCQMultipleResponseTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n	<div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<%=title %>\r\n	</div>\r\n    <span class="activityType"><%=AppLang.EDIT_MCQ_MULTIPLE%></span>\r\n</div>\r\n\r\n<div class="rubric-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n	<div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(rubric[0]){ %>	\r\n			<%=rubric[0].data %>\r\n		<% } %>		\r\n	</div>\r\n</div>\r\n\r\n\r\n<div class="question-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TEXT_LABEL%></span>\r\n	<div class="question-text add-img formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% _.each(questionBody, function(item, i){ %>\r\n			<%if(item.type === "text" && (item.data)){%>\r\n				<%=item.data%>\r\n				<%} else if(item.type === "image"){%>					\r\n							<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />						\r\n						 \r\n				<% } %>\r\n			 <% }); %>\r\n	</div>\r\n</div>\r\n\r\n\r\n<ul class="answerOptions">\r\n<li class="formLabel text-left"><%=AppLang.ANSWER_OPTIONS_LABEL%></li>\r\n<li class="text-right"><button class="btn-add addIcon"><%=AppLang.ADD_LABEL%></button></li>\r\n</ul>\r\n\r\n<div class="question-option-Wrapper" id="question-options">\r\n	<ul>\r\n		<% _.each(options, function(listItem, i){ %>\r\n			<li class=\'option-div\' id="li<%=(i) %>">		\r\n					<span class="dragIcon"></span>		\r\n					<!-- <div class="numbering"><%=i+1 %>)</div>-->\r\n                    <div class="formPlaceholder">\r\n						 <input type=\'checkbox\' class="css-checkbox" id="option<%=(i)%>" value=\'<%=(i) %>\' name=\'options\' <%= (answers.indexOf(i+1) >  				\r\n                         -1)?"checked=true": "" %>></input>\r\n                     <label  for="option<%=(i)%>" class="css-label" ></label>\r\n					 <div class="option-text add-img" contenteditable="true" spellcheck="false" role="textbox">\r\n						 <% _.each(listItem, function(item, i){ %>\r\n							<%if(item.type === "text" && (item.data)){%>\r\n								<%=item.data%>\r\n								<%} else if(item.type === "image"){%>					\r\n											<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />						\r\n										\r\n								<% } %>\r\n						 <% }); %>\r\n					 	</div>\r\n                     </div>\r\n					 <div class="addremove-btn">\r\n	        			<!--<span class="addIcon"><%=AppLang.ADD_LABEL%></span>-->\r\n	        			<span class="removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>\r\n	       			 </div>	   		\r\n			</li>\r\n		 <% }); %>\r\n	</ul>\r\n</div>\r\n\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>	\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>	\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>    	'}),define("com/es/quizEditor/views/MCQEditView",["com/es/text!templateBasePath/Editor/quiz/MCQSingleResponseTemplate.html","com/es/text!templateBasePath/Editor/quiz/MCQMultipleResponseTemplate.html","com/es/quizEditor/models/QuestionEditorModel","com/es/utilities/utils","com/es/utilities/services"],function(e,t,n,r,i){var s=function(s){var o=null,u=null,a=null,f=null,l=!1,c="",h=[],p=function(){var n=l?t:e,i=_.template(n,f.attributes);$(".activity-container",u).html(i);var s=l?AppLang.EDIT_MCQ_MULTIPLE:AppLang.EDIT_MCQ_SINGLE;$(".header > div.title",u).html(AppLang.EDIT_ACTIVITY+s),r.makeOptionsSortable(".question-option-Wrapper >ul","#question-options",b),o.trigger("render_complete")},d=function(e){$(".sortableOptions").sortable({cancel:".disable-sort"})},v=function(e){c=e;var t=new n,s=function(n){e&&(t.attributes=n.questionsData[0]),f=t,p()},o=function(e){r.log(e)},u=l?require.toUrl("./com/es/quizEditor/data/MCQ_MultipeDefaultQuestionData.json"):require.toUrl("./com/es/quizEditor/data/MCQ_SingleDefaultQuestionData.json"),a=e?e:u;t.url=a;if(e){var h={url:a,successCallback:s,errorCallback:o};i.fetchQuestionData(h)}else{var h={url:a,success:s,error:o};t.fetch(h)}},m=function(e,t){var n,i,s,u;i=function(e){e.status===!0?o.trigger(AppEvent.QUESTION_CREATED,e.url):e.status===!1&&r.showToasterMessage(AppLang.QUESTION_SAVE_ERROR)},s=function(e){console.log(e)},u={url:QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"/question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID,success:i,error:s},c=t,c?(n="update",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/book/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"/question/"+QUIZ_EDITOR_CONSTANTS.QUES_ID):(n="create",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID),h=_.uniq(h,function(e){return JSON.stringify(e)});var a={};a.title=f.get("title"),l?a.questionType=QUIZ_EDITOR_CONSTANTS.MCQ_MULTIPLE_RESPONSE_QUESTION_TYPE_ID:a.questionType=QUIZ_EDITOR_CONSTANTS.MCQ_SINGLE_RESPONSE_QUESTION_TYPE_ID,a.assetIds=h,a.questionsData=e,f.sync(n,a,u)},g=function(e){var t=$("ul",".question-option-Wrapper").children().first(),n=t.clone(),r=parseInt($("ul",".question-option-Wrapper").children().length),i=0;while($("#option"+i).length>0)i++;$(n.children().get(1)).find("input").attr("id","option"+parseInt(i)),$(n.children().get(1)).find("label").attr("for","option"+parseInt(i)),n.find(".option-text").html(AppLang.NEW_OPTION_LABEL),n.find("input[name=options]").removeAttr("checked"),t.before(n),b(),o.trigger(AppEvent.OPTION_ADDED,n)},y=function(e){var t=$(".option-div",u),n=l?3:2;if(t.length>n){var i=$(e.target.parentNode.parentNode);i.remove(),b()}else{var s=l?AppLang.MCQ_MULTIPLE_MIN_OPTION_TEXT:AppLang.MCQ_SINGLE_MIN_OPTION_TEXT;r.showToasterMessage(s)}},b=function(){var e=$(".option-div",u);_.each(e,function(e,t){$(e).attr("id","li"+t),$(e).find(".numbering").html(t+1+")"),$(e).find("input[name=options]").val(t)})},w=function(){var e=!1,t=$(".question-title",i).html().trim();t=r.removeNbsp(t),e=r.userInputValidator($(".question-title",i),!1);if(!e)return r.showToasterMessage(AppLang.BLANK_TITLE),!1;var n=$(".metadata",i).html().trim();n=r.removeNbsp(n);var i=$(".activity-container",u),s=l?2:1;h=[];var o=$("input[name=options]:checked",i);if(o.length<s)return r.showToasterMessage(AppLang.SELECT_ATLEAST_TEXT+s+AppLang.OPTION_TEXT),!1;var a=[];_.each(o,function(e){a.push(parseInt($(e).val())+1)});var c=f.attributes,p=$(".rubric-text",i).html().trim(),d=[];p!=""&&(p=r.removeNbsp(p),d=[{data:p,type:"text"}]);var v=$(".question-text",i).html();v=r.removeNbsp(v),e=r.userInputValidator($(".question-text",i),!0);if(!e)return r.showToasterMessage(AppLang.BLANK_QUESTION_TEXT),!1;var m=x(".question-text",i),g=$(".option-text",i);for(var y=0;y<g.length;y++){e=r.userInputValidator($(g[y]),!0);if(!e)return r.showToasterMessage(AppLang.BLANK_OPTION_TEXT),!1}var b=[];for(var y=0;y<g.length;y++){var w=x(g[y],i);b.push(w)}return QUIZ_EDITOR_CONSTANTS.QUES_ID&&(c.id=QUIZ_EDITOR_CONSTANTS.QUES_ID),c.rubric=d,c.answers=a,c.questionBody=m,c.options=b,c.metadata=n,f.attributes.title=t,f.attributes=c,f.attributes},E=function(e){$(e.target).parent().addClass("selectedDiv")},S=function(e){$(e.target).parent().removeClass("selectedDiv")},x=function(e,t){var n=[],i=[],s=$(e,t).clone(),o=$(s).find("img"),u=null,a=null;_.each(o,function(e){var t={},n=$(e).attr("src");i.push(n),t.id=$(e).attr("data-id"),t.name=n.substr(n.lastIndexOf("/")+1,n.length),h.push(t)}),_.each(o,function(e){o.after("[IMAGE]"),o.remove()});var f=$(s).html(),l=f.split("[IMAGE]");for(var c=0;c<l.length;c++){l[c]=r.removeNbsp(l[c]),u={data:l[c],type:"text"},n.push(u);if(c<l.length-1){var p=i.shift(),d;$("img[src='"+p+"']").length>0&&(d=$($("img[src='"+p+"']").get(0)).attr("data-id"));var v=p.substr(p.lastIndexOf("/")+1,p.length);a={data:v,type:"image",id:d},n.push(a)}}return n},T=function(e){parseInt($(".question-title").text().length)>=QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&e.preventDefault()},N=Backbone.View.extend({events:{"click .addIcon":g,"click .removeIcon":y,"click .option-text":d,"focus .option-text":E,"blur .option-text":S,"keypress .question-title":T},initialize:function(e){a=e||{},u=a.el,l=a.type==QUIZ_EDITOR_CONSTANTS.MCQ_MULTIPLE_RESPONSE_QUESTION_TYPE_ID?!0:!1,o=this},fetchData:v,syncData:m,handleDoneClick:w});return new N(s)};return s}),define("com/es/text!templateBasePath/Editor/quiz/MCQBinaryTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n    <span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n    <div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n    	<%=title %>\r\n    </div>\r\n    <span class="activityType"><%=AppLang.EDIT_BINARY%></span>\r\n</div>\r\n\r\n<div class="rubric-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n	<div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(rubric[0]){ %>	\r\n			<%=rubric[0].data %>\r\n		<% } %>		\r\n	</div>\r\n</div>\r\n\r\n<div class="question-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TEXT_LABEL%></span>\r\n	<div class="question-text add-img formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% _.each(questionBody, function(item, i){ %>\r\n		<%if(item.type === "text" && (item.data !== "<br />")){%>\r\n			<%=item.data %>\r\n			<%} else if(item.type === "image"){%>\r\n			<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />	\r\n			<%}%>\r\n			 <% }); %>\r\n	</div>\r\n</div>\r\n\r\n<ul class="answerOptions">\r\n<li class="formLabel text-left"><%=AppLang.STATEMENTS_LABEL%></li>\r\n<li class="text-right"><button class="addIcon btn-add"><%=AppLang.ADD_STATEMENT_LABEL%></button></li>\r\n</ul>\r\n\r\n<div class="question-option-Wrapper" id="question-options">\r\n	<ul><%var j = 0;%>\r\n		<% _.each(options, function(listItem, i){  %>\r\n			<%if(listItem.data !== "<br />" && (listItem.data !== "")){%>\r\n				<li class=\'option-div\' id="li<%=i %>">	\r\n						<span class="dragIcon"></span>\r\n						 <!--<div class="numbering"><%=i+1 %>)</div>-->\r\n						  <div class="option-text add-img formPlaceholder mcqBinaryEditView" contenteditable="true" spellcheck="false" role="textbox">						\r\n								<%if(listItem.type === "text" && (listItem.data !== "<br />")){ %>								\r\n									<%=listItem.data%>									\r\n									<%} else if(listItem.type === "image"){%>					\r\n												<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+listItem.data%> class="question-image" data-id=<%=listItem.id%> />						\r\n											\r\n									<% } %>						 \r\n						 	</div>	\r\n						 		\r\n						 	<div class="true-false-btn" id="tfb-<%=i %>">					 		\r\n						 	<%	if(answers[j] == "0" || answers[j] == 0){ %>\r\n							 		<span class="qr-correct selected" data-op="0"><%=AppLang.TRUE_LABEL%></span>\r\n							 		<span class="qr-incorrect" data-op="1"><%=AppLang.FALSE_LABEL%></span> \r\n							 		<%j++%>\r\n						 	<%	}else if(answers[j] == "1" || answers[j] == 1){ %>\r\n							 		<span class="qr-correct" data-op="0"><%=AppLang.TRUE_LABEL%></span>\r\n							 		<span class="qr-incorrect selected"  data-op="1"><%=AppLang.FALSE_LABEL%></span> \r\n							 		<%j++%>\r\n							 		\r\n						 	<%	}else {%>\r\n						 		<span class="qr-correct" data-op="0"><%=AppLang.TRUE_LABEL%></span>\r\n							 	<span class="qr-incorrect"  data-op="1"><%=AppLang.FALSE_LABEL%></span> 						 		\r\n						 	<%	}%>\r\n						 	</div>			 \r\n						 <div class="addremove-btn">\r\n		        			\r\n		        			<span class="removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>\r\n		       			 </div>	   		\r\n				</li>\r\n			<%}%>\r\n		<% }); %>\r\n	</ul>\r\n</div>\r\n\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>	\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>    	'}),define("com/es/quizEditor/views/MCQBinaryEditView",["com/es/text!templateBasePath/Editor/quiz/MCQBinaryTemplate.html","com/es/quizEditor/models/QuestionEditorModel","com/es/utilities/utils","com/es/utilities/services"],function(e,t,n,r){var s=function(s){var o=null,u=null,a=null,f=null,l="",c=[],h=function(){var t=f.attributes,r=_.template(e,t);$(".activity-container",u).html(r),$(".header > div.title",u).html(AppLang.EDIT_ACTIVITY+AppLang.EDIT_BINARY),n.makeOptionsSortable(".question-option-Wrapper >ul","#question-options",y),o.trigger("render_complete")},p=function(e){l=e;var n=function(n){e?f=new t(n.questionsData[0]):f=new t(n),h()},i=function(e){console.log(e)},s=require.toUrl("./com/es/quizEditor/data/MCQ_BinaryDefaultQuestionData.json"),o=e?e:s,u={url:o,successCallback:n,errorCallback:i};r.fetchQuestionData(u)},d=function(e,t){var r,i,s,u;i=function(e){e.status===!0?o.trigger(AppEvent.QUESTION_CREATED,e.url):e.status===!1&&n.showToasterMessage(AppLang.QUESTION_SAVE_ERROR)},s=function(e){console.log(e)},u={url:QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID,success:i,error:s},l=t,l?(r="update",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/book/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"/question/"+QUIZ_EDITOR_CONSTANTS.QUES_ID):(r="create",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID),c=_.uniq(c,function(e){return JSON.stringify(e)});var a={};a.title=f.get("title"),a.questionType=QUIZ_EDITOR_CONSTANTS.TRUE_OR_FALSE_QUESTION_TYPE_ID,a.assetIds=c,a.questionsData=e,f.sync(r,a,u)},v=function(e){var t=$("ul",".question-option-Wrapper").children().first(),n=t.clone();n.find(".option-text").html(AppLang.NEW_STATEMENT_LABEL),n.find(".selected").removeClass("selected"),n.find(".qr-correct").addClass("selected"),t.before(n),y(),o.trigger(AppEvent.OPTION_ADDED,n)},m=function(e){var t=$(".option-div",u);if(t.length>1){var r=$(e.target.parentNode.parentNode);r.remove(),y()}else n.showToasterMessage(AppLang.BINARY_MIN_STATEMENT_TEXT)},g=function(e){var t=e.target.parentNode;$(t).find(".selected").removeClass("selected"),$(e.target).addClass("selected")},y=function(){var e=$(".option-div",u);_.each(e,function(e,t){$(e).attr("id","li"+t),$(e).find(".numbering").html(t+1+")")})},b=function(e){$(e).find(".addIcon").bind(AppEvent.CLICK,v),$(e).find(".removeIcon").bind(AppEvent.CLICK,m),$(e).find(".true-false-btn > span").bind(AppEvent.CLICK,g)},w=function(){var e=$(".activity-container",u),t=[],r=[],i=[],s=!1,o=f.attributes;c=[];var a=$(".rubric-text",e).html().trim(),l=[];a!=""&&(a=n.removeNbsp(a),l=[{data:a,type:"text"}]);var h=$(".question-title",e).html().trim();h=n.removeNbsp(h),s=n.userInputValidator($(".question-title",e),!1);if(!s)return n.showToasterMessage(AppLang.BLANK_TITLE),!1;var p=$(".question-text",e).html().trim();p=n.removeNbsp(p),s=n.userInputValidator($(".question-text",e),!0);if(!s)return n.showToasterMessage(AppLang.BLANK_QUESTION_TEXT),!1;var d=E(".question-text",e),v=$(".option-div",e);for(var m=0;m<v.length;m++){var g=v[m],y=$(g).find(".option-text").html();y=n.removeNbsp(y),s=n.userInputValidator($(g).find(".option-text"),!0);if(!s)return n.showToasterMessage(AppLang.BINARY_BLANK_QUESTION_TEXT),!1;i=E($(g).find(".option-text"),e),r=r.concat(i),r.push({data:"<br />",type:"text"});var b=$(g).find(".true-false-btn >span.selected").attr("data-op");if(!b)return n.showToasterMessage(AppLang.BINARY_BLANK_ANSWER_TEXT),!1;t.push(b)}var w=$(".metadata",e).html().trim();return w=n.removeNbsp(w),QUIZ_EDITOR_CONSTANTS.QUES_ID&&(o.id=QUIZ_EDITOR_CONSTANTS.QUES_ID),o.title=h,o.rubric=l,o.answers=t,o.questionBody=d,o.options=r,o.metadata=w,f.attributes=o,f.attributes},E=function(e,t){var r=[],i=[],s=$(e,t).clone(),o=$(s).find("img"),u=null,a=null;_.each(o,function(e){var t={},n=$(e);i.push(n.attr("src")),t.id=n.attr("data-id"),t.name=n.attr("src").substr(n.attr("src").lastIndexOf("/")+1,n.attr("src").length),c.push(t)}),_.each(o,function(e){o.after("[IMAGE]"),o.remove()});var f=$(s).html(),l=f.split("[IMAGE]");for(var h=0;h<l.length;h++){l[h]=n.removeNbsp(l[h]),u={data:l[h],type:"text"},r.push(u);if(h<l.length-1){var p=i.shift(),d;$("img[src='"+p+"']").length>0&&(d=$($("img[src='"+p+"']").get(0)).attr("data-id"));var v=p.substr(p.lastIndexOf("/")+1,p.length);a={data:v,type:"image",id:d},r.push(a)}}return r},S=function(e){if($(e.target).find("img").length>0){for(i=1;i<=Object.keys(CKEDITOR.instances).length;i++)$("#cke_editor"+i).css("display","none");n.showConfirmPopUp(AppLang.ADD_TEXT_CONFIRMATiON_MESSAGE,"Confirm",["cancel"],function(t){if(t.toLowerCase()==="yes")$(e.target).children().remove();else{var n=$(e.target).children();$(e.target).html(""),$(e.target).html(n)}})}},x=function(e){parseInt($(".question-title").text().length)>=QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&e.preventDefault()},T=Backbone.View.extend({events:{"click .addIcon":v,"click .removeIcon":m,"click .true-false-btn > span":g,"input .option-text":S,"keypress .question-title":x},initialize:function(e){a=e||{},u=a.el,o=this},fetchData:p,syncData:d,handleDoneClick:w});return new T(s)};return s}),define("com/es/text!templateBasePath/Editor/quiz/MatchingTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n	<div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<%=title %>\r\n	</div>\r\n    <span class="activityType"><%=AppLang.EDIT_MATCHING%></span>\r\n</div>\r\n\r\n<div class="rubric-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n	<div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% _.each(rubric, function(item, i){ %>\r\n			<%=item.data %>\r\n			 <% }); %>\r\n	</div>\r\n</div>\r\n\r\n<div class="question-text-Wrapper">\r\n	\r\n    <ul class="answerOptions">\r\n    <li class="formLabel text-left"><%=AppLang.QUESTION_TEXT_LABEL%></li>\r\n	<li class="text-right"><button class="addIcon btn-add"><%=AppLang.ADD_STATEMENT_LABEL%></button></li>\r\n    </ul>\r\n    \r\n    \r\n	<div class="question-option-Wrapper"  id="question-options">\r\n	<ul>\r\n		<% _.each(options, function(listItem, i){ %>\r\n			<li class=\'option-div\' id="li<%=i %>">\r\n			<span class="dragIcon"></span>				\r\n					 <!--<div class="numbering"><%=i+1 %>)</div>-->\r\n					 <div id="opt<%=i %>" class="matchingOptions">\r\n					 	<!--div class="leftCol add-img formPlaceholder"  contenteditable="true"><%=questionBody[i].data%></div-->\r\n					 	<div class="leftCol add-img formPlaceholder"  contenteditable="true">\r\n					 		<%if(questionBody[i].type === "text" && (questionBody[i].data)){%>\r\n								<%=questionBody[i].data%>\r\n								<%} else if(questionBody[i].type === "image"){%>					\r\n											<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+questionBody[i].data%> class="question-image" data-id=<%=questionBody[i].id%> />						\r\n										\r\n								<% } %>	\r\n					 	</div>\r\n					 	<!--div class="rightCol add-img formPlaceholder"  contenteditable="true"><%=listItem.data%></div-->\r\n					 	<div class="rightCol add-img formPlaceholder"  contenteditable="true">\r\n					 		<%if(listItem.type === "text" && (listItem.data)){%>\r\n								<%=listItem.data%>\r\n								<%} else if(listItem.type === "image"){%>					\r\n											<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+listItem.data%> class="question-image" data-id=<%=listItem.id%> />						\r\n										\r\n								<% } %>	\r\n					 	</div>\r\n					 </div>				 \r\n					 <div class="addremove-btn">\r\n	        			<span class="removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>\r\n	       			 </div>	   		\r\n			</li>\r\n		 <% }); %>\r\n	</ul>\r\n	</div>\r\n</div>\r\n\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>	\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>    	'}),define("com/es/quizEditor/views/MatchingEditView",["com/es/text!templateBasePath/Editor/quiz/MatchingTemplate.html","com/es/quizEditor/models/QuestionEditorModel","com/es/utilities/utils","com/es/utilities/services"],function(e,t,n,r){var s=function(s){var o=null,u=null,a=null,f=null,l="",c=[],h=function(){var t=f.attributes,r=_.template(e,t);$(".activity-container",u).html(r),$(".activity-container",u).addClass("matchingEditView"),$(".header > div.title",u).html(AppLang.EDIT_ACTIVITY+AppLang.EDIT_MATCHING),n.makeOptionsSortable(".question-option-Wrapper >ul","#question-options",g),o.trigger("render_complete")},p=function(e){l=e;var n=function(n){e?f=new t(n.questionsData[0]):f=new t(n),h()},i=function(e){console.log(e)},s=require.toUrl("./com/es/quizEditor/data/MatchingDefaultQuestionData.json"),o=e?e:s,u={url:o,successCallback:n,errorCallback:i};r.fetchQuestionData(u)},d=function(e,t){var r,i,s,u;i=function(e){e.status===!0?o.trigger(AppEvent.QUESTION_CREATED,e.url):e.status===!1&&n.showToasterMessage(AppLang.QUESTION_SAVE_ERROR)},s=function(e){console.log(e)},u={url:QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID,success:i,error:s},l=t,l?(r="update",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/book/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"/question/"+QUIZ_EDITOR_CONSTANTS.QUES_ID):(r="create",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID),c=_.uniq(c,function(e){return JSON.stringify(e)});var a={};a.title=f.get("title"),a.questionType=QUIZ_EDITOR_CONSTANTS.MATCHING_QUESTION_TYPE_ID,a.assetIds=c,a.questionsData=e,f.sync(r,a,u)},v=function(e){var t=$("ul",".question-option-Wrapper").children().first(),n=t.clone();n.find(".leftCol").html(AppLang.NEW_QUESTION_LABEL),n.find(".rightCol").html(AppLang.NEW_ANSWER_LABEL),t.before(n),g(),o.trigger(AppEvent.OPTION_ADDED,n)},m=function(e){var t=$(".option-div",u);if(t.length>2){var r=$(e.target.parentNode.parentNode);r.remove(),g()}else n.showToasterMessage(AppLang.MATCHING_MIN_QUESTION_TEXT)},g=function(){var e=$(".option-div",u);_.each(e,function(e,t){$(e).attr("id","li"+t),$(e).find(".numbering").html(t+1+")")})},y=function(e){$(e).find(".addIcon").bind(AppEvent.CLICK,v),$(e).find(".removeIcon").bind(AppEvent.CLICK,m)},b=function(){var e=$(".activity-container",u),t=f.attributes,r=!1;c=[];var i=$(".question-title",e).html().trim();i=n.removeNbsp(i),r=n.userInputValidator($(".question-title",e),!1);if(!r)return n.showToasterMessage(AppLang.BLANK_TITLE),!1;var s=$(".metadata",e).html().trim();s=n.removeNbsp(s);var o=$(".rubric-text",e).html().trim();o=n.removeNbsp(o);var a=[{data:o,type:"text"}],l=$(".option-div",e),h=[],p=[];for(var d=0;d<l.length;d++){var v=$(l[d]).find(".leftCol").html();v=n.userInputValidator($(l[d]).find(".leftCol"),!0);var m=$(l[d]).find(".rightCol").html().trim();m=n.userInputValidator($(l[d]).find(".rightCol"),!0);var g=$(l[d]).html();if(!v||!m)return n.showToasterMessage(AppLang.BLANK_QUESTION_OR_ANSWER_TEXT),!1;var y=w($(l[d]).find(".leftCol"));if(y.length==0)return n.showToasterMessage(AppLang.BLANK_QUESTION_OR_ANSWER_TEXT),!1;p=p.concat(y);var b=w($(l[d]).find(".rightCol"));if(b.length==0)return n.showToasterMessage(AppLang.BLANK_QUESTION_OR_ANSWER_TEXT),!1;h=h.concat(b)}return QUIZ_EDITOR_CONSTANTS.QUES_ID&&(t.id=QUIZ_EDITOR_CONSTANTS.QUES_ID),t.title=i,t.rubric=a,t.questionBody=p,t.options=h,t.metadata=s,f.attributes=t,f.attributes},w=function(e){var t=e.clone(),r=[],i=[],s=$(t).find("img"),o=null,u=null;_.each(s,function(e){var t={},n=$(e);i.push(n.attr("src")),t.id=n.attr("data-id"),t.name=n.attr("src").substr(n.attr("src").lastIndexOf("/")+1,n.attr("src").length),c.push(t)}),_.each(s,function(e){s.after("[IMAGE]"),s.remove()});var a=$(t).html(),f=a.split("[IMAGE]");for(var l=0;l<f.length;l++){f[l]!==""&&(a.indexOf("[IMAGE]")>-1&&l==f.length-1||(f[l]=n.removeNbsp(f[l]),o={data:f[l],type:"text"},r.push(o)));if(l<f.length-1){var h=i.shift(),p;$("img[src='"+h+"']").length>0&&(p=$($("img[src='"+h+"']").get(0)).attr("data-id"));var d=h.substr(h.lastIndexOf("/")+1,h.length);u={data:d,type:"image",id:p},r.push(u)}}return r},E=function(e){if($(e.target).find("img").length>0){for(i=1;i<=Object.keys(CKEDITOR.instances).length;i++)$("#cke_editor"+i).css("display","none");n.showConfirmPopUp(AppLang.ADD_TEXT_CONFIRMATiON_MESSAGE,"Confirm",["cancel"],function(t){if(t.toLowerCase()==="yes")$(e.target).children().remove();else{var n=$(e.target).children();$(e.target).html(""),$(e.target).html(n)}})}},S=function(e){parseInt($(".question-title").text().length)>=QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&e.preventDefault()},x=Backbone.View.extend({events:{"click .addIcon":v,"click .removeIcon":m,"input .leftCol":E,"input .rightCol":E,"keypress .question-title":S},initialize:function(e){a=e||{},u=a.el,o=this},fetchData:p,syncData:d,handleDoneClick:b});return new x(s)};return s}),define("com/es/text!templateBasePath/Editor/quiz/GroupingTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n    <span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n    <div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n    	<%=title %>\r\n    </div>\r\n    <span class="activityType"><%=AppLang.EDIT_GROUPING%></span>\r\n</div>\r\n\r\n<div class="rubric-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n	<div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% _.each(rubric, function(item, i){ %>\r\n			<%=item.data %>\r\n			 <% }); %>\r\n	</div>\r\n</div>\r\n\r\n\r\n<ul class="answerOptions">\r\n<li class="formLabel text-left"><span class="formLabel"><%=AppLang.GROUPS_LABEL%></span></li>\r\n<li class="text-right"><button class="addGroupIcon btn-add"><%=AppLang.ADD_GROUP_LABEL%></button></li>\r\n</ul>\r\n\r\n\r\n<div class="question-groups-Wrapper">\r\n	<div id="question-groups">\r\n		<ul  id="groups-ul">\r\n			<% _.each(options, function(listItem, i){ %>\r\n				<li class=\'group-div\' id="group<%=i %>">\r\n					<div class="numbering"><%=String.fromCharCode(65+i) %></div>		\r\n							\r\n					<div class="group add-img" contenteditable="true" tabindex="0" spellcheck="false" role="textbox">				\r\n							<%=listItem.data %>					\r\n					</div>			 						\r\n		        	<span class="removeGroupIcon removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>    			 		\r\n				</li>\r\n			<% }); %>\r\n		</ul>\r\n	\r\n	</div>\r\n</div>\r\n\r\n<ul class="answerOptions">\r\n	<li class="text-left formLabel"><%=AppLang.STATEMENTS_LABEL%></li>\r\n    <li class="text-right"><button class="addIcon btn-add"><%=AppLang.ADD_STATEMENT_LABEL%></button></li>\r\n</ul>\r\n\r\n\r\n<div class="question-options-Wrapper">\r\n	<div id="question-options">\r\n		<ul id="options-ul">\r\n			<% _.each(questionBody, function(listItem, i){ %>\r\n				<li class=\'option-div\' id="option<%=i %>">	\r\n					<span class="dragIcon"></span>\r\n<!--					<div class="numbering"><%=i+1 %>)</div>			\r\n-->					<div class="option add-img formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox">								<%if(listItem[0].type === "text" && (listItem[0].data)){%>\r\n								<%=listItem[0].data%>\r\n								<%} else if(listItem[0].type === "image"){%>					\r\n											<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+listItem[0].data%> class="question-image" data-id=<%=listItem[0].id%> />																\r\n								<% } %>				\r\n					</div>	\r\n					<select class="ans-selector">		\r\n						<% _.each(options, function (opt, j) {%>            				          				 \r\n              				<option value="<%=j+1%>"><%=String.fromCharCode(65+j)%></option> \r\n           				<% });	%>				\r\n					</select>\r\n					<span class="removeOptionIcon removeIcon"><!--<%=AppLang.REMOVE_LABEL%>--></span>  		\r\n				</li>\r\n			 <% }); %>\r\n		</ul>\r\n		\r\n	</div>\r\n</div>\r\n\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>	\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>    	'}),define("com/es/quizEditor/views/GroupingEditView",["com/es/text!templateBasePath/Editor/quiz/GroupingTemplate.html","com/es/quizEditor/models/QuestionEditorModel","com/es/utilities/utils","com/es/utilities/services"],function(e,t,n,r){var s=function(s){var o=null,u=null,a=null,f=null,l="",c=[],h=function(){var t=f.attributes,r=_.template(e,t);$(".activity-container",u).html(r),$(".activity-container",u).addClass("groupingEditView"),E(t.answers),$(".header > div.title",u).html(AppLang.EDIT_ACTIVITY+AppLang.EDIT_GROUPING),n.makeOptionsSortable(".question-options-Wrapper > div#question-options > ul","#question-options",g),o.trigger("render_complete")},p=function(e){l=e;var n=function(n){e?f=new t(n.questionsData[0]):f=new t(n),h()},i=function(e){console.log(e)},s=require.toUrl("./com/es/quizEditor/data/GroupingDefaultQuestionData.json"),o=e?e:s,u={url:o,successCallback:n,errorCallback:i};r.fetchQuestionData(u)},d=function(e,t){var r,i,s,u;i=function(e){e.status===!0?o.trigger(AppEvent.QUESTION_CREATED,e.url):e.status===!1&&n.showToasterMessage(AppLang.QUESTION_SAVE_ERROR)},s=function(e){console.log(e)},u={url:QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID,success:i,error:s},l=t,l?(r="update",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/book/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"/question/"+QUIZ_EDITOR_CONSTANTS.QUES_ID):(r="create",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID),c=_.uniq(c,function(e){return JSON.stringify(e)});var a={};a.title=f.get("title"),a.questionType=QUIZ_EDITOR_CONSTANTS.GROUPING_QUESTION_TYPE_ID,a.assetIds=c,a.questionsData=e,f.sync(r,a,u)},v=function(e){var t=$("ul","#question-options").children().last(),n=t.clone();n.find(".option").html(AppLang.NEW_OPTION_LABEL),$("#options-ul",u).prepend(n),g(),o.trigger(AppEvent.OPTION_ADDED,n)},m=function(e){var t=$(".option-div",u);if(t.length>1){var r=$(e.target.parentNode);r.remove();var i=$(e.target.parentNode).attr("id").split("option")[1];g()}else n.showToasterMessage(AppLang.GROUPING_MIN_OPTION_TEXT)},g=function(){var e=$(".option-div",u);_.each(e,function(e,t){$(e).attr("id","option"+t),$(e).find(".numbering").html(t+1+")")})},y=function(e){var t=$(".group-div",u).length;if(t>=7){n.showToasterMessage(AppLang.GROUPING_MAX_GROUP_TEXT);return}var r=$($(".group-div",u).get(0)),i=r.clone();i.attr("id","group"+t),i.find(".group").html(AppLang.NEW_GROUP_LABEL),$("#groups-ul",u).append(i);var s=parseInt($($(".ans-selector option:last-child",u)).val()),a=String.fromCharCode(65+s);$(i).find(".numbering").html(a),$(".ans-selector",u).append("<option value="+(s+1)+">"+a+"</option>"),o.trigger(AppEvent.OPTION_ADDED,i)},b=function(e){var t=$(".group",u);if(t.length>2){var r=$(e.target.parentNode);r.remove(),w(),$(".ans-selector option:last-child",u).remove()}else n.showToasterMessage(AppLang.GROUPING_MIN_GROUP_TEXT)},w=function(){var e=$(".group-div",u);_.each(e,function(e,t){var n=String.fromCharCode(65+t);$(e).attr("id","group"+t),$(e).find(".numbering").html(n)})},E=function(e){var t=$(".option-div",u);_.each(t,function(t,n){var r=e[n];$(t).find(".ans-selector option[value="+r+"]").attr("selected","selected")})},S=function(e){$(e).find(".addIcon").bind(AppEvent.CLICK,v),$(e).find(".removeOptionIcon").bind(AppEvent.CLICK,m)},x=function(e){$(e).find(".addGroupIcon").bind(AppEvent.CLICK,y),$(e).find(".removeGroupIcon").bind(AppEvent.CLICK,b)},T=function(){var e=$(".activity-container",u),t=f.attributes,r=!1;c=[];var i=$(".question-title",e).html().trim();i=n.removeNbsp(i),r=n.userInputValidator($(".question-title",e),!1);if(!r)return n.showToasterMessage(AppLang.BLANK_TITLE),!1;var s=$(".metadata",e).html().trim();s=n.removeNbsp(s);var o=$(".rubric-text",e).html().trim();o=n.removeNbsp(o);var a=[{data:o,type:"text"}],l=[],h=[],p=[],d=$(".group",e);for(var v=0;v<d.length;v++){var m=$(d[v]).html().trim();m=n.removeNbsp(m),r=n.userInputValidator($(d[v]),!1);if(!r)return n.showToasterMessage(AppLang.BLANK_GROUP_TEXT),!1;var g=k($(d[v]));l=l.concat(g)}var y=$(".option-div",e);for(var v=0;v<y.length;v++){r=n.userInputValidator($(y[v]).find(".option"),!0);if(!r)return n.showToasterMessage(AppLang.BLANK_OPTION_TEXT),!1;var b=k($(y[v]).find(".option"));if(b.length==0||b["0"].data=="")return n.showToasterMessage(AppLang.BLANK_OPTION_TEXT),!1;h.push(b);var w=parseInt($(y[v]).find(".ans-selector option:selected").val());p.push(w)}return QUIZ_EDITOR_CONSTANTS.QUES_ID&&(t.id=QUIZ_EDITOR_CONSTANTS.QUES_ID),t.title=i,t.rubric=a,t.questionBody=h,t.options=l,t.answers=p,t.metadata=s,f.attributes=t,f.attributes},N=function(e){$(e.target).hasClass("group-div")?$(e.target).addClass("selectedDiv"):$(e.target).parent().addClass("selectedDiv")},C=function(e){$(e.target).parent().removeClass("selectedDiv")},k=function(e){var t=e.clone(),r=[],i=[],s=$(t).find("img"),o=null,u=null;_.each(s,function(e){var t={},n=$(e);i.push(n.attr("src")),t.id=n.attr("data-id"),t.name=n.attr("src").substr(n.attr("src").lastIndexOf("/")+1,n.attr("src").length),c.push(t)}),_.each(s,function(e){s.after("[IMAGE]"),s.remove()});var a=$(t).html().trim(),f=a.split("[IMAGE]");for(var l=0;l<f.length;l++){f[l]!==""&&(a.indexOf("[IMAGE]")>-1&&l==f.length-1||(f[l]=n.removeNbsp(f[l]),o={data:f[l],type:"text"},r.push(o)));if(l<f.length-1){var h=i.shift(),p;$("img[src='"+h+"']").length>0&&(p=$($("img[src='"+h+"']").get(0)).attr("data-id"));var d=h.substr(h.lastIndexOf("/")+1,h.length);u={data:d,type:"image",id:p},r.push(u)}}return r},L=function(e){if($(e.target).find("img").length>0){for(i=1;i<=Object.keys(CKEDITOR.instances).length;i++)$("#cke_editor"+i).css("display","none");n.showConfirmPopUp(AppLang.ADD_TEXT_CONFIRMATiON_MESSAGE,"Confirm",["cancel"],function(t){if(t.toLowerCase()==="yes")$(e.target).children().remove();else{var n=$(e.target).children();$(e.target).html(""),$(e.target).html(n)}})}},A=function(e){parseInt($(".question-title").text().length)>=QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&e.preventDefault()},O=Backbone.View.extend({events:{"click .addIcon":v,"click .removeOptionIcon":m,"click .addGroupIcon":y,"click .removeGroupIcon":b,"input .group":L,"input .option":L,"focus .group-div":N,"blur .group-div":C,"keypress .question-title":A},initialize:function(e){a=e||{},u=a.el,o=this},fetchData:p,syncData:d,handleDoneClick:T});return new O(s)};return s}),define("com/es/text!templateBasePath/Editor/quiz/FIBTapPlaceTemplate.html",[],function(){return'<div class="question-title-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TITLE_LABEL%></span>\r\n    <div class="question-title formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n    	<%=title %>\r\n    </div>\r\n    <span class="activityType"><%=AppLang.EDIT_FIB_TAPPLACE%></span>\r\n</div>\r\n\r\n<div class="rubric-text-Wrapper">\r\n    <span class="formLabel"><%=AppLang.QUESTION_RUBRIC_LABEL%></span>\r\n        <div class="rubric-text formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n            <% if(rubric[0]){ %>	\r\n                <%=rubric[0].data %>\r\n            <% } %>		\r\n        </div>\r\n</div>\r\n\r\n<div class="question-text-Wrapper">\r\n<%=AppLang.OPTIONS_LABEL%>\r\n<div class="question-option-Wrapper option-list" id="option-list-wrapper">\r\n	<div class="question-option fib-option add-img" tabindex="0" spellcheck="false" role="textbox" >\r\n	</div>\r\n	\r\n</div>\r\n</div>\r\n\r\n<div class="question-text-Wrapper">\r\n	<span class="formLabel"><%=AppLang.QUESTION_TEXT_LABEL%></span>\r\n	<div class="question-option-Wrapper questionContentWrapper" id="question-option-Wrapper">\r\n		<div class="question-option fib-option add-img question-text questionText formPlaceholder" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n			<% var gapCount = 0 %>\r\n			<% _.each(questionBody, function(item, i){ %>\r\n			<% if(item == "GAP"){ %>\r\n				<div data-name="fillup" class="data-values-activity-fill" contenteditable="false"><span class="spantext" contenteditable="false"><%=options[answers[gapCount][0] - 1].data %></span><div class="close-pop remove-option"></div></div>\r\n				<% gapCount++ %>\r\n			<%	}else{	%>\r\n					<%if(item.type === "text" && (item.data)){%>\r\n				<%=item.data%>\r\n				<%} else if(item.type === "image"){%>					\r\n							<img src=<%=QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH+item.data%> class="question-image" data-id=<%=item.id%> />						\r\n						\r\n				<% } %>				\r\n				<%	}%>\r\n				<% }); %>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n\r\n<div class="metadata-Wrapper">\r\n	<span class="formLabel"><%=AppLang.METADATA_LABEL%></span>	\r\n	<div class="rubric-text formPlaceholder metadata" contenteditable="true" tabindex="0" spellcheck="false" role="textbox" >\r\n		<% if(metadata){ %>	\r\n			<%=metadata %>\r\n		<% } %>	\r\n	</div>\r\n	<span class="formLabel metadata-additional-info"><%=AppLang.METADATA_ADDITIONAL_INFO%></span>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/quiz/FibDataActivitySelectedTemplate.html",[],function(){return'<div class="option-selected">\r\n	<span class="optionBadge"><%=usage%></span>\r\n    <span class="option-selected-item"><%=optionText%></span>\r\n    <div class="close-pop remove-option"></div>\r\n</div>'}),define("com/es/text!templateBasePath/Editor/quiz/AddDistractionTemplate.html",[],function(){return'<div class="extra-options">\n    <div class="options-container">\n        <div class="option-box">\n            <span class="option-text add-img formPlaceholder" contenteditable="true"  ></span>\n            <button class="addOptionIcon btn-add"><%=AppLang.ADD_DISTRACTORS_LABEL%></button>\n        </div>\n	</div>\n</div>'}),define("com/es/quizEditor/views/FIBTapPlaceEditView",["com/es/text!templateBasePath/Editor/quiz/FIBTapPlaceTemplate.html","com/es/text!templateBasePath/Editor/quiz/FibDataActivitySelectedTemplate.html","com/es/text!templateBasePath/Editor/quiz/AddDistractionTemplate.html","com/es/quizEditor/models/QuestionEditorModel","com/es/utilities/utils","com/es/utilities/services"],function(e,t,n,r,i,s){var o=function(o){var u=null,a=null,f=null,l=!1,c="",h="",p="",d="",v=[],m=function(){p=f.attributes;var t=_.template(e,p);h=$(".activity-container",u),h.html(t),$(".header > div.title",u).html(AppLang.EDIT_ACTIVITY+AppLang.EDIT_FIB_TAPPLACE),$(CKEDITOR).unbind(AppEvent.FIB_ANSWER_ADDED).bind(AppEvent.FIB_ANSWER_ADDED,N.bind(a)),a.trigger("render_complete"),f.on("change:options",E,a),d=f.get("options"),E()},g=function(e){c=e;var t=function(t){e?f=new r(t.questionsData[0]):f=new r(t),m()},n=function(e){console.log(e)},i=require.toUrl("./com/es/quizEditor/data/FIBTapPlaceDefaultQuestionData.json"),o=e?e:i,u={url:o,successCallback:t,errorCallback:n};s.fetchQuestionData(u)},y=function(){var e=[],t=[],n=!1;l=!1;var r="",s,o=[],u=$(".question-title",h).html().trim(),a=$("#question-option-Wrapper .question-option.fib-option",h).clone();u=i.removeNbsp(u),n=i.userInputValidator($(".question-title",h),!1);if(!n)return i.showToasterMessage(AppLang.BLANK_TITLE),!1;n=i.userInputValidator($(a),!0);if(!n)return i.showToasterMessage(AppLang.BLANK_QUESTION_TEXT),!1;var c=$(a).find("img"),p=$(a).find(".data-values-activity-fill");if(p.length===0)return i.showToasterMessage(AppLang.BLANK_MIN_TEXT),!1;var d=$("#option-list-wrapper .option-selected-item",h);v=[],_.each(p,function(e){var t=$(e).find(".spantext").html();t===""&&(l=!0),o.push(t),p.after("[GAP]"),p.remove()}),_.each(c,function(e){var n={},r=$(e);t.push(r.attr("src")),n.id=r.attr("data-id"),n.name=r.attr("src").substr(r.attr("src").lastIndexOf("/")+1,r.attr("src").length),v.push(n)}),_.each(c,function(e){c.after("[IMAGE]"),c.remove()});if(l)return i.showToasterMessage(AppLang.BLANK_FIB_TEXT),!1;var m=$(a).html(),g=m.split("[GAP]"),y=[];for(var b=0;b<g.length;b++)if(b!=g.length-1&&g[b]=="")y.push("GAP");else{var w=g[b].indexOf("[IMAGE]"),E=g[b],S="",x=0;if(w>-1){while(w>-1)S=E.substr(x,w),S=i.removeNbsp(S),E=E.substr(w+7,E.length),w=E.indexOf("[IMAGE]"),y.push({data:S,type:"text"}),s=t.shift(),r=s.substr(s.lastIndexOf("/")+1,s.length),y.push({data:r,type:"image"});E=i.removeNbsp(E),y.push({data:E,type:"text"})}else g[b]=i.removeNbsp(g[b]),y.push({data:g[b],type:"text"});b!=g.length-1&&y.push("GAP")}var T=$(".rubric-text",h).html().trim(),N=[];T!=""&&(T=i.removeNbsp(T),N=[{data:T,type:"text"}]);var C={};_.each(d,function(t){var n=$(t).html(),r=parseInt($(t).parent().find(".optionBadge").html());C[n]=r,n&&e.push(n)});var k=_.unique(e);k=_.shuffle(k);var L=[],A=[];_.each(o,function(e){var t=k,n=t.map(function(e){return e.toUpperCase()}),r=n.indexOf(e.toUpperCase());L.push([r+1])}),_.each(k,function(e){e=i.removeNbsp(e),A.push({data:e,type:"text",usage:C[e]})}),QUIZ_EDITOR_CONSTANTS.QUES_ID&&(f.attributes.id=QUIZ_EDITOR_CONSTANTS.QUES_ID);var O=$(".metadata",h).html().trim();O=i.removeNbsp(O);var M=f.attributes;return M.answers=L,M.options=A,M.questionBody=y,M.rubric=N,M.title=u,M.metadata=O,f.attributes=M,f.attributes},b=function(e,t){var n,r,s,o;r=function(e){e.status===!0?a.trigger(AppEvent.QUESTION_CREATED,e.url):e.status===!1&&i.showToasterMessage(AppLang.QUESTION_SAVE_ERROR)},s=function(e){console.log(e)},o={url:QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID,success:r,error:s},c=t,c?(n="update",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/book/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"/question/"+QUIZ_EDITOR_CONSTANTS.QUES_ID):(n="create",f.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"question/sync/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID),v=_.uniq(v,function(e){return JSON.stringify(e)});var u={};u.title=f.get("title"),u.questionType=QUIZ_EDITOR_CONSTANTS.FIB_TAP_AND_PLACE_QUESTION_TYPE_ID,u.assetIds=v,u.questionsData=e,f.sync(n,u,o)},w=function(e){var t=[],n,r,s,o,u,a=null;s=$(e.target),o=s.prev().text(),u=$(".data-values-activity-fill","#question-option-Wrapper"),a=i.clone(f.get("options")),n=_.pluck(f.get("options"),"data"),r=_.indexOf(n,o),r>-1&&(_.each(n,function(e){t.push(e)}),_.each(u,function(e){var t=$(e);o.toLowerCase()===t.text().replace("/&nbsp;/gi","").trim().toLowerCase()&&t.after(" "+t.text()).remove()}),a.splice(r,1),f.set({options:a}))},E=function(){var e,r,i,s,o,u;i=_.map(f.get("options"),function(e){var t={};return t.optionText=e.data,t.usage=e.usage,t}),u=$(".option-list > .question-option.fib-option",h),u.empty(),_.each(i,function(e){s=_.template(t,{optionText:e.optionText,usage:e.usage}),u.append(s)}),$(".option-text").html("");var a=_.template(n);u.append(a)},S=function(e,t){var n=[],r,s=null,o=null;r=i.clone(f.get("options")),s=_.find(r,function(t,n){if(t.data.toLowerCase()==e.toLowerCase())return o=n,t});if(s)return o!=null&&t===!0?i.showToasterMessage(AppLang.OPTION_ALREADY_EXIST):o!=null&&t===!1&&(r[o].usage=(parseInt(r[o].usage)+1).toString(),x(r)),!1;_.each(r,function(e){n.push(e)}),t?n.push({data:e,type:"text",usage:"0"}):n.push({data:e,type:"text",usage:"1"}),f.set({options:n})},x=function(e){f.set({options:e})},T=function(e){var t,n;t=$(".option-text",e.target.parentNode),n=t.text().replace("/&nbsp;/gi","").trim(),n.length>0&&S(n,!0)},N=function(e,t){var n=[],r,i,s;i=$(t),s=i.text().replace("/&nbsp;/gi","").trim(),s.length>0&&S(s,!1)},C=function(e){if($(e.target).parent().hasClass("data-values-activity-fill")){var t=$(e.target).parent().text(),n=null;$(e.target).parent().after(" "+t).remove();var r=i.clone(f.get("options")),s=_.find(r,function(e,r){if(e.data.toLowerCase()==t.toLowerCase())return n=r,e});r[n].usage==="0"?r.splice(n,1):r[n].usage=(parseInt(r[n].usage)-1).toString(),f.set({options:r})}},k=function(e){parseInt($(".question-title").text().length)>=QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&e.preventDefault()},L=Backbone.View.extend({events:{"click .addOptionIcon":T,"click #option-list-wrapper .option-selected > .remove-option":w,"click .data-values-activity-fill > .remove-option":C,"keypress .question-title":k},initialize:function(e){a=this,_options=e||{},u=_options.el},fetchData:g,syncData:b,handleDoneClick:y});return new L(o)};return o}),define("com/es/quizEditor/models/MediaAssetPopupModel",[],function(){var e=Backbone.Model.extend({defaults:{id:"",assetThumbnailURL:"",assetName:""}});return e}),define("com/es/quizEditor/collections/MediaAssetPopupCollection",["com/es/quizEditor/models/MediaAssetPopupModel"],function(e){var t=Backbone.Collection.extend({model:e,url:""});return t}),define("com/es/text!templateBasePath/Editor/quiz/MediaAssestSelectionPopup.html",[],function(){return'	\n	<div class="assest-browse-gal-popup  browse-popup" id="mediaAssetSelection" style="display: none;">\n\n		<div class="widget-header">\n			<h2 class="float-left"><%=AppLang.SELECT_IMAGE_LABLE%></h2>\n			<span id="closeBrowseGalPopup" class="icon-close-asset float-right"></span>\n		</div>			\n\n		<div id="assetFillByAjaxForGallery" class="widget-content-asset">\n            <ul>            \n            \n                <% _.each(collection, function(item, i){ %>\n                    <li class="">\n                        <div class="inline-block each-item">\n                            <div class="thumbnail-image" title="">\n                            	<img src=<%=item.assetThumbnailURL%> data-id=<%=item.id%> >\n                                <span class="selection-tick"></span>\n                            </div>                           \n                            <div class="thumbnail-text"><%=item.assetName%></div>\n                            </div>\n                    </li>\n                <% }); %>               \n            </ul>\n		</div>\n\n		<div class="form-footer">\n			<input type="button" value="<%=AppLang.ADD_TEXT%>" class="form-button" onclick=""  id="mediaAssetSelected"/>\n		</div>\n\n	</div>\n    '}),define("com/es/quizEditor/views/MediaAssestPopupView",["com/es/text!templateBasePath/Editor/quiz/MediaAssestSelectionPopup.html","com/es/utilities/utils"],function(e,t){var n=Backbone.View.extend({initialize:function(e){this.options=e.opt||{},this.el=this.options.container,this.render()},render:function(t){var n=this,r={collection:this.collection},i=_.template(e);$(".activity-container",this.el).length>0?$(".activity-container",this.el).append(i(r)):this.options.container.append(i(r)),$("#closeBrowseGalPopup").off(AppEvent.CLICK).on(AppEvent.CLICK,n._hidePopup),$(this.el).on(AppEvent.CLICK,".mediaTestBtn",n._showPopup),$("li",$(".widget-content-asset")).off(AppEvent.CLICK).on(AppEvent.CLICK,n._selectImage),$("#mediaAssetSelected").off(AppEvent.CLICK).on(AppEvent.CLICK,n._mediaAssetSelected.bind(n)),$(this.el).on(AppEvent.CLICK,".resetAssetSelection",n._clearSelectedImg),$("#mediaAssetSelected").prop("disabled",!0).css("opacity",.3),$("#mediaAssetSelection").on("shown.bs.modal",function(){_.delay(function(){$("body").css("overflow","hidden")},500)}),$("#mediaAssetSelection").on("hidden.bs.modal",function(){$("body").css("overflow","auto")})},_hidePopup:function(e){var t=this;e.stopPropagation(),$("li",$(".widget-content-asset")).removeClass("active-file"),$("#mediaAssetSelection").modal("hide");if(CKEDITOR)for(i=1;i<=Object.keys(CKEDITOR.instances).length;i++)$("#cke_editor"+i).css("opacity","1"),$("#cke_editor"+i).css("display")==="block"&&$("#cke_editor"+i).css("display","block!important")},_showPopup:function(e){var t=this;e.stopPropagation(),$("#mediaAssetSelection").modal("show")},_selectImage:function(e){e.stopPropagation(),$("li",$(".widget-content-asset")).removeClass("active-file"),$(this).toggleClass("active-file"),$("#mediaAssetSelected").prop("disabled",!1).css("opacity",1)},_mediaAssetSelected:function(e){e.stopPropagation(),$(".leftCol",this.el).length>0?this._removeText():$(".group").length>0?this._removeText():$(".option-text.mcqBinaryEditView").length>0?$(this.editor.element.$).hasClass("question-text")?this._createAndInsertImage():this._removeText():this._createAndInsertImage(),$("#mediaAssetSelection").modal("hide"),$("li",$(".widget-content-asset")).removeClass("active-file");if(CKEDITOR)for(i=1;i<=Object.keys(CKEDITOR.instances).length;i++)$("#cke_editor"+i).css("opacity","1"),$("#cke_editor"+i).css("display")==="block"&&$("#cke_editor"+i).css("display","block!important")},_removeText:function(){if($(this.editor.element.$).children().length==0&&$(this.editor.element.$).html().length==0)this._createAndInsertImage();else if($(this.editor.element.$).children().length==0&&$(this.editor.element.$).html().length!=0){$(this.editor.element.$).html("");var e=$(".active-file");if(!(e.length>0))return;this._createAndInsertImage()}else $(this.editor.element.$).children().length!=0&&$(this.editor.element.$).html().length!=0&&($(this.editor.element.$).html(""),this._createAndInsertImage())},_createAndInsertImage:function(){var e=$(".active-file"),t=e.find("img").get(0).src,n=t.substr(t.lastIndexOf("/")+1,t.length),r=$(e.find("img").get(0)).attr("data-id"),i='<img src="'+t+'" class="question-image" data-id="'+r+'"/>';if($(".activity-container",this.el).length>0){var s=CKEDITOR.dom.element.createFromHtml(i);this.editor.insertElement(s)}else $(".posterImageName").html(n),$(".posterImagePreview img").attr("src",t)},_clearSelectedImg:function(e){e.target.parentNode.remove()},assetAdd:function(e,t){$("#mediaAssetSelected").prop("disabled",!0).css("opacity",.3),this.editor=t}});return n}),define("com/es/quizEditor/views/previewPopupView",["com/es/widgets/WidgetPopup","com/es/widgets/assessment/view/assesmentWidget","com/es/widgets/WidgetUtils"],function(e,t,n){var r=function(e){$.fn.QAappend=function(e){var t=n.getAndroidVersion(),r=navigator.userAgent.toLowerCase(),i=r.match(/(iPad|iPhone|iPod)/i);t>=4.4||i?($("#QAPlaceHolder")[0].innerHTML=e,this.append($("#QAPlaceHolder").children()[0])):this.append(e)},$.fn.QAprepend=function(e){var t=n.getAndroidVersion(),r=navigator.userAgent.toLowerCase(),i=r.match(/(iPad|iPhone|iPod)/i);t>=4.4||i?($("#QAPlaceHolder")[0].innerHTML=e,this.prepend($("#QAPlaceHolder").children()[0])):this.prepend(e)};var r=null,i=null,s=null,o=null,u=function(){s=$(".preview-container"),a()},a=function(){var e={dataURL:i.dataURL};o=new t({directLaunch:!0,editPreview:!0,options:e,popupView:s}),o.on(WIDGET_EVENTS.INITIALIZED,f)},f=function(e){e.launch()},l=function(){o.destroy(),o.remove(),o=null,r.trigger(WIDGET_EVENTS.DESTROYED,r)},c=Backbone.View.extend({initialize:function(e){i=e||{},r=this,u()},destroy:l});return new c(e)};return r}),define("com/es/quizEditor/models/QuizEditorModel",[],function(){var e=Backbone.Model.extend({defaults:{title:"",testid:"",questionsData:[{id:null,answers:[],heading:[],leftCol:[],modelParagraph:"",options:[],optionsLayout:"",questionBody:[],questionLayout:"",responseType:"BUTTON",rightCol:[],rubric:[],questionMedia:[],optionsMedia:[],title:"",maxpoints:[""],type:""}]},url:function(){return"./com/es/quizEditor/data/MCQ_DefaultQuestionData.json"},sync:function(){options||(options={});switch(method){case"create":break;case"update":break;case"delete":break;case"read":}}});return e}),define("com/es/quizEditor/QuizEditor",["com/es/quizEditor/QuizEditorConstants","com/es/text!templateBasePath/Editor/quiz/baseTemplate.html","com/es/text!templateBasePath/Editor/popups/popUpTemplate.html","com/es/quizEditor/views/FIBDropDownEditView","com/es/quizEditor/views/FIBEditView","com/es/quizEditor/views/MCQEditView","com/es/quizEditor/views/MCQBinaryEditView","com/es/quizEditor/views/MatchingEditView","com/es/quizEditor/views/GroupingEditView","com/es/quizEditor/views/FIBTapPlaceEditView","com/es/utilities/utils","com/es/quizEditor/collections/MediaAssetPopupCollection","com/es/quizEditor/views/MediaAssestPopupView","com/es/quizEditor/views/previewPopupView","com/es/quizEditor/models/QuizEditorModel"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=function(){var e,v,m,g=null,y=null,b=null,w=null,E="",S=!1,x=null,T=null,N=null,C="",k=function(e,l,p){E=p,e=parseInt(e);var d=_.template(t,{});l.append(d),l.append(_.template(n)),m=$(".quiz-editor-popup",$(l)),v={container:m,el:m,url:p,type:e};switch(e){case QUIZ_EDITOR_CONSTANTS.MCQ_SINGLE_RESPONSE_QUESTION_TYPE_ID:case QUIZ_EDITOR_CONSTANTS.MCQ_MULTIPLE_RESPONSE_QUESTION_TYPE_ID:g=new s(v);break;case QUIZ_EDITOR_CONSTANTS.FIB_TEXT_QUESTION_TYPE_ID:g=new i(v),$(CKEDITOR).unbind(AppEvent.FIB_ANSWER_ADDED).bind(AppEvent.FIB_ANSWER_ADDED,g.fibAnswerAdded.bind(g));break;case QUIZ_EDITOR_CONSTANTS.FIB_DROP_DOWN_QUESTION_TYPE_ID:g=new r(v),$(CKEDITOR).unbind(AppEvent.FIB_ANSWER_ADDED).bind(AppEvent.FIB_ANSWER_ADDED,g.fibAnswerAdded.bind(g));break;case QUIZ_EDITOR_CONSTANTS.TRUE_OR_FALSE_QUESTION_TYPE_ID:g=new o(v);break;case QUIZ_EDITOR_CONSTANTS.MATCHING_QUESTION_TYPE_ID:g=new u(v);break;case QUIZ_EDITOR_CONSTANTS.GROUPING_QUESTION_TYPE_ID:g=new a(v);break;case QUIZ_EDITOR_CONSTANTS.FIB_TAP_AND_PLACE_QUESTION_TYPE_ID:g=new f(v);break;default:}g.on("render_complete",D($(".quiz-editor-popup"))),g.on(AppEvent.OPTION_ADDED,M),g.fetchData(v.url),g.on(AppEvent.QUESTION_CREATED,O),$(".activity-container").on("paste",L),_.delay(function(){w=new c,w.url=QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL+"assets/"+QUIZ_EDITOR_CONSTANTS.BOOK_ID+"?type=1";var e={success:function(e){var t=e.toJSON();b=new h({collection:t,opt:v}),$(CKEDITOR).unbind(AppEvent.ADD_ASSET).bind(AppEvent.ADD_ASSET,b.assetAdd.bind(b))},error:function(e){console.log("error in fetching media asset data")}};w.fetch(e)},500)},L=function(e){e.preventDefault();var t=undefined;window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.originalEvent.clipboardData&&e.originalEvent.clipboardData.getData&&(t=e.originalEvent.clipboardData.getData("text/plain"),e.originalEvent.clipboardData.setData("text/plain",""));if(t){t="<span>"+t+"</span>";var n=l.removeNbsp($(t.toString()).text()),r=$(e.target).text();A(n,$(e.target))}},A=function(e,t){var n,r;t.hasClass("question-title")&&e.length>QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&(e=e.substr(0,QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH));if(window.getSelection){n=window.getSelection();if(n.getRangeAt&&n.rangeCount){r=n.getRangeAt(0),r.deleteContents();var i=document.createElement("span");i.innerHTML=e;var s=document.createDocumentFragment(),o,u;while(o=i.firstChild)u=s.appendChild(o);r.insertNode(s),u&&(r=r.cloneRange(),r.setStartAfter(u),r.collapse(!0),n.removeAllRanges(),n.addRange(r))}}else document.selection&&document.selection.type!="Control"&&document.selection.createRange().pasteHTML(e);var a=$(".question-title").text();parseInt(a.length)>QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH&&$(".question-title").text(a.substr(0,QUIZ_EDITOR_CONSTANTS.MAX_TITLE_LENGTH))},O=function(e){E=e,S?F():$(window).trigger(AppEvent.QUESTION_CREATED)},M=function(e){D(e)},D=function(e){_.delay(function(){e.hasClass("quiz-editor-popup")&&_.each(CKEDITOR.instances,function(e){e.destroy()});var t=$(e).find("div[contenteditable=true]").filter(".question-text, .option-text, .question-option, .leftCol, .rightCol, .option");_.delay(function(e){_.each(t,function(e){var t=P(e);CKEDITOR.inline(e,t)})},200)},500)},P=function(e){var t={enterMode:CKEDITOR.ENTER_BR,shiftEnterMode:CKEDITOR.ENTER_P,allowedContent:!0};return $(e).hasClass("fib-option")&&(t.extraPlugins="fib"),$(e).hasClass("fib-dropdown")&&(t.extraPlugins="fib"),t.extraPlugins?$(e).hasClass("add-img")&&(t.extraPlugins=t.extraPlugins+","+"add_img"):$(e).hasClass("add-img")&&(t.extraPlugins="add_img"),t},H=function(){var e=g.handleDoneClick();if(e){e=JSON.parse(JSON.stringify(e).replace("​",""));var t=new d;t.attributes.questionsData[0]=e,e.title&&(t.attributes.title=e.title,C=e.title),t.attributes.testid||(t.attributes.testid="quiz_"+e.id),t.attributes.quesType||(t.attributes.quesType=N),T=t.attributes,g.syncData(t.attributes,E)}},B=function(){l.showConfirmPopUp(AppLang.SAVE_WIDGET_CONFIMATION_MESSAGE,"Confirm",["cancel"],function(e){if(e.toLowerCase()!=="yes")return;m.modal("hide")})},j=function(){S=!0,H()},F=function(){$("#editBtn").removeClass("active"),$("#previewBtn").addClass("active"),$(".activity-container").hide(),$(".preview-container-title").html(C),$(".preview-container-title").show(),$(".preview-container").show();var e={dataURL:E};y=new p(e),y.on(WIDGET_EVENTS.DESTROYED,q),S=!1},I=function(){$("#previewBtn").removeClass("active"),$("#editBtn").addClass("active"),$(".preview-container-title").hide(),$(".preview-container").hide(),$(".preview-container-title").html(""),y.destroy(),$(".activity-container").show()},q=function(){y.remove(),y=null},R=function(){b.remove(),g.remove(),g=null,_.each(CKEDITOR.instances,function(e){e.destroy()}),$(CKEDITOR).unbind(AppEvent.FIB_ANSWER_ADDED)},U=Backbone.View.extend({events:{"click .quiz-editor-popup .doneBtn":H,"click .quiz-editor-popup .cancelBtn":B,"click .quiz-editor-popup #previewBtn":j,"click .quiz-editor-popup #editBtn":I},initialize:function(){QUIZ_EDITOR_CONSTANTS.ROOT_URL=location.href.split("#")[0],QUIZ_EDITOR_CONSTANTS.ROOT_PATH=window.location.pathname.split("/")[1];var e=this.getURlQueryStringParams()},getURlQueryStringParams:function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++)t=n[r].split("="),e.push(t[0]),e[t[0]]=t[1];return e},init:function(e){var t=this;QUIZ_EDITOR_CONSTANTS.SERVICE_BASE_URL=e.baseServiceURL,QUIZ_EDITOR_CONSTANTS.BOOK_ID=e.bookId,$.getScript("QA/com/external/ckeditor/ckeditor.js",function(){var n=location.href.split("#")[0],r=window.location.pathname.split("/")[1],i=window.location.origin+"/"+r+"/QA/com/external/ckeditor/";CKEDITOR.basePath=i;var s=e.quesType,o=e.QuesContainer,u=e.url,a=e.quesId;e.quesId?QUIZ_EDITOR_CONSTANTS.QUES_ID=e.quesId:QUIZ_EDITOR_CONSTANTS.QUES_ID="",e.url&&(QUIZ_EDITOR_CONSTANTS.QUESTION_ASSET_BASE_PATH=e.url.substr(0,e.url.lastIndexOf("/")+1)),N=s,k(s,o,u),t.setElement(o)})}});return new U};return window.QuizEditor=new v,window.QuizEditor}),require(["main-config","com/es/widgets/WidgetConstants","com/es/app","com/es/controllers/router","com/es/utilities/AppConst","com/es/utilities/AppEvent","com/es/utilities/AppLang","com/es/widgets/WidgetLang","com/es/glossary/GlossaryEditor","com/es/quizEditor/QuizEditor"],function(e,t,n,r,i,s,o,u){app=new n,r.initialize(app),$(window).trigger("qa_ready")}),define("com/es/main",function(){});